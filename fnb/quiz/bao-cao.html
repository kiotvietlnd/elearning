<!DOCTYPE html><html lang="vi"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KiotViet Learning App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        /* CSS CORE */
        body { font-family: 'Inter', sans-serif; background-color: #e2e8f0; overflow: hidden; touch-action: manipulation; display: flex; justify-content: center; align-items: center; height: 100vh; background-image: radial-gradient(#cbd5e1 1px, transparent 1px); background-size: 20px 20px; }
        #mobile-frame { width: 100%; height: 100%; background: #fff; position: relative; overflow: hidden; display: flex; flex-direction: column; }
        @media (min-width: 768px) { #mobile-frame { width: 100%; max-width: 1024px; height: 92vh; border-radius: 24px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15); border: 1px solid #cbd5e1; } ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; } }
        #app-container { position: relative; width: 100%; height: 100%; overflow: hidden; flex: 1; padding-bottom: 80px; }
        .slide { position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: center; items-center; padding: 1rem; opacity: 0; pointer-events: none; transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); transform: translateX(50px) scale(0.95); }
        .slide.active { opacity: 1; pointer-events: auto; transform: translateX(0) scale(1); z-index: 10; }
        .inner-content { width: 100%; width: 100%; max-height: 100%; overflow-y: auto; padding: 10px 5px; border-radius: 1rem; scroll-behavior: smooth; }
        .inner-content::-webkit-scrollbar { width: 4px; }
        .inner-content::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 2px; }
        .perspective-1000 { perspective: 1000px; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .card-inner.flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; inset: 0; backface-visibility: hidden; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); background-color: white; }
        .card-back { transform: rotateY(180deg); }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
        .animate-shake { animation: shake 0.4s ease-in-out; }
        .soft-bg { background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); }
        .chat-bubble { max-width: 90%; padding: 14px 20px; border-radius: 16px; font-size: 1rem; line-height: 1.6; box-shadow: 0 2px 4px rgba(0,0,0,0.05); animation: popIn 0.3s ease-out backwards; }
        .chat-bubble-customer { background: white; border: 1px solid #e2e8f0; border-top-left-radius: 4px; margin-right: auto; }
        .chat-bubble-consultant { background: #eff6ff; border: 1px solid #bfdbfe; color: #1e40af; border-top-right-radius: 4px; margin-left: auto; }
        @keyframes popIn { 0% { opacity: 0; transform: scale(0.9) translateY(10px); } 100% { opacity: 1; transform: scale(1) translateY(0); } }
        #sidebar { transition: transform 0.3s ease; }
        .sidebar-closed { transform: translateX(-100%); }
        .sidebar-open { transform: translateX(0); }
        #dl-loading { position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); z-index: 9999; color: white; }
        #dl-loading:not(.hidden) { display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .bottom-nav-btn { position: absolute; bottom: 20px; width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); transition: all 0.2s; z-index: 50; cursor: pointer; border: none; opacity: 0.8; background: white; color: #64748b; border: 1px solid #e2e8f0; }
        .bottom-nav-btn:hover { opacity: 1; background: #f8fafc; color: #3b82f6; }
        .bottom-nav-btn:active { transform: scale(0.9); }
        .bottom-nav-btn:disabled { opacity: 0.3; cursor: not-allowed; background: #f1f5f9; color: #cbd5e1; box-shadow: none; }
        #btn-prev { left: 20px; } #btn-next { right: 20px; }
        /* Concept Card & Infographic Styles */
        .concept-card-single { width: 100%; max-width: 900px; background: white; border-radius: 1.5rem; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); overflow: hidden; border: 1px solid #e2e8f0; display: flex; flex-direction: column; }
        .concept-header-single { padding: 1.5rem; display: flex; align-items: center; gap: 1rem; border-bottom: 1px solid #f1f5f9; flex-shrink: 0; }
        .concept-body-single { padding: 2rem; display: flex; flex-direction: column; gap: 1.25rem; flex: 1; overflow-y: auto; }
        .concept-item-single { display: flex; align-items: flex-start; gap: 0.75rem; font-size: 1.1rem; color: #334155; line-height: 1.6; }
        @media (min-width: 768px) { .concept-item-single { font-size: 1.25rem; } }
        .concept-item-single i { margin-top: 0.5rem; font-size: 0.6rem; color: #cbd5e1; }
        .comp-grid { display: grid; grid-template-columns: 1fr; gap: 1rem; }
        @media (min-width: 768px) { .comp-grid { grid-template-columns: 1fr 1fr; gap: 1.5rem; } }
        .comp-col { display: flex; flex-direction: column; gap: 1rem; }
        .comp-item { display: flex; flex-direction: column; padding: 1rem; border-radius: 12px; border: 1px solid; height: 100%; }
        .comp-item-prob { background-color: #fef2f2; border-color: #fecaca; }
        .comp-item-sol { background-color: #eff6ff; border-color: #bfdbfe; }
        .comp-label { font-size: 0.75rem; font-weight: 800; text-transform: uppercase; margin-bottom: 0.5rem; letter-spacing: 0.05em; }
        .prob-label { color: #ef4444; }
        .sol-label { color: #3b82f6; }
        .comp-text { font-size: 0.95rem; font-weight: 500; color: #1e293b; line-height: 1.4; }
    </style></head><body>
    <div id="mobile-frame">
        <header class="h-14 bg-white border-b border-slate-200 flex items-center justify-between px-4 z-50 flex-shrink-0 shadow-sm relative">
            <div class="flex items-center gap-4 z-10">
                <button onclick="toggleSidebar()" class="text-slate-500 hover:text-blue-600 w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-50 transition"><i class="fa-solid fa-bars text-xl"></i></button>
                <button onclick="toggleMute()" id="btn-mute" class="text-slate-400 hover:text-blue-600 w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-50 transition" title="Bật/Tắt âm thanh"><i class="fa-solid fa-volume-high text-lg"></i></button>
                <div class="flex flex-col"><span id="header-section-title" class="text-xs font-bold text-blue-600 uppercase tracking-wide hidden md:block">Tổng quan</span><div class="flex items-center gap-1"><span id="slide-indicator" class="text-[10px] text-slate-400 font-medium">1/--</span></div></div>
            </div>
            <div class="flex items-center gap-2 z-10"><img src="https://logo.kiotviet.vn/KiotViet-Logo-Horizontal.svg" alt="KiotViet" class="h-6 md:h-8 opacity-100"></div>
            <div class="absolute bottom-0 left-0 w-full h-0.5 bg-slate-100"><div id="progress-bar" class="h-full bg-blue-600 transition-all duration-300" style="width: 0%"></div></div>
        </header>
        <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/20 z-40 hidden transition-opacity" style="position:absolute;"></div>
        <aside id="sidebar" class="absolute inset-y-0 left-0 z-50 w-64 bg-white shadow-2xl sidebar-closed flex flex-col h-full">
            <div class="p-4 border-b border-slate-100 flex items-center justify-center bg-slate-50 relative">
                <img src="https://logo.kiotviet.vn/KiotViet-Logo-Horizontal.svg" alt="Logo" class="h-6">
                <button onclick="toggleSidebar()" class="absolute right-4 text-slate-400 hover:text-red-500"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto p-2 space-y-1" id="sidebar-content"></div>
        </aside>
        <main id="app-container" class="soft-bg relative"></main>
        <button onclick="navSlide(-1)" id="btn-prev" class="bottom-nav-btn"><i class="fa-solid fa-arrow-left text-xl"></i></button>
        <button onclick="navSlide(1)" id="btn-next" class="bottom-nav-btn"><i class="fa-solid fa-arrow-right text-xl"></i></button>
    </div>
    <div id="dl-loading" class="hidden"><i class="fa-solid fa-circle-notch fa-spin text-4xl mb-3"></i><p class="font-bold">Đang tạo chứng nhận...</p></div>

    <template id="tpl-title">
        <div class="slide">
            <div class="text-center max-w-lg md:max-w-4xl animate-fade-in-up w-full px-4 mx-auto">
                <div class="w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6 text-blue-600 text-5xl shadow-sm border-4 border-white">
                    <i class="slide-icon"></i>
                </div>
                <h2 class="text-2xl md:text-4xl font-black text-blue-800 mb-2 slide-title leading-tight"></h2>
                <p class="text-lg md:text-xl font-bold text-blue-600 mb-3 slide-subtitle hidden"></p>
                <p class="text-slate-500 slide-desc text-sm md:text-lg">Bài học tương tác</p>
                <div class="mt-8">
                    <button onclick="navSlide(1)" class="bg-blue-600 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-blue-700 active:scale-95 transition text-sm md:text-base md:px-10 md:py-4">Bắt đầu ngay <i class="fa-solid fa-arrow-right ml-2"></i></button>
                </div>
            </div>
        </div>
    </template>

    <template id="tpl-intro"><div class="slide"><div class="text-center max-w-lg md:max-w-2xl animate-fade-in-up w-full px-4 mx-auto"><div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 text-green-600 text-4xl shadow-sm border-4 border-white"><i class="fa-solid fa-hand-sparkles"></i></div><h2 class="text-2xl md:text-3xl font-black text-slate-800 mb-4 intro-title">Chào mừng bạn!</h2><div class="bg-white p-6 md:p-8 rounded-2xl shadow-sm border border-slate-100 text-left space-y-4"><p class="text-slate-600 text-sm md:text-base leading-relaxed">Chào mừng bạn đến với học phần <span class="font-bold text-blue-600 course-name-span"></span>.</p><p class="text-slate-600 text-sm md:text-base leading-relaxed">Bên cạnh việc tự học qua <b>Tài liệu</b> và <b>Video Hướng dẫn sử dụng</b>, ứng dụng này mang đến một phương pháp học tập tương tác mới giúp bạn:</p><ul class="list-none space-y-3 mt-2"><li class="flex items-start gap-3 text-slate-700 text-sm md:text-base"><i class="fa-solid fa-check-circle text-green-500 mt-1"></i><span><b>Hệ thống hóa</b> kiến thức sản phẩm một cách logic.</span></li><li class="flex items-start gap-3 text-slate-700 text-sm md:text-base"><i class="fa-solid fa-check-circle text-green-500 mt-1"></i><span>Làm quen với các <b>tình huống giả định</b> thực tế.</span></li><li class="flex items-start gap-3 text-slate-700 text-sm md:text-base"><i class="fa-solid fa-check-circle text-green-500 mt-1"></i><span>Nhận diện và xóa bỏ các <b>lầm tưởng thường gặp</b>.</span></li><li class="flex items-start gap-3 text-slate-700 text-sm md:text-base"><i class="fa-solid fa-check-circle text-green-500 mt-1"></i><span>Hiểu rõ sự thật để <b>tư vấn khách hàng</b> hiệu quả nhất.</span></li></ul></div></div></div></template>
    <template id="tpl-concept-single"><div class="slide"><div class="inner-content w-full px-4 flex flex-col items-center justify-center h-full"><div class="concept-card-single animate-fade-in-up"><div class="concept-header-single header-color-bg"><div class="w-12 h-12 rounded-full bg-white flex items-center justify-center shadow-md text-xl icon-color"><i class="concept-icon"></i></div><h3 class="text-xl font-bold text-slate-800 concept-card-title"></h3></div><div class="concept-body-single"></div></div></div></div></template>
    <template id="tpl-chat"><div class="slide"><div class="inner-content flex flex-col justify-center h-full w-full"><div class="space-y-6 chat-container w-full px-2 max-w-5xl mx-auto"></div></div></div></template>

    <template id="tpl-card">
        <div class="slide">
            <div class="w-full h-full flex items-center justify-center p-4">
                <div class="w-full max-w-[320px] aspect-[3/4] perspective-1000 relative">
                    <div class="card-inner duration-500 w-full h-full shadow-2xl rounded-2xl relative">
                        <div class="card-face bg-white border-2 border-slate-100 p-6 flex flex-col justify-between items-center text-center">
                            <div class="hidden card-id">#</div>
                            <div class="flex-1 flex flex-col justify-center w-full">
                                <p class="text-xs text-slate-400 font-bold uppercase mb-4 tracking-widest">Nhận định</p>
                                <h3 class="text-lg font-medium text-slate-800 leading-snug card-question mb-6"></h3>
                                <div class="grid grid-cols-2 gap-3 w-full mt-auto">
                                    <button class="btn-true py-3 bg-green-50 text-green-600 border border-green-200 rounded-xl font-bold hover:bg-green-100 transition active:scale-95 shadow-sm text-sm"><i class="fa-solid fa-check mr-1"></i> ĐÚNG (1)</button>
                                    <button class="btn-false py-3 bg-red-50 text-red-600 border border-red-200 rounded-xl font-bold hover:bg-red-100 transition active:scale-95 shadow-sm text-sm"><i class="fa-solid fa-xmark mr-1"></i> SAI (2)</button>
                                </div>
                            </div>
                        </div>
                        <div class="card-face card-back p-6 flex flex-col text-center">
                            <div class="flex flex-col h-full overflow-y-auto">
                                <div class="mb-4">
                                    <div class="result-header text-lg font-bold flex items-center justify-center gap-2"></div>
                                </div>
                                <div class="text-left bg-slate-50 p-3 rounded-lg border border-slate-100 mb-3">
                                    <p class="text-[10px] text-slate-400 font-bold uppercase mb-1">Nhận định:</p>
                                    <p class="text-xs text-slate-600 italic card-original-q"></p>
                                </div>
                                <div class="text-left mb-3 bg-white border border-slate-100 p-2 rounded-lg shadow-sm">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="text-[10px] font-bold uppercase text-slate-500">Phương án bạn chọn:</span>
                                        <span class="text-xs font-bold user-choice-label"></span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-[10px] font-bold uppercase text-slate-500">Đáp án chính xác:</span>
                                        <span class="text-xs font-bold correct-ans-label"></span>
                                    </div>
                                </div>
                                <div class="text-left flex-1">
                                    <p class="text-[10px] text-blue-600 font-bold uppercase mb-1"><i class="fa-solid fa-lightbulb mr-1"></i> Sự thật là:</p>
                                    <p class="text-sm text-slate-700 font-medium leading-relaxed card-right-answer"></p>
                                </div>
                                <button class="btn-reset mt-auto text-xs uppercase tracking-wider p-3 rounded-xl border border-blue-100 bg-white text-blue-900 font-bold hover:bg-blue-50 transition shadow-sm"><i class="fa-solid fa-rotate-left mr-1"></i> Xem lại (0)</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="tpl-comparison"><div class="slide"><div class="inner-content w-full px-1 h-full flex flex-col"><div class="text-center mb-4 pt-2"><span class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest">Tổng kết</span><h3 class="text-lg font-bold text-slate-800 mt-2">Sự thật vs Lầm tưởng</h3><p class="text-[10px] text-slate-400 mt-1 italic">(Sử dụng mũi tên Lên/Xuống để cuộn)</p></div><div class="flex-1 overflow-y-auto bg-white rounded-xl shadow-sm border border-slate-200 relative comparison-scroll-area max-w-4xl mx-auto w-full"><table class="w-full text-left border-collapse"><thead class="bg-slate-50 sticky top-0 z-10 shadow-sm"><tr><th class="p-3 text-[10px] font-bold uppercase text-red-500 w-1/2 border-b border-slate-200 border-r text-center">Lầm tưởng (Sai)</th><th class="p-3 text-[10px] font-bold uppercase text-green-600 w-1/2 border-b border-slate-200 text-center">Sự thật (Đúng)</th></tr></thead><tbody class="text-xs text-slate-700 divide-y divide-slate-100 comp-tbody"></tbody></table></div></div></div></template>
    <template id="tpl-game-start"><div class="slide"><div class="w-full h-full flex items-center justify-center p-4"><div class="bg-white p-6 md:p-8 rounded-3xl shadow-xl text-center w-full max-w-md border border-slate-100 mx-auto transition-all"><div class="inline-block p-4 rounded-full bg-orange-100 mb-4 animate-bounce"><i class="fa-solid fa-gamepad text-4xl text-orange-500"></i></div><h2 class="text-2xl font-black text-slate-800 mb-2">Quiz Game</h2><p class="text-sm text-slate-500 mb-6 italic px-4">Học xong mà không làm quiz ôn tập thì kiến thức đọng lại "Như muối bỏ bể", "Chớp mắt một cái" là quên luôn đấy!</p><div class="space-y-3 game-mode-buttons"></div></div></div></div></template>
    <template id="tpl-game-play"><div class="slide"><div class="w-full max-w-sm md:max-w-3xl p-4 md:p-8 mx-auto"><div class="flex justify-between items-center mb-6"><span class="text-xs md:text-lg font-bold text-slate-400">Nhận định <span class="game-q-current">1</span>/<span class="game-q-total">10</span></span><span class="text-xs md:text-lg font-bold text-green-600 bg-green-50 px-2 py-1 rounded border border-green-100">Điểm: <span class="game-score">0</span></span></div><div class="bg-white rounded-3xl shadow-lg border border-slate-100 p-6 md:p-12 min-h-[180px] md:min-h-[250px] flex items-center justify-center text-center mb-6 relative overflow-hidden"><h3 class="text-base md:text-2xl font-bold text-slate-800 game-question-text leading-relaxed"></h3></div><div class="grid grid-cols-2 gap-3 md:gap-6"><button onclick="answerGame(true)" class="game-btn btn-game-true py-4 md:py-8 rounded-2xl bg-white border-2 border-green-100 text-green-600 font-bold text-base md:text-2xl hover:bg-green-50 hover:border-green-500 transition active:scale-95 shadow-sm"><i class="fa-solid fa-check mr-1"></i> ĐÚNG (1)</button><button onclick="answerGame(false)" class="game-btn btn-game-false py-4 md:py-8 rounded-2xl bg-white border-2 border-red-100 text-red-600 font-bold text-base md:text-2xl hover:bg-red-50 hover:border-red-500 transition active:scale-95 shadow-sm"><i class="fa-solid fa-xmark mr-1"></i> SAI (2)</button></div></div></div></template>
    <template id="tpl-winner-input"><div class="slide"><div class="w-full h-full flex items-center justify-center p-4"><div class="bg-white p-8 rounded-3xl shadow-2xl text-center w-full max-w-md border border-blue-100 mx-auto"><div class="inline-block p-4 rounded-full bg-yellow-100 mb-4 animate-bounce"><i class="fa-solid fa-trophy text-4xl text-yellow-500"></i></div><h2 class="text-2xl font-black text-blue-900 mb-2">CHÚC MỪNG!</h2><p class="text-sm text-slate-600 mb-6">Bạn đã vượt qua bài kiểm tra với số điểm <span class="font-bold text-green-600 winner-score"></span>.<br>Vui lòng nhập thông tin để nhận chứng nhận.</p><div class="space-y-4 text-left"><div class="space-y-1"><label class="text-xs font-bold text-slate-500 uppercase ml-1">Họ và Tên</label><input type="text" id="input-winner-name" placeholder="Đỗ Hoàng Sơn" class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 outline-none text-slate-800 font-bold"></div><div class="space-y-1"><label class="text-xs font-bold text-slate-500 uppercase ml-1">Bộ phận / Phòng ban</label><input type="text" id="input-winner-dept" placeholder="LND... / TSHNI... / DSSGN... / Customer Service..." class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-blue-500 outline-none text-slate-800"></div><button onclick="submitWinnerInfo()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:bg-blue-700 active:scale-95 transition mt-2">Nhận chứng nhận <i class="fa-solid fa-arrow-right ml-2"></i></button></div></div></div></div></template>
    <template id="tpl-certificate"><div class="slide"><div class="inner-content flex flex-col items-center w-full px-2"><div id="cert-view" class="w-full aspect-[4/3] md:aspect-video bg-white shadow-xl flex overflow-hidden rounded-xl relative mb-6 border border-slate-200 max-w-sm md:max-w-3xl mx-auto"><div class="w-1/3 bg-blue-900 flex flex-col items-center justify-center text-white p-4 gap-4 relative"><i class="fa-solid fa-award text-4xl md:text-7xl text-yellow-400 mb-6 drop-shadow-md"></i><div class="text-center z-10"><p class="uppercase tracking-widest text-[8px] md:text-xs opacity-70 mb-2">Cấp bởi</p><p class="font-bold text-[10px] md:text-base tracking-wide">KiotViet LND</p></div><div class="absolute bottom-0 left-0 w-full h-1.5 bg-yellow-400"></div></div><div class="w-2/3 p-4 md:p-8 flex flex-col justify-center relative"><h1 class="text-lg md:text-3xl font-black text-blue-900 uppercase mb-2">GIẤY CHỨNG NHẬN</h1><p class="text-slate-500 italic text-[8px] md:text-sm mb-4 border-b border-slate-100 pb-2 cert-course-title"></p><div class="mb-4 flex flex-col justify-center"><p class="text-[8px] md:text-xs text-slate-400 uppercase font-bold tracking-wider mb-1">Học viên</p><h2 class="text-sm md:text-2xl font-bold text-blue-700 uppercase cert-name leading-normal py-1 truncate"></h2><p class="text-[8px] md:text-xs text-slate-500 font-medium cert-dept truncate mt-1 pb-2 leading-relaxed h-auto block"></p></div><div class="flex justify-between items-end mt-auto pt-4 border-t border-slate-50"><div><p class="text-[8px] md:text-xs text-slate-400 uppercase font-bold">Ngày cấp</p><p class="text-[9px] md:text-sm font-medium text-slate-600 cert-date"></p></div><div class="text-right"><p class="text-[8px] md:text-xs text-slate-400 uppercase font-bold">Điểm số</p><p class="text-lg md:text-3xl font-black text-green-600 cert-score"></p></div></div><div class="cert-fail-mark hidden absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 -rotate-12 text-2xl md:text-5xl font-black text-red-100 border-4 border-red-100 p-2 rounded-lg whitespace-nowrap">KHÔNG ĐẠT</div></div></div><div class="flex flex-col gap-3 w-full max-w-xs md:max-w-md"><button id="btn-download-cert" onclick="downloadCert()" class="w-full bg-blue-600 text-white border border-blue-600 px-6 py-3 rounded-xl font-bold hover:bg-blue-700 transition text-sm flex items-center justify-center gap-2 shadow-lg"><i class="fa-solid fa-download"></i> Tải chứng nhận</button><div class="grid grid-cols-2 gap-3"><button onclick="backToGameLogin()" class="bg-white border border-slate-200 text-slate-600 px-4 py-3 rounded-xl font-bold hover:bg-slate-50 transition text-sm"><i class="fa-solid fa-rotate-right mr-2"></i> Chơi lại (0)</button><button onclick="goToReview()" class="bg-indigo-50 border border-indigo-100 text-indigo-700 px-4 py-3 rounded-xl font-bold hover:bg-indigo-100 transition text-sm"><i class="fa-solid fa-list-check mr-2"></i> Xem chi tiết</button></div></div></div></template>
    <template id="tpl-game-review"><div class="slide"><div class="inner-content w-full px-2 h-full flex flex-col"><div class="text-center mb-6 pt-2"><h3 class="text-xl font-bold text-slate-800">Chi tiết kết quả</h3><p class="text-xs text-slate-500 mt-1">Bảng tổng hợp đáp án</p></div><div class="flex-1 overflow-y-auto w-full max-w-4xl mx-auto pb-4"><table class="w-full text-left border-collapse rounded-xl overflow-hidden shadow-sm border border-slate-200"><thead class="bg-slate-50 text-slate-600 text-xs uppercase font-bold sticky top-0 shadow-sm"><tr><th class="p-4 w-1/2">Nhận định</th><th class="p-4 w-1/4 text-center">Đáp án chính xác</th><th class="p-4 w-1/4 text-center">Đáp án bạn chọn</th></tr></thead><tbody class="text-sm bg-white divide-y divide-slate-100 review-tbody"></tbody></table></div></div></div></template>
    <template id="tpl-end-course"><div class="slide"><div class="w-full h-full flex items-center justify-center p-4 text-center"><div class="bg-white p-8 rounded-3xl shadow-xl w-full max-w-2xl border border-blue-50 relative overflow-hidden"><div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-400 to-indigo-500"></div><div class="inline-block p-5 rounded-full bg-yellow-100 mb-6 animate-pulse"><i class="fa-solid fa-star text-5xl text-yellow-500"></i></div><h2 class="text-2xl md:text-3xl font-black text-slate-800 mb-4 end-course-title">Chúc mừng bạn đã hoàn thành học phần <span class="text-blue-600 course-name-end"></span>!</h2><p class="text-slate-600 text-sm md:text-base leading-relaxed mb-6 px-4">Nếu bạn đang tham gia khóa học trên hệ thống LMS, bạn có thể đóng ứng dụng E-Learning và đừng quên <span class="font-bold text-blue-700">làm nhiệm vụ trên LMS</span> để xác nhận hoàn thành học phần nhé!</p><div class="grid grid-cols-2 gap-3 w-full max-w-xl mx-auto mb-6"><button onclick="goToOverview()" class="bg-white border border-blue-200 text-blue-700 px-4 py-3 rounded-xl font-bold hover:bg-blue-50 transition text-sm"><i class="fa-solid fa-book-open mr-2"></i> Xem Cẩm nang</button><button onclick="goToComparison()" class="bg-purple-50 border border-purple-100 text-purple-700 px-4 py-3 rounded-xl font-bold hover:bg-purple-100 transition text-sm"><i class="fa-solid fa-table-columns mr-2"></i> Xem Bảng so sánh</button></div><div class="border-t border-slate-100 pt-6"><p class="text-slate-700 font-bold mb-1">Chúc bạn có trải nghiệm học tập hiệu quả và vui vẻ!</p><p class="text-slate-400 text-xs italic">From LND Team with <i class="fa-solid fa-heart text-red-400 mx-1"></i></p></div></div></div></div></template>
    <template id="tpl-video"><div class="slide"><div class="inner-content w-full px-2 flex flex-col items-center justify-center h-full"><div class="w-full max-w-4xl bg-black rounded-xl overflow-hidden shadow-xl aspect-video relative border-4 border-slate-200"><iframe class="w-full h-full video-iframe" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div></div></div></template>
    <template id="tpl-image"><div class="slide"><div class="inner-content w-full px-0 h-full flex flex-col justify-center items-center"><img src="" class="w-full h-auto max-h-full object-contain img-content shadow-lg rounded-lg"></div></div></template>
    <script>
        // --- 1. DATA CONFIG (AI SẼ ĐIỀN VÀO ĐÂY) ---
        const lessonData = {
    courseTitle: "Báo cáo",
    courseSubtitle: "Ngành Ăn uống, Giải trí",
    courseIcon: "fa-solid fa-chart-line",
    mediaModules: [
        { type: 'video', title: 'Video hướng dẫn', src: 'https://www.youtube.com/embed/UvXXsyd-W0U' },
        { type: 'image', title: 'Infographic', src: 'https://cdn-kvweb.kiotviet.vn/kiotviet-website/wp-content/uploads/2025/12/05044816/BAO-CAO-BAO-CAO.jpg' }
    ],
    overviewModules: [
        {
            type: 'concept',
            title: 'Giới thiệu chung',
            data: [
                {
                    title: 'Lợi ích tổng quan',
                    icon: 'fa-solid fa-info-circle',
                    color: 'blue',
                    bullets: [
                        "Khi sử dụng KiotViet, chủ cửa hàng có thể nắm bắt toàn cảnh các chỉ số kinh doanh như doanh thu, lợi nhuận và giá trị kho một cách chính xác."
                    ]
                }
            ]
        },
        {
            type: 'concept',
            title: 'Thao tác trên máy tính',
            data: [
                {
                    title: 'Báo cáo Cuối ngày (Quản lý)',
                    icon: 'fa-solid fa-desktop',
                    color: 'green',
                    bullets: [
                        "Khi cần cái nhìn tổng quan nhanh chóng về hoạt động trong ca làm việc hoặc cuối ngày, người dùng xem Báo cáo Cuối ngày trên màn hình Quản lý."
                    ]
                },
                {
                    title: 'Báo cáo Bán hàng',
                    icon: 'fa-solid fa-chart-bar',
                    color: 'green',
                    bullets: [
                        "Khi muốn tìm hiểu sâu hơn về hiệu quả kinh doanh theo thời gian hoặc từng chi nhánh, chủ cửa hàng sử dụng Báo cáo Bán hàng."
                    ]
                },
                {
                    title: 'Báo cáo Hàng hóa',
                    icon: 'fa-solid fa-boxes',
                    color: 'green',
                    bullets: [
                        "Khi cần xác định món ăn bán chạy nhất hoặc nguyên vật liệu tồn kho quá lâu, người quản lý truy cập Báo cáo Hàng hóa."
                    ]
                },
                {
                    title: 'Báo cáo Khách hàng',
                    icon: 'fa-solid fa-users',
                    color: 'green',
                    bullets: [
                        "Khi muốn biết khách hàng nào chi tiêu nhiều nhất hoặc theo dõi công nợ, chủ quán xem Báo cáo Khách hàng."
                    ]
                },
                {
                    title: 'Báo cáo Nhà cung cấp',
                    icon: 'fa-solid fa-truck',
                    color: 'green',
                    bullets: [
                        "Khi cần đối soát các giao dịch nhập nguyên vật liệu và công nợ với đối tác, người dùng sử dụng Báo cáo Nhà cung cấp."
                    ]
                },
                {
                    title: 'Báo cáo Nhân viên',
                    icon: 'fa-solid fa-user-tie',
                    color: 'green',
                    bullets: [
                        "Khi cần đánh giá năng lực nhân viên dựa trên doanh số bán hàng để tính thưởng, quản lý chọn Báo cáo Nhân viên."
                    ]
                },
                {
                    title: 'Báo cáo Kênh bán hàng',
                    icon: 'fa-solid fa-network-wired',
                    color: 'green',
                    bullets: [
                        "Khi bán hàng trên nhiều nền tảng như GrabFood hay tại quán, người dùng vào Báo cáo Kênh bán hàng để so sánh hiệu quả."
                    ]
                },
                {
                    title: 'Báo cáo Tài chính',
                    icon: 'fa-solid fa-file-invoice-dollar',
                    color: 'green',
                    bullets: [
                        "Khi cần biết lợi nhuận thực tế tổng thể của nhà hàng cuối kỳ, chủ quán xem Báo cáo Tài chính."
                    ]
                },
                {
                    title: 'Báo cáo tại màn hình Thu ngân',
                    icon: 'fa-solid fa-cash-register',
                    color: 'green',
                    bullets: [
                        "Khi kết thúc ca làm việc, nhân viên thu ngân xem nhanh báo cáo tổng kết bằng cách nhấn vào biểu tượng tùy chọn ba gạch tại màn hình Thu ngân."
                    ]
                }
            ]
        },
        {
            type: 'concept',
            title: 'Thao tác trên Điện thoại',
            data: [
                {
                    title: 'Xem chi tiết số liệu (App Quản lý)',
                    icon: 'fa-solid fa-mobile-alt',
                    color: 'orange',
                    bullets: [
                        "Khi sử dụng ứng dụng KiotViet Quản lý, chủ quán chạm vào các dòng Doanh thu hoặc Lợi nhuận để xem báo cáo chi tiết."
                    ]
                },
                {
                    title: 'Xem tồn kho (App Quản lý)',
                    icon: 'fa-solid fa-box-open',
                    color: 'orange',
                    bullets: [
                        "Khi cần xem Top hàng bán chạy hoặc giá trị kho trên điện thoại, người dùng truy cập Báo cáo Hàng hóa trong menu Nhiều hơn."
                    ]
                },
                {
                    title: 'Báo cáo cá nhân (App Nhân viên)',
                    icon: 'fa-solid fa-user-clock',
                    color: 'orange',
                    bullets: [
                        "Khi nhân viên phục vụ muốn xem tổng kết bán hàng trong ngày của mình, họ chọn Báo cáo cuối ngày từ menu ba gạch trên ứng dụng Nhân viên."
                    ]
                }
            ]
        },
        {
            type: 'concept',
            title: 'Thao tác trên Máy POS',
            data: [
                {
                    title: 'Xem và in báo cáo tại POS',
                    icon: 'fa-solid fa-print',
                    color: 'purple',
                    bullets: [
                        "Khi cần in báo cáo tổng kết ca khổ K80 ngay tại quầy, thu ngân chọn Xem báo cáo cuối ngày trên máy POS."
                    ]
                }
            ]
        },
        { type: 'comparison-link', title: 'Tổng kết: Sự thật vs Lầm tưởng', data: null }
    ],
    comparison: [
        { prob: "Báo cáo trên KiotViet chỉ hiển thị số liệu doanh thu tổng hợp mà không thể chi tiết hóa lợi nhuận hay giá trị tồn kho.", sol: "Khi sử dụng KiotViet, chủ cửa hàng có thể nắm bắt toàn cảnh các chỉ số kinh doanh như doanh thu, lợi nhuận và giá trị kho một cách chính xác." },
        { prob: "Báo cáo Cuối ngày trên màn hình Quản lý chỉ có thể xem được dữ liệu sau khi đã kết thúc tháng kinh doanh.", sol: "Khi cần cái nhìn tổng quan nhanh chóng về hoạt động trong ca làm việc hoặc cuối ngày, người dùng xem Báo cáo Cuối ngày trên màn hình Quản lý." },
        { prob: "Hiệu quả kinh doanh chi tiết theo thời gian và chi nhánh chỉ được hiển thị trong Báo cáo Tài chính tổng hợp.", sol: "Khi muốn tìm hiểu sâu hơn về hiệu quả kinh doanh theo thời gian hoặc từng chi nhánh, chủ cửa hàng sử dụng Báo cáo Bán hàng." },
        { prob: "Việc xác định món ăn bán chạy và hàng tồn kho phải thực hiện thủ công bằng cách đếm hóa đơn và kiểm kho trực tiếp.", sol: "Khi cần xác định món ăn bán chạy nhất hoặc nguyên vật liệu tồn kho quá lâu, người quản lý truy cập Báo cáo Hàng hóa." },
        { prob: "Thông tin công nợ và mức chi tiêu của khách hàng nằm trong Báo cáo Tài chính thay vì Báo cáo Khách hàng.", sol: "Khi muốn biết khách hàng nào chi tiêu nhiều nhất hoặc theo dõi công nợ, chủ quán xem Báo cáo Khách hàng." },
        { prob: "Công nợ nhà cung cấp được quản lý chung trong sổ quỹ tiền mặt và không có báo cáo riêng biệt để đối soát.", sol: "Khi cần đối soát các giao dịch nhập nguyên vật liệu và công nợ với đối tác, người dùng sử dụng Báo cáo Nhà cung cấp." },
        { prob: "Việc tính thưởng nhân viên dựa trên doanh số phải được tổng hợp thủ công từ file excel bên ngoài hệ thống.", sol: "Khi cần đánh giá năng lực nhân viên dựa trên doanh số bán hàng để tính thưởng, quản lý chọn Báo cáo Nhân viên." },
        { prob: "Doanh thu từ các ứng dụng giao đồ ăn được gộp chung vào doanh thu bán tại quán và không thể tách biệt báo cáo.", sol: "Khi bán hàng trên nhiều nền tảng như GrabFood hay tại quán, người dùng vào Báo cáo Kênh bán hàng để so sánh hiệu quả." },
        { prob: "Lợi nhuận thực tế của cửa hàng chỉ được tính toán chính xác khi sử dụng phần mềm kế toán chuyên dụng khác.", sol: "Khi cần biết lợi nhuận thực tế tổng thể của nhà hàng cuối kỳ, chủ quán xem Báo cáo Tài chính." },
        { prob: "Thu ngân bắt buộc phải đăng nhập vào trang Quản lý mới có thể xem được báo cáo tổng kết ca làm việc của mình.", sol: "Khi kết thúc ca làm việc, nhân viên thu ngân xem nhanh báo cáo tổng kết bằng cách nhấn vào biểu tượng tùy chọn ba gạch tại màn hình Thu ngân." },
        { prob: "Ứng dụng điện thoại chỉ hiển thị biểu đồ tổng quan dạng hình ảnh và không thể xem chi tiết số liệu cụ thể.", sol: "Khi sử dụng ứng dụng KiotViet Quản lý, chủ quán chạm vào các dòng Doanh thu hoặc Lợi nhuận để xem báo cáo chi tiết." },
        { prob: "Báo cáo tồn kho và giá trị kho hàng hóa chỉ có thể xem được đầy đủ trên phiên bản máy tính.", sol: "Khi cần xem Top hàng bán chạy hoặc giá trị kho trên điện thoại, người dùng truy cập Báo cáo Hàng hóa trong menu Nhiều hơn." },
        { prob: "Nhân viên phục vụ không thể tự xem kết quả bán hàng cá nhân trên ứng dụng điện thoại mà phải nhờ quản lý xem giúp.", sol: "Khi nhân viên phục vụ muốn xem tổng kết bán hàng trong ngày của mình, họ chọn Báo cáo cuối ngày từ menu ba gạch trên ứng dụng Nhân viên." },
        { prob: "Máy POS chỉ dùng để order và thanh toán chứ không thể xem hay in được báo cáo cuối ngày.", sol: "Khi cần in báo cáo tổng kết ca khổ K80 ngay tại quầy, thu ngân chọn Xem báo cáo cuối ngày trên máy POS." }
    ],
    practiceTopics: [
        {
            title: "Tình huống Lợi ích tổng quan",
            chat: [
                { r: 'customer', t: 'Em ơi, anh muốn xem lãi lỗ với tồn kho mà sao nhìn cái báo cáo nó chung chung quá.' },
                { r: 'consultant', t: 'Dạ anh yên tâm, hệ thống bên em cung cấp cái nhìn toàn cảnh từ doanh thu, lợi nhuận đến giá trị kho chi tiết luôn ạ.' }
            ],
            cards: [
                {
                    id: 1,
                    question: "Khi sử dụng KiotViet, chủ cửa hàng có thể nắm bắt toàn cảnh các chỉ số kinh doanh như doanh thu, lợi nhuận và giá trị kho một cách chính xác.",
                    isTrue: true,
                    wrong: "Hệ thống báo cáo cung cấp cái nhìn toàn cảnh về hoạt động kinh doanh (doanh thu, lợi nhuận, giá trị kho, công nợ...), phân tích đa chiều và hỗ trợ ra quyết định chính xác.",
                    right: "Hệ thống báo cáo cung cấp cái nhìn toàn cảnh về hoạt động kinh doanh (doanh thu, lợi nhuận, giá trị kho, công nợ...), phân tích đa chiều và hỗ trợ ra quyết định chính xác."
                },
                {
                    id: 2,
                    question: "Báo cáo trên KiotViet chỉ hiển thị số liệu doanh thu tổng hợp mà không thể chi tiết hóa lợi nhuận hay giá trị tồn kho.",
                    isTrue: false,
                    wrong: "Hệ thống báo cáo cung cấp cái nhìn toàn cảnh về hoạt động kinh doanh (doanh thu, lợi nhuận, giá trị kho, công nợ...), phân tích đa chiều và hỗ trợ ra quyết định chính xác.",
                    right: "Hệ thống báo cáo cung cấp cái nhìn toàn cảnh về hoạt động kinh doanh (doanh thu, lợi nhuận, giá trị kho, công nợ...), phân tích đa chiều và hỗ trợ ra quyết định chính xác."
                }
            ]
        },
        {
            title: "Tình huống Báo cáo Cuối ngày (Quản lý)",
            chat: [
                { r: 'customer', t: 'Cô muốn xem nhanh hôm nay bán chác thế nào thì vào đâu hả cháu?' },
                { r: 'consultant', t: 'Dạ cô vào mục Báo cáo rồi chọn Cuối ngày trên màn hình Quản lý để xem tổng quan ngay cô nhé.' }
            ],
            cards: [
                {
                    id: 1,
                    question: "Khi cần cái nhìn tổng quan nhanh chóng về hoạt động trong ca làm việc hoặc cuối ngày, người dùng xem Báo cáo Cuối ngày trên màn hình Quản lý.",
                    isTrue: true,
                    wrong: "Báo cáo Cuối ngày giúp xem nhanh tổng quan hoạt động diễn ra trong ngày hoặc cuối ca làm việc.",
                    right: "Báo cáo Cuối ngày giúp xem nhanh tổng quan hoạt động diễn ra trong ngày hoặc cuối ca làm việc."
                },
                {
                    id: 2,
                    question: "Báo cáo Cuối ngày trên màn hình Quản lý chỉ có thể xem được dữ liệu sau khi đã kết thúc tháng kinh doanh.",
                    isTrue: false,
                    wrong: "Báo cáo Cuối ngày giúp xem nhanh tổng quan hoạt động diễn ra trong ngày hoặc cuối ca làm việc.",
                    right: "Báo cáo Cuối ngày giúp xem nhanh tổng quan hoạt động diễn ra trong ngày hoặc cuối ca làm việc."
                }
            ]
        },
        {
            title: "Tình huống Báo cáo Bán hàng",
            chat: [
                { r: 'customer', t: 'Anh muốn xem tháng rồi chi nhánh A bán tốt không thì xem ở đâu em?' },
                { r: 'consultant', t: 'Dạ anh vào Báo cáo Bán hàng, rồi lọc theo thời gian và chi nhánh là ra ngay kết quả anh cần ạ.' }
            ],
            cards: [
                {
                    id: 1,
                    question: "Khi muốn tìm hiểu sâu hơn về hiệu quả kinh doanh theo thời gian hoặc từng chi nhánh, chủ cửa hàng sử dụng Báo cáo Bán hàng.",
                    isTrue: true,
                    wrong: "Báo cáo Bán hàng cho phép tìm hiểu sâu về hiệu quả bán hàng, hỗ trợ lọc theo thời gian và chi nhánh.",
                    right: "Báo cáo Bán hàng cho phép tìm hiểu sâu về hiệu quả bán hàng, hỗ trợ lọc theo thời gian và chi nhánh."
                },
                {
                    id: 2,
                    question: "Hiệu quả kinh doanh chi tiết theo thời gian và chi nhánh chỉ được hiển thị trong Báo cáo Tài chính tổng hợp.",
                    isTrue: false,
                    wrong: "Báo cáo Bán hàng cho phép tìm hiểu sâu về hiệu quả bán hàng, hỗ trợ lọc theo thời gian và chi nhánh.",
                    right: "Báo cáo Bán hàng cho phép tìm hiểu sâu về hiệu quả bán hàng, hỗ trợ lọc theo thời gian và chi nhánh."
                }
            ]
        },
        {
            title: "Tình huống Báo cáo Hàng hóa",
            chat: [
                { r: 'customer', t: 'Làm sao biết món nào khách gọi nhiều để nhập thêm đồ hả em?' },
                { r: 'consultant', t: 'Dạ anh vào Báo cáo Hàng hóa, nó sẽ thống kê món bán chạy và cả hàng tồn kho cho anh luôn ạ.' }
            ],
            cards: [
                {
                    id: 1,
                    question: "Khi cần xác định món ăn bán chạy nhất hoặc nguyên vật liệu tồn kho quá lâu, người quản lý truy cập Báo cáo Hàng hóa.",
                    isTrue: true,
                    wrong: "Báo cáo Hàng hóa giúp xác định món ăn/đồ uống bán chạy, lợi nhuận hàng hóa và theo dõi xuất nhập tồn.",
                    right: "Báo cáo Hàng hóa giúp xác định món ăn/đồ uống bán chạy, lợi nhuận hàng hóa và theo dõi xuất nhập tồn."
                },
                {
                    id: 2,
                    question: "Việc xác định món ăn bán chạy và hàng tồn kho phải thực hiện thủ công bằng cách đếm hóa đơn và kiểm kho trực tiếp.",
                    isTrue: false,
                    wrong: "Báo cáo Hàng hóa giúp xác định món ăn/đồ uống bán chạy, lợi nhuận hàng hóa và theo dõi xuất nhập tồn.",
                    right: "Báo cáo Hàng hóa giúp xác định món ăn/đồ uống bán chạy, lợi nhuận hàng hóa và theo dõi xuất nhập tồn."
                }
            ]
        },
        {
            title: "Tình huống Báo cáo Khách hàng",
            chat: [
                { r: 'customer', t: 'Chị muốn xem công ty ABC nợ bao nhiêu tiền tiệc thì vào đâu em?' },
                { r: 'consultant', t: 'Dạ chị vào Báo cáo Khách hàng để xem chi tiết công nợ và lịch sử chi tiêu của họ chị nhé.' }
            ],
            cards: [
                {
                    id: 1,
                    question: "Khi muốn biết khách hàng nào chi tiêu nhiều nhất hoặc theo dõi công nợ, chủ quán xem Báo cáo Khách hàng.",
                    isTrue: true,
                    wrong: "Báo cáo Khách hàng giúp theo dõi chi tiêu của khách (khách quen, khách đoàn) và quản lý công nợ khách hàng.",
                    right: "Báo cáo Khách hàng giúp theo dõi chi tiêu của khách (khách quen, khách đoàn) và quản lý công nợ khách hàng."
                },
                {
                    id: 2,
                    question: "Thông tin công nợ và mức chi tiêu của khách hàng nằm trong Báo cáo Tài chính thay vì Báo cáo Khách hàng.",
                    isTrue: false,
                    wrong: "Báo cáo Khách hàng giúp theo dõi chi tiêu của khách (khách quen, khách đoàn) và quản lý công nợ khách hàng.",
                    right: "Báo cáo Khách hàng giúp theo dõi chi tiêu của khách (khách quen, khách đoàn) và quản lý công nợ khách hàng."
                }
            ]
        },
        {
            title: "Tình huống Báo cáo Nhà cung cấp",
            chat: [
                { r: 'customer', t: 'Anh muốn kiểm tra tiền nợ tiền thịt, rau củ với bên cung cấp thì xem đâu?' },
                { r: 'consultant', t: 'Dạ anh vào Báo cáo Nhà cung cấp để đối soát nhập hàng và công nợ chi tiết ạ.' }
            ],
            cards: [
                {
                    id: 1,
                    question: "Khi cần đối soát các giao dịch nhập nguyên vật liệu và công nợ với đối tác, người dùng sử dụng Báo cáo Nhà cung cấp.",
                    isTrue: true,
                    wrong: "Báo cáo Nhà cung cấp hỗ trợ đối soát giao dịch nhập nguyên vật liệu và quản lý công nợ với nhà cung cấp.",
                    right: "Báo cáo Nhà cung cấp hỗ trợ đối soát giao dịch nhập nguyên vật liệu và quản lý công nợ với nhà cung cấp."
                },
                {
                    id: 2,
                    question: "Công nợ nhà cung cấp được quản lý chung trong sổ quỹ tiền mặt và không có báo cáo riêng biệt để đối soát.",
                    isTrue: false,
                    wrong: "Báo cáo Nhà cung cấp hỗ trợ đối soát giao dịch nhập nguyên vật liệu và quản lý công nợ với nhà cung cấp.",
                    right: "Báo cáo Nhà cung cấp hỗ trợ đối soát giao dịch nhập nguyên vật liệu và quản lý công nợ với nhà cung cấp."
                }
            ]
        },
        {
            title: "Tình huống Báo cáo Nhân viên",
            chat: [
                { r: 'customer', t: 'Cuối tháng tính hoa hồng cho nhân viên mà số liệu lắt nhắt quá em.' },
                { r: 'consultant', t: 'Dạ anh vào Báo cáo Nhân viên, hệ thống tự tính doanh số và lợi nhuận từng bạn để anh tính thưởng dễ dàng ạ.' }
            ],
            cards: [
                {
                    id: 1,
                    question: "Khi cần đánh giá năng lực nhân viên dựa trên doanh số bán hàng để tính thưởng, quản lý chọn Báo cáo Nhân viên.",
                    isTrue: true,
                    wrong: "Báo cáo Nhân viên hiển thị chi tiết doanh số, lợi nhuận theo từng nhân viên để đánh giá năng lực và tính thưởng.",
                    right: "Báo cáo Nhân viên hiển thị chi tiết doanh số, lợi nhuận theo từng nhân viên để đánh giá năng lực và tính thưởng."
                },
                {
                    id: 2,
                    question: "Việc tính thưởng nhân viên dựa trên doanh số phải được tổng hợp thủ công từ file excel bên ngoài hệ thống.",
                    isTrue: false,
                    wrong: "Báo cáo Nhân viên hiển thị chi tiết doanh số, lợi nhuận theo từng nhân viên để đánh giá năng lực và tính thưởng.",
                    right: "Báo cáo Nhân viên hiển thị chi tiết doanh số, lợi nhuận theo từng nhân viên để đánh giá năng lực và tính thưởng."
                }
            ]
        },
        {
            title: "Tình huống Báo cáo Kênh bán hàng",
            chat: [
                { r: 'customer', t: 'Anh bán cả trên Grab với bán tại chỗ, muốn xem kênh nào hiệu quả hơn thì làm sao?' },
                { r: 'consultant', t: 'Dạ anh xem Báo cáo Kênh bán hàng, nó sẽ tách riêng hiệu quả từng kênh để anh so sánh đấy ạ.' }
            ],
            cards: [
                {
                    id: 1,
                    question: "Khi bán hàng trên nhiều nền tảng như GrabFood hay tại quán, người dùng vào Báo cáo Kênh bán hàng để so sánh hiệu quả.",
                    isTrue: true,
                    wrong: "Báo cáo Kênh bán hàng giúp so sánh hiệu quả kinh doanh giữa các kênh (Tại quán, Mang về, App giao hàng...).",
                    right: "Báo cáo Kênh bán hàng giúp so sánh hiệu quả kinh doanh giữa các kênh (Tại quán, Mang về, App giao hàng...)."
                },
                {
                    id: 2,
                    question: "Doanh thu từ các ứng dụng giao đồ ăn được gộp chung vào doanh thu bán tại quán và không thể tách biệt báo cáo.",
                    isTrue: false,
                    wrong: "Báo cáo Kênh bán hàng giúp so sánh hiệu quả kinh doanh giữa các kênh (Tại quán, Mang về, App giao hàng...).",
                    right: "Báo cáo Kênh bán hàng giúp so sánh hiệu quả kinh doanh giữa các kênh (Tại quán, Mang về, App giao hàng...)."
                }
            ]
        },
        {
            title: "Tình huống Báo cáo Tài chính",
            chat: [
                { r: 'customer', t: 'Anh cần con số lợi nhuận cuối cùng sau khi trừ hết chi phí thì xem ở đâu?' },
                { r: 'consultant', t: 'Dạ anh vào Báo cáo Tài chính để xem kết quả kinh doanh tổng thể và lợi nhuận thực tế anh nhé.' }
            ],
            cards: [
                {
                    id: 1,
                    question: "Khi cần biết lợi nhuận thực tế tổng thể của nhà hàng cuối kỳ, chủ quán xem Báo cáo Tài chính.",
                    isTrue: true,
                    wrong: "Báo cáo Tài chính cung cấp báo cáo kết quả kinh doanh tổng thể và lợi nhuận thực tế.",
                    right: "Báo cáo Tài chính cung cấp báo cáo kết quả kinh doanh tổng thể và lợi nhuận thực tế."
                },
                {
                    id: 2,
                    question: "Lợi nhuận thực tế của cửa hàng chỉ được tính toán chính xác khi sử dụng phần mềm kế toán chuyên dụng khác.",
                    isTrue: false,
                    wrong: "Báo cáo Tài chính cung cấp báo cáo kết quả kinh doanh tổng thể và lợi nhuận thực tế.",
                    right: "Báo cáo Tài chính cung cấp báo cáo kết quả kinh doanh tổng thể và lợi nhuận thực tế."
                }
            ]
        },
        {
            title: "Tình huống Báo cáo tại màn hình Thu ngân",
            chat: [
                { r: 'customer', t: 'Hết ca em muốn xem tổng tiền để giao ca thì xem ở đâu cho nhanh hả chị?' },
                { r: 'consultant', t: 'Dạ em nhấn vào biểu tượng ba gạch ở màn hình Thu ngân rồi chọn Báo cáo cuối ngày là xem được ngay nhé.' }
            ],
            cards: [
                {
                    id: 1,
                    question: "Khi kết thúc ca làm việc, nhân viên thu ngân xem nhanh báo cáo tổng kết bằng cách nhấn vào biểu tượng tùy chọn ba gạch tại màn hình Thu ngân.",
                    isTrue: true,
                    wrong: "Tại màn hình Thu ngân, nhân viên có thể xem nhanh Báo cáo cuối ngày qua biểu tượng tùy chọn (ba gạch).",
                    right: "Tại màn hình Thu ngân, nhân viên có thể xem nhanh Báo cáo cuối ngày qua biểu tượng tùy chọn (ba gạch)."
                },
                {
                    id: 2,
                    question: "Thu ngân bắt buộc phải đăng nhập vào trang Quản lý mới có thể xem được báo cáo tổng kết ca làm việc của mình.",
                    isTrue: false,
                    wrong: "Tại màn hình Thu ngân, nhân viên có thể xem nhanh Báo cáo cuối ngày qua biểu tượng tùy chọn (ba gạch).",
                    right: "Tại màn hình Thu ngân, nhân viên có thể xem nhanh Báo cáo cuối ngày qua biểu tượng tùy chọn (ba gạch)."
                }
            ]
        },
        {
            title: "Tình huống Xem chi tiết số liệu (App Quản lý)",
            chat: [
                { r: 'customer', t: 'Trên điện thoại anh muốn xem kỹ hơn số lãi lỗ chứ không chỉ mỗi cái biểu đồ thì làm thế nào?' },
                { r: 'consultant', t: 'Dạ anh chạm trực tiếp vào dòng Doanh thu hoặc Lợi nhuận trên app Quản lý là xem được chi tiết ngay ạ.' }
            ],
            cards: [
                {
                    id: 1,
                    question: "Khi sử dụng ứng dụng KiotViet Quản lý, chủ quán chạm vào các dòng Doanh thu hoặc Lợi nhuận để xem báo cáo chi tiết.",
                    isTrue: true,
                    wrong: "Trên app Quản lý, chạm vào các dòng thông tin (Doanh thu, Lợi nhuận, Top bàn...) để xem báo cáo chi tiết.",
                    right: "Trên app Quản lý, chạm vào các dòng thông tin (Doanh thu, Lợi nhuận, Top bàn...) để xem báo cáo chi tiết."
                },
                {
                    id: 2,
                    question: "Ứng dụng điện thoại chỉ hiển thị biểu đồ tổng quan dạng hình ảnh và không thể xem chi tiết số liệu cụ thể.",
                    isTrue: false,
                    wrong: "Trên app Quản lý, chạm vào các dòng thông tin (Doanh thu, Lợi nhuận, Top bàn...) để xem báo cáo chi tiết.",
                    right: "Trên app Quản lý, chạm vào các dòng thông tin (Doanh thu, Lợi nhuận, Top bàn...) để xem báo cáo chi tiết."
                }
            ]
        },
        {
            title: "Tình huống Xem tồn kho (App Quản lý)",
            chat: [
                { r: 'customer', t: 'Anh đang đi chợ, muốn xem nhanh trong kho còn bao nhiêu thịt bò thì xem trên điện thoại được không?' },
                { r: 'consultant', t: 'Dạ được chứ ạ, anh vào menu Nhiều hơn, chọn Báo cáo Hàng hóa là thấy ngay tồn kho và giá trị kho ạ.' }
            ],
            cards: [
                {
                    id: 1,
                    question: "Khi cần xem Top hàng bán chạy hoặc giá trị kho trên điện thoại, người dùng truy cập Báo cáo Hàng hóa trong menu Nhiều hơn.",
                    isTrue: true,
                    wrong: "App Quản lý hỗ trợ xem Báo cáo Hàng hóa (Top bán chạy, Tồn kho, Giá trị kho) qua menu Nhiều hơn.",
                    right: "App Quản lý hỗ trợ xem Báo cáo Hàng hóa (Top bán chạy, Tồn kho, Giá trị kho) qua menu Nhiều hơn."
                },
                {
                    id: 2,
                    question: "Báo cáo tồn kho và giá trị kho hàng hóa chỉ có thể xem được đầy đủ trên phiên bản máy tính.",
                    isTrue: false,
                    wrong: "App Quản lý hỗ trợ xem Báo cáo Hàng hóa (Top bán chạy, Tồn kho, Giá trị kho) qua menu Nhiều hơn.",
                    right: "App Quản lý hỗ trợ xem Báo cáo Hàng hóa (Top bán chạy, Tồn kho, Giá trị kho) qua menu Nhiều hơn."
                }
            ]
        },
        {
            title: "Tình huống Báo cáo cá nhân (App Nhân viên)",
            chat: [
                { r: 'customer', t: 'Em muốn biết hôm nay mình chạy được bao nhiêu bàn để tính lương thì xem ở đâu ạ?' },
                { r: 'consultant', t: 'Dạ em mở app Nhân viên, vào menu ba gạch rồi chọn Báo cáo cuối ngày là thấy thành tích của mình nhé.' }
            ],
            cards: [
                {
                    id: 1,
                    question: "Khi nhân viên phục vụ muốn xem tổng kết bán hàng trong ngày của mình, họ chọn Báo cáo cuối ngày từ menu ba gạch trên ứng dụng Nhân viên.",
                    isTrue: true,
                    wrong: "App KiotViet Nhân viên nhà hàng hỗ trợ nhân viên tự xem Báo cáo cuối ngày của mình.",
                    right: "App KiotViet Nhân viên nhà hàng hỗ trợ nhân viên tự xem Báo cáo cuối ngày của mình."
                },
                {
                    id: 2,
                    question: "Nhân viên phục vụ không thể tự xem kết quả bán hàng cá nhân trên ứng dụng điện thoại mà phải nhờ quản lý xem giúp.",
                    isTrue: false,
                    wrong: "App KiotViet Nhân viên nhà hàng hỗ trợ nhân viên tự xem Báo cáo cuối ngày của mình.",
                    right: "App KiotViet Nhân viên nhà hàng hỗ trợ nhân viên tự xem Báo cáo cuối ngày của mình."
                }
            ]
        },
        {
            title: "Tình huống Xem và in báo cáo tại POS",
            chat: [
                { r: 'customer', t: 'Máy POS này có in được cái báo cáo tổng kết để nộp cho chủ không em?' },
                { r: 'consultant', t: 'Dạ có ạ, chị chọn Xem báo cáo cuối ngày trên máy POS rồi nhấn In báo cáo là ra khổ K80 luôn chị nhé.' }
            ],
            cards: [
                {
                    id: 1,
                    question: "Khi cần in báo cáo tổng kết ca khổ K80 ngay tại quầy, thu ngân chọn Xem báo cáo cuối ngày trên máy POS.",
                    isTrue: true,
                    wrong: "Trên máy POS, nhân viên có thể xem và in Báo cáo cuối ngày (khổ K80).",
                    right: "Trên máy POS, nhân viên có thể xem và in Báo cáo cuối ngày (khổ K80)."
                },
                {
                    id: 2,
                    question: "Máy POS chỉ dùng để order và thanh toán chứ không thể xem hay in được báo cáo cuối ngày.",
                    isTrue: false,
                    wrong: "Trên máy POS, nhân viên có thể xem và in Báo cáo cuối ngày (khổ K80).",
                    right: "Trên máy POS, nhân viên có thể xem và in Báo cáo cuối ngày (khổ K80)."
                }
            ]
        }
    ]
};
        // --- KẾT THÚC PHẦN DỮ LIỆU CỦA AI ---

        const { courseTitle, courseSubtitle, courseIcon, overviewModules, practiceTopics, mediaModules } = lessonData;

        const audioCtx = new(window.AudioContext || window.webkitAudioContext)(); 
        let isMuted = false;
        let slides = []; 
        let currentSlideIndex = 0; 
        let gameQuestions = []; 
        let gameScore = 0; 
        let gameCurrentQIndex = 0; 
        let gameStartSlideIndex = 0;
        let userGameHistory = []; 
        let overviewStartIndex = 1; 
        let comparisonSlideIndex = 0;

        function toggleMute() {
            isMuted = !isMuted;
            const btn = document.getElementById('btn-mute');
            btn.innerHTML = isMuted ? '<i class="fa-solid fa-volume-xmark text-lg"></i>' : '<i class="fa-solid fa-volume-high text-lg"></i>';
            btn.classList.toggle('text-red-500', isMuted);
            btn.classList.toggle('text-slate-400', !isMuted);
        }

        function playSound(type) {
            if (isMuted || audioCtx.state === 'suspended') {
                audioCtx.resume();
                if(isMuted) return;
            }
            const o = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            o.connect(g);
            g.connect(audioCtx.destination);
            const n = audioCtx.currentTime;
            
            if(type === 'pop'){
                o.type='sine';
                o.frequency.setValueAtTime(800,n);
                o.frequency.exponentialRampToValueAtTime(300,n+0.1);
                g.gain.setValueAtTime(0.3,n);
                g.gain.exponentialRampToValueAtTime(0.01,n+0.1);
            } else if(type === 'correct'){
                o.type='sine';
                o.frequency.setValueAtTime(600,n);
                o.frequency.exponentialRampToValueAtTime(1200,n+0.1);
                g.gain.setValueAtTime(0.3,n);
                g.gain.exponentialRampToValueAtTime(0.01,n+0.3);
            } else if(type === 'incorrect'){
                o.type='sawtooth';
                o.frequency.setValueAtTime(200,n);
                o.frequency.linearRampToValueAtTime(150,n+0.2);
                g.gain.setValueAtTime(0.3,n);
                g.gain.linearRampToValueAtTime(0.01,n+0.2);
            } else if(type === 'win'){
                const t=[523.25,659.25,783.99,1046.5];
                let e=n;
                t.forEach((t,i)=>{
                    const s=audioCtx.createOscillator();
                    const a=audioCtx.createGain();
                    s.connect(a);
                    a.connect(audioCtx.destination);
                    s.type='triangle';
                    s.frequency.setValueAtTime(t,e);
                    a.gain.setValueAtTime(0.2,e);
                    a.gain.linearRampToValueAtTime(0,e+0.5);
                    s.start(e);
                    s.stop(e+0.5);
                    e+=i===t.length-2?0.3:0.15;
                });
                return;
            } else if(type === 'fail'){
                o.type='sawtooth';
                o.frequency.setValueAtTime(300,n);
                o.frequency.linearRampToValueAtTime(150,n+0.8);
                g.gain.setValueAtTime(0.3,n);
                g.gain.linearRampToValueAtTime(0,n+0.8);
            }
            o.start();
            o.stop(n + (type==='pop' ? 0.1 : type==='correct' ? 0.3 : type==='incorrect' ? 0.2 : 0.8));
        }

        function initApp() {
            slides = [];
            const sidebarContent = document.getElementById('sidebar-content');
            sidebarContent.innerHTML = '';
            
            slides.push({ type: 'title', section: 'Mở đầu' });
            slides.push({ type: 'intro', section: 'Mở đầu' });
            
            const createSidebarGroup = (t) => {
                const d = document.createElement('div');
                d.className = "text-sm font-bold text-slate-700 bg-slate-100 p-3 rounded-lg mt-4 mb-2 shadow-sm uppercase";
                d.innerText = t;
                sidebarContent.appendChild(d);
            };
            
            const createSidebarButton = (t, i, c, o) => {
                const b = document.createElement('button');
                b.className = `w-full text-left px-4 py-2 rounded-lg hover:bg-${c}-50 text-sm font-medium text-slate-600 hover:text-${c}-600 flex items-center gap-3 transition`;
                b.innerHTML = `<i class="${i} w-4 text-center text-${c}-500"></i><span class="truncate">${t}</span>`;
                b.onclick = () => { o(); toggleSidebar(); };
                sidebarContent.appendChild(b);
            };
            
            overviewStartIndex = slides.length;

            if(mediaModules && mediaModules.length > 0) {
                const grpTitle = "Tài liệu đa phương tiện";
                createSidebarGroup(grpTitle);
                mediaModules.forEach(m => {
                    const s = slides.length;
                    if(m.type === 'video') slides.push({ type: 'video', data: m.src, title: m.title, section: grpTitle });
                    else if(m.type === 'image') slides.push({ type: 'image', data: m.src, title: m.title, section: grpTitle });
                    
                    const icon = m.type === 'video' ? 'fa-brands fa-youtube' : 'fa-solid fa-image';
                    createSidebarButton(m.title, icon, "red", () => { currentSlideIndex = s; renderSlide(); });
                });
            }

            if(overviewModules && overviewModules.length > 0){
                overviewModules.forEach(m => {
                    const grpTitle = m.title;
                    createSidebarGroup(grpTitle);
                    if (m.type === 'concept') {
                        if(Array.isArray(m.data)){
                            m.data.forEach((item) => {
                                const sIndex = slides.length;
                                slides.push({ type: 'concept-single', data: item, title: item.title, section: grpTitle });
                                createSidebarButton(item.title, item.icon, item.color, () => { currentSlideIndex = sIndex; renderSlide(); });
                            });
                        }
                    } else if (m.type === 'comparison-link') {
                        // Skip
                    } else {
                        const s = slides.length;
                        slides.push({ type: m.type, data: m.data, title: m.title, section: grpTitle });
                        createSidebarButton("Xem Cẩm nang", "fa-solid fa-book-open", "blue", () => { currentSlideIndex = s; renderSlide(); });
                    }
                });
            }
            
            if(practiceTopics && practiceTopics.length > 0){
                const grpTitle = "2. Tìm hiểu chi tiết";
                createSidebarGroup(grpTitle);
                practiceTopics.forEach(t => {
                    let s = slides.length;
                    if(t.chat){
                        for(let i = 0; i < t.chat.length; i += 2){
                            slides.push({type:'chat', data: t.chat.slice(i, i+2), title: t.title, section: grpTitle});
                        }
                    }
                    if(t.cards){
                        t.cards.forEach(c => slides.push({type:'card', data: c, title: t.title, section: grpTitle}));
                    }
                    createSidebarButton(t.title, "fa-solid fa-comment-dots", "slate", () => { currentSlideIndex = s; renderSlide(); });
                });
            }
            
            const reviewTitle = "3. Tổng kết & Đánh giá";
            createSidebarGroup(reviewTitle);
            
            comparisonSlideIndex = slides.length;
            slides.push({type:'comparison', title: "Bảng so sánh", section: reviewTitle});
            createSidebarButton("Bảng so sánh", "fa-solid fa-table-columns", "purple", () => { currentSlideIndex = comparisonSlideIndex; renderSlide(); });
            
            gameStartSlideIndex = slides.length;
            slides.push({type:'game-start', title: "Quiz Game", section: reviewTitle});
            slides.push({type:'game-play', title: "Đang chơi...", section: reviewTitle});
            slides.push({type:'winner-input', title: "Nhận thưởng", section: reviewTitle});
            slides.push({type:'certificate', title: "Chứng nhận", section: reviewTitle});
            slides.push({type:'game-review', title: "Chi tiết kết quả", section: reviewTitle});
            slides.push({type:'end-course', title: "Kết thúc", section: reviewTitle});

            createSidebarButton("Quiz Game", "fa-solid fa-gamepad", "orange", () => { currentSlideIndex = gameStartSlideIndex; renderSlide(); });
            
            renderSlide();
        }

        function renderSlide() {
            const c = document.getElementById('app-container');
            const s = slides[currentSlideIndex];
            
            document.getElementById('header-section-title').innerText = s.section || "Bài học";
            let subTitle = s.title ? ` • ${s.title}` : "";
            if(s.type === 'title') subTitle = "";
            document.getElementById('slide-indicator').innerText = `${currentSlideIndex+1}/${slides.length}${subTitle}`;
            document.getElementById('progress-bar').style.width = `${((currentSlideIndex+1)/slides.length)*100}%`;
            
            const btnPrev = document.getElementById('btn-prev');
            const btnNext = document.getElementById('btn-next');
            btnPrev.disabled = currentSlideIndex === 0;
            
            let disableNext = false;
            if (currentSlideIndex >= slides.length - 1) disableNext = true;
            if (s.type === 'game-start') disableNext = true;
            if (s.type === 'game-play') disableNext = true;
            if (s.type === 'winner-input') disableNext = true;
            btnNext.disabled = disableNext;

            const tpl = document.getElementById(`tpl-${s.type}`);
            if(!tpl) { console.error("Template not found:", s.type); return; }

            const t = tpl.content.cloneNode(true);
            const e = t.querySelector('.slide');
            
            if(s.type === 'title'){
                e.querySelector('.slide-title').innerText = courseTitle;
                e.querySelector('.slide-icon').className = courseIcon + " slide-icon";
                
                const subEl = e.querySelector('.slide-subtitle');
                if(lessonData.courseSubtitle) {
                    subEl.innerText = lessonData.courseSubtitle;
                    subEl.classList.remove('hidden');
                }
            }
            else if(s.type === 'intro'){
                e.querySelector('.course-name-span').innerText = courseTitle;
            }
            else if(s.type === 'end-course'){
                e.querySelector('.end-course-title').innerText = "Chúc mừng bạn đã hoàn thành học phần " + courseTitle + "!";
            }
            else if(s.type === 'video'){
                let vidSrc = s.data;
                // FIX YOUTUBE LINKS
                if (vidSrc.includes('youtube.com/watch?v=')) {
                    vidSrc = vidSrc.replace('watch?v=', 'embed/');
                    if(vidSrc.includes('&')) vidSrc = vidSrc.split('&')[0];
                } else if (vidSrc.includes('youtu.be/')) {
                    vidSrc = vidSrc.replace('youtu.be/', 'www.youtube.com/embed/');
                }
                e.querySelector('.video-iframe').src = vidSrc;
            }
            else if(s.type === 'image'){
                e.querySelector('.img-content').src = s.data;
            }
            else if(s.type === 'concept-single'){
                e.querySelector('.concept-card-single').classList.add(`border-${s.data.color}-200`);
                e.querySelector('.concept-header-single').classList.add(`bg-${s.data.color}-50`, `text-${s.data.color}-700`);
                e.querySelector('.concept-icon').className = `${s.data.icon} text-2xl`;
                e.querySelector('.concept-card-title').innerText = s.data.title;
                const body = e.querySelector('.concept-body-single');
                
                if(s.data.comparison) {
                    body.innerHTML = `
                        <div class="comp-grid">
                            <div class="comp-col">
                                <div class="comp-item comp-item-prob">
                                    <div class="comp-label prob-label"><i class="fa-solid fa-triangle-exclamation mr-1"></i> Vấn đề / Nỗi đau</div>
                                    ${s.data.comparison.map(i => `<div class="mb-4 pb-4 border-b border-red-200 last:border-0 last:pb-0 last:mb-0"><p class="comp-text">${i.prob}</p></div>`).join('')}
                                </div>
                            </div>
                            <div class="comp-col">
                                <div class="comp-item comp-item-sol">
                                    <div class="comp-label sol-label"><i class="fa-solid fa-circle-check mr-1"></i> Giải pháp KiotViet</div>
                                    ${s.data.comparison.map(i => `<div class="mb-4 pb-4 border-b border-blue-200 last:border-0 last:pb-0 last:mb-0"><p class="comp-text">${i.sol}</p></div>`).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    const bullets = Array.isArray(s.data.bullets) ? s.data.bullets : [];
                    body.innerHTML = bullets.map(b => `<div class="concept-item-single"><i class="fa-solid fa-circle text-[8px] mt-2 text-${s.data.color}-500"></i><span>${b}</span></div>`).join('');
                }
            }
            else if(s.type === 'chat'){
                const iconCustomer = '<div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 flex-shrink-0 shadow-sm border border-gray-300"><i class="fa-solid fa-user"></i></div>';
                const iconConsultant = '<div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white flex-shrink-0 shadow-sm border border-blue-700"><i class="fa-solid fa-headset"></i></div>';

                e.querySelector('.chat-container').innerHTML = s.data.map((m, i) => {
                    const role = m.r || m.type || (m.role ? m.role : 'consultant');
                    const txt = m.t || m.text || m.content || '';
                    const isCust = (role === 'customer' || role === 'user');
                    
                    return `
                    <div class="flex w-full gap-2 items-end ${isCust ? 'flex-row' : 'flex-row-reverse'}" style="animation-delay:${i * 0.2}s">
                        ${isCust ? iconCustomer : iconConsultant}
                        <div class="chat-bubble ${isCust ? 'chat-bubble-customer' : 'chat-bubble-consultant'}">
                            <div class="text-[9px] font-bold uppercase mb-1 opacity-60">${isCust ? 'Chủ cửa hàng/Nhân viên' : 'Chuyên viên KiotViet'}</div>
                            ${txt}
                        </div>
                    </div>
                    `;
                }).join('');
            }
            else if(s.type === 'card'){
                e.querySelector('.card-id').innerText = s.data.id;
                e.querySelector('.card-question').innerHTML = s.data.question;
                e.querySelector('.card-original-q').innerHTML = s.data.question;
                e.querySelector('.card-right-answer').innerHTML = s.data.right;
                const bT = e.querySelector('.btn-true');
                const bF = e.querySelector('.btn-false');
                const bR = e.querySelector('.btn-reset');
                bT.onclick = ev => { ev.stopPropagation(); flipCardCheck(e, true, s.data.isTrue); };
                bF.onclick = ev => { ev.stopPropagation(); flipCardCheck(e, false, s.data.isTrue); };
                bR.onclick = ev => { ev.stopPropagation(); resetCardFlip(e); };
            }
            else if(s.type === 'comparison'){
                const y = e.querySelector('.comp-tbody');
                let comps = [];
                if(lessonData.comparison) comps = lessonData.comparison;
                y.innerHTML = comps.map(c => `<tr><td class="p-3 align-top border-r border-slate-100 bg-red-50/20 text-red-800">${c.prob}</td><td class="p-3 align-top bg-green-50/20 text-green-800">${c.sol}</td></tr>`).join('');
            }
            else if(s.type === 'game-start'){
                let totalQ = 0;
                practiceTopics.forEach(t => { if(t.cards) totalQ += t.cards.length; });
                
                const btnContainer = e.querySelector('.game-mode-buttons');
                if(totalQ < 10) {
                     btnContainer.innerHTML = `<button onclick="startGame('promax')" class="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-4 rounded-xl font-bold text-base shadow-lg hover:opacity-90 active:scale-95 transition flex items-center justify-center gap-2 group"><i class="fa-solid fa-rocket"></i> <span>Qua nốt màn này là ngon luôn ;)</span> <span class="hidden md:inline-block bg-white/20 px-2 py-0.5 rounded text-[10px] ml-1">[Enter]</span></button>
                     <p class="text-[10px] text-slate-400 mt-2 md:hidden">(Nhấn Enter hoặc Space để bắt đầu)</p>`;
                } else {
                     btnContainer.innerHTML = `
                        <button onclick="startGame('standard')" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold text-base shadow-lg hover:bg-blue-700 active:scale-95 transition flex items-center justify-center gap-2"><span class="w-6 h-6 rounded-full bg-white/20 flex items-center justify-center text-[10px]">1</span> Tiêu chuẩn (5 câu) <span class="hidden md:inline-block bg-white/20 px-2 py-0.5 rounded text-[10px] ml-1">[Phím 1]</span></button>
                        <button onclick="startGame('promax')" class="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-4 rounded-xl font-bold text-base shadow-lg hover:opacity-90 active:scale-95 transition flex items-center justify-center gap-2"><span class="w-6 h-6 rounded-full bg-white/20 flex items-center justify-center text-[10px]">2</span> Promax (Toàn bộ) <span class="hidden md:inline-block bg-white/20 px-2 py-0.5 rounded text-[10px] ml-1">[Phím 2]</span></button>
                     `;
                }
            }
            else if(s.type === 'game-play'){
                const q = gameQuestions[gameCurrentQIndex];
                if(q){
                    e.querySelector('.game-q-current').innerText = gameCurrentQIndex + 1;
                    e.querySelector('.game-q-total').innerText = gameQuestions.length;
                    e.querySelector('.game-score').innerText = gameScore;
                    e.querySelector('.game-question-text').innerHTML = q.question;
                } else {
                    e.querySelector('.game-question-text').innerText = "Vui lòng chọn chế độ!";
                    e.querySelectorAll('.game-btn').forEach(b => b.disabled = true);
                }
            }
            else if(s.type === 'winner-input'){
                const total = gameQuestions.length;
                const pct = total > 0 ? Math.round((gameScore / total) * 100) : 0;
                e.querySelector('.winner-score').innerText = pct + "%";
                setTimeout(() => {
                    const inp = document.getElementById('input-winner-name');
                    if(inp) inp.focus();
                }, 500);
            }
            else if(s.type === 'certificate'){
                 const name = localStorage.getItem('kv_player_name');
                 const dept = localStorage.getItem('kv_player_dept');
                 const score = localStorage.getItem('kv_player_score');
                 const passed = (parseInt(score) || 0) >= 80;
                 
                 if(name) e.querySelector('.cert-name').innerText = name;
                 if(dept) e.querySelector('.cert-dept').innerText = dept;
                 if(score) e.querySelector('.cert-score').innerText = score + "%";
                 
                 e.querySelector('.cert-course-title').innerText = `Hoàn thành khóa học ${courseTitle}`;
                 const d = new Date();
                 e.querySelector('.cert-date').innerText = `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`;
                 
                 const failMark = e.querySelector('.cert-fail-mark');
                 const dlBtn = e.querySelector('#btn-download-cert');
                 const certView = e.querySelector('#cert-view');

                 if(passed){
                    failMark.classList.add('hidden');
                    certView.classList.remove('grayscale');
                    if(dlBtn) dlBtn.classList.remove('hidden');
                 } else {
                    failMark.classList.remove('hidden');
                    certView.classList.add('grayscale');
                    if(dlBtn) dlBtn.classList.add('hidden');
                    e.querySelector('.cert-name').innerText = "---";
                    e.querySelector('.cert-dept').innerText = "";
                 }
            }
            else if(s.type === 'game-review'){
                const tbody = e.querySelector('.review-tbody');
                if(userGameHistory.length === 0){
                    tbody.innerHTML = '<tr><td colspan="3" class="p-4 text-center text-slate-400">Chưa có dữ liệu. Hãy chơi Quiz Game trước!</td></tr>';
                } else {
                    tbody.innerHTML = userGameHistory.map(item => {
                        const correctAnsText = item.qObj.isTrue ? "Đúng" : "Sai";
                        const yourAnsText = item.yourChoiceVal ? "Đúng" : "Sai";
                        
                        const rowClass = item.isCorrect ? "bg-green-50/30" : "bg-red-50/30";
                        const statusClass = item.isCorrect ? "text-green-600 font-bold" : "text-red-600 font-bold";
                        
                        return `<tr class="${rowClass} border-b border-slate-50 last:border-0">
                            <td class="p-4 align-top text-slate-800">${item.q}</td>
                            <td class="p-4 align-top text-center font-bold text-slate-600">${correctAnsText}</td>
                            <td class="p-4 align-top text-center ${statusClass}">${yourAnsText}</td>
                        </tr>`;
                    }).join('');
                }
            }
            
            c.innerHTML = '';
            e.classList.add('active');
            c.appendChild(e);
        }

        function navSlide(dir){
            const next = currentSlideIndex + dir;
            if(next >= 0 && next < slides.length){
                if(slides[currentSlideIndex].type === 'game-start' && dir === 1) return;
                if(slides[currentSlideIndex].type === 'game-play' && dir > 0) return;
                if(slides[currentSlideIndex].type === 'winner-input' && dir > 0) return;
                playSound('pop');
                currentSlideIndex = next;
                renderSlide();
            }
        }

        function toggleSidebar(){
            const sb = document.getElementById('sidebar');
            const ov = document.getElementById('sidebar-overlay');
            sb.classList.toggle('sidebar-closed');
            sb.classList.toggle('sidebar-open');
            ov.classList.toggle('hidden');
        }

        function flipCardCheck(slideEl, userChoice, isCorrectValue){
            const cardInner = slideEl.querySelector('.card-inner');
            const isUserCorrect = (userChoice === isCorrectValue);
            const cardBack = slideEl.querySelector('.card-back');
            const resultHeader = cardBack.querySelector('.result-header');
            
            // Inject User Choice & Correct Answer
            const userChoiceLabel = cardBack.querySelector('.user-choice-label');
            const correctAnsLabel = cardBack.querySelector('.correct-ans-label');
            
            if(userChoiceLabel) {
                userChoiceLabel.innerText = userChoice ? "ĐÚNG" : "SAI";
                userChoiceLabel.className = `text-xs font-bold user-choice-label ml-2 ${userChoice === isCorrectValue ? 'text-green-600' : 'text-red-600'}`;
            }
            
            if(correctAnsLabel) {
                correctAnsLabel.innerText = isCorrectValue ? "ĐÚNG" : "SAI";
                correctAnsLabel.className = "text-xs font-bold correct-ans-label ml-2 text-blue-600";
            }
            
            playSound(isUserCorrect ? 'correct' : 'incorrect');
            
            if(isUserCorrect){
                resultHeader.innerHTML = `<i class="fa-solid fa-check-circle text-green-500"></i><span class="text-green-600">CHÍNH XÁC!</span>`;
                cardBack.className = 'card-face card-back p-6 flex flex-col text-center border-2 border-green-200 bg-green-50/20';
                confetti({particleCount: 30, spread: 50, origin: {y: 0.6}});
            } else {
                resultHeader.innerHTML = `<i class="fa-solid fa-times-circle text-red-500"></i><span class="text-red-600">CHƯA ĐÚNG!</span>`;
                cardBack.className = 'card-face card-back p-6 flex flex-col text-center border-2 border-red-200 bg-red-50/20';
            }
            cardInner.classList.add('flipped');
        }

        function resetCardFlip(slideEl){
            playSound('pop');
            slideEl.querySelector('.card-inner').classList.remove('flipped');
        }

        function startGame(mode){
            let allQ = [];
            practiceTopics.forEach(t => { if(t.cards) allQ = [...allQ, ...t.cards] });
            allQ.sort(() => 0.5 - Math.random());
            gameQuestions = mode === 'standard' ? allQ.slice(0, Math.min(5, allQ.length)) : allQ;
            gameScore = 0;
            gameCurrentQIndex = 0;
            userGameHistory = [];
            const next = currentSlideIndex + 1;
            if(next < slides.length){
                playSound('pop');
                currentSlideIndex = next;
                renderSlide();
            }
        }

        function answerGame(choice){
            const q = gameQuestions[gameCurrentQIndex];
            if(!q) return;
            const isCorrect = (choice === q.isTrue);
            userGameHistory.push({
                q: q.question,
                qObj: q,
                isCorrect: isCorrect,
                yourChoiceVal: choice
            });
            playSound(isCorrect ? 'correct' : 'incorrect');
            if(isCorrect){
                gameScore++;
                confetti({particleCount: 50, spread: 60, origin: {y: 0.7}});
            } else {
                const qt = document.querySelector('.game-question-text');
                if(qt){
                    qt.parentElement.classList.add('animate-shake');
                    setTimeout(() => qt.parentElement.classList.remove('animate-shake'), 400);
                }
            }
            document.querySelectorAll('.game-btn').forEach(b => b.disabled = true);
            setTimeout(() => {
                gameCurrentQIndex++;
                if(gameCurrentQIndex < gameQuestions.length){
                    renderSlide();
                } else {
                    finishGame();
                }
            }, isCorrect ? 500 : 800);
        }

        function finishGame(){
            const total = gameQuestions.length;
            const pct = total > 0 ? Math.round((gameScore / total) * 100) : 0;
            localStorage.setItem('kv_player_score', pct);
            if(pct >= 80){
                currentSlideIndex++; // To winner-input
                renderSlide();
                playSound('win');
                confetti({particleCount: 100, spread: 100, origin: {y: 0.6}});
            } else {
                currentSlideIndex += 2; // Skip winner-input, go to cert
                renderSlide();
                playSound('fail');
            }
        }

        function submitWinnerInfo(){
            const name = document.getElementById('input-winner-name').value.trim();
            const dept = document.getElementById('input-winner-dept').value.trim();
            if(!name){ alert("Vui lòng nhập Họ tên!"); return; }
            localStorage.setItem('kv_player_name', name);
            localStorage.setItem('kv_player_dept', dept);
            currentSlideIndex++; // Go to cert
            renderSlide();
            playSound('win');
            confetti({particleCount: 200, spread: 120, origin: {y: 0.6}});
        }

        function backToGameLogin(){ currentSlideIndex = gameStartSlideIndex; renderSlide(); }

        function goToReview(){
            const idx = slides.findIndex(s => s.type === 'game-review');
            if(idx !== -1) {
                currentSlideIndex = idx;
                renderSlide();
            }
        }

        function goToOverview(){ currentSlideIndex = overviewStartIndex; renderSlide(); }
        function goToComparison(){ currentSlideIndex = comparisonSlideIndex; renderSlide(); }

        function downloadCert(){
            const originalCert = document.getElementById('cert-view');
            const loading = document.getElementById('dl-loading');
            loading.classList.remove('hidden');
            const clone = originalCert.cloneNode(true);
            clone.style.width = "1024px";
            clone.style.height = "auto";
            clone.style.aspectRatio = "16/9";
            clone.style.position = "fixed";
            clone.style.top = "0";
            clone.style.left = "-9999px";
            clone.style.zIndex = "-1";
            clone.classList.remove("shadow-xl", "rounded-xl");
            document.body.appendChild(clone);
            html2canvas(clone, { scale: 2, useCORS: true, backgroundColor: "#ffffff" }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'chung-nhan-kiotviet.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                document.body.removeChild(clone);
                loading.classList.add('hidden');
            }).catch(err => {
                console.error(err);
                alert("Lỗi khi tạo ảnh. Vui lòng thử lại!");
                loading.classList.add('hidden');
                document.body.removeChild(clone);
            });
        }

        document.addEventListener('keydown', e => {
            const s = document.querySelector('.slide.active');
            if(!s || !slides[currentSlideIndex]) return;
            const t = slides[currentSlideIndex].type;
            if(e.key === 'ArrowRight') navSlide(1);
            else if(e.key === 'ArrowLeft') navSlide(-1);
            
            if(t === 'card'){
                if(e.key === '1') s.querySelector('.btn-true')?.click();
                else if(e.key === '2') s.querySelector('.btn-false')?.click();
                else if(e.key === '0') s.querySelector('.btn-reset')?.click();
            } else if(t === 'game-start'){
                let totalQ = 0;
                practiceTopics.forEach(t => { if(t.cards) totalQ += t.cards.length; });
                if (totalQ < 10) {
                    if (e.key === 'Enter' || e.key === ' ' || e.key === 'ArrowRight') startGame('promax');
                } else {
                    if (e.key === '1') startGame('standard');
                    else if (e.key === '2') startGame('promax');
                }
            } else if(t === 'game-play'){
                if(e.key === '1') s.querySelector('.btn-game-true:not(:disabled)')?.click();
                else if(e.key === '2') s.querySelector('.btn-game-false:not(:disabled)')?.click();
            } else if(t === 'certificate' && e.key === '0') backToGameLogin();
            else if(t === 'comparison'){
                const a = s.querySelector('.comparison-scroll-area');
                if(e.key === 'ArrowUp') a.scrollTop -= 50;
                else if(e.key === 'ArrowDown') a.scrollTop += 50;
            } else if(t === 'winner-input' && e.key === 'Enter'){
                submitWinnerInfo();
            }
        });

        document.addEventListener('DOMContentLoaded', initApp);
    </script></body></html>
