<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Learning: Nhập hàng - KiotViet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f9ff; overflow-x: hidden; }
        ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-thumb { background: #93c5fd; border-radius: 3px; }
        .soft-glow-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -10; background: linear-gradient(135deg, #ffffff 0%, #e0f2fe 50%, #dcfce7 100%); }
        .soft-glow-background .shape { position: absolute; filter: blur(120px); opacity: 0.6; }
        .soft-glow-background .shape1 { height: 300px; width: 300px; background: #bae6fd; border-radius: 50%; top: -50px; left: -50px; animation: moveInCircle 25s ease-in-out infinite; }
        .soft-glow-background .shape2 { height: 350px; width: 350px; background: #bbf7d0; border-radius: 50%; bottom: -50px; right: -50px; animation: moveVertical 30s ease-in-out infinite; }
        @keyframes moveInCircle { 0% { transform: rotate(0deg); } 50% { transform: rotate(180deg); } 100% { transform: rotate(360deg); } }
        @keyframes moveVertical { 0% { transform: translateY(-20%); } 50% { transform: translateY(20%); } 100% { transform: translateY(-20%); } }
        .nav-link { transition: all 0.2s ease; border-left: 3px solid transparent; }
        .nav-link:hover { color: #2563eb; background: rgba(255, 255, 255, 0.6); }
        .nav-link.active { color: #1e3a8a; border-left: 3px solid #2563eb; background: #eff6ff; font-weight: 600; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
        
        /* Flashcard 3D CSS */
        .perspective-1000 { perspective: 1000px; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; }
        .card-inner.flipped { transform: rotateY(180deg); }
        .card-face { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            -webkit-backface-visibility: hidden; backface-visibility: hidden; 
            border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); background-color: white; 
        }
        .card-back { transform: rotateY(180deg); }
        
        .type-card { transition: all 0.3s ease; }
        .type-card:hover { box-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.1); transform: translateY(-5px); border-color: #60a5fa; }
        .chat-bubble { max-width: 90%; padding: 1rem 1.25rem; border-radius: 1rem; position: relative; font-size: 0.95rem; line-height: 1.6; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .chat-bubble-customer { background-color: #ffffff; color: #334155; border-bottom-left-radius: 0.25rem; border: 1px solid #e2e8f0; }
        .chat-bubble-consultant { background-color: #eff6ff; color: #1e40af; border-bottom-right-radius: 0.25rem; border: 1px solid #bfdbfe; }
        #mobile-overlay { transition: opacity 0.3s ease; }
        #sidebar { transition: transform 0.3s ease; }
        .sidebar-open #sidebar { transform: translateX(0); }
        .sidebar-open #mobile-overlay { opacity: 1; pointer-events: auto; }
        .sidebar-closed #sidebar { transform: translateX(-100%); }
        .sidebar-closed #mobile-overlay { opacity: 0; pointer-events: none; }
        @media (min-width: 768px) { .sidebar-closed #sidebar { transform: translateX(0); } }
        .certificate-container { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); transition: filter 0.3s ease; }
        .watermark { position: absolute; top: 50%; left: 60%; transform: translate(-50%, -50%) rotate(-30deg); font-size: 6rem; font-weight: 900; color: rgba(200, 0, 0, 0.05); pointer-events: none; z-index: 0; }
        .grayscale-filter { filter: grayscale(100%); }
        .animate-fade-in-up { animation: fadeInUp 0.5s ease-out; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="text-slate-700 antialiased h-screen flex flex-col overflow-hidden sidebar-closed" id="app-body">
    <div class="soft-glow-background"><div class="shape shape1"></div><div class="shape shape2"></div></div>
    
    <!-- HEADER -->
    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-white/50 h-20 shadow-sm flex-shrink-0">
        <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 h-full">
            <div class="flex items-center justify-between h-full gap-4 lg:gap-8">
                <a href="https://kiotvietlnd.github.io/elearning/" class="flex-shrink-0 flex items-center gap-3 select-none hover:opacity-80 transition-opacity">
                    <img src="https://logo.kiotviet.vn/KiotViet-Logo-Horizontal.svg" alt="KiotViet Logo" class="h-6 lg:h-8">
                    <span class="text-slate-300 font-light text-xl lg:text-2xl">|</span>
                    <span class="font-bold text-blue-700 tracking-tight text-base lg:text-lg uppercase">E-Learning</span>
                </a>
                <nav class="hidden lg:flex flex-1 justify-end items-center gap-4">
                    <a href="https://www.kiotviet.vn/ho-tro" target="_blank" class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-full font-bold text-sm shadow-md hover:bg-blue-700 hover:-translate-y-0.5 transition-all"><i class="fa-solid fa-book-open-reader"></i> Kho Tài liệu HDSD</a>
                    <a href="https://www.youtube.com/@HDSDPhanmemKiotViet" target="_blank" class="flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-full font-bold text-sm shadow-md hover:bg-red-700 hover:-translate-y-0.5 transition-all"><i class="fa-brands fa-youtube"></i> Kho Video HDSD</a>
                </nav>
                <div class="lg:hidden"><button onclick="toggleSidebar()" class="text-slate-600 hover:text-blue-700 text-2xl"><i class="fa-solid fa-bars"></i></button></div>
            </div>
        </div>
    </header>

    <div class="flex-1 flex overflow-hidden relative">
        <div id="mobile-overlay" class="fixed inset-0 bg-black/20 z-40 md:hidden" onclick="toggleSidebar()"></div>
        
        <!-- SIDEBAR -->
        <aside id="sidebar" class="absolute inset-y-0 left-0 z-50 w-80 bg-white/95 backdrop-blur-xl border-r border-white/60 shadow-2xl md:static md:bg-white/60 md:shadow-lg md:rounded-r-2xl flex flex-col transform transition-transform duration-300">
            <div class="p-5 border-b border-slate-100 flex-shrink-0">
                <div class="flex justify-between items-start mb-4 md:hidden"><img src="https://logo.kiotviet.vn/KiotViet-Logo-Horizontal.svg" alt="Logo" class="h-5"><button onclick="toggleSidebar()" class="text-slate-400"><i class="fa-solid fa-xmark text-xl"></i></button></div>
                <h2 class="font-black text-lg leading-tight mb-2 uppercase text-blue-700">Nhập hàng</h2>
                <h3 class="font-bold text-slate-500 text-xs uppercase tracking-wider mb-2">TIẾN ĐỘ BÀI HỌC</h3>
                <div class="w-full bg-slate-200 rounded-full h-2"><div id="totalProgress" class="bg-blue-600 hover:bg-blue-700 h-2 rounded-full transition-all duration-500" style="width: 0%"></div></div>
                <div class="flex justify-between mt-1 text-[10px] text-slate-500 font-medium"><span id="completedCount">0/0</span><span>Hoàn thành</span></div>
            </div>
            <nav class="flex-1 overflow-y-auto p-3 space-y-2 custom-scrollbar">
                 <button onclick="switchTab('cheatsheet')" id="nav-cheatsheet" class="nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3 active"><i class="fa-solid fa-bolt text-yellow-500 w-6 text-center"></i><span class="font-bold text-sm">Cẩm nang nghiệp vụ</span></button>
                 <div class="mt-4 mb-2 px-3 text-[10px] font-bold text-slate-400 uppercase">TÌM HIỂU CHI TIẾT</div>
                 <div id="dynamic-nav-container"></div>
                 <div class="mt-4 mb-2 px-3 text-[10px] font-bold text-slate-400 uppercase">Ôn tập</div>
                 <button onclick="switchTab('all-chats')" id="nav-all-chats" class="nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3"><i class="fa-solid fa-comments text-pink-500 w-6 text-center"></i><span class="font-bold text-sm">Xem toàn bộ hội thoại</span></button>
                 <button onclick="switchTab('summary')" id="nav-summary" class="nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3"><i class="fa-solid fa-table-columns text-purple-500 w-6 text-center"></i><span class="font-bold text-sm">Bảng so sánh</span></button>
                 <button onclick="switchTab('game')" id="nav-game" class="nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3"><i class="fa-solid fa-gamepad text-orange-500 w-6 text-center"></i><span class="font-bold text-sm">Quiz Game</span></button>
            </nav>
            <div class="p-4 bg-slate-50 border-t border-slate-100 text-center text-[10px] text-slate-400">© KiotViet Learning & Development Department</div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="flex-1 overflow-y-auto scroll-smooth p-4 md:p-8" id="contentArea">
            <div class="max-w-5xl mx-auto pb-20" id="lessonContainer">
                
                <!-- TAB CHEATSHEET -->
                <div id="tab-cheatsheet" class="tab-content block animate-fade-in-up">
                    <div class="mb-8 text-center">
                         <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider border border-blue-200">Đào tạo Sản phẩm Ngành Bán lẻ</span>
                        <h1 class="text-3xl md:text-4xl font-black text-blue-700 mt-4 leading-tight">Nhập hàng</h1>
                        <p class="text-slate-500 mt-3 italic text-base md:text-lg max-w-2xl mx-auto">Hướng dẫn tạo phiếu nhập kho, quản lý nhà cung cấp và ghi nhận công nợ tự động trên KiotViet.</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                            <h3 class="text-lg font-bold text-blue-700 mb-4 flex items-center gap-2"><i class="fa-solid fa-road"></i> Quy trình nhập kho</h3>
                            <ul class="space-y-4">
                                <li class="flex gap-3">
                                    <span class="flex-shrink-0 w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-xs">1</span>
                                    <span class="text-sm"><strong>Truy cập:</strong> Hàng hóa → Nhập hàng → <strong>+ Nhập hàng</strong>.</span>
                                </li>
                                <li class="flex gap-3">
                                    <span class="flex-shrink-0 w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-xs">2</span>
                                    <span class="text-sm"><strong>Chọn hàng:</strong> Tìm tên → Chọn Đơn vị tính (Thùng/Lốc) → Nhập Số lượng & Giá.</span>
                                </li>
                                <li class="flex gap-3">
                                    <span class="flex-shrink-0 w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-xs">3</span>
                                    <span class="text-sm"><strong>Hoàn tất:</strong> Nhấn "Hoàn thành" để tăng tồn kho ngay lập tức.</span>
                                </li>
                            </ul>
                        </div>
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                            <h3 class="text-lg font-bold text-orange-600 mb-4 flex items-center gap-2"><i class="fa-solid fa-star"></i> Quản lý Đối tác & Công nợ</h3>
                            <ul class="space-y-4">
                                <li class="flex gap-3">
                                    <i class="fa-solid fa-user-plus text-orange-400 mt-1"></i>
                                    <div class="text-sm">
                                        <strong>Nhà cung cấp:</strong> 
                                        <p class="text-slate-500 text-xs mt-1">Nhấn dấu <strong>(+)</strong> để tạo nhanh NCC mới ngay trên phiếu nhập.</p>
                                    </div>
                                </li>
                                <li class="flex gap-3">
                                    <i class="fa-solid fa-file-invoice-dollar text-orange-400 mt-1"></i>
                                    <div class="text-sm">
                                        <strong>Công nợ tự động:</strong> 
                                        <p class="text-slate-500 text-xs mt-1">Nếu chưa thanh toán, để ô "Tiền trả NCC" = <strong>0</strong>. Hệ thống tự ghi nợ.</p>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- DYNAMIC TABS WILL BE INJECTED HERE -->
                
                <!-- TAB: ALL CHATS -->
                <div id="tab-all-chats" class="tab-content hidden animate-fade-in-up"></div>

                <!-- TAB: SUMMARY -->
                <div id="tab-summary" class="tab-content hidden animate-fade-in-up">
                    <h2 class="text-xl font-bold text-blue-700 mb-6 border-l-4 border-slate-400 pl-3">Bảng so sánh: Lầm tưởng & Sự thật</h2>
                    <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                        <table class="w-full table-fixed border-collapse">
                            <thead>
                                <tr class="bg-slate-100 text-slate-600 text-sm uppercase tracking-wider">
                                    <th class="w-16 py-4 border-r border-slate-200 text-center">#</th>
                                    <th class="w-[45%] py-4 border-r border-slate-200 text-center text-red-600 bg-red-50/50">Lầm tưởng (Sai)</th>
                                    <th class="w-[45%] py-4 text-center text-green-600 bg-green-50/50">Sự thật (Đúng)</th>
                                </tr>
                            </thead>
                            <tbody id="summaryTableBody" class="text-sm"></tbody>
                        </table>
                    </div>
                </div>

                <!-- TAB: GAME -->
                <div id="tab-game" class="tab-content hidden animate-fade-in-up">
                    <!-- GAME START -->
                    <div id="game-start" class="text-center py-20 bg-white/60 backdrop-blur rounded-3xl border border-white/50 shadow-xl">
                        <div class="inline-block p-6 rounded-full bg-orange-100 mb-6 animate-bounce"><i class="fa-solid fa-gamepad text-5xl md:text-6xl text-orange-500"></i></div>
                        <h2 class="text-2xl md:text-3xl font-black text-slate-800 mb-4 tracking-tight">Quiz Game: Chuyên Gia Kho Vận</h2>
                        <p class="text-slate-600 mb-6 max-w-lg mx-auto leading-relaxed text-sm md:text-base">Hệ thống sẽ hiển thị ngẫu nhiên các nhận định.<br><strong>Đạt 80% để nhận Chứng chỉ.</strong></p>
                        <div class="mb-8 flex justify-center"><input type="text" id="player-name" placeholder="Nhập tên của bạn..." class="px-5 py-3 rounded-lg border border-slate-300 w-full max-w-md text-center font-medium shadow-inner"></div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 max-w-3xl mx-auto">
                            <button id="btn-mode-standard" onclick="startGame('standard')" class="bg-white border border-blue-200 text-blue-700 px-4 py-3 rounded-lg font-bold shadow-sm text-sm"><div class="text-base mb-1">Tiêu Chuẩn</div><div class="text-xs font-normal text-slate-500">4 Câu hỏi ngẫu nhiên</div></button>
                            <button id="btn-mode-pro" onclick="startGame('pro')" class="bg-white border border-purple-200 text-purple-700 px-4 py-3 rounded-lg font-bold shadow-sm text-sm"><div class="text-base mb-1">Pro</div><div class="text-xs font-normal text-slate-500">5 Câu hỏi ngẫu nhiên</div></button>
                            <button id="btn-mode-promax" onclick="startGame('promax')" class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-4 py-3 rounded-lg font-bold shadow-lg text-sm"><div class="text-base mb-1" id="btn-promax-text">Promax (Full)</div><div class="text-xs font-normal text-white/80">Toàn bộ câu hỏi</div></button>
                        </div>
                    </div>
                    <!-- GAME PLAYING -->
                    <div id="game-playing" class="hidden max-w-2xl mx-auto py-6">
                        <div class="flex justify-between items-center mb-6 px-2">
                            <div class="text-slate-400 font-bold uppercase text-xs tracking-wider">Câu hỏi: <span id="q-progress" class="text-blue-600 text-base">1/10</span></div>
                            <div class="text-xs font-bold bg-white px-3 py-1.5 rounded-full border border-slate-200 shadow-sm text-slate-600">Score: <span id="current-score" class="text-green-600">0</span></div>
                        </div>
                        
                        <!-- GAME CARD - SIMPLE CONTAINER (NO FLIP) -->
                        <div id="game-card-container" class="w-full h-[300px] mb-6 relative z-10">
                            <!-- Card Body -->
                            <div id="game-card-content" class="w-full h-full bg-white rounded-3xl shadow-xl p-8 flex flex-col justify-center items-center text-center border border-slate-100 relative overflow-hidden transition-all duration-300">
                                 <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-400 to-green-400"></div>
                                 <!-- Question Content -->
                                 <h3 id="question-text" class="text-lg md:text-xl font-extrabold text-slate-800 leading-snug animate-fade-in-up">Loading...</h3>
                                 <!-- Result Notification (Hidden by default) -->
                                 <div id="result-notification" class="hidden absolute inset-0 bg-white/95 flex flex-col justify-center items-center z-20">
                                     <!-- JS will populate this -->
                                 </div>
                            </div>
                        </div>

                        <!-- Buttons -->
                        <div class="grid grid-cols-2 gap-4">
                            <button id="btn-true" onclick="answerGame(true)" class="py-3 md:py-4 rounded-2xl bg-white border-2 border-green-100 hover:border-green-500 hover:bg-green-50 text-green-600 font-bold text-base md:text-xl shadow-sm hover:shadow-lg transition-all transform active:scale-95 group"><i class="fa-solid fa-check-circle mb-1 block text-xl md:text-2xl group-hover:scale-110 transition-transform"></i> ĐÚNG</button>
                            <button id="btn-false" onclick="answerGame(false)" class="py-3 md:py-4 rounded-2xl bg-white border-2 border-red-100 hover:border-red-500 hover:bg-red-50 text-red-600 font-bold text-base md:text-xl shadow-sm hover:shadow-lg transition-all transform active:scale-95 group"><i class="fa-solid fa-times-circle mb-1 block text-xl md:text-2xl group-hover:scale-110 transition-transform"></i> SAI</button>
                        </div>
                    </div>
                    
                    <!-- GAME RESULT -->
                    <div id="game-result" class="hidden flex flex-col items-center">
                        <div id="certificate" class="w-full max-w-4xl aspect-video bg-white shadow-2xl flex overflow-hidden certificate-container mx-auto">
                            <div class="w-1/3 bg-blue-900 flex flex-col items-center justify-center text-white p-6 relative">
                                <div class="mb-6"><i class="fa-solid fa-award text-6xl text-yellow-400"></i></div>
                                <div class="text-center z-10"><p class="uppercase tracking-widest text-[10px] opacity-70 mb-1">Cấp bởi</p><p class="font-bold text-sm leading-tight">KiotViet LND Department</p></div>
                                <div class="absolute bottom-0 left-0 w-full h-2 bg-green-500"></div><div class="absolute top-0 right-0 w-2 h-full bg-black/10"></div>
                            </div>
                            <div class="w-2/3 p-8 md:p-12 flex flex-col justify-center relative bg-white">
                                <div id="fail-watermark" class="watermark hidden">Suýt đạt</div>
                                <h1 class="text-3xl md:text-4xl font-black text-blue-900 uppercase mb-1 font-sans tracking-tight">GIẤY CHỨNG NHẬN</h1>
                                <p class="text-slate-500 italic text-sm mb-6 border-b border-slate-100 pb-4">Đã hoàn thành xuất sắc nội dung đào tạo sản phẩm</p>
                                <div class="space-y-1 mb-6"><p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider">Trao tặng cho:</p><h2 class="text-2xl md:text-3xl font-bold text-blue-700 uppercase leading-tight" id="certificate-name">TÊN HỌC VIÊN</h2></div>
                                <div class="space-y-1 mb-6"><p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider">Học phần:</p><h3 class="text-xl font-bold text-slate-800 uppercase">Nhập hàng</h3></div>
                                <div class="flex justify-between items-end mt-auto pt-4 border-t border-slate-100">
                                    <div><p class="text-[10px] text-slate-400 uppercase font-bold">Ngày hoàn thành</p><p class="text-sm font-medium text-slate-600" id="cert-date">dd/mm/yyyy</p></div>
                                    <div class="text-right"><p class="text-[10px] text-slate-400 uppercase font-bold">Điểm số</p><p class="text-xl font-black text-green-600" id="final-score-cert">100%</p></div>
                                </div>
                            </div>
                        </div>
                        <div id="fail-message-container" class="hidden mt-6 bg-red-50 px-6 py-4 rounded-xl border border-red-100 text-center">
                            <p class="text-red-600 font-bold"><i class="fa-solid fa-triangle-exclamation mr-2"></i>Chưa đạt yêu cầu nhận chứng nhận (Cần >80%)</p>
                            <p class="text-sm text-slate-600 mt-1">Hãy ôn lại kiến thức và thử lại nhé!</p>
                        </div>
                        <div class="flex flex-wrap justify-center gap-4 mt-8 mb-12">
                            <button onclick="playAgain()" class="bg-white border-2 border-blue-600 text-blue-700 px-6 py-3 rounded-full font-bold shadow-sm hover:bg-blue-50 transition"><i class="fa-solid fa-rotate-right mr-2"></i> Chơi lại</button>
                            <button onclick="switchTab('cheatsheet')" class="bg-white border border-slate-200 text-slate-700 px-6 py-3 rounded-full font-bold shadow hover:bg-slate-50 transition flex items-center gap-2"><i class="fa-solid fa-bolt text-yellow-500"></i> Xem Cẩm nang</button>
                            <button id="btn-download" onclick="downloadCertificate()" class="bg-blue-600 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-blue-700 transition hidden"><i class="fa-solid fa-download mr-2"></i> Tải chứng nhận</button>
                        </div>
                        <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden w-full">
                            <h3 class="text-xl font-bold text-blue-900 px-6 py-4 bg-slate-50 border-b border-slate-100">Chi tiết kết quả</h3>
                            <table class="min-w-full divide-y divide-slate-100"><thead class="bg-white"><tr><th class="px-6 py-4 text-center text-xs font-bold text-slate-500 uppercase">Câu hỏi</th><th class="px-6 py-4 text-center text-xs font-bold text-slate-500 uppercase w-32">Bạn chọn</th><th class="px-6 py-4 text-center text-xs font-bold text-slate-500 uppercase w-40">Kết quả</th></tr></thead><tbody id="review-body" class="bg-white divide-y divide-slate-100 text-sm"></tbody></table>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script>
        // DỮ LIỆU BÀI HỌC
        const lessonData = [
            {
                id: 1,
                title: "Thao tác Nhập hàng",
                icon: "fa-solid fa-truck-ramp-box",
                chat: [
                    { role: "customer", text: "Em ơi, bên giao hàng vừa chở đến 10 thùng 'Sữa tươi Ba Vì - Vani' mà anh tạo mã hôm trước. Giờ anh vào đâu để nhập kho số lượng này?" },
                    { role: "consultant", text: "Dạ, để nhập kho và quản lý công nợ, anh vào menu <strong>Hàng hóa</strong>, chọn <strong>Nhập hàng</strong>, sau đó nhấn nút <strong>+ Nhập hàng</strong> ở góc phải nhé." },
                    { role: "customer", text: "Rồi, anh đã tìm thấy tên sản phẩm. Nhưng anh nhập theo 'Thùng', mà trên màn hình nó đang hiện giá của 'Hộp'. Anh phải tự nhân chia ra số hộp à?" },
                    { role: "consultant", text: "Dạ không cần tính tay đâu ạ. Ngay trên dòng sản phẩm đó, anh click vào ô đơn vị tính và chọn là <strong>Thùng</strong>. Sau đó anh nhập số lượng là 10 và điền giá nhập mua vào là được ạ." },
                    { role: "customer", text: "Tiện thật. À mà lô này anh lấy của 'Nhà cung cấp A', đây là mối mới, anh chưa lưu tên họ vào máy thì làm thế nào?" },
                    { role: "consultant", text: "Anh không cần thoát ra đâu ạ. Ở góc phải màn hình, cạnh ô tìm kiếm nhà cung cấp có <strong>dấu cộng (+)</strong>. Anh nhấn vào đó để thêm nhanh thông tin 'Nhà cung cấp A' rồi lưu lại là xong." },
                    { role: "customer", text: "OK. Mà do là chỗ mới nên anh thỏa thuận bán hết mới trả tiền, giờ chưa thanh toán đồng nào cả." },
                    { role: "consultant", text: "Vậy tại ô <strong>Tiền trả nhà cung cấp</strong>, anh cứ để số tiền là <strong>0</strong>. Hệ thống sẽ tự động ghi nhận toàn bộ giá trị đơn hàng này vào công nợ phải trả. Cuối cùng anh nhấn <strong>Hoàn thành</strong> nhé." },
                    { role: "customer", text: "Anh nhấn Hoàn thành rồi. Vậy là kho tự tăng lên 10 thùng rồi đúng không?" },
                    { role: "consultant", text: "Chính xác ạ. Tồn kho đã tự động cập nhật và công nợ của NCC A cũng đã được ghi nhận ngay lập tức." }
                ],
                cards: [
                    {
                        id: 201,
                        isTrue: false,
                        question: "Tồn kho sản phẩm chỉ được cập nhật sau khi chủ cửa hàng thực hiện thao tác Kiểm kho định kỳ cuối tháng.",
                        wrong: "Tồn kho sản phẩm chỉ được cập nhật sau khi chủ cửa hàng thực hiện thao tác Kiểm kho định kỳ cuối tháng.",
                        right: "Ngay sau khi nhấn nút 'Hoàn thành' trên phiếu nhập hàng, hệ thống tự động cộng thêm số lượng hàng vào tồn kho hiện tại.",
                        detail: "Việc cập nhật thời gian thực giúp chủ cửa hàng luôn nắm được chính xác số lượng hàng sẵn bán."
                    },
                    {
                        id: 202,
                        isTrue: false,
                        question: "Để nhập hàng, người dùng thao tác trực tiếp việc cộng số lượng tại màn hình Danh sách hàng hóa hoặc màn hình Thu ngân.",
                        wrong: "Để nhập hàng, người dùng thao tác trực tiếp việc cộng số lượng tại màn hình Danh sách hàng hóa hoặc màn hình Thu ngân.",
                        right: "Người dùng cần truy cập menu Hàng hóa -> chọn Nhập hàng, sau đó nhấn nút '+ Nhập hàng' để tạo phiếu nhập kho chuẩn.",
                        detail: "Tạo phiếu nhập giúp ghi nhận lịch sử giao dịch và quản lý công nợ, thay vì chỉ điều chỉnh số lượng thủ công."
                    },
                    {
                        id: 203,
                        isTrue: true,
                        question: "Hệ thống cho phép chọn trực tiếp Đơn vị tính (như Thùng/Lốc) ngay trên phiếu nhập mà không cần tính toán quy đổi thủ công.",
                        wrong: "Khi nhập hàng theo đơn vị lớn (Thùng), người dùng bắt buộc phải tự quy đổi ra đơn vị cơ bản (Hộp/Cái) để nhập vào hệ thống.",
                        right: "Hệ thống cho phép chọn trực tiếp Đơn vị tính (như Thùng/Lốc) ngay trên phiếu nhập mà không cần tính toán quy đổi thủ công.",
                        detail: "Hệ thống sẽ tự động nhân số lượng quy đổi để cộng vào kho đơn vị cơ bản."
                    },
                    {
                        id: 204,
                        isTrue: true,
                        question: "Tại màn hình Nhập hàng, người dùng có thể tạo nhanh Nhà cung cấp mới bằng cách nhấn vào biểu tượng dấu cộng (+) cạnh ô tìm kiếm.",
                        wrong: "Nếu nhà cung cấp chưa có trên hệ thống, người dùng bắt buộc phải thoát màn hình Nhập hàng để vào menu Đối tác tạo mới trước.",
                        right: "Tại màn hình Nhập hàng, người dùng có thể tạo nhanh Nhà cung cấp mới bằng cách nhấn vào biểu tượng dấu cộng (+) cạnh ô tìm kiếm.",
                        detail: "Tính năng này giúp đảm bảo luồng công việc không bị gián đoạn."
                    },
                    {
                        id: 205,
                        isTrue: false,
                        question: "Để ghi nợ nhà cung cấp, người dùng phải tạo phiếu nhập hàng xong, sau đó sang màn hình Sổ quỹ để lập phiếu ghi nợ riêng.",
                        wrong: "Để ghi nợ nhà cung cấp, người dùng phải tạo phiếu nhập hàng xong, sau đó sang màn hình Sổ quỹ để lập phiếu ghi nợ riêng.",
                        right: "Tại phiếu nhập hàng, nếu nhập số tiền ở ô 'Tiền trả nhà cung cấp' nhỏ hơn tổng tiền hàng (hoặc bằng 0), hệ thống tự động ghi nhận khoản còn thiếu là công nợ.",
                        detail: "Đây là cơ chế theo dõi công nợ tự động, giúp giảm thiểu sai sót do quên ghi chép."
                    },
                    {
                        id: 206,
                        isTrue: true,
                        question: "Người dùng có thể nhập/điền chính xác đơn giá nhập của lần nhập hàng hiện tại vào cột Giá nhập trên phiếu.",
                        wrong: "Hệ thống luôn mặc định lấy giá vốn cũ làm giá nhập và không cho phép chỉnh sửa giá này trên phiếu nhập hàng.",
                        right: "Người dùng có thể nhập/điền chính xác đơn giá nhập của lần nhập hàng hiện tại (Ví dụ: 240,000đ) vào cột Giá nhập trên phiếu.",
                        detail: "Giá nhập thực tế này sẽ được dùng để tính lại Giá vốn trung bình của sản phẩm."
                    }
                ]
            }
        ];

        // GLOBAL STATE
        let completedCards = new Set();
        let totalCards = 0;
        let currentGameQuestions = [];
        let currentGameIndex = 0;
        let currentScore = 0;
        let playerHistory = [];

        // INIT & NAVIGATION
        function renderNav() {
            const navContainer = document.getElementById('dynamic-nav-container');
            const mainContainer = document.getElementById('lessonContainer');
            
            navContainer.innerHTML = '';
            document.querySelectorAll('.dynamic-topic-tab').forEach(e => e.remove());
            
            let allCards = [];

            lessonData.forEach((topic, index) => {
                // 1. Sidebar Link
                const btn = document.createElement('button');
                btn.className = `nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3`;
                btn.id = `nav-topic-${topic.id}`;
                btn.onclick = () => switchTab(`topic-${topic.id}`);
                btn.innerHTML = `<i class="${topic.icon} w-6 text-center text-blue-500"></i><span class="font-bold text-sm">${topic.title}</span>`;
                navContainer.appendChild(btn);

                // 2. Content Tab
                const div = document.createElement('div');
                div.id = `tab-topic-${topic.id}`;
                div.className = `tab-content hidden animate-fade-in-up dynamic-topic-tab`;
                
                // Render Chat
                let chatHTML = '';
                if(topic.chat && topic.chat.length > 0) {
                    chatHTML = `<div class="mb-10 space-y-4 max-w-3xl mx-auto">
                        <h3 class="font-bold text-slate-400 text-xs uppercase tracking-wider mb-4 text-center">Hội thoại ngữ cảnh</h3>
                        ${topic.chat.map(msg => `
                            <div class="flex ${msg.role === 'customer' ? 'justify-start' : 'justify-end'}">
                                <div class="chat-bubble ${msg.role === 'customer' ? 'chat-bubble-customer' : 'chat-bubble-consultant'}">
                                    <div class="text-[10px] font-bold uppercase mb-1 opacity-70">${msg.role === 'customer' ? 'Chủ cửa hàng' : 'Chuyên viên KiotViet'}</div>
                                    ${msg.text}
                                </div>
                            </div>
                        `).join('')}
                    </div>`;
                }

                // Render Cards
                const cardsHTML = topic.cards.map(card => {
                    allCards.push(card);
                    return `
                    <div class="h-[500px] w-full perspective-1000 group">
                        <div class="card-inner w-full h-full duration-500" id="card-container-${card.id}">
                            <!-- FRONT -->
                            <div class="card-face p-6 flex flex-col justify-between items-center text-center border-2 border-slate-100 type-card bg-white">
                                <div class="w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center text-blue-600 font-bold text-lg mb-2">${card.id}</div>
                                <h3 class="text-slate-700 text-lg leading-snug font-normal">${card.question}</h3>
                                <div class="mt-4 flex gap-3 w-full">
                                    <button onclick="flipCard(${card.id}, true)" class="flex-1 py-2 bg-green-50 text-green-600 rounded-lg font-bold hover:bg-green-100 transition text-sm">ĐÚNG</button>
                                    <button onclick="flipCard(${card.id}, false)" class="flex-1 py-2 bg-red-50 text-red-600 rounded-lg font-bold hover:bg-red-100 transition text-sm">SAI</button>
                                </div>
                                <div class="absolute top-2 right-2 text-slate-300"><i class="fa-solid fa-rotate"></i></div>
                            </div>
                            <!-- BACK -->
                            <div class="card-face card-back"></div>
                        </div>
                    </div>`;
                }).join('');

                div.innerHTML = `
                    <div class="mb-6"><h2 class="text-2xl font-black text-blue-700">${topic.title}</h2></div>
                    ${chatHTML}
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">${cardsHTML}</div>
                `;
                
                const summaryTab = document.getElementById('tab-all-chats');
                mainContainer.insertBefore(div, summaryTab);
            });

            totalCards = allCards.length;
            document.getElementById('totalProgress').style.width = '0%';
            document.getElementById('completedCount').innerText = `0/${totalCards}`;

            // Render Summary
            const tbody = document.getElementById('summaryTableBody');
            tbody.innerHTML = allCards.map(c => `
                <tr class="hover:bg-slate-50 border-b border-slate-100 transition-colors">
                    <td class="py-4 text-center font-bold text-slate-400 border-r border-slate-100">${c.id}</td>
                    <td class="py-4 px-4 align-top text-red-700 border-r border-slate-100 bg-red-50/20">${c.wrong}</td>
                    <td class="py-4 px-4 align-top text-green-700 bg-green-50/20 font-medium">${c.right}</td>
                </tr>
            `).join('');

            // Render All Chats
            const allChatsContainer = document.getElementById('tab-all-chats');
            allChatsContainer.innerHTML = `
                <h2 class="text-xl font-bold text-blue-700 mb-6 border-l-4 border-slate-400 pl-3">Toàn bộ hội thoại</h2>
                <div class="space-y-8 max-w-4xl mx-auto">
                    ${lessonData.map(topic => `
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                            <h3 class="font-bold text-blue-600 mb-4 border-b border-slate-100 pb-2">${topic.title}</h3>
                            <div class="space-y-3">
                                ${topic.chat.map(msg => `
                                    <div class="flex ${msg.role === 'customer' ? 'justify-start' : 'justify-end'}">
                                        <div class="chat-bubble ${msg.role === 'customer' ? 'chat-bubble-customer' : 'chat-bubble-consultant'}">
                                            <div class="text-[10px] font-bold uppercase mb-1 opacity-70">${msg.role === 'customer' ? 'Chủ cửa hàng' : 'Chuyên viên KiotViet'}</div>
                                            ${msg.text}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`tab-${tabId}`).classList.remove('hidden');
            
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            const navBtn = document.getElementById(`nav-${tabId}`);
            if(navBtn) navBtn.classList.add('active');
            
            if(window.innerWidth < 768) {
                document.body.classList.remove('sidebar-open');
                document.body.classList.add('sidebar-closed');
            }
        }

        function toggleSidebar() {
            const body = document.getElementById('app-body');
            if (body.classList.contains('sidebar-closed')) {
                body.classList.remove('sidebar-closed');
                body.classList.add('sidebar-open');
            } else {
                body.classList.remove('sidebar-open');
                body.classList.add('sidebar-closed');
            }
        }

        // FLIP CARD LOGIC
        function flipCard(id, choice, prefix = '') {
            const containerId = prefix + 'card-container-' + id;
            const inner = document.getElementById(containerId);
            if (!inner) return;

            let item;
            lessonData.forEach(t => {
                const found = t.cards.find(c => c.id === id);
                if(found) item = found;
            });
            if (!item) return;

            const backFace = inner.querySelector('.card-back');
            const isCorrect = (choice === item.isTrue);
            
            const resultHeader = isCorrect 
                ? '<div class="mb-2 font-bold text-lg text-green-600 flex items-center justify-center gap-2"><i class="fa-solid fa-check-circle"></i> Chính xác!</div>' 
                : '<div class="mb-2 font-bold text-lg text-red-600 flex items-center justify-center gap-2"><i class="fa-solid fa-times-circle"></i> Chưa chính xác!</div>';
            
            const badgeClass = item.isTrue ? 'bg-green-100 text-green-700 border-green-200' : 'bg-red-100 text-red-700 border-red-200';
            const badgeText = item.isTrue ? 'ĐÚNG' : 'SAI';
            const backBorderClass = isCorrect ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50';

            backFace.className = `card-face card-back p-5 border-2 flex flex-col rounded-2xl text-center ${backBorderClass}`;
            backFace.innerHTML = `
                <div class="flex flex-col h-full overflow-y-auto custom-scrollbar">
                    ${resultHeader}
                    <div class="mb-4 text-sm text-slate-500 italic"><span class="font-bold">Nhận định:</span> "${item.question}"</div>
                    <div class="mb-4"><span class="px-3 py-1 rounded-full text-[10px] font-bold border ${badgeClass}">${badgeText}</span></div>
                    <div class="bg-white p-4 rounded-xl border border-blue-100 shadow-sm text-left flex-1">
                        <p class="text-xs text-blue-600 font-bold uppercase mb-2 flex items-center gap-2"><i class="fa-solid fa-lightbulb"></i> Chính xác là nhận định này...</p>
                        <p class="text-slate-700 text-sm leading-relaxed font-medium">${item.right}</p>
                        <p class="text-slate-600 text-xs mt-2 pt-2 border-t border-slate-100">${item.detail || ''}</p>
                    </div>
                    <button onclick="event.stopPropagation(); resetCard(${item.id}, '${prefix}')" class="mt-4 text-xs text-slate-400 font-bold hover:text-blue-600 uppercase tracking-wider flex items-center justify-center gap-1"><i class="fa-solid fa-rotate-left"></i> Xem lại câu hỏi</button>
                </div>`;

            inner.classList.add('flipped');
            
            if (!prefix && !completedCards.has(id)) {
                completedCards.add(id);
                updateProgress();
            }
        }

        function resetCard(id, prefix = '') {
            const containerId = prefix + 'card-container-' + id;
            const inner = document.getElementById(containerId);
            if(inner) inner.classList.remove('flipped');
        }

        function updateProgress() {
            const pct = Math.round((completedCards.size / totalCards) * 100);
            document.getElementById('totalProgress').style.width = `${pct}%`;
            document.getElementById('completedCount').innerText = `${completedCards.size}/${totalCards}`;
        }

        // GAME LOGIC
        function startGame(mode) {
            const name = document.getElementById('player-name').value.trim();
            if(!name) { alert("Vui lòng nhập tên của bạn!"); return; }
            
            let allQ = [];
            lessonData.forEach(t => t.cards.forEach(c => allQ.push(c)));
            allQ.sort(() => 0.5 - Math.random());
            
            if(mode === 'standard') currentGameQuestions = allQ.slice(0, 4);
            else if(mode === 'pro') currentGameQuestions = allQ.slice(0, 5);
            else currentGameQuestions = allQ;

            if(currentGameQuestions.length === 0) return;

            currentGameIndex = 0;
            currentScore = 0;
            playerHistory = [];

            document.getElementById('game-start').classList.add('hidden');
            document.getElementById('game-playing').classList.remove('hidden');
            document.getElementById('game-result').classList.add('hidden');
            
            loadGameQuestion();
        }

        function loadGameQuestion() {
            const item = currentGameQuestions[currentGameIndex];
            document.getElementById('q-progress').innerText = `${currentGameIndex + 1}/${currentGameQuestions.length}`;
            document.getElementById('current-score').innerText = currentScore;
            document.getElementById('question-text').innerText = `"${item.question}"`;
            
            const resDiv = document.getElementById('result-notification');
            resDiv.classList.add('hidden');
            resDiv.innerHTML = '';
            
            document.getElementById('btn-true').disabled = false;
            document.getElementById('btn-false').disabled = false;
        }

        function answerGame(choice) {
            const item = currentGameQuestions[currentGameIndex];
            const isCorrect = (choice === item.isTrue);
            
            document.getElementById('btn-true').disabled = true;
            document.getElementById('btn-false').disabled = true;

            if(isCorrect) currentScore++;
            
            playerHistory.push({
                q: item.question,
                choice: choice,
                isCorrect: isCorrect,
                result: isCorrect ? 'Đúng' : 'Sai'
            });

            const resDiv = document.getElementById('result-notification');
            resDiv.classList.remove('hidden');
            resDiv.innerHTML = isCorrect 
                ? `<i class="fa-solid fa-check-circle text-6xl text-green-500 mb-4 animate-bounce"></i><div class="text-2xl font-black text-green-600">CHÍNH XÁC!</div>`
                : `<i class="fa-solid fa-times-circle text-6xl text-red-500 mb-4 animate-shake"></i><div class="text-2xl font-black text-red-600">SAI RỒI!</div>`;
            
            if(isCorrect) confetti({ particleCount: 50, spread: 60, origin: { y: 0.6 } });

            setTimeout(() => {
                currentGameIndex++;
                if(currentGameIndex < currentGameQuestions.length) {
                    loadGameQuestion();
                } else {
                    endGame();
                }
            }, 1200);
        }

        function endGame() {
            document.getElementById('game-playing').classList.add('hidden');
            document.getElementById('game-result').classList.remove('hidden');
            
            const total = currentGameQuestions.length;
            const percentage = Math.round((currentScore / total) * 100);
            const passed = percentage >= 80;
            const playerName = document.getElementById('player-name').value;
            
            document.getElementById('certificate-name').innerText = playerName;
            document.getElementById('cert-date').innerText = new Date().toLocaleDateString('vi-VN');
            document.getElementById('final-score-cert').innerText = `${percentage}%`;

            if(passed) {
                document.getElementById('certificate').classList.remove('grayscale-filter');
                document.getElementById('fail-watermark').classList.add('hidden');
                document.getElementById('fail-message-container').classList.add('hidden');
                document.getElementById('btn-download').classList.remove('hidden');
                confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
            } else {
                document.getElementById('certificate').classList.add('grayscale-filter');
                document.getElementById('fail-watermark').classList.remove('hidden');
                document.getElementById('fail-message-container').classList.remove('hidden');
                document.getElementById('btn-download').classList.add('hidden');
            }

            const tbody = document.getElementById('review-body');
            tbody.innerHTML = playerHistory.map((h, i) => `
                <tr>
                    <td class="px-6 py-4 text-slate-700">${i+1}. ${h.q}</td>
                    <td class="px-6 py-4 text-center font-bold ${h.choice ? 'text-green-600' : 'text-red-600'}">${h.choice ? 'ĐÚNG' : 'SAI'}</td>
                    <td class="px-6 py-4 text-center"><span class="px-2 py-1 rounded text-xs font-bold text-white ${h.isCorrect ? 'bg-green-500' : 'bg-red-500'}">${h.result}</span></td>
                </tr>
            `).join('');
        }

        function playAgain() {
            document.getElementById('game-result').classList.add('hidden');
            document.getElementById('game-start').classList.remove('hidden');
        }

        function downloadCertificate() {
            const cert = document.getElementById('certificate');
            html2canvas(cert, { scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = `ChungNhan_KiotViet_${Date.now()}.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        window.onload = function() {
            renderNav();
            switchTab('cheatsheet');
        }
    </script>
</body>
</html>
