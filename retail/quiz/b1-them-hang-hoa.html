<!DOCTYPE html><html lang="vi"><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>KiotViet Learning App</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<style>
    body { font-family: 'Inter', sans-serif; background-color: #e2e8f0; overflow: hidden; touch-action: manipulation; display: flex; justify-content: center; align-items: center; height: 100vh; background-image: radial-gradient(#cbd5e1 1px, transparent 1px); background-size: 20px 20px; }
    #mobile-frame { width: 100%; height: 100%; background: #fff; position: relative; overflow: hidden; display: flex; flex-direction: column; }
    @media (min-width: 768px) { #mobile-frame { width: 100%; max-width: 1024px; height: 92vh; border-radius: 24px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15); border: 1px solid #cbd5e1; } ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; } }
    #app-container { position: relative; width: 100%; height: 100%; overflow: hidden; flex: 1; }
    .slide { position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: center; items-center; padding: 1rem; opacity: 0; pointer-events: none; transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); transform: translateX(50px) scale(0.95); }
    .slide.active { opacity: 1; pointer-events: auto; transform: translateX(0) scale(1); z-index: 10; }
    .inner-content { width: 100%; width: 100%; max-height: 100%; overflow-y: auto; padding: 10px 5px; border-radius: 1rem; scroll-behavior: smooth; }
    .inner-content::-webkit-scrollbar { width: 4px; }
    .inner-content::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 2px; }
    .perspective-1000 { perspective: 1000px; }
    .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
    .card-inner.flipped { transform: rotateY(180deg); }
    .card-face { position: absolute; inset: 0; backface-visibility: hidden; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); background-color: white; }
    .card-back { transform: rotateY(180deg); }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
    .animate-shake { animation: shake 0.4s ease-in-out; }
    .soft-bg { background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); }
    .chat-bubble { max-width: 90%; padding: 12px 16px; border-radius: 16px; font-size: 0.9rem; line-height: 1.5; box-shadow: 0 2px 4px rgba(0,0,0,0.05); animation: popIn 0.3s ease-out backwards; }
    .chat-bubble-customer { background: white; border: 1px solid #e2e8f0; border-bottom-left-radius: 4px; margin-right: auto; }
    .chat-bubble-consultant { background: #eff6ff; border: 1px solid #bfdbfe; color: #1e40af; border-bottom-right-radius: 4px; margin-left: auto; }
    @keyframes popIn { 0% { opacity: 0; transform: scale(0.9) translateY(10px); } 100% { opacity: 1; transform: scale(1) translateY(0); } }
    #sidebar { transition: transform 0.3s ease; }
    .sidebar-closed { transform: translateX(-100%); }
    .sidebar-open { transform: translateX(0); }
</style></head><body>
<div id="mobile-frame">
    <header class="h-14 bg-white border-b border-slate-200 flex items-center justify-between px-4 z-50 flex-shrink-0 shadow-sm relative">
        <div class="flex items-center gap-2">
            <button onclick="toggleSidebar()" class="text-slate-500 hover:text-blue-600 w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-50 transition"><i class="fa-solid fa-bars text-xl"></i></button>
            <button onclick="toggleMute()" id="btn-mute" class="text-slate-400 hover:text-blue-600 w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-50 transition" title="Bật/Tắt âm thanh"><i class="fa-solid fa-volume-high text-lg"></i></button>
        </div>
        <div class="flex items-center gap-2">
            <button onclick="navSlide(-1)" id="btn-prev" class="w-9 h-9 rounded-full bg-slate-100 hover:bg-blue-50 text-slate-500 hover:text-blue-600 flex items-center justify-center transition disabled:opacity-30 disabled:cursor-not-allowed" title="Phím tắt: Mũi tên trái"><i class="fa-solid fa-chevron-left"></i></button>
            <div class="flex flex-col items-center w-16">
                <span id="slide-indicator" class="text-[10px] font-bold text-slate-500">1/--</span>
                <div class="w-full h-1 bg-slate-100 rounded-full overflow-hidden mt-0.5"><div id="progress-bar" class="h-full bg-blue-600 transition-all duration-300" style="width: 0%"></div></div>
            </div>
            <button onclick="navSlide(1)" id="btn-next" class="w-9 h-9 rounded-full bg-blue-600 hover:bg-blue-700 text-white flex items-center justify-center shadow-lg hover:shadow-xl transition active:scale-95" title="Phím tắt: Mũi tên phải"><i class="fa-solid fa-chevron-right"></i></button>
        </div>
    </header>
    <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/20 z-40 hidden transition-opacity" style="position:absolute;"></div>
    <aside id="sidebar" class="absolute inset-y-0 left-0 z-50 w-64 bg-white shadow-2xl sidebar-closed flex flex-col h-full">
        <div class="p-4 border-b border-slate-100 flex items-center justify-between bg-slate-50">
            <img src="https://logo.kiotviet.vn/KiotViet-Logo-Horizontal.svg" alt="Logo" class="h-6">
            <button onclick="toggleSidebar()" class="text-slate-400 hover:text-red-500"><i class="fa-solid fa-xmark text-xl"></i></button>
        </div>
        <div class="flex-1 overflow-y-auto p-2 space-y-1" id="sidebar-content"></div>
    </aside>
    <main id="app-container" class="soft-bg relative"></main>
</div>

<!-- TEMPLATES -->
<template id="tpl-title"><div class="slide"><div class="text-center max-w-lg md:max-w-2xl animate-fade-in-up w-full px-4 mx-auto"><div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6 text-blue-600 text-4xl shadow-sm border-4 border-white"><i class="slide-icon"></i></div><h2 class="text-2xl md:text-4xl font-black text-blue-800 mb-3 slide-title leading-tight"></h2><p class="text-slate-500 slide-desc text-sm md:text-lg">Bài học tương tác</p><div class="mt-8"><button onclick="navSlide(1)" class="bg-blue-600 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-blue-700 active:scale-95 transition text-sm md:text-base md:px-10 md:py-4">Bắt đầu ngay <i class="fa-solid fa-arrow-right ml-2"></i></button></div></div></div></template>
<template id="tpl-video"><div class="slide"><div class="inner-content flex flex-col justify-center h-full text-center"><div class="mb-4"><span class="bg-red-50 text-red-600 px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest border border-red-100">Video</span></div><h3 class="text-xl font-bold text-slate-800 mb-4 px-2 video-title mx-auto"></h3><div class="w-full bg-black rounded-xl overflow-hidden shadow-lg border-2 border-white aspect-video relative"><iframe class="w-full h-full video-iframe" src="" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><p class="mt-4 text-xs text-slate-500 italic video-desc"></p></div></div></template>
<template id="tpl-chat"><div class="slide"><div class="inner-content flex flex-col justify-center h-full w-full"><div class="mb-6 text-center"><span class="bg-blue-50 text-blue-600 px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest border border-blue-100">Hội thoại mẫu</span></div><div class="space-y-6 chat-container w-full px-2 max-w-3xl mx-auto"></div></div></div></template>
<template id="tpl-card"><div class="slide"><div class="w-full h-full flex items-center justify-center p-4"><div class="w-full max-w-[320px] aspect-[3/4] perspective-1000 relative"><div class="card-inner duration-500 w-full h-full shadow-2xl rounded-2xl relative"><div class="card-face bg-white border-2 border-slate-100 p-6 flex flex-col justify-between items-center text-center"><div class="hidden card-id">#</div><div class="flex-1 flex flex-col justify-center w-full"><h3 class="text-lg font-medium text-slate-800 leading-snug card-question mb-6"></h3><div class="grid grid-cols-2 gap-3 w-full mt-auto"><button class="btn-true py-3 bg-green-50 text-green-600 border border-green-200 rounded-xl font-bold hover:bg-green-100 transition active:scale-95 shadow-sm text-sm"><i class="fa-solid fa-check mr-1"></i> ĐÚNG (1)</button><button class="btn-false py-3 bg-red-50 text-red-600 border border-red-200 rounded-xl font-bold hover:bg-red-100 transition active:scale-95 shadow-sm text-sm"><i class="fa-solid fa-xmark mr-1"></i> SAI (2)</button></div></div></div><div class="card-face card-back p-6 flex flex-col text-center"><div class="flex flex-col h-full overflow-y-auto"><div class="mb-4"><div class="result-header text-lg font-bold flex items-center justify-center gap-2"></div></div><div class="text-left bg-slate-50 p-3 rounded-lg border border-slate-100 mb-3"><p class="text-[10px] text-slate-400 font-bold uppercase mb-1">Câu hỏi:</p><p class="text-xs text-slate-600 italic card-original-q"></p></div><div class="text-left flex-1"><p class="text-[10px] text-blue-600 font-bold uppercase mb-1"><i class="fa-solid fa-lightbulb mr-1"></i> Sự thật là:</p><p class="text-sm text-slate-700 font-medium leading-relaxed card-right-answer"></p></div><button class="btn-reset mt-auto text-xs text-slate-400 font-bold uppercase tracking-wider hover:text-blue-600 p-2"><i class="fa-solid fa-rotate-left mr-1"></i> Làm lại (0)</button></div></div></div></div></div></div></template>
<template id="tpl-list"><div class="slide"><div class="inner-content w-full px-2"><div class="text-center mb-6"><div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3 text-blue-600 text-xl"><i class="list-icon"></i></div><h3 class="text-xl font-bold text-slate-800 list-title"></h3></div><div class="space-y-3 list-container max-w-3xl mx-auto"></div></div></div></template>
<template id="tpl-grid"><div class="slide"><div class="inner-content w-full px-2"><div class="text-center mb-6"><div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-3 text-orange-600 text-xl"><i class="fa-solid fa-handshake"></i></div><h3 class="text-xl font-bold text-slate-800 mx-auto"></h3></div><div class="grid grid-cols-2 gap-3 grid-container max-w-3xl mx-auto"></div></div></div></template>
<template id="tpl-comparison"><div class="slide"><div class="inner-content w-full px-1 h-full flex flex-col"><div class="text-center mb-4 pt-2"><span class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest">Tổng kết</span><h3 class="text-lg font-bold text-slate-800 mt-2">Sự thật vs Lầm tưởng</h3><p class="text-[10px] text-slate-400 mt-1 italic">(Sử dụng mũi tên Lên/Xuống để cuộn)</p></div><div class="flex-1 overflow-y-auto bg-white rounded-xl shadow-sm border border-slate-200 relative comparison-scroll-area max-w-4xl mx-auto w-full"><table class="w-full text-left border-collapse"><thead class="bg-slate-50 sticky top-0 z-10 shadow-sm"><tr><th class="p-3 text-[10px] font-bold uppercase text-red-500 w-1/2 border-b border-slate-200 border-r">Lầm tưởng (Sai)</th><th class="p-3 text-[10px] font-bold uppercase text-green-600 w-1/2 border-b border-slate-200">Sự thật (Đúng)</th></tr></thead><tbody class="text-xs text-slate-700 divide-y divide-slate-100 comp-tbody"></tbody></table></div></div></div></template>
<template id="tpl-game-start"><div class="slide"><div class="w-full h-full flex items-center justify-center p-4"><div class="bg-white p-6 md:p-12 rounded-3xl shadow-xl text-center w-full max-w-xs md:max-w-2xl border border-slate-100 mx-auto transition-all"><div class="inline-block p-4 rounded-full bg-orange-100 mb-4 animate-bounce"><i class="fa-solid fa-gamepad text-4xl md:text-6xl text-orange-500"></i></div><h2 class="text-xl md:text-4xl font-black text-slate-800 mb-2">Quiz Game</h2><p class="text-xs md:text-lg text-slate-500 mb-6">Nhập tên và chọn chế độ để bắt đầu.</p><input type="text" id="player-name-input" placeholder="Nhập tên của bạn" class="w-full px-4 py-3 md:py-4 rounded-xl border border-slate-300 mb-4 text-center font-bold focus:ring-2 focus:ring-blue-500 outline-none text-sm md:text-xl"><div class="space-y-3"><button onclick="startGame('standard')" class="w-full bg-white border border-blue-200 text-blue-700 py-3 md:py-4 rounded-xl font-bold text-sm md:text-lg shadow-sm hover:bg-blue-50 active:scale-95 transition flex items-center justify-center gap-2"><span class="w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center text-[10px]">1</span> Tiêu chuẩn (5 câu)</button><button onclick="startGame('promax')" class="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-3 md:py-4 rounded-xl font-bold text-sm md:text-lg shadow-lg hover:opacity-90 active:scale-95 transition flex items-center justify-center gap-2"><span class="w-6 h-6 rounded-full bg-white/20 flex items-center justify-center text-[10px]">2</span> Promax (Toàn bộ)</button></div></div></div></div></template>
<template id="tpl-game-play"><div class="slide"><div class="w-full max-w-sm md:max-w-4xl p-4 md:p-8 mx-auto"><div class="flex justify-between items-center mb-6"><span class="text-xs md:text-lg font-bold text-slate-400">Câu <span class="game-q-current">1</span>/<span class="game-q-total">10</span></span><span class="text-xs md:text-lg font-bold text-green-600 bg-green-50 px-2 py-1 rounded border border-green-100">Điểm: <span class="game-score">0</span></span></div><div class="bg-white rounded-3xl shadow-lg border border-slate-100 p-6 md:p-12 min-h-[180px] md:min-h-[300px] flex items-center justify-center text-center mb-6 relative overflow-hidden"><h3 class="text-base md:text-3xl font-bold text-slate-800 game-question-text leading-relaxed"></h3></div><div class="grid grid-cols-2 gap-3 md:gap-6"><button onclick="answerGame(true)" class="game-btn btn-game-true py-4 md:py-8 rounded-2xl bg-white border-2 border-green-100 text-green-600 font-bold text-base md:text-2xl hover:bg-green-50 hover:border-green-500 transition active:scale-95 shadow-sm"><i class="fa-solid fa-check mr-1"></i> ĐÚNG (1)</button><button onclick="answerGame(false)" class="game-btn btn-game-false py-4 md:py-8 rounded-2xl bg-white border-2 border-red-100 text-red-600 font-bold text-base md:text-2xl hover:bg-red-50 hover:border-red-500 transition active:scale-95 shadow-sm"><i class="fa-solid fa-xmark mr-1"></i> SAI (2)</button></div></div></div></template>
<template id="tpl-certificate"><div class="slide"><div class="inner-content flex flex-col items-center w-full px-2"><div id="cert-view" class="w-full aspect-[4/3] md:aspect-video bg-white shadow-xl flex overflow-hidden rounded-xl relative mb-6 border border-slate-200 max-w-sm md:max-w-3xl mx-auto"><div class="w-1/3 bg-blue-900 flex flex-col items-center justify-center text-white p-2 relative"><i class="fa-solid fa-award text-3xl md:text-6xl text-yellow-400 mb-2"></i><div class="text-center z-10"><p class="uppercase tracking-widest text-[6px] md:text-[10px] opacity-70 mb-1">Cấp bởi</p><p class="font-bold text-[8px] md:text-sm">KiotViet LND</p></div><div class="absolute bottom-0 left-0 w-full h-1 bg-yellow-400"></div></div><div class="w-2/3 p-4 md:p-8 flex flex-col justify-center relative"><h1 class="text-lg md:text-3xl font-black text-blue-900 uppercase mb-1">GIẤY CHỨNG NHẬN</h1><p class="text-slate-500 italic text-[8px] md:text-sm mb-2 border-b border-slate-100 pb-1 cert-course-title"></p><div class="mb-2"><p class="text-[8px] md:text-xs text-slate-400 uppercase font-bold tracking-wider">Học viên</p><h2 class="text-sm md:text-2xl font-bold text-blue-700 uppercase cert-name truncate"></h2></div><div class="flex justify-between items-end mt-auto pt-2 border-t border-slate-50"><div><p class="text-[8px] md:text-xs text-slate-400 uppercase font-bold">Ngày cấp</p><p class="text-[9px] md:text-sm font-medium text-slate-600 cert-date"></p></div><div class="text-right"><p class="text-[8px] md:text-xs text-slate-400 uppercase font-bold">Điểm số</p><p class="text-lg md:text-3xl font-black text-green-600 cert-score"></p></div></div><div class="cert-fail-mark hidden absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 -rotate-12 text-2xl md:text-5xl font-black text-red-100 border-4 border-red-100 p-2 rounded-lg whitespace-nowrap">KHÔNG ĐẠT</div></div></div><div class="flex flex-col gap-3 w-full max-w-xs md:max-w-md"><button onclick="downloadCert()" class="hidden md:inline-flex w-full bg-blue-600 text-white border border-blue-600 px-6 py-3 rounded-xl font-bold hover:bg-blue-700 transition text-sm items-center justify-center gap-2 shadow-lg"><i class="fa-solid fa-download"></i> Tải chứng nhận</button><button onclick="backToGameLogin()" class="bg-white border border-slate-200 text-slate-600 px-6 py-3 rounded-xl font-bold hover:bg-slate-50 transition text-sm"><i class="fa-solid fa-rotate-right mr-2"></i> Chơi lại (0)</button></div></div></div></template>

<script>
    // --- 1. DATA CONFIG (AI SẼ ĐIỀN VÀO ĐÂY) ---
    const lessonData = {
        courseTitle: "Bước 1 - Thêm mới hàng hóa",
        courseIcon: "fa-solid fa-box-open",
        overviewModules: [
            {
                type: "list",
                title: "1. Tại sao cần thêm hàng hóa?",
                icon: "fa-solid fa-star",
                data: [
                    { icon: "fa-database", title: "Nền tảng dữ liệu", text: "Tạo cơ sở gốc cho toàn bộ quy trình bán hàng và quản lý về sau." },
                    { icon: "fa-warehouse", title: "Quản lý tồn kho", text: "Giúp khai báo tồn đầu kỳ để theo dõi xuất-nhập-tồn chính xác." },
                    { icon: "fa-tags", title: "Linh hoạt đơn vị", text: "Bán hàng theo nhiều đơn vị (Thùng, Hộp) và thuộc tính (Màu, Size)." }
                ]
            },
            {
                type: "grid",
                title: "2. Quy trình 4 bước chuẩn",
                icon: "fa-solid fa-list-ol",
                data: [
                    { color: "blue", label: "Bước 1", desc: "Vào Hàng hóa > Danh sách > +Tạo mới" },
                    { color: "green", label: "Bước 2", desc: "Nhập thông tin cơ bản (Tên, Mã, Nhóm, Giá)" },
                    { color: "orange", label: "Bước 3", desc: "Thiết lập Đơn vị & Thuộc tính (Nếu có)" },
                    { color: "purple", label: "Bước 4", desc: "Lưu thông tin & Kiểm tra lại" }
                ]
            },
            {
                type: "grid",
                title: "3. Phân biệt Khái niệm",
                icon: "fa-solid fa-scale-balanced",
                data: [
                    { color: "indigo", label: "Đơn vị tính", desc: "Dùng để quy đổi số lượng (VD: Hộp -> Thùng)" },
                    { color: "pink", label: "Thuộc tính", desc: "Dùng phân loại phiên bản (VD: Màu, Size)" }
                ]
            }
        ],
        practiceTopics: [
            {
                title: "Tiếp cận & Thông tin cơ bản",
                chat: [
                    { r: "customer", t: "Tôi vừa đăng nhập vào nhưng thấy màn hình 'Tổng quan' trống trơn, tôi phải bấm vào đâu để nhập hàng?" },
                    { r: "consultant", t: "Vì là cửa hàng mới nên hệ thống chưa có dữ liệu. Để bắt đầu, anh/chị cần vào menu <b>Hàng hóa</b>, chọn <b>Danh sách hàng hóa</b>, sau đó nhìn sang góc phải màn hình sẽ thấy nút <b>+Tạo mới</b>." },
                    { r: "customer", t: "Hàng hóa của tôi nhiều mã vạch lắm, tôi có phải tự nghĩ ra mã hàng cho từng món không?" },
                    { r: "consultant", t: "Không cần đâu ạ. Nếu sản phẩm đã có mã vạch, anh/chị dùng máy quét tít vào ô Mã hàng. Còn nếu để trống ô này, hệ thống sẽ <b>tự động sinh mã</b> duy nhất cho sản phẩm đó." },
                    { r: "customer", t: "Nếu tôi có 1000 mặt hàng, nhập thủ công thế này thì bao giờ mới xong?" },
                    { r: "consultant", t: "Nhập thủ công dùng khi thêm lẻ tẻ thôi ạ. Với số lượng lớn ban đầu, bên em có tính năng <b>Import Excel</b> để nhập hàng loạt nhé." }
                ],
                cards: [
                    {
                        id: "Q1",
                        isTrue: false,
                        question: "Để thêm hàng mới, cần truy cập menu 'Giao dịch' -> 'Nhập hàng'.",
                        right: "Để thêm hàng mới, cần truy cập menu <b>Hàng hóa</b> -> <b>Danh sách hàng hóa</b>.",
                        wrong: "Để thêm hàng mới, cần truy cập menu 'Giao dịch' -> 'Nhập hàng'."
                    },
                    {
                        id: "Q2",
                        isTrue: true,
                        question: "Hệ thống ban đầu là dữ liệu trống, người dùng cần tự nhập liệu hoặc Import file Excel.",
                        right: "Hệ thống ban đầu là dữ liệu trống, người dùng cần tự nhập liệu hoặc Import file Excel.",
                        wrong: "Hệ thống KiotViet luôn có sẵn danh sách hàng hóa mẫu khi mới tạo gian hàng."
                    },
                    {
                        id: "Q3",
                        isTrue: true,
                        question: "Nếu để trống ô Mã hàng, hệ thống sẽ tự động sinh mã ngẫu nhiên.",
                        right: "Nếu để trống ô Mã hàng, hệ thống sẽ tự động sinh mã ngẫu nhiên.",
                        wrong: "Bắt buộc phải nhập mã hàng thủ công cho mọi sản phẩm."
                    },
                    {
                        id: "Q4",
                        isTrue: false,
                        question: "Khi quét mã vạch vào ô Mã hàng, hệ thống sẽ tự điền luôn tên hàng và giá bán.",
                        right: "Việc quét mã vạch giúp nhập <b>mã chính xác</b>, còn Tên hàng và Giá bán vẫn cần nhập tay (nếu là hàng mới).",
                        wrong: "Khi quét mã vạch vào ô Mã hàng, hệ thống sẽ tự điền luôn tên hàng và giá bán."
                    }
                ]
            },
            {
                title: "Đơn vị tính & Thuộc tính",
                chat: [
                    { r: "customer", t: "Tôi đang nhập 'Sữa tươi Ba Vì'. Khách mua lẻ 1 hộp, có khi mua cả lốc 4 hộp hoặc thùng 48 hộp. Tôi phải tạo 3 mã hàng khác nhau à?" },
                    { r: "consultant", t: "Đừng làm thế sẽ sai tồn kho ạ! Anh/chị hãy dùng tính năng <b>Đơn vị tính</b>. Đơn vị cơ bản là 'Hộp', sau đó thêm đơn vị 'Lốc' (quy đổi 4) và 'Thùng' (quy đổi 48). Như vậy khi bán 1 Thùng, kho sẽ tự trừ 48 Hộp." },
                    { r: "customer", t: "Thế còn vụ 'Hương vị' thì sao? Sữa này có vị Dâu và Vani, giá như nhau." },
                    { r: "consultant", t: "Cái này anh/chị dùng <b>Thuộc tính</b> nhé. Tạo thuộc tính tên là 'Hương vị', sau đó nhập giá trị 'Dâu' và 'Vani'." },
                    { r: "customer", t: "Tôi gõ 'Dâu, Vani' vào ô Giá trị thuộc tính mà nó cứ dính liền một dòng, không tách ra." },
                    { r: "consultant", t: "Đây là lỗi thao tác thường gặp ạ. Sau khi gõ 'Dâu', anh/chị <b>phải nhấn phím Enter</b>, sau đó mới gõ tiếp 'Vani' và nhấn Enter. Tuyệt đối không dùng dấu phẩy để tách." }
                ],
                cards: [
                    {
                        id: "Q5",
                        isTrue: false,
                        question: "Để tách các giá trị thuộc tính (Màu, Size), người dùng sử dụng dấu phẩy (,) hoặc dấu chấm (.).",
                        right: "Để tách các giá trị thuộc tính, người dùng BẮT BUỘC phải nhấn phím <b>Enter</b> sau mỗi giá trị.",
                        wrong: "Để tách các giá trị thuộc tính (Màu, Size), người dùng sử dụng dấu phẩy (,) hoặc dấu chấm (.)."
                    },
                    {
                        id: "Q6",
                        isTrue: false,
                        question: "'Đơn vị tính' và 'Thuộc tính' có chức năng giống hệt nhau, dùng cái nào cũng được.",
                        right: "'Đơn vị tính' dùng để <b>quy đổi số lượng</b>, còn 'Thuộc tính' dùng để tạo ra các <b>phiên bản sản phẩm</b> khác nhau.",
                        wrong: "'Đơn vị tính' và 'Thuộc tính' có chức năng giống hệt nhau, dùng cái nào cũng được."
                    },
                    {
                        id: "Q7",
                        isTrue: true,
                        question: "Khi thêm thuộc tính 'Hương vị' là Dâu và Vani, hệ thống sẽ sinh ra 2 hàng hóa con để quản lý.",
                        right: "Khi thêm thuộc tính 'Hương vị' là Dâu và Vani, hệ thống sẽ sinh ra 2 hàng hóa con để quản lý.",
                        wrong: "Khi thêm thuộc tính 'Hương vị' là Dâu và Vani, hệ thống vẫn chỉ tạo ra 1 hàng hóa duy nhất."
                    },
                    {
                        id: "Q8",
                        isTrue: true,
                        question: "Người dùng cần thiết lập 'Giá trị quy đổi' để hệ thống tự động trừ tồn kho chính xác khi bán đơn vị lớn.",
                        right: "Người dùng cần thiết lập 'Giá trị quy đổi' để hệ thống tự động trừ tồn kho chính xác khi bán đơn vị lớn.",
                        wrong: "Giá trị quy đổi của đơn vị lớn (Ví dụ: Thùng) là ngẫu nhiên, không liên quan đến tồn kho."
                    }
                ]
            }
        ]
    };
    // --- KẾT THÚC PHẦN DỮ LIỆU CỦA AI ---

    const { courseTitle, courseIcon, overviewModules, practiceTopics } = lessonData;
    const audioCtx = new(window.AudioContext || window.webkitAudioContext)(); let isMuted = false;
    let slides = []; let currentSlideIndex = 0; let gameQuestions = []; let gameScore = 0; let gameCurrentQIndex = 0; let gameStartSlideIndex = 0;
    function toggleMute() { isMuted = !isMuted; const btn = document.getElementById('btn-mute'); btn.innerHTML = isMuted ? '<i class="fa-solid fa-volume-xmark text-lg"></i>' : '<i class="fa-solid fa-volume-high text-lg"></i>'; btn.classList.toggle('text-red-500', isMuted); btn.classList.toggle('text-slate-400', !isMuted); }
    function playSound(type) { if (isMuted || audioCtx.state === 'suspended') { audioCtx.resume(); if(isMuted) return; } const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);const n=audioCtx.currentTime;if(type==='pop'){o.type='sine';o.frequency.setValueAtTime(800,n);o.frequency.exponentialRampToValueAtTime(300,n+0.1);g.gain.setValueAtTime(0.3,n);g.gain.exponentialRampToValueAtTime(0.01,n+0.1);}else if(type==='correct'){o.type='sine';o.frequency.setValueAtTime(600,n);o.frequency.exponentialRampToValueAtTime(1200,n+0.1);g.gain.setValueAtTime(0.3,n);g.gain.exponentialRampToValueAtTime(0.01,n+0.3);}else if(type==='incorrect'){o.type='sawtooth';o.frequency.setValueAtTime(200,n);o.frequency.linearRampToValueAtTime(150,n+0.2);g.gain.setValueAtTime(0.3,n);g.gain.linearRampToValueAtTime(0.01,n+0.2);}else if(type==='win'){const t=[523.25,659.25,783.99,1046.5];let e=n;t.forEach((t,i)=>{const s=audioCtx.createOscillator(),a=audioCtx.createGain();s.connect(a);a.connect(audioCtx.destination);s.type='triangle';s.frequency.setValueAtTime(t,e);a.gain.setValueAtTime(0.2,e);a.gain.linearRampToValueAtTime(0,e+0.5);s.start(e);s.stop(e+0.5);e+=i===t.length-2?0.3:0.15});return;}else if(type==='fail'){o.type='sawtooth';o.frequency.setValueAtTime(300,n);o.frequency.linearRampToValueAtTime(150,n+0.8);g.gain.setValueAtTime(0.3,n);g.gain.linearRampToValueAtTime(0,n+0.8);}o.start();o.stop(n+(type==='pop'?0.1:type==='correct'?0.3:type==='incorrect'?0.2:0.8));}
    function initApp() { slides = []; const sidebarContent = document.getElementById('sidebar-content'); sidebarContent.innerHTML = ''; slides.push({ type: 'title' }); const createSidebarGroup = (t) => { const d=document.createElement('div'); d.className="text-sm font-bold text-slate-700 bg-slate-100 p-3 rounded-lg mt-4 mb-2 shadow-sm uppercase"; d.innerText=t; sidebarContent.appendChild(d); }; const createSidebarButton = (t,i,c,o) => { const b=document.createElement('button');b.className=`w-full text-left px-4 py-2 rounded-lg hover:bg-${c}-50 text-sm font-medium text-slate-600 hover:text-${c}-600 flex items-center gap-3 transition`;b.innerHTML=`<i class="${i} w-4 text-center text-${c}-500"></i><span class="truncate">${t}</span>`;b.onclick=()=>{o();toggleSidebar();};sidebarContent.appendChild(b);}; if(overviewModules && overviewModules.length>0){createSidebarGroup("1. Cẩm nang");const s=slides.length;overviewModules.forEach(m=>slides.push({type:m.type,data:m.data,title:m.title,icon:m.icon}));createSidebarButton("Xem Cẩm nang","fa-solid fa-book-open","blue",()=>{currentSlideIndex=s;renderSlide();});} if(practiceTopics && practiceTopics.length>0){createSidebarGroup("2. Tìm hiểu chi tiết");practiceTopics.forEach(t=>{let s=slides.length;if(t.chat){for(let i=0;i<t.chat.length;i+=2){slides.push({type:'chat',data:t.chat.slice(i,i+2),title:t.title});}} if(t.cards){t.cards.forEach(c=>slides.push({type:'card',data:c,title:t.title}));} createSidebarButton(t.title,"fa-solid fa-comment-dots","slate",()=>{currentSlideIndex=s;renderSlide();});});} createSidebarGroup("3. Ôn tập"); slides.push({type:'comparison'}); createSidebarButton("Bảng so sánh","fa-solid fa-table-columns","purple",()=>{currentSlideIndex=slides.length-1;renderSlide();}); gameStartSlideIndex=slides.length; slides.push({type:'game-start'}); slides.push({type:'game-play'}); slides.push({type:'certificate'}); createSidebarButton("Quiz Game","fa-solid fa-gamepad","orange",()=>{currentSlideIndex=gameStartSlideIndex;renderSlide();}); renderSlide(); }
    function renderSlide() { const c=document.getElementById('app-container'),s=slides[currentSlideIndex];document.getElementById('slide-indicator').innerText=`${currentSlideIndex+1}/${slides.length}`;document.getElementById('progress-bar').style.width=`${((currentSlideIndex+1)/slides.length)*100}%`;document.getElementById('btn-prev').disabled=currentSlideIndex===0;document.getElementById('btn-next').disabled=(currentSlideIndex>=slides.length-1)||s.type==='game-start';const t=document.getElementById(`tpl-${s.type}`).content.cloneNode(true),e=t.querySelector('.slide');if(s.type==='title'){e.querySelector('.slide-title').innerText=courseTitle;e.querySelector('.slide-icon').className=courseIcon+" slide-icon";}else if(s.type==='video'){e.querySelector('.video-title').innerHTML=s.data.title;e.querySelector('.video-desc').innerHTML=s.data.desc;e.querySelector('.video-iframe').src=s.data.src;}else if(s.type==='list'){e.querySelector('.list-title').innerHTML=s.title.substring(s.title.indexOf('.')+1).trim();e.querySelector('.list-icon').className=s.icon+" list-icon";const l=e.querySelector('.list-container');s.data.forEach(i=>{const d=document.createElement('div');d.className="bg-white p-3 rounded-xl border border-slate-100 shadow-sm flex items-start gap-3";d.innerHTML=`<div class="w-8 h-8 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center flex-shrink-0 mt-1"><i class="fa-solid ${i.icon}"></i></div><div><h4 class="text-sm font-bold text-slate-700">${i.title}</h4><p class="text-xs text-slate-500 leading-tight mt-1">${i.text}</p></div>`;l.appendChild(d);});}else if(s.type==='grid'){e.querySelector('.grid-container').innerHTML = s.data.map(i => `<div class="bg-${i.color}-50 p-3 rounded-xl border border-${i.color}-100 text-center"><h4 class="text-xs font-bold text-${i.color}-700">${i.label}</h4><p class="text-[10px] text-${i.color}-600 mt-1">${i.desc}</p></div>`).join(''); e.querySelector('h3').innerHTML=s.title.substring(s.title.indexOf('.')+1).trim();}else if(s.type==='chat'){e.querySelector('.chat-container').innerHTML=s.data.map((m,i)=>`<div class="flex w-full ${m.r==='customer'?'justify-start':'justify-end'}"><div class="chat-bubble ${m.r==='customer'?'chat-bubble-customer':'chat-bubble-consultant'}" style="animation-delay:${i*0.2}s"><div class="text-[9px] font-bold uppercase mb-1 opacity-60">${m.r==='customer'?'Chủ cửa hàng':'Chuyên viên KiotViet'}</div>${m.t}</div></div>`).join('');}else if(s.type==='card'){e.querySelector('.card-id').innerText=s.data.id;e.querySelector('.card-question').innerHTML=s.data.question;e.querySelector('.card-original-q').innerHTML=s.data.question;e.querySelector('.card-right-answer').innerHTML=s.data.right;const bT=e.querySelector('.btn-true'),bF=e.querySelector('.btn-false'),bR=e.querySelector('.btn-reset');bT.onclick=ev=>{ev.stopPropagation();flipCardCheck(e,true,s.data.isTrue);};bF.onclick=ev=>{ev.stopPropagation();flipCardCheck(e,false,s.data.isTrue);};bR.onclick=ev=>{ev.stopPropagation();resetCardFlip(e);};}else if(s.type==='comparison'){const y=e.querySelector('.comp-tbody');let a=[];practiceTopics.forEach(t=>{if(t.cards)a=[...a,...t.cards]});y.innerHTML=a.map(c=>`<tr><td class="p-3 align-top border-r border-slate-100 bg-red-50/20 text-red-800">${c.wrong}</td><td class="p-3 align-top bg-green-50/20 text-green-800">${c.right}</td></tr>`).join('');}else if(s.type==='game-start'){setTimeout(()=>{const i=document.getElementById('player-name-input');if(i){i.focus();i.onkeydown=e=>{if(e.key==='Enter')startGame('standard');}}},100);}else if(s.type==='game-play'){const q=gameQuestions[gameCurrentQIndex];if(q){e.querySelector('.game-q-current').innerText=gameCurrentQIndex+1;e.querySelector('.game-q-total').innerText=gameQuestions.length;e.querySelector('.game-score').innerText=gameScore;e.querySelector('.game-question-text').innerHTML=q.question;}else{e.querySelector('.game-question-text').innerText="Vui lòng chọn chế độ!";e.querySelectorAll('.game-btn').forEach(b=>b.disabled=true);}}c.innerHTML='';e.classList.add('active');c.appendChild(e);}
    function navSlide(dir){const next=currentSlideIndex+dir;if(next>=0&&next<slides.length){if((slides[currentSlideIndex].type==='game-start'&&dir>0&&gameQuestions.length===0)||(slides[currentSlideIndex].type==='game-play'&&dir>0))return;playSound('pop');currentSlideIndex=next;renderSlide();}}
    function toggleSidebar(){const sb=document.getElementById('sidebar'),ov=document.getElementById('sidebar-overlay');sb.classList.toggle('sidebar-closed');sb.classList.toggle('sidebar-open');ov.classList.toggle('hidden');}
    function flipCardCheck(slideEl,userChoice,isCorrectValue){const cardInner=slideEl.querySelector('.card-inner'),isUserCorrect=(userChoice===isCorrectValue),cardBack=slideEl.querySelector('.card-back'),resultHeader=cardBack.querySelector('.result-header');playSound(isUserCorrect?'correct':'incorrect');if(isUserCorrect){resultHeader.innerHTML=`<i class="fa-solid fa-check-circle text-green-500"></i><span class="text-green-600">CHÍNH XÁC!</span>`;cardBack.className='card-face card-back p-6 flex flex-col text-center border-2 border-green-200 bg-green-50/20';confetti({particleCount:30,spread:50,origin:{y:0.6}});}else{resultHeader.innerHTML=`<i class="fa-solid fa-times-circle text-red-500"></i><span class="text-red-600">CHƯA ĐÚNG!</span>`;cardBack.className='card-face card-back p-6 flex flex-col text-center border-2 border-red-200 bg-red-50/20';}cardInner.classList.add('flipped');}
    function resetCardFlip(slideEl){playSound('pop');slideEl.querySelector('.card-inner').classList.remove('flipped');}
    function startGame(mode){const name=document.getElementById('player-name-input').value.trim();if(!name){alert('Vui lòng nhập tên!');return;}localStorage.setItem('kv_player',name);let allQ=[];practiceTopics.forEach(t=>{if(t.cards)allQ=[...allQ,...t.cards]});allQ.sort(()=>0.5-Math.random());gameQuestions=mode==='standard'?allQ.slice(0,Math.min(5,allQ.length)):allQ;gameScore=0;gameCurrentQIndex=0;navSlide(1);}
    function answerGame(choice){const q=gameQuestions[gameCurrentQIndex];if(!q)return;const isCorrect=(choice===q.isTrue);playSound(isCorrect?'correct':'incorrect');if(isCorrect){gameScore++;confetti({particleCount:50,spread:60,origin:{y:0.7}});}else{const qt=document.querySelector('.game-question-text');if(qt){qt.parentElement.classList.add('animate-shake');setTimeout(()=>qt.parentElement.classList.remove('animate-shake'),400);}}document.querySelectorAll('.game-btn').forEach(b=>b.disabled=true);setTimeout(()=>{gameCurrentQIndex++;if(gameCurrentQIndex<gameQuestions.length){renderSlide();}else{finishGame();}},isCorrect?500:800);}
    function finishGame(){currentSlideIndex++;renderSlide();const total=gameQuestions.length,pct=total>0?Math.round((gameScore/total)*100):0,passed=pct>=80,name=localStorage.getItem('kv_player'),certView=document.querySelector('.slide.active #cert-view');if(!certView)return;certView.querySelector('.cert-course-title').innerText=`Hoàn thành khóa học ${courseTitle}`;certView.querySelector('.cert-name').innerText=name;certView.querySelector('.cert-score').innerText=pct+"%";const d=new Date();certView.querySelector('.cert-date').innerText=`${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`;const failMark=certView.querySelector('.cert-fail-mark');if(passed){failMark.classList.add('hidden');certView.classList.remove('grayscale');playSound('win');confetti({particleCount:200,spread:100,origin:{y:0.6}});}else{failMark.classList.remove('hidden');certView.classList.add('grayscale');playSound('fail');}}
    function backToGameLogin(){currentSlideIndex=gameStartSlideIndex;renderSlide();}
    function downloadCert(){const c=document.getElementById('cert-view');html2canvas(c).then(canvas=>{const link=document.createElement('a');link.download='chung-nhan-kiotviet.png';link.href=canvas.toDataURL();link.click();});}
    document.addEventListener('keydown',e=>{const s=document.querySelector('.slide.active');if(!s||!slides[currentSlideIndex])return;const t=slides[currentSlideIndex].type;if(e.key==='ArrowRight')navSlide(1);else if(e.key==='ArrowLeft')navSlide(-1);if(t==='card'){if(e.key==='1')s.querySelector('.btn-true')?.click();else if(e.key==='2')s.querySelector('.btn-false')?.click();else if(e.key==='0')s.querySelector('.btn-reset')?.click();}else if(t==='game-start'&&document.activeElement!==document.getElementById('player-name-input')){if(e.key==='1')startGame('standard');else if(e.key==='2')startGame('promax');}else if(t==='game-play'){if(e.key==='1')s.querySelector('.btn-game-true:not(:disabled)')?.click();else if(e.key==='2')s.querySelector('.btn-game-false:not(:disabled)')?.click();}else if(t==='certificate'&&e.key==='0')backToGameLogin();else if(t==='comparison'){const a=s.querySelector('.comparison-scroll-area');if(e.key==='ArrowUp')a.scrollTop-=50;else if(e.key==='ArrowDown')a.scrollTop+=50;}});
    document.addEventListener('DOMContentLoaded', initApp);
</script></body></html>
