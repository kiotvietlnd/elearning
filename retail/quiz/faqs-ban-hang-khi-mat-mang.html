<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Learning: Bán hàng khi mất mạng (Offline Mode) - KiotViet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f9ff; overflow-x: hidden; }
        ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-thumb { background: #93c5fd; border-radius: 3px; }
        .soft-glow-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -10; background: linear-gradient(135deg, #ffffff 0%, #e0f2fe 50%, #dcfce7 100%); }
        .soft-glow-background .shape { position: absolute; filter: blur(120px); opacity: 0.6; }
        .soft-glow-background .shape1 { height: 300px; width: 300px; background: #bae6fd; border-radius: 50%; top: -50px; left: -50px; animation: moveInCircle 25s ease-in-out infinite; }
        .soft-glow-background .shape2 { height: 350px; width: 350px; background: #bbf7d0; border-radius: 50%; bottom: -50px; right: -50px; animation: moveVertical 30s ease-in-out infinite; }
        @keyframes moveInCircle { 0% { transform: rotate(0deg); } 50% { transform: rotate(180deg); } 100% { transform: rotate(360deg); } }
        @keyframes moveVertical { 0% { transform: translateY(-20%); } 50% { transform: translateY(20%); } 100% { transform: translateY(-20%); } }
        .nav-link { transition: all 0.2s ease; border-left: 3px solid transparent; }
        .nav-link:hover { color: #2563eb; background: rgba(255, 255, 255, 0.6); }
        .nav-link.active { color: #1e3a8a; border-left: 3px solid #2563eb; background: #eff6ff; font-weight: 600; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
        /* Flashcard 3D CSS */
        .perspective-1000 { perspective: 1000px; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; }
        .card-inner.flipped { transform: rotateY(180deg); }
        .card-face { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            -webkit-backface-visibility: hidden; backface-visibility: hidden; 
            border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); background-color: white; 
        }
        .card-back { transform: rotateY(180deg); }
        .type-card { transition: all 0.3s ease; }
        .type-card:hover { box-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.1); transform: translateY(-5px); border-color: #60a5fa; }
        .chat-bubble { max-width: 90%; padding: 1rem 1.25rem; border-radius: 1rem; position: relative; font-size: 0.95rem; line-height: 1.6; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .chat-bubble-customer { background-color: #ffffff; color: #334155; border-bottom-left-radius: 0.25rem; border: 1px solid #e2e8f0; }
        .chat-bubble-consultant { background-color: #eff6ff; color: #1e40af; border-bottom-right-radius: 0.25rem; border: 1px solid #bfdbfe; }
        #mobile-overlay { transition: opacity 0.3s ease; }
        #sidebar { transition: transform 0.3s ease; }
        .sidebar-open #sidebar { transform: translateX(0); }
        .sidebar-open #mobile-overlay { opacity: 1; pointer-events: auto; }
        .sidebar-closed #sidebar { transform: translateX(-100%); }
        .sidebar-closed #mobile-overlay { opacity: 0; pointer-events: none; }
        @media (min-width: 768px) { .sidebar-closed #sidebar { transform: translateX(0); } }
        .certificate-container { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); transition: filter 0.3s ease; }
        .watermark { position: absolute; top: 50%; left: 60%; transform: translate(-50%, -50%) rotate(-30deg); font-size: 6rem; font-weight: 900; color: rgba(200, 0, 0, 0.05); pointer-events: none; z-index: 0; }
        .grayscale-filter { filter: grayscale(100%); }
        .animate-fade-in-up { animation: fadeInUp 0.5s ease-out; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="text-slate-700 antialiased h-screen flex flex-col overflow-hidden sidebar-closed" id="app-body">
    <div class="soft-glow-background"><div class="shape shape1"></div><div class="shape shape2"></div></div>
    
    <!-- HEADER -->
    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-white/50 h-20 shadow-sm flex-shrink-0">
        <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 h-full">
            <div class="flex items-center justify-between h-full gap-4 lg:gap-8">
                <a href="https://kiotvietlnd.github.io/elearning/" class="flex-shrink-0 flex items-center gap-3 select-none hover:opacity-80 transition-opacity">
                    <img src="https://logo.kiotviet.vn/KiotViet-Logo-Horizontal.svg" alt="KiotViet Logo" class="h-6 lg:h-8">
                    <span class="text-slate-300 font-light text-xl lg:text-2xl">|</span>
                    <span class="font-bold text-blue-700 tracking-tight text-base lg:text-lg uppercase">E-Learning</span>
                </a>
                <nav class="hidden lg:flex flex-1 justify-end items-center gap-4">
                    <a href="https://www.kiotviet.vn/ho-tro" target="_blank" class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-full font-bold text-sm shadow-md hover:bg-blue-700 hover:-translate-y-0.5 transition-all"><i class="fa-solid fa-book-open-reader"></i> Kho Tài liệu HDSD</a>
                    <a href="https://www.youtube.com/@HDSDPhanmemKiotViet" target="_blank" class="flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-full font-bold text-sm shadow-md hover:bg-red-700 hover:-translate-y-0.5 transition-all"><i class="fa-brands fa-youtube"></i> Kho Video HDSD</a>
                </nav>
                <div class="lg:hidden"><button onclick="toggleSidebar()" class="text-slate-600 hover:text-blue-700 text-2xl"><i class="fa-solid fa-bars"></i></button></div>
            </div>
        </div>
    </header>

    <div class="flex-1 flex overflow-hidden relative">
        <div id="mobile-overlay" class="fixed inset-0 bg-black/20 z-40 md:hidden" onclick="toggleSidebar()"></div>
        
        <!-- SIDEBAR -->
        <aside id="sidebar" class="absolute inset-y-0 left-0 z-50 w-80 bg-white/95 backdrop-blur-xl border-r border-white/60 shadow-2xl md:static md:bg-white/60 md:shadow-lg md:rounded-r-2xl flex flex-col transform transition-transform duration-300">
            <div class="p-5 border-b border-slate-100 flex-shrink-0">
                <div class="flex justify-between items-start mb-4 md:hidden"><img src="https://logo.kiotviet.vn/KiotViet-Logo-Horizontal.svg" alt="Logo" class="h-5"><button onclick="toggleSidebar()" class="text-slate-400"><i class="fa-solid fa-xmark text-xl"></i></button></div>
                <h2 class="font-black text-lg leading-tight mb-2 uppercase text-blue-700">Bán hàng khi mất mạng</h2>
                <h3 class="font-bold text-slate-500 text-xs uppercase tracking-wider mb-2">TIẾN ĐỘ BÀI HỌC</h3>
                <div class="w-full bg-slate-200 rounded-full h-2"><div id="totalProgress" class="bg-blue-600 hover:bg-blue-700 h-2 rounded-full transition-all duration-500" style="width: 0%"></div></div>
                <div class="flex justify-between mt-1 text-[10px] text-slate-500 font-medium"><span id="completedCount">0/0</span><span>Hoàn thành</span></div>
            </div>
            <nav class="flex-1 overflow-y-auto p-3 space-y-2 custom-scrollbar">
                 <button onclick="switchTab('cheatsheet')" id="nav-cheatsheet" class="nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3 active"><i class="fa-solid fa-bolt text-yellow-500 w-6 text-center"></i><span class="font-bold text-sm">Cẩm nang nghiệp vụ</span></button>
                 <div class="mt-4 mb-2 px-3 text-[10px] font-bold text-slate-400 uppercase">TÌM HIỂU CHI TIẾT</div>
                 <div id="dynamic-nav-container"></div>
                 <div class="mt-4 mb-2 px-3 text-[10px] font-bold text-slate-400 uppercase">Ôn tập</div>
                 <button onclick="switchTab('all-chats')" id="nav-all-chats" class="nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3"><i class="fa-solid fa-comments text-pink-500 w-6 text-center"></i><span class="font-bold text-sm">Xem toàn bộ hội thoại</span></button>
                 <button onclick="switchTab('summary')" id="nav-summary" class="nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3"><i class="fa-solid fa-table-columns text-purple-500 w-6 text-center"></i><span class="font-bold text-sm">Bảng so sánh</span></button>
                 <button onclick="switchTab('game')" id="nav-game" class="nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3"><i class="fa-solid fa-gamepad text-orange-500 w-6 text-center"></i><span class="font-bold text-sm">Quiz Game</span></button>
            </nav>
            <div class="p-4 bg-slate-50 border-t border-slate-100 text-center text-[10px] text-slate-400">© KiotViet Learning & Development Department</div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="flex-1 overflow-y-auto scroll-smooth p-4 md:p-8" id="contentArea">
            <div class="max-w-5xl mx-auto pb-20" id="lessonContainer">
                
                <!-- TAB CHEATSHEET -->
                <div id="tab-cheatsheet" class="tab-content block animate-fade-in-up">
                    <div class="mb-8 text-center">
                         <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider border border-blue-200">Đào tạo Sản phẩm Ngành Bán lẻ</span>
                        <h1 class="text-3xl md:text-4xl font-black text-blue-700 mt-4 leading-tight">Bán hàng khi mất mạng (Offline Mode)</h1>
                        <p class="text-slate-500 mt-3 italic text-base md:text-lg max-w-2xl mx-auto">Hướng dẫn xử lý đơn hàng, in hóa đơn và đồng bộ dữ liệu khi mất kết nối Internet.</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <!-- Card 1 -->
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                            <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-red-600 mb-4"><i class="fa-solid fa-wifi-slash"></i></div>
                            <h3 class="font-bold text-slate-800 text-lg mb-2">1. Cơ chế hoạt động</h3>
                            <ul class="space-y-2 text-sm text-slate-600">
                                <li class="flex gap-2"><i class="fa-solid fa-check text-green-500 mt-1"></i> <span>Tự động chuyển chế độ <strong>Offline</strong> khi mất mạng.</span></li>
                                <li class="flex gap-2"><i class="fa-solid fa-check text-green-500 mt-1"></i> <span>Dấu hiệu: Thanh thông báo <strong>màu hồng</strong> trên đầu màn hình.</span></li>
                                <li class="flex gap-2"><i class="fa-solid fa-check text-green-500 mt-1"></i> <span>Dữ liệu lưu tại <strong>Bộ nhớ đệm (Cache)</strong> trình duyệt.</span></li>
                            </ul>
                        </div>
                        <!-- Card 2 -->
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                            <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 mb-4"><i class="fa-solid fa-cart-shopping"></i></div>
                            <h3 class="font-bold text-slate-800 text-lg mb-2">2. Khả năng thao tác</h3>
                            <ul class="space-y-2 text-sm text-slate-600">
                                <li class="flex gap-2"><i class="fa-solid fa-check text-green-500 mt-1"></i> <span>Vẫn làm được: Tìm hàng, chọn khách, thanh toán, in bill.</span></li>
                                <li class="flex gap-2"><i class="fa-solid fa-check text-green-500 mt-1"></i> <span>Mã hóa đơn Offline: Bắt đầu bằng <strong>HDO</strong>.</span></li>
                                <li class="flex gap-2"><i class="fa-solid fa-triangle-exclamation text-yellow-500 mt-1"></i> <span>Chỉ xem được trên máy tạo đơn cho đến khi đồng bộ.</span></li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Card 3 (Full width) -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-2xl border border-blue-100 mb-8">
                        <div class="flex items-start gap-4">
                            <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-blue-600 shadow-sm flex-shrink-0"><i class="fa-solid fa-link"></i></div>
                            <div>
                                <h3 class="font-bold text-blue-800 text-lg mb-2">3. Truy cập khi không có mạng từ đầu</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                    <div class="bg-white p-3 rounded-lg border border-red-200 text-red-700">
                                        <div class="font-bold text-xs uppercase mb-1"><i class="fa-solid fa-xmark mr-1"></i> KHÔNG ĐƯỢC</div>
                                        Vào Google, Facebook hoặc gõ tên miền trang chủ kiotviet.vn (Sẽ báo lỗi kết nối).
                                    </div>
                                    <div class="bg-white p-3 rounded-lg border border-green-200 text-green-700">
                                        <div class="font-bold text-xs uppercase mb-1"><i class="fa-solid fa-check mr-1"></i> PHẢI LÀM</div>
                                        Truy cập link trực tiếp: <code>https://[GianHàng].kiotviet.vn/sale/</code> hoặc dùng <strong>Bookmark</strong> đã lưu.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- DYNAMIC TABS WILL BE INJECTED HERE -->
                
                <!-- TAB: ALL CHATS -->
                <div id="tab-all-chats" class="tab-content hidden animate-fade-in-up"></div>

                <!-- TAB: SUMMARY -->
                <div id="tab-summary" class="tab-content hidden animate-fade-in-up">
                    <h2 class="text-xl font-bold text-blue-700 mb-6 border-l-4 border-slate-400 pl-3">Bảng so sánh: Lầm tưởng & Sự thật</h2>
                    <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                        <table class="w-full table-fixed border-collapse">
                            <thead>
                                <tr class="bg-slate-100 text-slate-600 text-sm uppercase tracking-wider">
                                    <th class="w-16 py-4 border-r border-slate-200 text-center">#</th>
                                    <th class="w-[45%] py-4 border-r border-slate-200 text-center text-red-600 bg-red-50/50">Lầm tưởng (Sai)</th>
                                    <th class="w-[45%] py-4 text-center text-green-600 bg-green-50/50">Sự thật (Đúng)</th>
                                </tr>
                            </thead>
                            <tbody id="summaryTableBody" class="text-sm"></tbody>
                        </table>
                    </div>
                </div>

                <!-- TAB: GAME -->
                <div id="tab-game" class="tab-content hidden animate-fade-in-up">
                    <!-- GAME START -->
                    <div id="game-start" class="text-center py-20 bg-white/60 backdrop-blur rounded-3xl border border-white/50 shadow-xl">
                        <div class="inline-block p-6 rounded-full bg-orange-100 mb-6 animate-bounce"><i class="fa-solid fa-gamepad text-5xl md:text-6xl text-orange-500"></i></div>
                        <h2 class="text-2xl md:text-3xl font-black text-slate-800 mb-4 tracking-tight">Quiz Game: Bậc Thầy Offline</h2>
                        <p class="text-slate-600 mb-6 max-w-lg mx-auto leading-relaxed text-sm md:text-base">Hệ thống sẽ hiển thị ngẫu nhiên các nhận định về tính năng Offline.<br><strong>Đạt 80% để nhận Chứng chỉ.</strong></p>
                        <div class="mb-8 flex justify-center"><input type="text" id="player-name" placeholder="Nhập tên của bạn..." class="px-5 py-3 rounded-lg border border-slate-300 w-full max-w-md text-center font-medium shadow-inner"></div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 max-w-3xl mx-auto">
                            <button id="btn-mode-standard" onclick="startGame('standard')" class="bg-white border border-blue-200 text-blue-700 px-4 py-3 rounded-lg font-bold shadow-sm text-sm"><div class="text-base mb-1">Tiêu Chuẩn</div><div class="text-xs font-normal text-slate-500">5 Câu hỏi ngẫu nhiên</div></button>
                            <button id="btn-mode-pro" onclick="startGame('pro')" class="bg-white border border-purple-200 text-purple-700 px-4 py-3 rounded-lg font-bold shadow-sm text-sm"><div class="text-base mb-1">Pro</div><div class="text-xs font-normal text-slate-500">8 Câu hỏi ngẫu nhiên</div></button>
                            <button id="btn-mode-promax" onclick="startGame('promax')" class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-4 py-3 rounded-lg font-bold shadow-lg text-sm"><div class="text-base mb-1" id="btn-promax-text">Promax (Full)</div><div class="text-xs font-normal text-white/80">Toàn bộ câu hỏi</div></button>
                        </div>
                    </div>
                    <!-- GAME PLAYING -->
                    <div id="game-playing" class="hidden max-w-2xl mx-auto py-6">
                        <div class="flex justify-between items-center mb-6 px-2">
                            <div class="text-slate-400 font-bold uppercase text-xs tracking-wider">Câu hỏi: <span id="q-progress" class="text-blue-600 text-base">1/10</span></div>
                            <div class="text-xs font-bold bg-white px-3 py-1.5 rounded-full border border-slate-200 shadow-sm text-slate-600">Score: <span id="current-score" class="text-green-600">0</span></div>
                        </div>
                        
                        <!-- GAME CARD - SIMPLE CONTAINER (NO FLIP) -->
                        <div id="game-card-container" class="w-full h-[300px] mb-6 relative z-10">
                            <!-- Card Body -->
                            <div id="game-card-content" class="w-full h-full bg-white rounded-3xl shadow-xl p-8 flex flex-col justify-center items-center text-center border border-slate-100 relative overflow-hidden transition-all duration-300">
                                 <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-400 to-green-400"></div>
                                 <!-- Question Content -->
                                 <h3 id="question-text" class="text-lg md:text-xl font-extrabold text-slate-800 leading-snug animate-fade-in-up">Loading...</h3>
                                 <!-- Result Notification (Hidden by default) -->
                                 <div id="result-notification" class="hidden absolute inset-0 bg-white/95 flex flex-col justify-center items-center z-20">
                                     <!-- JS will populate this -->
                                 </div>
                            </div>
                        </div>

                        <!-- Buttons -->
                        <div class="grid grid-cols-2 gap-4">
                            <button id="btn-true" onclick="answerGame(true)" class="py-3 md:py-4 rounded-2xl bg-white border-2 border-green-100 hover:border-green-500 hover:bg-green-50 text-green-600 font-bold text-base md:text-xl shadow-sm hover:shadow-lg transition-all transform active:scale-95 group"><i class="fa-solid fa-check-circle mb-1 block text-xl md:text-2xl group-hover:scale-110 transition-transform"></i> ĐÚNG</button>
                            <button id="btn-false" onclick="answerGame(false)" class="py-3 md:py-4 rounded-2xl bg-white border-2 border-red-100 hover:border-red-500 hover:bg-red-50 text-red-600 font-bold text-base md:text-xl shadow-sm hover:shadow-lg transition-all transform active:scale-95 group"><i class="fa-solid fa-times-circle mb-1 block text-xl md:text-2xl group-hover:scale-110 transition-transform"></i> SAI</button>
                        </div>
                    </div>
                    
                    <!-- GAME RESULT -->
                    <div id="game-result" class="hidden flex flex-col items-center">
                        <div id="certificate" class="w-full max-w-4xl aspect-video bg-white shadow-2xl flex overflow-hidden certificate-container mx-auto">
                            <div class="w-1/3 bg-blue-900 flex flex-col items-center justify-center text-white p-6 relative">
                                <div class="mb-6"><i class="fa-solid fa-award text-6xl text-yellow-400"></i></div>
                                <div class="text-center z-10"><p class="uppercase tracking-widest text-[10px] opacity-70 mb-1">Cấp bởi</p><p class="font-bold text-sm leading-tight">KiotViet LND Department</p></div>
                                <div class="absolute bottom-0 left-0 w-full h-2 bg-green-500"></div><div class="absolute top-0 right-0 w-2 h-full bg-black/10"></div>
                            </div>
                            <div class="w-2/3 p-8 md:p-12 flex flex-col justify-center relative bg-white">
                                <div id="fail-watermark" class="watermark hidden">Suýt đạt</div>
                                <h1 class="text-3xl md:text-4xl font-black text-blue-900 uppercase mb-1 font-sans tracking-tight">GIẤY CHỨNG NHẬN</h1>
                                <p class="text-slate-500 italic text-sm mb-6 border-b border-slate-100 pb-4">Đã hoàn thành xuất sắc nội dung đào tạo sản phẩm</p>
                                <div class="space-y-1 mb-6"><p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider">Trao tặng cho:</p><h2 class="text-2xl md:text-3xl font-bold text-blue-700 uppercase leading-tight" id="certificate-name">TÊN HỌC VIÊN</h2></div>
                                <div class="space-y-1 mb-6"><p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider">Học phần:</p><h3 class="text-xl font-bold text-slate-800 uppercase">Offline Mode</h3></div>
                                <div class="flex justify-between items-end mt-auto pt-4 border-t border-slate-100">
                                    <div><p class="text-[10px] text-slate-400 uppercase font-bold">Ngày hoàn thành</p><p class="text-sm font-medium text-slate-600" id="cert-date">dd/mm/yyyy</p></div>
                                    <div class="text-right"><p class="text-[10px] text-slate-400 uppercase font-bold">Điểm số</p><p class="text-xl font-black text-green-600" id="final-score-cert">100%</p></div>
                                </div>
                            </div>
                        </div>
                        <div id="fail-message-container" class="hidden mt-6 bg-red-50 px-6 py-4 rounded-xl border border-red-100 text-center">
                            <p class="text-red-600 font-bold"><i class="fa-solid fa-triangle-exclamation mr-2"></i>Chưa đạt yêu cầu nhận chứng nhận (Cần >80%)</p>
                            <p class="text-sm text-slate-600 mt-1">Hãy ôn lại kiến thức và thử lại nhé!</p>
                        </div>
                        <div class="flex flex-wrap justify-center gap-4 mt-8 mb-12">
                            <button onclick="playAgain()" class="bg-white border-2 border-blue-600 text-blue-700 px-6 py-3 rounded-full font-bold shadow-sm hover:bg-blue-50 transition"><i class="fa-solid fa-rotate-right mr-2"></i> Chơi lại</button>
                            <button onclick="switchTab('cheatsheet')" class="bg-white border border-slate-200 text-slate-700 px-6 py-3 rounded-full font-bold shadow hover:bg-slate-50 transition flex items-center gap-2"><i class="fa-solid fa-bolt text-yellow-500"></i> Xem Cẩm nang</button>
                            <button id="btn-download" onclick="downloadCertificate()" class="bg-blue-600 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-blue-700 transition hidden"><i class="fa-solid fa-download mr-2"></i> Tải chứng nhận</button>
                        </div>
                        <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden w-full">
                            <h3 class="text-xl font-bold text-blue-900 px-6 py-4 bg-slate-50 border-b border-slate-100">Chi tiết kết quả</h3>
                            <table class="min-w-full divide-y divide-slate-100"><thead class="bg-white"><tr><th class="px-6 py-4 text-center text-xs font-bold text-slate-500 uppercase">Câu hỏi</th><th class="px-6 py-4 text-center text-xs font-bold text-slate-500 uppercase w-32">Bạn chọn</th><th class="px-6 py-4 text-center text-xs font-bold text-slate-500 uppercase w-40">Kết quả</th></tr></thead><tbody id="review-body" class="bg-white divide-y divide-slate-100 text-sm"></tbody></table>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script>
        const lessonData = [
            {
                id: 1,
                title: "Cơ chế Offline & Đồng bộ",
                icon: "fa-solid fa-wifi",
                chat: [
                    { role: "customer", text: "Chào em, cửa hàng chị dạo này mạng chập chờn quá. Đang bán hàng mà mất mạng thì KiotViet có hoạt động được không? Chị sợ mất đơn hàng của khách." },
                    { role: "consultant", text: "Chị yên tâm ạ. KiotViet Retail có chế độ <strong>Offline</strong> tự động kích hoạt ngay khi mất mạng. Lúc này, trên màn hình bán hàng sẽ hiện một <strong>dòng thông báo màu hồng</strong> báo hiệu đã chuyển sang chế độ Offline." },
                    { role: "customer", text: "Vậy lúc đó chị có tìm kiếm sản phẩm hay thông tin khách hàng cũ để thanh toán được không?" },
                    { role: "consultant", text: "Hoàn toàn được chị nhé. Chị vẫn tìm hàng, chọn khách, thanh toán và in hóa đơn bình thường. Dữ liệu lúc này được lưu tạm vào bộ nhớ đệm (Cache) của trình duyệt." },
                    { role: "customer", text: "Thế làm sao chị biết đơn nào bán lúc mất mạng? Và các máy khác trong cửa hàng có thấy đơn đó ngay không?" },
                    { role: "consultant", text: "Đơn bán khi mất mạng sẽ có mã bắt đầu bằng chữ <strong>'HDO'</strong>. Vì lưu ở bộ nhớ máy chị nên <strong>các máy khác sẽ chưa thấy ngay</strong>. Khi có mạng lại, hệ thống tự động đồng bộ lên máy chủ, lúc đó mã đơn sẽ trở về bình thường và các máy khác mới nhìn thấy được." },
                    { role: "customer", text: "À, còn một trường hợp nữa. Nếu sáng sớm đến mở máy tính lên mà chưa có mạng ngay thì làm sao vào phần mềm bán hàng?" },
                    { role: "consultant", text: "Trường hợp này chị <strong>tuyệt đối không</strong> vào Google tìm kiếm hay gõ kiotviet.vn nhé, vì không có mạng sẽ không tải được. Chị cần truy cập thẳng vào đường dẫn bán hàng: <code>[Tên-gian-hàng].kiotviet.vn/sale/</code>." },
                    { role: "customer", text: "Nhớ đường dẫn dài thế hơi khó nhỉ." },
                    { role: "consultant", text: "Mẹo nhỏ là khi đang có mạng, chị hãy bấm vào hình ngôi sao trên trình duyệt để lưu <strong>Dấu trang (Bookmark)</strong> lại. Lần sau mất mạng, chỉ cần bấm vào Bookmark đó là vào bán hàng được ngay ạ." }
                ],
                cards: [
                    {
                        id: 101,
                        isTrue: false,
                        question: "Tại màn hình bán hàng, khi mất kết nối Internet, phần mềm sẽ bị treo và không thể thực hiện bất kỳ thao tác nào.",
                        wrong: "Khi mất kết nối Internet, phần mềm sẽ bị treo và không thể thực hiện bất kỳ thao tác bán hàng nào.",
                        right: "Khi mất kết nối Internet, hệ thống hiển thị thông báo màu hồng và chuyển sang chế độ Offline cho phép tiếp tục bán hàng.",
                        detail: "Hệ thống tự động kích hoạt chế độ Offline (Bán hàng khi mất mạng) để đảm bảo kinh doanh không gián đoạn."
                    },
                    {
                        id: 102,
                        isTrue: false,
                        question: "Ở chế độ Offline, người dùng chỉ có thể tạo đơn nháp chứ không thể in hóa đơn cho khách hàng.",
                        wrong: "Ở chế độ Offline, người dùng chỉ có thể tạo đơn nháp chứ không thể in hóa đơn cho khách hàng.",
                        right: "Ở chế độ Offline, người dùng vẫn có thể hoàn tất thanh toán và in hóa đơn trực tiếp cho khách hàng như bình thường.",
                        detail: "Các thao tác cơ bản như tìm hàng, chọn khách, thanh toán và in hóa đơn vẫn hoạt động bình thường nhờ Cache trình duyệt."
                    },
                    {
                        id: 103,
                        isTrue: false,
                        question: "Khi bán hàng mất mạng, dữ liệu hóa đơn sẽ bị mất hoàn toàn nếu tắt trình duyệt web ngay lập tức.",
                        wrong: "Khi bán hàng mất mạng, dữ liệu hóa đơn sẽ bị mất hoàn toàn nếu tắt trình duyệt web ngay lập tức.",
                        right: "Dữ liệu hóa đơn Offline được lưu tạm thời vào bộ nhớ đệm (Cache) của trình duyệt và chờ đồng bộ.",
                        detail: "Dữ liệu được lưu trữ an toàn trong Local Storage/Cache của trình duyệt cho đến khi có mạng để đồng bộ."
                    },
                    {
                        id: 104,
                        isTrue: true,
                        question: "Hóa đơn tạo khi mất mạng sẽ có mã phiếu bắt đầu bằng ký tự 'HDO' (Hóa Đơn Offline).",
                        wrong: "Hóa đơn tạo khi mất mạng không có dấu hiệu nhận biết nào khác biệt so với hóa đơn thông thường.",
                        right: "Hóa đơn tạo khi mất mạng có mã phiếu bắt đầu bằng ký tự 'HDO' (Hóa Đơn Offline) để phân biệt.",
                        detail: "HDO giúp người dùng dễ dàng nhận biết các đơn hàng được tạo trong thời gian mất kết nối."
                    },
                    {
                        id: 105,
                        isTrue: false,
                        question: "Ngay khi tạo hóa đơn Offline trên một thiết bị, tất cả các thiết bị khác trong cửa hàng đều nhìn thấy đơn hàng đó.",
                        wrong: "Ngay khi tạo hóa đơn Offline trên một thiết bị, tất cả các thiết bị khác trong cửa hàng đều nhìn thấy đơn hàng đó.",
                        right: "Hóa đơn Offline chỉ hiển thị trên thiết bị tạo ra nó cho đến khi có mạng trở lại và được đồng bộ lên hệ thống chung.",
                        detail: "Do dữ liệu nằm ở bộ nhớ máy cục bộ (Local), các máy khác không thể thấy cho đến khi dữ liệu được đẩy lên Server."
                    },
                    {
                        id: 106,
                        isTrue: false,
                        question: "Khi mở cửa hàng mà không có mạng, người dùng có thể vào Google hoặc gõ 'kiotviet.vn' để đăng nhập vào màn hình bán hàng.",
                        wrong: "Khi mở cửa hàng mà không có mạng, người dùng có thể vào Google hoặc gõ 'kiotviet.vn' để đăng nhập.",
                        right: "Khi không có mạng, người dùng bắt buộc phải truy cập trực tiếp đường dẫn '.../sale/' hoặc dùng Bookmark đã lưu.",
                        detail: "Google và trang chủ cần Internet để tải. Màn hình bán hàng (đã lưu Cache) mới có thể truy cập trực tiếp."
                    },
                    {
                        id: 107,
                        isTrue: false,
                        question: "Chế độ Offline hoạt động được trên bất kỳ máy tính nào, kể cả máy tính mới mua chưa từng truy cập KiotViet.",
                        wrong: "Chế độ Offline hoạt động được trên bất kỳ máy tính nào, kể cả máy tính mới mua chưa từng truy cập KiotViet.",
                        right: "Chế độ Offline chỉ hoạt động trên trình duyệt đã từng truy cập và đăng nhập thành công vào gian hàng trước đó.",
                        detail: "Cần phải có dữ liệu Cache (Bộ nhớ đệm) từ lần truy cập trước đó thì chế độ Offline mới hoạt động được."
                    },
                    {
                        id: 108,
                        isTrue: true,
                        question: "Hệ thống sẽ tự động đồng bộ dữ liệu hóa đơn Offline lên máy chủ ngay khi thiết bị kết nối lại Internet.",
                        wrong: "Người dùng phải bấm nút 'Gửi dữ liệu' thủ công để đồng bộ các hóa đơn Offline lên hệ thống.",
                        right: "Hệ thống sẽ tự động đồng bộ dữ liệu hóa đơn Offline lên máy chủ ngay khi thiết bị kết nối lại Internet.",
                        detail: "Quá trình đồng bộ diễn ra tự động hoàn toàn, đảm bảo dữ liệu được cập nhật nhanh nhất."
                    }
                ]
            }
        ];

        let currentTab = 'cheatsheet';
        const completedCards = new Set();
        let totalCards = 0;
        
        // GAME VARS
        let gameQuestions = [];
        let currentGameIndex = 0;
        let score = 0;
        let userAnswers = [];
        let isGameProMax = false; // Flag to check max questions

        // DOM ELEMENTS
        const contentArea = document.getElementById('contentArea');
        const lessonContainer = document.getElementById('lessonContainer');
        const navContainer = document.getElementById('dynamic-nav-container');

        // INITIALIZE
        function init() {
            renderNav();
            renderAllChats();
            renderSummary();
            updateProgress();
        }

        // RENDER NAV & CARDS
        function renderNav() {
            navContainer.innerHTML = '';
            totalCards = 0;

            lessonData.forEach((topic, index) => {
                totalCards += topic.cards.length;
                
                // Create Nav Button
                const btn = document.createElement('button');
                btn.className = `nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3 mb-1`;
                btn.id = `nav-topic-${topic.id}`;
                btn.onclick = () => switchTab(`topic-${topic.id}`);
                btn.innerHTML = `<i class="${topic.icon} w-6 text-center text-blue-500"></i><span class="font-medium text-sm truncate">${topic.title}</span>`;
                navContainer.appendChild(btn);

                // Create Content Section
                const section = document.createElement('div');
                section.id = `tab-topic-${topic.id}`;
                section.className = `tab-content hidden animate-fade-in-up`;
                
                // Chat UI
                let chatHTML = '';
                if(topic.chat && topic.chat.length > 0) {
                    chatHTML = `<div class="mb-10 max-w-3xl mx-auto space-y-6">`;
                    topic.chat.forEach(msg => {
                        const isConsultant = msg.role === 'consultant';
                        const align = isConsultant ? 'justify-end' : 'justify-start';
                        const bubbleClass = isConsultant ? 'chat-bubble-consultant' : 'chat-bubble-customer';
                        const label = isConsultant ? 'Chuyên viên KiotViet' : 'Chủ cửa hàng';
                        const icon = isConsultant ? '<div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white shadow-md text-xs"><i class="fa-solid fa-headset"></i></div>' : '<div class="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-slate-600 shadow-md text-xs"><i class="fa-solid fa-user"></i></div>';
                        
                        chatHTML += `
                            <div class="flex w-full ${align} gap-3">
                                ${!isConsultant ? icon : ''}
                                <div class="flex flex-col ${isConsultant ? 'items-end' : 'items-start'} max-w-[85%]">
                                    <span class="text-[10px] text-slate-400 font-bold uppercase mb-1 ml-1">${label}</span>
                                    <div class="chat-bubble ${bubbleClass}">${msg.text}</div>
                                </div>
                                ${isConsultant ? icon : ''}
                            </div>`;
                    });
                    chatHTML += `</div>`;
                }

                // Flashcards Grid
                // FIX ID PLACEMENT: ID goes to card-inner
                const cardsHTML = topic.cards.map(card => `
                    <div class="h-[500px] w-full perspective-1000 group">
                        <div class="card-inner w-full h-full duration-500" id="card-container-${card.id}">
                            <!-- FRONT -->
                            <div class="card-face p-6 flex flex-col justify-between items-center text-center border-2 border-slate-100 type-card bg-white">
                                <div class="w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center text-blue-600 font-bold text-lg mb-2">${card.id}</div>
                                <h3 class="text-slate-700 text-lg leading-snug font-normal select-none">${card.question}</h3>
                                <div class="mt-4 flex gap-3 w-full">
                                    <button onclick="flipCard(${card.id}, true)" class="flex-1 py-3 bg-green-50 text-green-600 rounded-xl font-bold hover:bg-green-100 transition text-sm border border-green-100 shadow-sm">ĐÚNG</button>
                                    <button onclick="flipCard(${card.id}, false)" class="flex-1 py-3 bg-red-50 text-red-600 rounded-xl font-bold hover:bg-red-100 transition text-sm border border-red-100 shadow-sm">SAI</button>
                                </div>
                                <div class="absolute top-4 right-4 text-slate-200"><i class="fa-solid fa-rotate"></i></div>
                            </div>
                            <!-- BACK -->
                            <div class="card-face card-back"></div>
                        </div>
                    </div>`).join('');

                section.innerHTML = `
                    <h2 class="text-2xl font-bold text-blue-800 mb-6 flex items-center gap-3"><i class="${topic.icon}"></i> ${topic.title}</h2>
                    ${chatHTML}
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">${cardsHTML}</div>
                `;
                
                lessonContainer.appendChild(section);
            });
        }

        // FLIP LOGIC (FIXED DOM ID)
        function flipCard(id, choice, prefix = '') {
            const containerId = prefix + 'card-container-' + id;
            const inner = document.getElementById(containerId); 
            if (!inner) { console.error("Card not found:", containerId); return; }
            
            const backFace = inner.querySelector('.card-back');
            
            let item; 
            lessonData.forEach(t => { 
                const found = t.cards.find(c => c.id === id); 
                if(found) item = found; 
            });
            
            if (!item) return;

            const isCorrect = (choice === item.isTrue);
            const resultHeader = isCorrect 
                ? '<div class="mb-2 font-bold text-lg text-green-600 flex items-center justify-center gap-2 animate-bounce"><i class="fa-solid fa-check-circle"></i> Chính xác!</div>' 
                : '<div class="mb-2 font-bold text-lg text-red-600 flex items-center justify-center gap-2 animate-pulse"><i class="fa-solid fa-times-circle"></i> Chưa chính xác!</div>';
            
            const badgeClass = item.isTrue ? 'bg-green-100 text-green-700 border-green-200' : 'bg-red-100 text-red-700 border-red-200';
            const badgeText = item.isTrue ? 'ĐÚNG' : 'SAI'; 
            const backBorderClass = isCorrect ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50';
            
            backFace.className = `card-face card-back p-5 border-2 flex flex-col rounded-2xl text-center ${backBorderClass}`;
            backFace.innerHTML = `
                <div class="flex flex-col h-full overflow-y-auto custom-scrollbar">
                    ${resultHeader}
                    <div class="mb-3 text-sm text-slate-500 italic px-2"><span class="font-bold">Nhận định:</span> "${item.question}"</div>
                    <div class="mb-3"><span class="px-4 py-1 rounded-full text-xs font-bold border ${badgeClass}">${badgeText}</span></div>
                    <div class="bg-white p-4 rounded-xl border border-blue-100 shadow-sm text-left flex-1">
                        <p class="text-xs text-blue-600 font-bold uppercase mb-2 flex items-center gap-2"><i class="fa-solid fa-lightbulb"></i> Chính xác là nhận định này...</p>
                        <p class="text-slate-700 text-sm leading-relaxed font-medium">${item.right}</p>
                        <p class="text-slate-600 text-xs mt-3 pt-3 border-t border-slate-100">${item.detail || ''}</p>
                    </div>
                    <button onclick="event.stopPropagation(); resetCard(${item.id}, '${prefix}')" class="mt-4 text-xs text-slate-400 font-bold hover:text-blue-600 uppercase tracking-wider flex items-center justify-center gap-1 transition-colors"><i class="fa-solid fa-rotate-left"></i> Xem lại câu hỏi</button>
                </div>`;
            
            inner.classList.add('flipped'); 
            
            if (!prefix) {
                if(isCorrect && !completedCards.has(id)) {
                    completedCards.add(id);
                    confetti({ particleCount: 50, spread: 60, origin: { y: 0.7 }, colors: ['#4ade80', '#22c55e'] });
                }
                updateProgress();
            }
        }

        function resetCard(id, prefix = '') {
            const containerId = prefix + 'card-container-' + id;
            const inner = document.getElementById(containerId);
            if(inner) inner.classList.remove('flipped');
        }

        function updateProgress() {
            const pct = Math.round((completedCards.size / totalCards) * 100);
            document.getElementById('totalProgress').style.width = pct + '%';
            document.getElementById('completedCount').innerText = `${completedCards.size}/${totalCards}`;
        }

        // RENDER ALL CHATS
        function renderAllChats() {
            const container = document.getElementById('tab-all-chats');
            let html = `<h2 class="text-xl font-bold text-blue-700 mb-6 border-l-4 border-slate-400 pl-3">Tổng hợp hội thoại nghiệp vụ</h2>`;
            lessonData.forEach(topic => {
                if(topic.chat) {
                    html += `<div class="mb-8"><h3 class="font-bold text-slate-700 mb-4 ml-2 uppercase text-sm tracking-wider border-b border-slate-200 pb-2">${topic.title}</h3><div class="space-y-4">`;
                    topic.chat.forEach(msg => {
                        const isConsultant = msg.role === 'consultant';
                        const name = isConsultant ? 'Chuyên viên' : 'Chủ shop';
                        const color = isConsultant ? 'text-blue-700' : 'text-slate-600';
                        const bg = isConsultant ? 'bg-blue-50' : 'bg-white';
                        html += `<div class="flex gap-4 p-4 rounded-xl ${bg} border border-slate-100 shadow-sm"><div class="font-bold text-xs w-20 flex-shrink-0 ${color}">${name}</div><div class="text-sm text-slate-700 flex-1">${msg.text}</div></div>`;
                    });
                    html += `</div></div>`;
                }
            });
            container.innerHTML = html;
        }

        // RENDER SUMMARY
        function renderSummary() {
            const tbody = document.getElementById('summaryTableBody');
            let html = '';
            let count = 1;
            lessonData.forEach(topic => {
                topic.cards.forEach(card => {
                    html += `<tr class="border-b border-slate-100 hover:bg-slate-50 transition">
                        <td class="py-4 border-r border-slate-200 text-center font-bold text-slate-400">${count++}</td>
                        <td class="py-4 px-4 border-r border-slate-200 text-red-600 bg-red-50/20 align-top">${card.wrong}</td>
                        <td class="py-4 px-4 text-green-700 bg-green-50/20 font-medium align-top">${card.right}</td>
                    </tr>`;
                });
            });
            tbody.innerHTML = html;
        }

        // GAME LOGIC (STATIC NO FLIP)
        function startGame(mode) {
            const nameInput = document.getElementById('player-name').value.trim();
            if(!nameInput) { alert('Vui lòng nhập tên của bạn!'); return; }
            
            document.getElementById('game-start').classList.add('hidden');
            document.getElementById('game-playing').classList.remove('hidden');
            document.getElementById('game-result').classList.add('hidden');
            
            let allCards = [];
            lessonData.forEach(t => allCards.push(...t.cards));
            
            // Randomize questions
            gameQuestions = [...allCards].sort(() => 0.5 - Math.random());
            
            if(mode === 'standard') gameQuestions = gameQuestions.slice(0, 5);
            else if(mode === 'pro') gameQuestions = gameQuestions.slice(0, 8);
            
            isGameProMax = (mode === 'promax');
            currentGameIndex = 0;
            score = 0;
            userAnswers = [];
            
            loadGameQuestion();
        }

        function loadGameQuestion() {
            const item = gameQuestions[currentGameIndex];
            const cardContent = document.getElementById('game-card-content');
            const questionText = document.getElementById('question-text');
            const resultNotif = document.getElementById('result-notification');
            
            // Reset UI
            resultNotif.classList.add('hidden');
            cardContent.className = "w-full h-full bg-white rounded-3xl shadow-xl p-8 flex flex-col justify-center items-center text-center border border-slate-100 relative overflow-hidden transition-all duration-300";
            
            // Randomly pick showing WRONG or RIGHT statement as the "Question"
            // To make it interesting, we present a statement and ask True/False.
            // We use the 'question' field (which is neutral/contextual) but sometimes we can spice it up by using 'wrong' or 'right' content as the prompt?
            // STRICT RULE: Prompt says "Random hiển thị vế Wrong hoặc Right làm đề bài".
            
            // Let's decide if this round presents a True statement or False statement
            // If item.isTrue is true, the 'question' is usually the premise. 
            // However, to follow "Random Wrong or Right", we should pick the text from either 'wrong' or 'right' column and ask: Is this TRUE?
            
            const useCorrectStatement = Math.random() < 0.5; 
            const displayText = useCorrectStatement ? item.right : item.wrong;
            
            // Store current question logic
            // If we show Right text -> Correct Answer is TRUE
            // If we show Wrong text -> Correct Answer is FALSE
            item.gameCorrectAnswer = useCorrectStatement; 
            
            document.getElementById('q-progress').innerText = `${currentGameIndex + 1}/${gameQuestions.length}`;
            document.getElementById('current-score').innerText = score;
            
            questionText.innerHTML = `"${displayText}"`;
        }

        function answerGame(userChoice) {
            const item = gameQuestions[currentGameIndex];
            const isCorrect = (userChoice === item.gameCorrectAnswer);
            
            if(isCorrect) {
                score += 10;
                confetti({ particleCount: 30, spread: 50, origin: { y: 0.8 }, colors: ['#4ade80'] });
            }

            userAnswers.push({
                question: item.gameCorrectAnswer ? item.right : item.wrong, // What was shown
                userChoice: userChoice,
                isCorrect: isCorrect,
                correctAnswer: item.gameCorrectAnswer
            });

            // Show immediate result
            const resultNotif = document.getElementById('result-notification');
            const cardContent = document.getElementById('game-card-content');
            
            resultNotif.classList.remove('hidden');
            resultNotif.innerHTML = isCorrect 
                ? `<i class="fa-solid fa-check-circle text-6xl text-green-500 mb-4 animate-bounce"></i><div class="text-2xl font-black text-green-600">CHÍNH XÁC!</div>`
                : `<i class="fa-solid fa-circle-xmark text-6xl text-red-500 mb-4 animate-shake"></i><div class="text-2xl font-black text-red-600">SAI RỒI!</div>`;
            
            // Visual feedback on border
            cardContent.classList.add(isCorrect ? 'border-green-400' : 'border-red-400');
            cardContent.classList.add(isCorrect ? 'bg-green-50' : 'bg-red-50');

            setTimeout(() => {
                currentGameIndex++;
                if(currentGameIndex < gameQuestions.length) {
                    loadGameQuestion();
                } else {
                    endGame();
                }
            }, 1000);
        }

        function endGame() {
            document.getElementById('game-playing').classList.add('hidden');
            document.getElementById('game-result').classList.remove('hidden');
            
            const maxScore = gameQuestions.length * 10;
            const percentage = Math.round((score / maxScore) * 100);
            const passed = percentage >= 80;
            
            document.getElementById('certificate-name').innerText = document.getElementById('player-name').value;
            document.getElementById('cert-date').innerText = new Date().toLocaleDateString('vi-VN');
            document.getElementById('final-score-cert').innerText = percentage + '%';
            
            const cert = document.getElementById('certificate');
            const failMsg = document.getElementById('fail-message-container');
            const failWatermark = document.getElementById('fail-watermark');
            const btnDown = document.getElementById('btn-download');

            if(passed) {
                cert.classList.remove('grayscale-filter');
                failWatermark.classList.add('hidden');
                failMsg.classList.add('hidden');
                btnDown.classList.remove('hidden');
                confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
            } else {
                cert.classList.add('grayscale-filter');
                failWatermark.classList.remove('hidden');
                failMsg.classList.remove('hidden');
                btnDown.classList.add('hidden');
            }

            // Render Review Table
            const tbody = document.getElementById('review-body');
            tbody.innerHTML = userAnswers.map(ans => `
                <tr>
                    <td class="px-6 py-4 text-slate-700">${ans.question}</td>
                    <td class="px-6 py-4 text-center font-bold ${ans.userChoice ? 'text-green-600' : 'text-red-600'}">${ans.userChoice ? 'ĐÚNG' : 'SAI'}</td>
                    <td class="px-6 py-4 text-center">
                        ${ans.isCorrect 
                            ? '<span class="px-2 py-1 rounded bg-green-100 text-green-700 text-xs font-bold">Chính xác</span>' 
                            : '<span class="px-2 py-1 rounded bg-red-100 text-red-700 text-xs font-bold">Sai</span>'}
                    </td>
                </tr>
            `).join('');
        }

        function playAgain() {
            document.getElementById('game-result').classList.add('hidden');
            document.getElementById('game-start').classList.remove('hidden');
        }

        function downloadCertificate() {
            const cert = document.getElementById('certificate');
            html2canvas(cert, { scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = `ChungNhan_OfflineMode_${document.getElementById('player-name').value}.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        // TAB SWITCHING
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            
            document.getElementById(`tab-${tabId}`).classList.remove('hidden');
            const navBtn = document.getElementById(`nav-${tabId}`);
            if(navBtn) navBtn.classList.add('active');
            
            if(window.innerWidth < 768) {
                document.getElementById('app-body').classList.add('sidebar-closed');
                document.getElementById('app-body').classList.remove('sidebar-open');
            }
        }

        function toggleSidebar() {
            const body = document.getElementById('app-body');
            if(body.classList.contains('sidebar-closed')) {
                body.classList.remove('sidebar-closed');
                body.classList.add('sidebar-open');
            } else {
                body.classList.add('sidebar-closed');
                body.classList.remove('sidebar-open');
            }
        }

        // Main Run
        window.onload = init;
    </script>
</body>
</html>
