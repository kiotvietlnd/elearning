<!DOCTYPE html><html lang="vi" class="scroll-smooth"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khóa học: Phát hành Hóa đơn điện tử trên KiotViet | KiotViet Retail</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #334155; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .soft-glow-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -10; background: linear-gradient(to bottom right, #f8fafc, #e0f2fe); }
        .nav-link { position: relative; transition: color 0.3s; }
        .nav-link.active { color: var(--theme-color); }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.8); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); transition: all 0.3s ease; }
        .glass-card:hover { transform: translateY(-4px); box-shadow: 0 15px 30px -5px rgba(0,0,0,0.1); }
        .perspective-1000 { perspective: 1000px; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; cursor: pointer; }
        .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
        .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 1rem; }
        .flip-card-back { transform: rotateY(180deg); }
        .float-btn { transition: transform 0.2s; }
        .float-btn:hover { transform: scale(1.1); }
        .tab-btn { position: relative; transition: all 0.3s ease; }
        .tab-btn::after { content: ''; position: absolute; bottom: -2px; left: 0; width: 0; height: 2px; background-color: currentColor; transition: width 0.3s ease; }
        .tab-btn.active::after { width: 100%; }
        .modal { transition: opacity 0.3s ease; }
        body.modal-active { overflow: hidden; }
        .knowledge-list li::marker { color: var(--theme-color); font-weight: bold; }
        @media print { body * { visibility: hidden; } #certificate-modal, #certificate-modal * { visibility: visible; } #certificate-modal { position: absolute; left: 0; top: 0; width: 100%; height: 100%; background: white; } .no-print { display: none; } }
    </style></head><body id="top" class="text-slate-700 antialiased selection:bg-blue-100 selection:text-blue-900">
    <div class="soft-glow-background"></div>

    <header class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-slate-200 h-20">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 h-full">
            <div class="flex items-center justify-between h-full gap-8">
                <a href="https://kiotvietlnd.github.io/elearning" class="flex-shrink-0 flex items-center gap-3 hover:opacity-80">
                    <img src="https://logo.kiotviet.vn/KiotViet-Logo-Horizontal.svg" alt="KiotViet Logo" class="h-8">
                    <span class="text-slate-300 font-light text-2xl">|</span>
                    <span class="font-bold text-blue-600 tracking-tight text-lg uppercase">E-Learning</span>
                </a>
                <nav class="hidden lg:flex flex-1 justify-end items-center gap-8">
                    <a href="https://kiotvietlnd.github.io/elearning/retail" class="nav-link text-sm font-bold text-slate-600 hover:text-blue-600 uppercase py-1">Retail</a>
                    <a href="https://kiotvietlnd.github.io/elearning/fnb" class="nav-link text-sm font-bold text-slate-600 hover:text-orange-600 uppercase py-1">FNB</a>
                    <a href="https://kiotvietlnd.github.io/elearning/salon" class="nav-link text-sm font-bold text-slate-600 hover:text-pink-600 uppercase py-1">Salon</a>
                    <a href="https://kiotvietlnd.github.io/elearning/hotel" class="nav-link text-sm font-bold text-slate-600 hover:text-green-600 uppercase py-1">Hotel</a>
                    <div class="h-6 w-px bg-slate-300"></div>
                    <a href="https://kiotvietlnd.github.io/elearning/retail" class="flex items-center gap-2 px-4 py-2 bg-slate-100 text-slate-600 rounded-full font-bold text-sm border border-slate-200 hover:bg-slate-200 hover:text-blue-700 transition-all">
                        <i class="fa-solid fa-arrow-left"></i> Quay lại Danh mục
                    </a>
                </nav>
                <div class="lg:hidden">
                    <button onclick="document.getElementById('mobile-menu').classList.toggle('hidden')" class="text-slate-600 text-2xl p-2"><i class="fa-solid fa-bars"></i></button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden lg:hidden bg-white border-b border-slate-200 shadow-lg absolute w-full left-0 top-20 z-50">
            <div class="px-4 pt-2 pb-4 space-y-2">
                <a href="https://kiotvietlnd.github.io/elearning/retail" class="block px-3 py-2 rounded-md text-base font-bold text-blue-600 bg-blue-50">Retail</a>
                <a href="https://kiotvietlnd.github.io/elearning/fnb" class="block px-3 py-2 rounded-md text-base font-medium text-slate-600 hover:text-orange-600 hover:bg-orange-50">FNB</a>
                <a href="https://kiotvietlnd.github.io/elearning/salon" class="block px-3 py-2 rounded-md text-base font-medium text-slate-600 hover:text-pink-600 hover:bg-pink-50">Salon</a>
                <a href="https://kiotvietlnd.github.io/elearning/hotel" class="block px-3 py-2 rounded-md text-base font-medium text-slate-600 hover:text-green-600 hover:bg-green-50">Hotel</a>
                <div class="border-t border-slate-200 my-2 pt-2">
                    <a href="https://kiotvietlnd.github.io/elearning/retail" class="flex items-center gap-2 px-3 py-2 text-base font-bold text-slate-600 hover:text-blue-600">
                        <i class="fa-solid fa-arrow-left"></i> Quay lại Danh mục
                    </a>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-10 min-h-[80vh]">
        <div id="view-menu" class="animate__animated animate__fadeIn">
            <div class="text-center mb-12">
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-100 mb-4">
                    <i class="fa-solid fa-boxes-stacked text-xs"></i><span class="text-xs font-bold uppercase tracking-wider">Khóa học Retail</span>
                </div>
                <h1 class="text-3xl md:text-5xl font-black text-slate-800 tracking-tight mb-4">08. Phát hành Hóa đơn điện tử trên KiotViet</h1>
                <div class="max-w-md mx-auto bg-white rounded-full h-4 shadow-inner border border-slate-200 overflow-hidden relative">
                    <div id="course-progress" class="bg-gradient-to-r from-blue-500 to-blue-400 h-full w-0 transition-all duration-1000"></div>
                </div>
                <p class="text-xs text-slate-400 mt-2 font-bold uppercase">Tiến độ: <span id="progress-text" class="text-blue-600">0%</span></p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="lesson-grid"></div>
            <div onclick="loadLessonFromMenu(-1)" class="mt-8 bg-gradient-to-r from-indigo-600 to-purple-600 p-1 rounded-2xl cursor-pointer group hover:scale-[1.01] transition-transform shadow-xl">
                <div class="bg-white/10 backdrop-blur-md p-6 rounded-xl flex items-center justify-between h-full">
                    <div class="flex items-center gap-5 text-white">
                        <div class="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center text-3xl"><i class="fa-solid fa-graduation-cap"></i></div>
                        <div><h3 class="font-bold text-xl mb-1">Bài kiểm tra Tổng hợp</h3><p class="text-indigo-100 text-sm opacity-90">Hoàn thành để nhận chứng chỉ.</p></div>
                    </div>
                    <div class="w-10 h-10 rounded-full bg-white text-indigo-600 flex items-center justify-center shadow-lg"><i class="fa-solid fa-arrow-right"></i></div>
                </div>
            </div>
        </div>

        <div id="view-learning" class="hidden animate__animated animate__fadeInRight">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                <button onclick="goBack()" class="group flex items-center gap-2 text-slate-500 hover:text-blue-600 font-bold text-sm bg-white px-4 py-2 rounded-lg border border-slate-200 shadow-sm hover:shadow transition-all">
                    <i class="fa-solid fa-arrow-left group-hover:-translate-x-1 transition-transform"></i> Danh sách mục
                </button>
                <div class="flex items-center gap-3 bg-white px-4 py-2 rounded-lg border border-slate-200 shadow-sm">
                    <i class="fa-solid fa-list-check text-blue-500"></i>
                    <select id="lesson-selector" onchange="switchLessonFromDropdown(this.value)" class="bg-transparent text-sm font-bold text-slate-700 focus:outline-none cursor-pointer w-56"></select>
                </div>
            </div>
            <div class="bg-white p-8 rounded-2xl shadow-sm border border-slate-200 mb-8 relative overflow-hidden">
                <div class="absolute right-0 top-0 w-64 h-64 bg-gradient-to-br from-blue-50 to-transparent rounded-full -mr-16 -mt-16 opacity-70 pointer-events-none"></div>
                <div class="relative z-10 flex items-center gap-6">
                    <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 text-white flex items-center justify-center shrink-0 shadow-lg">
                        <i id="lesson-icon" class="fa-solid fa-book-open text-2xl"></i>
                    </div>
                    <div>
                        <div class="flex items-center gap-2 mb-1"><span class="text-[10px] font-bold text-white bg-blue-500 px-2 py-0.5 rounded uppercase tracking-wider">Đang học</span></div>
                        <div id="lesson-title-container"></div>
                        <p id="lesson-desc" class="text-slate-500 mt-2 font-medium"></p>
                    </div>
                </div>
            </div>
            <div class="mb-8 bg-white rounded-xl shadow-sm border border-slate-100 p-1 inline-flex w-full md:w-auto overflow-x-auto">
                <button onclick="switchTab('knowledge')" id="btn-tab-knowledge" class="tab-btn flex-1 md:flex-none px-6 py-3 text-sm font-bold text-slate-500 hover:text-blue-600 active:text-blue-600 transition-all whitespace-nowrap"><i class="fa-regular fa-lightbulb"></i> Kiến thức</button>
                <div class="w-px bg-slate-200 my-2"></div>
                <button onclick="switchTab('dialogue')" id="btn-tab-dialogue" class="tab-btn flex-1 md:flex-none px-6 py-3 text-sm font-bold text-slate-500 hover:text-blue-600 active:text-blue-600 transition-all whitespace-nowrap"><i class="fa-regular fa-comments"></i> Hội thoại</button>
                <div class="w-px bg-slate-200 my-2"></div>
                <button onclick="switchTab('vocab')" id="btn-tab-vocab" class="tab-btn flex-1 md:flex-none px-6 py-3 text-sm font-bold text-slate-500 hover:text-blue-600 active:text-blue-600 transition-all whitespace-nowrap"><i class="fa-solid fa-bolt"></i> Flashcard</button>
                <div class="w-px bg-slate-200 my-2"></div>
                <button onclick="switchTab('quiz')" id="btn-tab-quiz" class="tab-btn flex-1 md:flex-none px-6 py-3 text-sm font-bold text-slate-500 hover:text-blue-600 active:text-blue-600 transition-all whitespace-nowrap"><i class="fa-solid fa-clipboard-question"></i> Luyện tập</button>
            </div>
            <div class="min-h-[400px]">
                <div id="content-knowledge" class="space-y-4 max-w-4xl mx-auto pb-10 hidden"></div>
                <div id="content-dialogue" class="space-y-6 max-w-3xl mx-auto pb-10 hidden"></div>
                <div id="content-vocab" class="grid grid-cols-1 md:grid-cols-2 gap-6 pb-10 hidden"></div>
                <div id="content-quiz" class="max-w-2xl mx-auto pb-10 hidden">
                     <div id="quiz-stats" class="bg-indigo-50 rounded-2xl p-5 flex justify-between items-center mb-6 border border-indigo-100">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-white text-indigo-600 flex items-center justify-center font-bold text-xl shadow-sm"><i class="fa-solid fa-trophy"></i></div>
                            <div><p class="text-xs text-indigo-500 font-bold uppercase">Kết quả</p><p class="text-xl font-black text-slate-800"><span id="quiz-score">0</span>/<span id="quiz-total">0</span></p></div>
                        </div>
                        <button onclick="resetQuiz()" class="text-xs font-bold text-slate-600 bg-white px-4 py-2 rounded-xl border border-slate-200 hover:bg-slate-50 shadow-sm"><i class="fa-solid fa-rotate-right"></i> Làm lại</button>
                    </div>
                    <div id="quiz-list" class="space-y-6"></div>
                </div>
            </div>
            <div id="lesson-navigation" class="mt-8 pt-6 border-t border-slate-200 flex justify-between items-center"></div>
        </div>
    </main>

    <footer class="bg-white/80 backdrop-blur-md border-t border-slate-200 mt-10 py-8 text-center relative z-10">
        <p class="text-slate-500 font-medium text-sm">Learning and Development Department</p>
        <p class="text-slate-400 text-xs mt-2">© 2026 KiotViet. All rights reserved.</p>
    </footer>

    <div class="fixed bottom-6 right-6 z-50 flex flex-col items-center space-y-3">
        <a href="https://notebooklm.google.com/notebook/a4480a38-2d6e-4974-9880-c45e534f5fa5" target="_blank" title="Hỏi Chatbot AI" class="float-btn w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 text-white rounded-full flex items-center justify-center shadow-lg border-2 border-white"><i class="fa-solid fa-robot"></i></a>
        <a href="https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-hoa-don-dien-tu/phat-hanh-hoa-don-dien-tu-tren-kiotviet/#v-thao-tac-tren-may-pos" target="_blank" title="Xem Tài liệu" class="float-btn w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center shadow-lg border-2 border-white"><i class="fa-solid fa-book-open"></i></a>
        <a href="https://www.youtube.com/playlist?list=PL3x3GXJzpHzSXXO4aVoriCCGga4hTWsMYFNB" target="_blank" title="Xem Video" class="float-btn w-12 h-12 bg-red-600 text-white rounded-full flex items-center justify-center shadow-lg border-2 border-white"><i class="fa-brands fa-youtube"></i></a>
        <button id="scroll-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="hidden w-12 h-12 bg-white text-slate-600 border border-slate-200 rounded-full items-center justify-center shadow-lg float-btn"><i class="fas fa-arrow-up"></i></button>
    </div>

    <div id="certificate-modal" class="modal opacity-0 pointer-events-none fixed inset-0 z-[100] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/90 backdrop-blur-sm" onclick="toggleModal('certificate-modal')"></div>
        <div class="bg-white w-full max-w-3xl rounded-xl shadow-2xl relative z-10 transform scale-95 transition-all duration-300" id="cert-content">
            <div class="p-2">
                <div class="border-8 border-double border-blue-800 p-8 text-center bg-white relative overflow-hidden">
                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-[url('https://cdn-icons-png.flaticon.com/512/2912/2912761.png')] bg-contain bg-no-repeat opacity-5 pointer-events-none"></div>
                    <img src="https://logo.kiotviet.vn/KiotViet-Logo-Horizontal.svg" alt="Logo" class="h-10 mx-auto mb-6">
                    <h2 class="text-4xl font-black font-sans text-blue-900 mb-2 uppercase tracking-widest">Giấy Chứng Nhận</h2>
                    <div class="w-24 h-1 bg-gradient-to-r from-blue-600 to-indigo-600 mx-auto mb-8"></div>
                    <p class="text-slate-500 italic mb-2 font-medium">Chứng nhận nhân viên:</p>
                    <div class="text-3xl font-black text-blue-600 mb-6 uppercase tracking-wider font-sans">Học Viên KiotViet</div>
                    <p class="text-slate-600 mb-2 font-medium">Đã hoàn thành xuất sắc khóa đào tạo:</p>
                    <h3 class="text-2xl font-bold text-slate-800 mb-10 uppercase border-2 border-slate-800 inline-block px-6 py-2">Phát hành Hóa đơn điện tử trên KiotViet</h3>
                    <div class="flex justify-between items-end mt-12 px-10">
                        <div class="text-center"><p class="text-xs text-slate-400 font-bold uppercase mb-1">Ngày cấp</p><p class="text-lg font-bold text-slate-700" id="cert-date">--/--/----</p></div>
                        <div class="text-center relative"><div class="w-24 h-24 absolute -top-12 -left-6 bg-[url('https://cdn-icons-png.flaticon.com/512/1041/1041166.png')] bg-contain bg-no-repeat opacity-80 rotate-12"></div><p class="text-sm font-bold text-blue-900 mt-10 relative z-10">KiotViet Training Dept.</p></div>
                    </div>
                </div>
            </div>
            <div class="bg-slate-50 p-4 flex justify-end gap-3 rounded-b-xl border-t border-slate-100 no-print">
                <button onclick="toggleModal('certificate-modal')" class="px-5 py-2.5 text-slate-600 font-bold rounded-lg hover:bg-slate-200">Đóng</button>
                <button onclick="window.print()" class="px-5 py-2.5 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 flex items-center gap-2"><i class="fa-solid fa-print"></i> In chứng chỉ</button>
            </div>
        </div>
    </div>

    <script>
        const courseData = [
  {
    "title": "Giới thiệu chung",
    "icon": "fa-solid fa-info-circle",
    "desc": "Tổng quan về lợi ích và các nhà cung cấp hỗ trợ kết nối.",
    "knowledge": [
      { "header": "Mục đích & Kết nối", "content": ["Hỗ trợ cửa hàng phát hành HĐĐT khởi tạo từ máy tính tiền.", "Kết nối trực tiếp: KiotViet KV-EINVOICE, MISA, VIETTEL, VNPT, FPT."] },
      { "header": "Lợi ích nổi bật", "content": ["Chủ động 24/7: Lập và xử lý hóa đơn linh hoạt.", "Tức thời: Giải quyết độ trễ giữa thanh toán và xuất hóa đơn.", "Đơn giản: Không yêu cầu chữ ký số người bán trên từng hóa đơn."] }
    ],
    "dialogue": [
      { "speaker": "An (Chủ cửa hàng)", "target": "Chào bạn, cửa hàng mình muốn xuất hóa đơn điện tử ngay khi khách trả tiền thì KiotViet có làm được không?" },
      { "speaker": "Hà (Chuyên viên KiotViet)", "target": "Chào anh An. Hoàn toàn được ạ. Tính năng Phát hành HĐĐT trên KiotViet giúp anh kết nối trực tiếp với các nhà cung cấp như **KV-EINVOICE** hay Viettel, VNPT để xuất hóa đơn ngay trên máy tính tiền." },
      { "speaker": "An (Chủ cửa hàng)", "target": "Nghe tiện quá, vậy anh có cần cắm USB Token để ký từng tờ hóa đơn không?" },
      { "speaker": "Hà (Chuyên viên KiotViet)", "target": "Dạ không cần đâu ạ. Giải pháp này hỗ trợ khởi tạo từ máy tính tiền nên thao tác cực kỳ đơn giản và không yêu cầu **chữ ký số** trên từng hóa đơn lẻ anh nhé." }
    ],
    "vocab": [
      { "q": "Tính năng Phát hành HĐĐT hỗ trợ khởi tạo hóa đơn từ __________ tuân thủ quy định pháp luật.", "full": "Tính năng Phát hành HĐĐT hỗ trợ khởi tạo hóa đơn từ **máy tính tiền** tuân thủ quy định pháp luật." },
      { "q": "Một ưu điểm lớn của tính năng là không yêu cầu __________ của người bán trên từng hóa đơn.", "full": "Một ưu điểm lớn của tính năng là không yêu cầu **chữ ký số** của người bán trên từng hóa đơn." },
      { "q": "KV-EINVOICE, MISA, VIETTEL là các __________ Hóa đơn điện tử có thể kết nối với KiotViet.", "full": "KV-EINVOICE, MISA, VIETTEL là các **nhà cung cấp** Hóa đơn điện tử có thể kết nối với KiotViet." }
    ],
    "quiz": [
      { "q": "Tính năng Phát hành HĐĐT trên KiotViet KHÔNG hỗ trợ kết nối với nhà cung cấp nào dưới đây?", "opts": ["KiotViet KV-EINVOICE", "Nhà cung cấp nước ngoài (Amazon Invoice)", "VIETTEL S-Invoice"], "a": 1 },
      { "q": "Lợi ích nào sau đây là ĐÚNG khi sử dụng tính năng Phát hành HĐĐT?", "opts": ["Giải quyết độ trễ giữa thanh toán và lập hóa đơn", "Bắt buộc phải xuất hóa đơn giấy trước rồi mới nhập lên phần mềm", "Chỉ cho phép xuất hóa đơn vào giờ hành chính"], "a": 0 }
    ]
  },
  {
    "title": "Các thao tác cơ bản",
    "icon": "fa-solid fa-desktop",
    "desc": "Hướng dẫn thiết lập tự động và phát hành hàng loạt trên Web.",
    "knowledge": [
      { "header": "Điều kiện cần", "content": ["Tích chọn 'Phát hành hóa đơn điện tử ngay trên Màn hình bán hàng' trong Thiết lập.", "Tài khoản nhân viên phải được phân quyền."] },
      { "header": "Phát hành tự động", "content": ["Tại màn hình Bán hàng: Bật biểu tượng 'Tự động phát hành HĐĐT'.", "Cơ chế: Tự động gửi dữ liệu ngay khi thanh toán thành công."] },
      { "header": "Theo dõi & Xử lý lỗi", "content": ["Pop-up góc màn hình báo trạng thái: Đang xử lý, Đã phát hành, Phát hành lỗi.", "Nếu quên/lỗi: Vào Quản lý -> Hóa đơn -> Chọn đơn -> Thao tác 'Phát hành hàng loạt'."] }
    ],
    "dialogue": [
      { "speaker": "Mai (Thu ngân)", "target": "Chị ơi, làm sao để em biết hóa đơn vừa bán đã được xuất điện tử thành công hay chưa ạ?" },
      { "speaker": "Chi (Cửa hàng trưởng)", "target": "Sau khi em thanh toán xong, góc màn hình sẽ hiện một Pop-up **Xử lý hóa đơn điện tử**. Em nhìn vào đó nhé." },
      { "speaker": "Mai (Thu ngân)", "target": "Dạ, thế nếu em lỡ quên chưa xuất ngay lúc bán thì sao ạ?" },
      { "speaker": "Chi (Cửa hàng trưởng)", "target": "Không sao đâu. Cuối ca em vào màn hình Quản lý, chọn các hóa đơn đó rồi nhấn thao tác **Phát hành** hàng loạt là được." }
    ],
    "vocab": [
      { "q": "Để hệ thống tự xuất hóa đơn khi bán hàng, cần bật chế độ __________ phát hành hóa đơn điện tử.", "full": "Để hệ thống tự xuất hóa đơn khi bán hàng, cần bật chế độ **Tự động** phát hành hóa đơn điện tử." },
      { "q": "Khi phát hành hàng loạt, chỉ chọn được các hóa đơn có trạng thái __________ hoặc Đang xử lý.", "full": "Khi phát hành hàng loạt, chỉ chọn được các hóa đơn có trạng thái **Hoàn thành** hoặc Đang xử lý." },
      { "q": "Nếu hệ thống không xuất được hóa đơn do sai thông tin, trạng thái sẽ báo là __________.", "full": "Nếu hệ thống không xuất được hóa đơn do sai thông tin, trạng thái sẽ báo là **Phát hành lỗi**." }
    ],
    "quiz": [
      { "q": "Để thực hiện phát hành HĐĐT tự động, thao tác nào sau đây là bắt buộc tại màn hình Bán hàng?", "opts": ["Bật biểu tượng 'Tự động phát hành hóa đơn điện tử'", "Gửi email cho khách hàng trước", "In hóa đơn giấy ra để ký tên"], "a": 0 },
      { "q": "Riêng với nhà cung cấp KV-EINVOICE, sau khi phát hành thành công trên KiotViet, hệ thống có thể làm gì?", "opts": ["Tự động gửi thông tin đến Cơ quan Thuế", "Phải đợi đến cuối tháng mới gửi Cơ quan Thuế", "Không thể gửi Cơ quan Thuế"], "a": 0 }
    ]
  },
  {
    "title": "Các tính năng nâng cao",
    "icon": "fa-solid fa-layer-group",
    "desc": "Tra cứu, xem bản thể hiện và gửi thông tin cho khách hàng.",
    "knowledge": [
      { "header": "Theo dõi trạng thái", "content": ["Xem tại cột 'Trạng thái HĐĐT' trong danh sách Hóa đơn.", "Các trạng thái: Trống, Đã chuyển, Đã phát hành, Phát hành lỗi."] },
      { "header": "Xem & Gửi hóa đơn", "content": ["Xem bản thể hiện: Bấm 3 chấm -> Chọn 'Xem hóa đơn điện tử' (PDF/Ảnh).", "Gửi khách: Sao chép 'Mã tra cứu' và Link tra cứu gửi cho khách."] }
    ],
    "dialogue": [
      { "speaker": "Lâm (Khách hàng)", "target": "Em ơi, anh muốn lấy hóa đơn về để kê khai thuế thì làm thế nào?" },
      { "speaker": "Thảo (Thu ngân)", "target": "Dạ anh đợi chút. Em sẽ gửi cho anh **Mã tra cứu** và đường link website." },
      { "speaker": "Lâm (Khách hàng)", "target": "Có xem được hình ảnh hóa đơn luôn không em?" },
      { "speaker": "Thảo (Thu ngân)", "target": "Được ạ. Anh nhập mã vào link là xem được **bản thể hiện** PDF chi tiết, y hệt hóa đơn giấy luôn ạ." }
    ],
    "vocab": [
      { "q": "Bạn có thể xem tình trạng hóa đơn tại cột __________ trong danh sách hóa đơn.", "full": "Bạn có thể xem tình trạng hóa đơn tại cột **Trạng thái HĐĐT** trong danh sách hóa đơn." },
      { "q": "Để khách hàng tự kiểm tra hóa đơn, bạn cần cung cấp __________ và đường link tra cứu.", "full": "Để khách hàng tự kiểm tra hóa đơn, bạn cần cung cấp **Mã tra cứu** và đường link tra cứu." },
      { "q": "Tính năng 'Xem hóa đơn điện tử' cho phép xem __________ của hóa đơn dưới dạng ảnh hoặc PDF.", "full": "Tính năng 'Xem hóa đơn điện tử' cho phép xem **bản thể hiện** của hóa đơn dưới dạng ảnh hoặc PDF." }
    ],
    "quiz": [
      { "q": "Làm thế nào để gửi thông tin tra cứu hóa đơn cho khách hàng?", "opts": ["Sao chép Mã tra cứu và Link tra cứu trong chi tiết hóa đơn", "Chụp ảnh màn hình máy tính gửi cho khách", "Bắt buộc khách phải đến cửa hàng để xem"], "a": 0 },
      { "q": "Trạng thái 'Trống' tại cột Trạng thái HĐĐT nghĩa là gì?", "opts": ["Hóa đơn chưa được thực hiện thao tác phát hành điện tử", "Hóa đơn đã bị hủy", "Hóa đơn đã gửi cơ quan thuế nhưng chưa có phản hồi"], "a": 0 }
    ]
  },
  {
    "title": "Thao tác trên Điện thoại",
    "icon": "fa-solid fa-mobile-screen",
    "desc": "Phát hành hóa đơn ngay trên App Mobile KiotViet Bán hàng.",
    "knowledge": [
      { "header": "Phát hành tự động", "content": ["Khi thanh toán: Tích chọn 'Hóa đơn điện tử' và mẫu in hợp lệ.", "Cài đặt mặc định: Vào Thiết lập bán hàng -> Bật 'Tự động phát hành hóa đơn điện tử'."] },
      { "header": "Phát hành hàng loạt", "content": ["Menu Hóa đơn -> Chọn 3 chấm -> 'Phát hành Hóa đơn điện tử'.", "Giới hạn: Tối đa 50 hóa đơn/lần."] },
      { "header": "Xem danh sách xử lý", "content": ["Tại menu Bán hàng -> Chọn biểu tượng chữ 'e' góc phải."] }
    ],
    "dialogue": [
      { "speaker": "Tú (Shipper)", "target": "Anh đi giao hàng, thu tiền xong muốn xuất hóa đơn luôn trên điện thoại được không?" },
      { "speaker": "Vân (Chuyên viên KiotViet)", "target": "Được chứ anh. Lúc thanh toán trên App, anh nhớ tích vào ô **Hóa đơn điện tử** là xong ngay." },
      { "speaker": "Tú (Shipper)", "target": "Thế cuối ngày anh muốn xuất một loạt các đơn đã giao thì sao?" },
      { "speaker": "Vân (Chuyên viên KiotViet)", "target": "Anh vào menu Hóa đơn, chọn 'Phát hành hàng loạt'. Nhưng lưu ý mỗi lần chỉ chọn được tối đa **50 đơn** thôi nhé." }
    ],
    "vocab": [
      { "q": "Trên điện thoại, để xem danh sách các hóa đơn đã xử lý, bấm vào biểu tượng __________.", "full": "Trên điện thoại, để xem danh sách các hóa đơn đã xử lý, bấm vào biểu tượng **chữ e**." },
      { "q": "Số lượng hóa đơn tối đa cho một lần phát hành hàng loạt trên App là __________ hóa đơn.", "full": "Số lượng hóa đơn tối đa cho một lần phát hành hàng loạt trên App là **50** hóa đơn." },
      { "q": "Để xuất hóa đơn ngay khi thanh toán trên App, cần tích chọn ô __________ và mẫu in hợp lệ.", "full": "Để xuất hóa đơn ngay khi thanh toán trên App, cần tích chọn ô **Hóa đơn điện tử** và mẫu in hợp lệ." }
    ],
    "quiz": [
      { "q": "Số lượng hóa đơn tối đa có thể phát hành hàng loạt trong một lần thao tác trên điện thoại là bao nhiêu?", "opts": ["50 hóa đơn", "100 hóa đơn", "Không giới hạn"], "a": 0 },
      { "q": "Để cài đặt mặc định luôn chọn phát hành HĐĐT khi bán hàng trên điện thoại, bạn vào đâu?", "opts": ["Vào Thiết lập bán hàng -> Bật 'Tự động phát hành hóa đơn điện tử'", "Vào Cài đặt máy in", "Vào Quản lý nhân viên"], "a": 0 }
    ]
  },
  {
    "title": "Thao tác trên Máy POS",
    "icon": "fa-solid fa-cash-register",
    "desc": "Xử lý hóa đơn điện tử trên máy POS Android.",
    "knowledge": [
      { "header": "Thao tác bán hàng", "content": ["Tương tự Mobile: Tích chọn 'Hóa đơn điện tử' khi thanh toán.", "Hệ thống tự động gửi thông tin phát hành sau khi hoàn tất."] },
      { "header": "Quản lý & Lưu ý", "content": ["Xem danh sách: Menu Tùy chọn -> 'Xử lý hóa đơn điện tử'.", "Lưu ý: Thiết lập kết nối ban đầu PHẢI làm trên Web (Máy tính)."] }
    ],
    "dialogue": [
      { "speaker": "Hùng (Thu ngân)", "target": "Máy POS này có xem được danh sách hóa đơn nào bị lỗi phát hành không chị?" },
      { "speaker": "Lan (Quản lý)", "target": "Có em nhé. Em vào Menu Tùy chọn, rồi bấm vào mục **Xử lý hóa đơn điện tử** là thấy hết." },
      { "speaker": "Hùng (Thu ngân)", "target": "Vậy em có thể cài đặt kết nối nhà cung cấp hóa đơn ngay trên máy POS này không?" },
      { "speaker": "Lan (Quản lý)", "target": "Không được đâu. Việc thiết lập kết nối ban đầu bắt buộc phải làm trên **máy tính (Web)** em nhé." }
    ],
    "vocab": [
      { "q": "Để xem danh sách xử lý HĐĐT trên máy POS, bạn truy cập vào menu __________.", "full": "Để xem danh sách xử lý HĐĐT trên máy POS, bạn truy cập vào menu **Tùy chọn**." },
      { "q": "Việc thiết lập kết nối nhà cung cấp HĐĐT bắt buộc phải thực hiện trên __________.", "full": "Việc thiết lập kết nối nhà cung cấp HĐĐT bắt buộc phải thực hiện trên **giao diện web**." },
      { "q": "Tính năng phát hành HĐĐT trên máy POS hỗ trợ hệ điều hành __________.", "full": "Tính năng phát hành HĐĐT trên máy POS hỗ trợ hệ điều hành **Android**." }
    ],
    "quiz": [
      { "q": "Thao tác nào sau đây KHÔNG thể thực hiện trực tiếp trên máy POS?", "opts": ["Thiết lập kết nối ban đầu với nhà cung cấp HĐĐT", "Tích chọn phát hành hóa đơn khi thanh toán", "Xem danh sách các hóa đơn phát hành lỗi"], "a": 0 },
      { "q": "Danh sách 'Xử lý hóa đơn điện tử' trên máy POS hiển thị những hóa đơn nào?", "opts": ["Chỉ hiển thị các hóa đơn do chính tài khoản đó phát hành trên chi nhánh đăng nhập", "Hiển thị tất cả hóa đơn của toàn bộ hệ thống", "Chỉ hiển thị hóa đơn của ngày hôm qua"], "a": 0 }
    ]
  }
]; 

        let currentLessonId = 0;
        let completedLessons = new Set();
        let quizState = { correct: 0, total: 0 };
        let currentActiveTab = 'knowledge'; // Default tab

        function init() {
            renderMenu();
            updateProgress();
            const today = new Date();
            document.getElementById('cert-date').innerText = `${today.getDate()}/${today.getMonth() + 1}/${today.getFullYear()}`;
            
            const scrollTopBtn = document.getElementById('scroll-to-top');
            window.onscroll = function() {
                if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) { scrollTopBtn.classList.remove('hidden'); scrollTopBtn.classList.add('flex'); }
                else { scrollTopBtn.classList.add('hidden'); scrollTopBtn.classList.remove('flex'); }
            };
        }

        function renderMenu() {
            const grid = document.getElementById('lesson-grid');
            grid.innerHTML = courseData.map((lesson, idx) => `
                <div onclick="loadLessonFromMenu(${idx})" class="glass-card bg-white rounded-xl p-5 cursor-pointer group hover:border-blue-400 relative overflow-hidden transition-all duration-300">
                    <div class="flex items-start gap-4 relative z-10">
                        <div class="w-12 h-12 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center text-xl shadow-sm border border-blue-100 group-hover:bg-blue-600 group-hover:text-white transition-colors duration-300"><i class="${lesson.icon}"></i></div>
                        <div><h3 class="font-bold text-lg text-slate-800 group-hover:text-blue-600 transition-colors">${lesson.title}</h3><p class="text-sm text-slate-500 mt-1 line-clamp-2">${lesson.desc}</p></div>
                    </div>
                    <div class="mt-4 pt-3 border-t border-slate-100 flex items-center justify-between">
                        <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest group-hover:text-blue-500">Mục ${idx + 1}</span>
                        ${completedLessons.has(idx) ? '<i class="fa-solid fa-circle-check text-green-500 text-xl animate__animated animate__rubberBand"></i>' : '<i class="fa-regular fa-circle-play text-slate-300 text-xl group-hover:text-blue-500 transition-colors"></i>'}
                    </div>
                </div>
            `).join('');
        }

        function loadLessonFromMenu(id) {
            currentActiveTab = 'knowledge';
            if(id === -1) loadComprehensiveLesson(); else loadLesson(id);
        }

        function loadLesson(id) {
            currentLessonId = id;
            const lesson = courseData[id];
            const mainTopic = '<span class="block text-sm text-blue-500 font-bold uppercase tracking-wider mb-1">Phát hành Hóa đơn điện tử trên KiotViet</span>';
            document.getElementById('lesson-title-container').innerHTML = `${mainTopic}<h2 id="lesson-title" class="text-2xl md:text-3xl font-black text-slate-800">${lesson.title}</h2>`;
            document.getElementById('lesson-desc').innerText = lesson.desc;
            document.getElementById('lesson-icon').className = `${lesson.icon} text-2xl`;
            
            renderKnowledge(lesson.knowledge);
            renderDialogue(lesson.dialogue);
            renderVocab(lesson.vocab);
            renderQuiz(lesson.quiz);
            
            updateDropdown();
            renderNavigation();
            document.getElementById('view-menu').classList.add('hidden');
            document.getElementById('view-learning').classList.remove('hidden');
            switchTab(currentActiveTab);
            window.scrollTo(0, 0);
        }

        function renderKnowledge(data) {
            const container = document.getElementById('content-knowledge');
            if(!data || data.length === 0) {
                 container.innerHTML = `<div class="p-6 bg-slate-50 rounded-xl text-center text-slate-500">Chưa có dữ liệu chi tiết.</div>`;
                 return;
            }
            container.innerHTML = data.map((item, idx) => `
                <div class="bg-white rounded-xl p-6 shadow-sm border border-slate-100 animate__animated animate__fadeInUp" style="animation-delay: ${idx * 100}ms">
                    <div class="flex gap-4">
                        <div class="shrink-0 w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center font-bold shadow-sm border border-blue-100">${idx + 1}</div>
                        <div class="flex-1">
                            <h3 class="font-bold text-slate-800 text-lg mb-3 pb-2 border-b border-slate-100">${item.header}</h3>
                            <ul class="space-y-3 knowledge-list">
                                ${item.content.map(point => `<li class="flex gap-3 text-sm text-slate-600 leading-relaxed items-start"><i class="fa-solid fa-check text-blue-500 mt-1 shrink-0"></i> <span>${point}</span></li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderDialogue(dialogue) {
            const container = document.getElementById('content-dialogue');
            container.innerHTML = dialogue.map((line, idx) => {
                const isKiot = line.speaker.includes('KiotViet');
                const formattedText = line.target.replace(/\*\*(.*?)\*\*/g, '<b class="text-blue-700 font-bold">$1</b>');
                return `
                <div class="flex ${isKiot ? 'flex-row' : 'flex-row-reverse'} gap-4 items-end animate__animated animate__fadeInUp" style="animation-delay: ${idx * 50}ms">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center shrink-0 shadow-md ${isKiot ? 'bg-blue-600 text-white' : 'bg-white border border-slate-200 text-slate-600'}"><i class="fa-solid ${isKiot ? 'fa-user-tie' : 'fa-store'}"></i></div>
                    <div class="flex flex-col ${isKiot ? 'items-start' : 'items-end'} max-w-[80%]">
                        <span class="text-[10px] font-bold text-slate-400 mb-1 uppercase tracking-wide">${line.speaker}</span>
                        <div class="p-4 rounded-2xl shadow-sm text-sm font-medium leading-relaxed border ${isKiot ? 'bg-blue-50 border-blue-100 rounded-bl-none text-slate-700' : 'bg-white border-slate-200 rounded-br-none text-slate-600'}">${formattedText}</div>
                    </div>
                </div>`;
            }).join('');
        }

        function renderVocab(vocab) {
            const container = document.getElementById('content-vocab');
            container.innerHTML = vocab.map((v, i) => {
                // FIXED: Parse markdown bold syntax to HTML span
                const formattedFull = v.full.replace(/\*\*(.*?)\*\*/g, '<span class="text-yellow-300 font-black border-b border-yellow-300">$1</span>');
                return `
                <div class="flip-card h-56 perspective-1000 group animate__animated animate__fadeIn" style="animation-delay: ${i * 50}ms" onclick="this.classList.toggle('flipped')">
                    <div class="flip-card-inner shadow-sm rounded-xl">
                        <div class="flip-card-front bg-white border border-slate-200 hover:border-blue-300 transition-colors">
                            <div class="w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center mb-4 text-blue-500"><i class="fa-solid fa-question text-xl"></i></div>
                            <h3 class="text-base font-bold text-slate-800 px-4 leading-snug">${v.q}</h3>
                            <p class="text-[10px] text-slate-400 mt-6 uppercase tracking-widest font-bold flex items-center gap-1"><i class="fa-solid fa-hand-pointer animate-pulse"></i> Chạm để lật</p>
                        </div>
                        <div class="flip-card-back bg-gradient-to-br from-blue-600 to-indigo-700 text-white">
                            <i class="fa-solid fa-lightbulb text-yellow-300 text-3xl mb-3"></i>
                            <span class="text-[10px] font-bold uppercase tracking-widest text-blue-200 mb-1">Ghi nhớ</span>
                            <p class="font-medium text-sm px-4 leading-relaxed">${formattedFull}</p>
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        function renderQuiz(quiz) {
            const list = document.getElementById('quiz-list');
            quizState = { correct: 0, total: quiz.length };
            updateQuizStats();
            list.innerHTML = quiz.map((q, idx) => `
                <div class="bg-white rounded-xl p-6 shadow-sm border border-slate-100 quiz-card transition-all" id="quiz-${idx}">
                    <div class="flex gap-4 mb-4"><span class="shrink-0 w-8 h-8 bg-blue-100 text-blue-700 rounded-lg flex items-center justify-center text-xs font-bold">Q${idx + 1}</span><h3 class="font-bold text-slate-800 text-base leading-snug">${q.q}</h3></div>
                    <div class="space-y-3 pl-12">
                        ${q.opts.map((opt, oid) => `
                            <button onclick="checkAnswer(${idx}, ${oid}, ${q.a})" class="w-full text-left p-3 rounded-lg border border-slate-200 hover:bg-blue-50 hover:border-blue-300 transition-all text-sm font-medium text-slate-600 quiz-opt flex items-center group">
                                <span class="w-6 h-6 rounded-md border border-slate-300 flex items-center justify-center text-[10px] text-slate-500 font-bold mr-3 group-hover:border-blue-400 group-hover:text-blue-500 opt-idx transition-colors">${String.fromCharCode(65+oid)}</span><span class="flex-1">${opt}</span>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function checkAnswer(qIdx, selected, correct) {
            const card = document.getElementById(`quiz-${qIdx}`);
            if(card.hasAttribute('data-answered')) return;
            card.setAttribute('data-answered', 'true');
            const opts = card.querySelectorAll('.quiz-opt');
            opts.forEach((btn, idx) => {
                btn.disabled = true;
                btn.classList.remove('hover:bg-blue-50', 'hover:border-blue-300');
                const idxSpan = btn.querySelector('.opt-idx');
                if (idx === correct) {
                    btn.classList.add('bg-green-50', 'border-green-500', 'text-green-800');
                    idxSpan.classList.add('bg-green-500', 'border-green-500', 'text-white');
                    idxSpan.innerHTML = '<i class="fa-solid fa-check"></i>';
                } else if (idx === selected) {
                    btn.classList.add('bg-red-50', 'border-red-500', 'text-red-800');
                    idxSpan.classList.add('bg-red-500', 'border-red-500', 'text-white');
                    idxSpan.innerHTML = '<i class="fa-solid fa-xmark"></i>';
                }
            });
            if (selected === correct) { quizState.correct++; confetti({ particleCount: 40, spread: 60, origin: { y: 0.7 } }); } 
            else { card.classList.add('animate__animated', 'animate__shakeX'); }
            updateQuizStats();
            if(document.querySelectorAll('.quiz-card[data-answered]').length === quizState.total) {
                if(quizState.correct === quizState.total && currentLessonId !== -1) { completedLessons.add(currentLessonId); updateProgress(); }
                if(currentLessonId === -1 && quizState.correct === quizState.total) { triggerMegaConfetti(); setTimeout(() => toggleModal('certificate-modal'), 1200); }
            }
        }

        function updateQuizStats() { document.getElementById('quiz-score').innerText = quizState.correct; document.getElementById('quiz-total').innerText = quizState.total; }
        function resetQuiz() { if(currentLessonId === -1) loadComprehensiveLesson(); else renderQuiz(courseData[currentLessonId].quiz); }

        function loadComprehensiveLesson() {
            currentLessonId = -1;
            const allQuizzes = courseData.flatMap(c => c.quiz);
            const allDialogues = courseData.flatMap(c => c.dialogue);
            const allVocabs = courseData.flatMap(c => c.vocab);
            const allKnowledge = courseData.flatMap(c => c.knowledge);
            
            const mainTopic = '<span class="block text-sm text-indigo-500 font-bold uppercase tracking-wider mb-1">Phát hành Hóa đơn điện tử trên KiotViet</span>';
            document.getElementById('lesson-title-container').innerHTML = `${mainTopic}<h2 id="lesson-title" class="text-2xl md:text-3xl font-black text-slate-800">Bài kiểm tra Tổng hợp</h2>`;
            document.getElementById('lesson-desc').innerText = "Ôn tập toàn diện và trả lời đúng 100% câu hỏi để nhận Chứng chỉ.";
            document.getElementById('lesson-icon').className = "fa-solid fa-graduation-cap text-2xl";
            
            // Render content
            renderKnowledge(allKnowledge); renderDialogue(allDialogues); renderVocab(allVocabs); renderQuiz(allQuizzes);
            
            // View transition
            document.getElementById('view-menu').classList.add('hidden');
            document.getElementById('view-learning').classList.remove('hidden');
            document.getElementById('lesson-navigation').innerHTML = `<div class="w-full flex justify-center"><button onclick="goBack()" class="text-slate-400 font-bold text-sm hover:text-slate-600 flex items-center gap-2"><i class="fa-solid fa-arrow-up"></i> Quay về trang chủ</button></div>`;
            
            // Show all tabs
            document.getElementById('btn-tab-knowledge').classList.remove('hidden');
            document.getElementById('btn-tab-dialogue').nextElementSibling.classList.remove('hidden'); 
            
            updateDropdown(); // Update dropdown to show "Test" selected

            switchTab('quiz'); 
            window.scrollTo(0, 0);
        }

        function switchTab(tab) {
            currentActiveTab = tab;
            ['knowledge', 'dialogue', 'vocab', 'quiz'].forEach(t => { 
                const contentEl = document.getElementById(`content-${t}`);
                const btnEl = document.getElementById(`btn-tab-${t}`);
                if(contentEl) contentEl.classList.add('hidden'); 
                if(btnEl) btnEl.classList.remove('active', 'text-blue-600'); 
            });
            const targetContent = document.getElementById(`content-${tab}`);
            const targetBtn = document.getElementById(`btn-tab-${tab}`);
            if(targetContent) targetContent.classList.remove('hidden');
            if(targetBtn) targetBtn.classList.add('active', 'text-blue-600');
        }

        function goBack() { 
            document.getElementById('btn-tab-knowledge').classList.remove('hidden');
            document.getElementById('btn-tab-dialogue').nextElementSibling.classList.remove('hidden');
            document.getElementById('view-learning').classList.add('hidden'); 
            document.getElementById('view-menu').classList.remove('hidden'); 
            updateProgress(); 
            renderMenu(); 
            window.scrollTo(0, 0); 
        }
        function updateProgress() { const pct = Math.round((completedLessons.size / courseData.length) * 100); document.getElementById('course-progress').style.width = `${pct}%`; document.getElementById('progress-text').innerText = `${pct}%`; }
        function updateDropdown() { 
            const select = document.getElementById('lesson-selector'); 
            let html = courseData.map((l, i) => `<option value="${i}" ${i === currentLessonId ? 'selected' : ''}>${i+1}. ${l.title}</option>`).join(''); 
            html += `<option value="-1" ${currentLessonId === -1 ? 'selected' : ''}>Bài kiểm tra Tổng hợp</option>`;
            select.innerHTML = html;
        }
        function switchLessonFromDropdown(val) { 
            const id = parseInt(val);
            if(id === -1) loadComprehensiveLesson();
            else loadLesson(id); 
        }

        function renderNavigation() {
            const container = document.getElementById('lesson-navigation');
            const prev = currentLessonId > 0 ? currentLessonId - 1 : null;
            const next = currentLessonId < courseData.length - 1 ? currentLessonId + 1 : null;
            let html = '<div class="flex-1">';
            if (prev !== null) html += `<button onclick="loadLesson(${prev})" class="flex items-center gap-2 text-slate-500 hover:text-blue-600 font-bold text-sm transition-colors"><i class="fa-solid fa-arrow-left"></i> Mục trước</button>`;
            html += '</div><div class="flex-1 text-right">';
            if (next !== null) html += `<button onclick="loadLesson(${next})" class="flex items-center gap-2 text-blue-600 hover:text-blue-800 font-bold text-sm transition-colors ml-auto">Mục tiếp theo <i class="fa-solid fa-arrow-right"></i></button>`;
            else html += `<button onclick="loadComprehensiveLesson()" class="flex items-center gap-2 text-white bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg shadow-md font-bold text-sm transition-all ml-auto animate-pulse">Thi chứng chỉ <i class="fa-solid fa-graduation-cap"></i></button>`;
            html += '</div>';
            container.innerHTML = html;
        }

        function toggleModal(id) {
            const m = document.getElementById(id);
            const content = document.getElementById('cert-content');
            if (m.classList.contains('opacity-0')) { m.classList.remove('opacity-0', 'pointer-events-none'); content.classList.remove('scale-95'); content.classList.add('scale-100'); }
            else { m.classList.add('opacity-0', 'pointer-events-none'); content.classList.remove('scale-100'); content.classList.add('scale-95'); }
            document.body.classList.toggle('modal-active');
        }

        function triggerMegaConfetti() {
            var duration = 3000; var animationEnd = Date.now() + duration; var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) return clearInterval(interval);
                var particleCount = 50 * (timeLeft / duration);
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: Math.random() * 0.2 + 0.1, y: Math.random() - 0.2 } }));
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: Math.random() * 0.2 + 0.7, y: Math.random() - 0.2 } }));
            }, 250);
        }

        window.onload = init;
    </script></body></html>
