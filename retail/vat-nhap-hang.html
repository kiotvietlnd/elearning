<!DOCTYPE html><html lang="vi" class="scroll-smooth"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khóa học: VAT Nhập hàng | KiotViet Retail</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --theme-color: #2563eb; }
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #334155; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .soft-glow-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -10; background: linear-gradient(to bottom right, #f8fafc, #e0f2fe); }
        .nav-link { position: relative; transition: color 0.3s; }
        .nav-link.active { color: var(--theme-color); }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.8); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); transition: all 0.3s ease; }
        .glass-card:hover { transform: translateY(-4px); box-shadow: 0 15px 30px -5px rgba(0,0,0,0.1); }
        .perspective-1000 { perspective: 1000px; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; cursor: pointer; }
        .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
        .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 1rem; padding: 1.5rem; }
        .flip-card-back { transform: rotateY(180deg); }
        .float-btn { transition: transform 0.2s; }
        .float-btn:hover { transform: scale(1.1); }
        .tab-btn { position: relative; transition: all 0.3s ease; }
        .tab-btn::after { content: ''; position: absolute; bottom: -2px; left: 0; width: 0; height: 2px; background-color: currentColor; transition: width 0.3s ease; }
        .tab-btn.active::after { width: 100%; }
        .modal { transition: opacity 0.3s ease; }
        body.modal-active { overflow: hidden; }
        .knowledge-list li::marker { color: var(--theme-color); font-weight: bold; }
        @media print { body * { visibility: hidden; } #certificate-modal, #certificate-modal * { visibility: visible; } #certificate-modal { position: absolute; left: 0; top: 0; width: 100%; height: 100%; background: white; } .no-print { display: none; } }
    </style></head><body id="top" class="text-slate-700 antialiased selection:bg-blue-100 selection:text-blue-900">
    <div class="soft-glow-background"></div>

    <header class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-slate-200 h-20">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 h-full">
            <div class="flex items-center justify-between h-full gap-8">
                <a href="https://kiotvietlnd.github.io/elearning" class="flex-shrink-0 flex items-center gap-3 hover:opacity-80">
                    <img src="https://logo.kiotviet.vn/KiotViet-Logo-Horizontal.svg" alt="KiotViet Logo" class="h-8">
                    <span class="text-slate-300 font-light text-2xl">|</span>
                    <span class="font-bold text-blue-600 tracking-tight text-lg uppercase">E-Learning</span>
                </a>
                <nav class="hidden lg:flex flex-1 justify-end items-center gap-8">
                    <a href="https://kiotvietlnd.github.io/elearning/retail" class="nav-link text-sm font-bold text-blue-600 active uppercase py-1">Retail</a>
                    <a href="https://kiotvietlnd.github.io/elearning/fnb" class="nav-link text-sm font-bold text-slate-600 hover:text-orange-600 uppercase py-1">FNB</a>
                    <a href="https://kiotvietlnd.github.io/elearning/salon" class="nav-link text-sm font-bold text-slate-600 hover:text-pink-600 uppercase py-1">Salon</a>
                    <a href="https://kiotvietlnd.github.io/elearning/hotel" class="nav-link text-sm font-bold text-slate-600 hover:text-green-600 uppercase py-1">Hotel</a>
                    <div class="h-6 w-px bg-slate-300"></div>
                    <a href="https://kiotvietlnd.github.io/elearning/retail" class="flex items-center gap-2 px-4 py-2 bg-slate-100 text-slate-600 rounded-full font-bold text-sm border border-slate-200 hover:bg-slate-200 hover:text-blue-700 transition-all">
                        <i class="fa-solid fa-arrow-left"></i> Quay lại Danh mục
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-10 min-h-[80vh]">
        <!-- VIEW MENU -->
        <div id="view-menu" class="animate__animated animate__fadeIn">
            <div class="text-center mb-12">
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-100 mb-4">
                    <i class="fa-solid fa-boxes-stacked text-xs"></i><span class="text-xs font-bold uppercase tracking-wider">Khóa học Retail</span>
                </div>
                <h1 class="text-3xl md:text-5xl font-black text-slate-800 tracking-tight mb-4">VAT Nhập hàng</h1>
                <div class="max-w-md mx-auto bg-white rounded-full h-4 shadow-inner border border-slate-200 overflow-hidden relative">
                    <div id="course-progress" class="bg-gradient-to-r from-blue-500 to-blue-400 h-full w-0 transition-all duration-1000"></div>
                </div>
                <p class="text-xs text-slate-400 mt-2 font-bold uppercase">Tiến độ: <span id="progress-text" class="text-blue-600">0%</span></p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="lesson-grid"></div>
            <div onclick="loadLessonFromMenu(-1)" class="mt-8 bg-gradient-to-r from-indigo-600 to-purple-600 p-1 rounded-2xl cursor-pointer group hover:scale-[1.01] transition-transform shadow-xl">
                <div class="bg-white/10 backdrop-blur-md p-6 rounded-xl flex items-center justify-between h-full">
                    <div class="flex items-center gap-5 text-white">
                        <div class="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center text-3xl"><i class="fa-solid fa-graduation-cap"></i></div>
                        <div><h3 class="font-bold text-xl mb-1">Bài kiểm tra Tổng hợp</h3><p class="text-indigo-100 text-sm opacity-90">Hoàn thành để nhận chứng chỉ.</p></div>
                    </div>
                    <div class="w-10 h-10 rounded-full bg-white text-indigo-600 flex items-center justify-center shadow-lg"><i class="fa-solid fa-arrow-right"></i></div>
                </div>
            </div>
        </div>

        <!-- VIEW LEARNING -->
        <div id="view-learning" class="hidden animate__animated animate__fadeInRight">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                <button onclick="goBack()" class="group flex items-center gap-2 text-slate-500 hover:text-blue-600 font-bold text-sm bg-white px-4 py-2 rounded-lg border border-slate-200 shadow-sm hover:shadow transition-all">
                    <i class="fa-solid fa-arrow-left group-hover:-translate-x-1 transition-transform"></i> Danh sách mục
                </button>
                <div class="flex items-center gap-3 bg-white px-4 py-2 rounded-lg border border-slate-200 shadow-sm">
                    <i class="fa-solid fa-list-check text-blue-500"></i>
                    <select id="lesson-selector" onchange="switchLessonFromDropdown(this.value)" class="bg-transparent text-sm font-bold text-slate-700 focus:outline-none cursor-pointer w-56"></select>
                </div>
            </div>
            
            <div class="bg-white p-8 rounded-2xl shadow-sm border border-slate-200 mb-8 relative overflow-hidden">
                <div class="absolute right-0 top-0 w-64 h-64 bg-gradient-to-br from-blue-50 to-transparent rounded-full -mr-16 -mt-16 opacity-70 pointer-events-none"></div>
                <div class="relative z-10 flex items-center gap-6">
                    <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 text-white flex items-center justify-center shrink-0 shadow-lg">
                        <i id="lesson-icon" class="fa-solid fa-book-open text-2xl"></i>
                    </div>
                    <div>
                        <div class="flex items-center gap-2 mb-1"><span class="text-[10px] font-bold text-white bg-blue-500 px-2 py-0.5 rounded uppercase tracking-wider">Đang học</span></div>
                        <div id="lesson-title-container"></div>
                        <p id="lesson-desc" class="text-slate-500 mt-2 font-medium"></p>
                    </div>
                </div>
            </div>

            <div class="mb-8 bg-white rounded-xl shadow-sm border border-slate-100 p-1 inline-flex w-full md:w-auto overflow-x-auto">
                <button onclick="switchTab('knowledge')" id="btn-tab-knowledge" class="tab-btn flex-1 md:flex-none px-6 py-3 text-sm font-bold text-slate-500 hover:text-blue-600 active transition-all whitespace-nowrap"><i class="fa-regular fa-lightbulb"></i> Kiến thức</button>
                <div class="w-px bg-slate-200 my-2"></div>
                <button onclick="switchTab('dialogue')" id="btn-tab-dialogue" class="tab-btn flex-1 md:flex-none px-6 py-3 text-sm font-bold text-slate-500 hover:text-blue-600 transition-all whitespace-nowrap"><i class="fa-regular fa-comments"></i> Hội thoại</button>
                <div class="w-px bg-slate-200 my-2"></div>
                <button onclick="switchTab('vocab')" id="btn-tab-vocab" class="tab-btn flex-1 md:flex-none px-6 py-3 text-sm font-bold text-slate-500 hover:text-blue-600 transition-all whitespace-nowrap"><i class="fa-solid fa-bolt"></i> Flashcard</button>
                <div class="w-px bg-slate-200 my-2"></div>
                <button onclick="switchTab('quiz')" id="btn-tab-quiz" class="tab-btn flex-1 md:flex-none px-6 py-3 text-sm font-bold text-slate-500 hover:text-blue-600 transition-all whitespace-nowrap"><i class="fa-solid fa-clipboard-question"></i> Luyện tập</button>
            </div>

            <div class="min-h-[400px]">
                <div id="content-knowledge" class="space-y-4 max-w-4xl mx-auto pb-10 hidden"></div>
                <div id="content-dialogue" class="space-y-6 max-w-3xl mx-auto pb-10 hidden"></div>
                <div id="content-vocab" class="grid grid-cols-1 md:grid-cols-2 gap-6 pb-10 hidden"></div>
                <div id="content-quiz" class="max-w-2xl mx-auto pb-10 hidden">
                     <div id="quiz-stats" class="bg-indigo-50 rounded-2xl p-5 flex justify-between items-center mb-6 border border-indigo-100">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-white text-indigo-600 flex items-center justify-center font-bold text-xl shadow-sm"><i class="fa-solid fa-trophy"></i></div>
                            <div><p class="text-xs text-indigo-500 font-bold uppercase">Kết quả</p><p class="text-xl font-black text-slate-800"><span id="quiz-score">0</span>/<span id="quiz-total">0</span></p></div>
                        </div>
                        <button onclick="resetQuiz()" class="text-xs font-bold text-slate-600 bg-white px-4 py-2 rounded-xl border border-slate-200 hover:bg-slate-50 shadow-sm"><i class="fa-solid fa-rotate-right"></i> Làm lại</button>
                    </div>
                    <div id="quiz-list" class="space-y-6"></div>
                </div>
            </div>
            <div id="lesson-navigation" class="mt-8 pt-6 border-t border-slate-200 flex justify-between items-center"></div>
        </div>
    </main>

    <footer class="bg-white/80 backdrop-blur-md border-t border-slate-200 mt-10 py-8 text-center relative z-10">
        <p class="text-slate-500 font-medium text-sm">Learning and Development Department</p>
        <p class="text-slate-400 text-xs mt-2">© 2026 KiotViet. All rights reserved.</p>
    </footer>

    <div class="fixed bottom-6 right-6 z-50 flex flex-col items-center space-y-3">
        <a href="https://notebooklm.google.com/notebook/a4480a38-2d6e-4974-9880-c45e534f5fa5" target="_blank" title="Hỏi Chatbot AI" class="float-btn w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 text-white rounded-full flex items-center justify-center shadow-lg border-2 border-white"><i class="fa-solid fa-robot"></i></a>
        <a href="https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-giao-dich/vat-nhap-hang/#4-xem-bao-cao-vat-nhap-hang-4-2" target="_blank" title="Xem Tài liệu" class="float-btn w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center shadow-lg border-2 border-white"><i class="fa-solid fa-book-open"></i></a>
        <a href="https://www.youtube.com/playlist?list=PL3x3GXJzpHzSXXO4aVoriCCGga4hTWsMY" target="_blank" title="Xem Video" class="float-btn w-12 h-12 bg-red-600 text-white rounded-full flex items-center justify-center shadow-lg border-2 border-white"><i class="fa-brands fa-youtube"></i></a>
    </div>

    <!-- CERTIFICATE MODAL -->
    <div id="certificate-modal" class="modal opacity-0 pointer-events-none fixed inset-0 z-[100] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/90 backdrop-blur-sm" onclick="toggleModal('certificate-modal')"></div>
        <div class="bg-white w-full max-w-3xl rounded-xl shadow-2xl relative z-10 transform scale-95 transition-all duration-300" id="cert-content">
            <div class="p-2">
                <div class="border-8 border-double border-blue-800 p-8 text-center bg-white relative overflow-hidden">
                    <img src="https://logo.kiotviet.vn/KiotViet-Logo-Horizontal.svg" alt="Logo" class="h-10 mx-auto mb-6">
                    <h2 class="text-4xl font-black text-blue-900 mb-2 uppercase tracking-widest">Giấy Chứng Nhận</h2>
                    <div class="w-24 h-1 bg-gradient-to-r from-blue-600 to-indigo-600 mx-auto mb-8"></div>
                    <p class="text-slate-500 italic mb-2 font-medium">Chứng nhận nhân viên:</p>
                    <div class="text-3xl font-black text-blue-600 mb-6 uppercase tracking-wider font-sans">Học Viên KiotViet</div>
                    <p class="text-slate-600 mb-2 font-medium">Đã hoàn thành xuất sắc khóa đào tạo:</p>
                    <h3 class="text-2xl font-bold text-slate-800 mb-10 uppercase border-2 border-slate-800 inline-block px-6 py-2">VAT Nhập hàng</h3>
                    <div class="flex justify-between items-end mt-12 px-10">
                        <div class="text-center"><p class="text-xs text-slate-400 font-bold uppercase mb-1">Ngày cấp</p><p class="text-lg font-bold text-slate-700" id="cert-date">30/12/2025</p></div>
                        <div class="text-center"><p class="text-sm font-bold text-blue-900 mt-10">KiotViet Training Dept.</p></div>
                    </div>
                </div>
            </div>
            <div class="bg-slate-50 p-4 flex justify-end gap-3 rounded-b-xl no-print">
                <button onclick="toggleModal('certificate-modal')" class="px-5 py-2.5 text-slate-600 font-bold rounded-lg hover:bg-slate-200">Đóng</button>
                <button onclick="window.print()" class="px-5 py-2.5 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 flex items-center gap-2"><i class="fa-solid fa-print"></i> In chứng chỉ</button>
            </div>
        </div>
    </div>

    <script>
        const courseData = [
            {
                title: "Giới thiệu chung",
                desc: "Hiểu về lợi ích và ý nghĩa của việc quản lý VAT nhập hàng đối với doanh nghiệp.",
                icon: "fa-solid fa-star",
                knowledge: [
                    {
                        header: "Lợi ích nổi bật của tính năng VAT Nhập hàng",
                        content: [
                            "Tuân thủ quy định & tính toán chính xác: Áp dụng thuế GTGT chính xác cho các giao dịch.",
                            "Quản lý công nợ minh bạch: Tách bạch rõ ràng giữa tiền hàng và tiền thuế VAT.",
                            "Hạch toán giá vốn hiệu quả: VAT nhập hàng KHÔNG tính vào giá vốn sản phẩm, giúp tính đúng lợi nhuận gộp."
                        ]
                    }
                ],
                dialogue: [
                    { speaker: "Minh (Chủ cửa hàng)", target: "Chào Lan, bên mình mới chuyển lên mô hình doanh nghiệp nên cần quản lý thuế VAT đầu vào khi nhập hàng thật kỹ để đối soát kế toán. KiotViet hỗ trợ việc này như thế nào?" },
                    { speaker: "Lan (Chuyên viên KiotViet)", target: "Chào anh Minh, tính năng VAT Nhập hàng sẽ giúp anh tự động tách riêng tiền thuế và tiền hàng. Quan trọng nhất là khoản thuế này sẽ **không bị cộng vào giá vốn**, giúp anh theo dõi lợi nhuận chính xác tuyệt đối ạ!" }
                ],
                vocab: [
                    { q: "VAT nhập hàng __________ vào giá vốn sản phẩm.", full: "VAT nhập hàng **KHÔNG TÍNH** vào giá vốn sản phẩm." },
                    { q: "Quản lý VAT giúp tách bạch rõ ràng giữa tiền hàng và __________.", full: "Quản lý VAT giúp tách bạch rõ ràng giữa tiền hàng và **TIỀN THUẾ**." },
                    { q: "VAT nhập hàng giúp ghi nhận chính xác __________ phải trả nhà cung cấp.", full: "VAT nhập hàng giúp ghi nhận chính xác **TỔNG CÔNG NỢ** phải trả nhà cung cấp." }
                ],
                quiz: [
                    { q: "VAT nhập hàng có được tính vào giá vốn hàng hóa trên KiotViet không?", opts: ["Có, tính vào giá vốn để tăng chi phí.", "Không, để đảm bảo tính toán chính xác lợi nhuận gộp.", "Chỉ tính khi nhà cung cấp yêu cầu."], a: 1 },
                    { q: "Việc quản lý VAT nhập hàng mang lại lợi ích gì cho công nợ?", opts: ["Giúp giảm số tiền phải trả nhà cung cấp.", "Giúp nhà cung cấp không tính thuế nữa.", "Giúp đối soát công nợ minh bạch giữa tiền hàng và tiền thuế."], a: 2 }
                ]
            },
            {
                title: "Các thao tác cơ bản",
                desc: "Hướng dẫn thiết lập thuế và áp dụng vào các phiếu nhập hàng, trả hàng.",
                icon: "fa-solid fa-gears",
                knowledge: [
                    {
                        header: "Quy trình thiết lập và áp dụng",
                        content: [
                            "Thiết lập hệ thống: Bật 'Sử dụng thuế VAT' trong Thiết lập -> Thuế, chọn phương pháp 'Thuế khấu trừ'.",
                            "Thiết lập hàng hóa: Cấu hình mức thuế suất cho từng sản phẩm hoặc thay đổi hàng loạt qua menu 'Thao tác'.",
                            "Áp dụng giao dịch: Bật tùy chọn 'VAT nhập hàng' trên phiếu Nhập hàng để hệ thống tự động tính thuế.",
                            "Xử lý hoàn lại: Bật 'VAT hoàn lại' khi Trả hàng nhập để giảm trừ công nợ thuế tương ứng."
                        ]
                    }
                ],
                dialogue: [
                    { speaker: "Tâm (Kế toán)", target: "Lan ơi, khi mình trả hàng cho nhà cung cấp thì tiền thuế đã nộp trước đó xử lý sao trên phần mềm?" },
                    { speaker: "Lan (Chuyên viên KiotViet)", target: "Chị Tâm yên tâm nhé, khi tạo phiếu Trả hàng nhập, chị chỉ cần bật nút **VAT hoàn lại**. Hệ thống sẽ tự tính toán và trừ số tiền thuế đó vào công nợ chị còn nợ nhà cung cấp một cách tự động ạ!" }
                ],
                vocab: [
                    { q: "Để dùng VAT nhập hàng, bạn cần chọn phương pháp __________.", full: "Để dùng VAT nhập hàng, bạn cần chọn phương pháp **THUẾ KHẤU TRỪ**." },
                    { q: "Để cập nhật thuế suất cho nhiều hàng hóa, ta dùng menu _________.", full: "Để cập nhật thuế suất cho nhiều hàng hóa, ta dùng menu **THAO TÁC**." },
                    { q: "Khi trả hàng, cần bật tùy chọn __________ để ghi nhận giảm công nợ thuế.", full: "Khi trả hàng, cần bật tùy chọn **VAT HOÀN LẠI** để ghi nhận giảm công nợ thuế." },
                    { q: "Xem báo cáo thuế tại mục Phân tích -> __________.", full: "Xem báo cáo thuế tại mục Phân tích -> **NHÀ CUNG CẤP**." }
                ],
                quiz: [
                    { q: "Phương pháp thuế nào sau đây bắt buộc phải chọn để sử dụng tính năng VAT nhập hàng?", opts: ["Thuế trực tiếp.", "Thuế khấu trừ.", "Thuế ưu đãi."], a: 1 },
                    { q: "Khi tạo phiếu nhập hàng, làm sao để hệ thống tính tiền thuế VAT?", opts: ["Hệ thống tự cộng vào giá nhập.", "Phải tự tính tay rồi điền vào ghi chú.", "Bật tùy chọn 'VAT nhập hàng' tại khu vực thanh toán."], a: 2 },
                    { q: "Báo cáo VAT nhập hàng hiển thị những loại giao dịch nào?", opts: ["Chỉ hiển thị phiếu Nhập hàng.", "Chỉ hiển thị phiếu Trả hàng nhập.", "Cả phiếu Nhập hàng và Trả hàng nhập có ghi nhận VAT."], a: 2 }
                ]
            }
        ];

        let currentLessonId = 0;
        let completedLessons = new Set();
        let quizState = { correct: 0, total: 0 };
        let currentActiveTab = 'knowledge';

        function init() {
            renderMenu();
            updateProgress();
            window.onscroll = function() {
                // Scroll top button logic can go here
            };
        }

        function renderMenu() {
            const grid = document.getElementById('lesson-grid');
            grid.innerHTML = courseData.map((lesson, idx) => `
                <div onclick="loadLessonFromMenu(${idx})" class="glass-card bg-white rounded-xl p-5 cursor-pointer group hover:border-blue-400 relative overflow-hidden transition-all duration-300">
                    <div class="flex items-start gap-4 relative z-10">
                        <div class="w-12 h-12 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center text-xl shadow-sm border border-blue-100 group-hover:bg-blue-600 group-hover:text-white transition-colors duration-300"><i class="${lesson.icon}"></i></div>
                        <div><h3 class="font-bold text-lg text-slate-800 group-hover:text-blue-600 transition-colors">${lesson.title}</h3><p class="text-sm text-slate-500 mt-1 line-clamp-2">${lesson.desc}</p></div>
                    </div>
                    <div class="mt-4 pt-3 border-t border-slate-100 flex items-center justify-between">
                        <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest group-hover:text-blue-500">Mục ${idx + 1}</span>
                        ${completedLessons.has(idx) ? '<i class="fa-solid fa-circle-check text-green-500 text-xl animate__animated animate__rubberBand"></i>' : '<i class="fa-regular fa-circle-play text-slate-300 text-xl group-hover:text-blue-500 transition-colors"></i>'}
                    </div>
                </div>
            `).join('');
        }

        function loadLessonFromMenu(id) {
            if(id === -1) loadComprehensiveLesson(); else loadLesson(id);
        }

        function loadLesson(id) {
            currentLessonId = id;
            const lesson = courseData[id];
            const mainTopic = '<span class="block text-sm text-blue-500 font-bold uppercase tracking-wider mb-1">VAT Nhập hàng</span>';
            document.getElementById('lesson-title-container').innerHTML = `${mainTopic}<h2 class="text-2xl md:text-3xl font-black text-slate-800">${lesson.title}</h2>`;
            document.getElementById('lesson-desc').innerText = lesson.desc;
            document.getElementById('lesson-icon').className = `${lesson.icon} text-2xl`;
            
            renderKnowledge(lesson.knowledge);
            renderDialogue(lesson.dialogue);
            renderVocab(lesson.vocab);
            renderQuiz(lesson.quiz);
            
            updateDropdown();
            renderNavigation();
            document.getElementById('view-menu').classList.add('hidden');
            document.getElementById('view-learning').classList.remove('hidden');
            switchTab('knowledge');
            window.scrollTo(0, 0);
        }

        function renderKnowledge(data) {
            const container = document.getElementById('content-knowledge');
            container.innerHTML = data.map((item, idx) => `
                <div class="bg-white rounded-xl p-6 shadow-sm border border-slate-100 animate__animated animate__fadeInUp" style="animation-delay: ${idx * 100}ms">
                    <h3 class="font-bold text-slate-800 text-lg mb-3 pb-2 border-b border-slate-100">${item.header}</h3>
                    <ul class="space-y-3 knowledge-list">
                        ${item.content.map(point => `<li class="flex gap-3 text-sm text-slate-600 leading-relaxed items-start"><i class="fa-solid fa-check text-blue-500 mt-1 shrink-0"></i> <span>${point}</span></li>`).join('')}
                    </ul>
                </div>
            `).join('');
        }

        function renderDialogue(dialogue) {
            const container = document.getElementById('content-dialogue');
            container.innerHTML = dialogue.map((line, idx) => {
                const isKiot = line.speaker.includes('KiotViet');
                const formattedText = line.target.replace(/\*\*(.*?)\*\*/g, '<b class="text-blue-700 font-bold">$1</b>');
                return `
                <div class="flex ${isKiot ? 'flex-row' : 'flex-row-reverse'} gap-4 items-end animate__animated animate__fadeInUp">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center shrink-0 shadow-md ${isKiot ? 'bg-blue-600 text-white' : 'bg-white border border-slate-200 text-slate-600'}"><i class="fa-solid ${isKiot ? 'fa-user-tie' : 'fa-store'}"></i></div>
                    <div class="flex flex-col ${isKiot ? 'items-start' : 'items-end'} max-w-[80%]">
                        <span class="text-[10px] font-bold text-slate-400 mb-1 uppercase tracking-wide">${line.speaker}</span>
                        <div class="p-4 rounded-2xl shadow-sm text-sm font-medium leading-relaxed border ${isKiot ? 'bg-blue-50 border-blue-100 rounded-bl-none text-slate-700' : 'bg-white border-slate-200 rounded-br-none text-slate-600'}">${formattedText}</div>
                    </div>
                </div>`;
            }).join('');
        }

        function renderVocab(vocab) {
            const container = document.getElementById('content-vocab');
            container.innerHTML = vocab.map((v, i) => {
                const formattedFull = v.full.replace(/\*\*(.*?)\*\*/g, '<span class="text-yellow-300 font-black border-b border-yellow-300">$1</span>');
                return `
                <div class="flip-card h-56 perspective-1000 group animate__animated animate__fadeIn" onclick="this.classList.toggle('flipped')">
                    <div class="flip-card-inner shadow-sm rounded-xl">
                        <div class="flip-card-front bg-white border border-slate-200 hover:border-blue-300 transition-colors">
                            <h3 class="text-base font-bold text-slate-800 px-4 leading-snug">${v.q}</h3>
                        </div>
                        <div class="flip-card-back bg-gradient-to-br from-blue-600 to-indigo-700 text-white">
                            <p class="font-medium text-sm px-4 leading-relaxed">${formattedFull}</p>
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        function renderQuiz(quiz) {
            const list = document.getElementById('quiz-list');
            quizState = { correct: 0, total: quiz.length };
            updateQuizStats();
            list.innerHTML = quiz.map((q, idx) => `
                <div class="bg-white rounded-xl p-6 shadow-sm border border-slate-100 quiz-card transition-all" id="quiz-${idx}">
                    <div class="flex gap-4 mb-4"><span class="shrink-0 w-8 h-8 bg-blue-100 text-blue-700 rounded-lg flex items-center justify-center text-xs font-bold">Q${idx + 1}</span><h3 class="font-bold text-slate-800 text-base leading-snug">${q.q}</h3></div>
                    <div class="space-y-3 pl-12">
                        ${q.opts.map((opt, oid) => `
                            <button onclick="checkAnswer(${idx}, ${oid}, ${q.a})" class="w-full text-left p-3 rounded-lg border border-slate-200 hover:bg-blue-50 hover:border-blue-300 transition-all text-sm font-medium text-slate-600 quiz-opt flex items-center group">
                                <span class="w-6 h-6 rounded-md border border-slate-300 flex items-center justify-center text-[10px] text-slate-500 font-bold mr-3 group-hover:border-blue-400 transition-colors">${String.fromCharCode(65+oid)}</span><span class="flex-1">${opt}</span>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function checkAnswer(qIdx, selected, correct) {
            const card = document.getElementById(`quiz-${qIdx}`);
            if(card.hasAttribute('data-answered')) return;
            card.setAttribute('data-answered', 'true');
            const opts = card.querySelectorAll('.quiz-opt');
            opts.forEach((btn, idx) => {
                btn.disabled = true;
                if (idx === correct) btn.classList.add('bg-green-50', 'border-green-500', 'text-green-800');
                else if (idx === selected) btn.classList.add('bg-red-50', 'border-red-500', 'text-red-800');
            });
            if (selected === correct) { quizState.correct++; confetti({ particleCount: 30, spread: 50, origin: { y: 0.8 } }); } 
            updateQuizStats();
            if(document.querySelectorAll('.quiz-card[data-answered]').length === quizState.total) {
                if(quizState.correct === quizState.total && currentLessonId !== -1) { completedLessons.add(currentLessonId); updateProgress(); }
                if(currentLessonId === -1 && quizState.correct === quizState.total) { triggerMegaConfetti(); toggleModal('certificate-modal'); }
            }
        }

        function updateQuizStats() { document.getElementById('quiz-score').innerText = quizState.correct; document.getElementById('quiz-total').innerText = quizState.total; }
        function resetQuiz() { if(currentLessonId === -1) loadComprehensiveLesson(); else renderQuiz(courseData[currentLessonId].quiz); }

        function loadComprehensiveLesson() {
            currentLessonId = -1;
            const allQuizzes = courseData.flatMap(c => c.quiz);
            document.getElementById('lesson-title-container').innerHTML = `<h2 class="text-2xl md:text-3xl font-black text-slate-800">Bài kiểm tra Tổng hợp</h2>`;
            document.getElementById('lesson-desc').innerText = "Trả lời đúng 100% câu hỏi để nhận Chứng chỉ.";
            document.getElementById('lesson-icon').className = "fa-solid fa-graduation-cap text-2xl";
            
            document.getElementById('content-knowledge').innerHTML = "<div class='p-10 text-center bg-white rounded-xl border border-slate-100'>Chào mừng bạn đến với bài thi cuối khóa. Hãy chuyển sang Tab <b>Luyện tập</b> để bắt đầu.</div>";
            document.getElementById('content-dialogue').innerHTML = "";
            document.getElementById('content-vocab').innerHTML = "";
            renderQuiz(allQuizzes);
            
            document.getElementById('view-menu').classList.add('hidden');
            document.getElementById('view-learning').classList.remove('hidden');
            document.getElementById('lesson-navigation').innerHTML = `<button onclick="goBack()" class="text-slate-400 font-bold text-sm hover:text-slate-600">Quay về danh sách</button>`;
            
            updateDropdown();
            switchTab('quiz');
        }

        function switchTab(tab) {
            ['knowledge', 'dialogue', 'vocab', 'quiz'].forEach(t => { 
                document.getElementById(`content-${t}`).classList.add('hidden'); 
                document.getElementById(`btn-tab-${t}`).classList.remove('active', 'text-blue-600'); 
            });
            document.getElementById(`content-${tab}`).classList.remove('hidden');
            document.getElementById(`btn-tab-${tab}`).classList.add('active', 'text-blue-600');
        }

        function goBack() { 
            document.getElementById('view-learning').classList.add('hidden'); 
            document.getElementById('view-menu').classList.remove('hidden'); 
            updateProgress(); renderMenu(); 
        }
        function updateProgress() { const pct = Math.round((completedLessons.size / courseData.length) * 100); document.getElementById('course-progress').style.width = pct + '%'; document.getElementById('progress-text').innerText = pct + '%'; }
        function updateDropdown() { 
            const select = document.getElementById('lesson-selector'); 
            let html = courseData.map((l, i) => `<option value="${i}" ${i === currentLessonId ? 'selected' : ''}>${i+1}. ${l.title}</option>`).join(''); 
            html += `<option value="-1" ${currentLessonId === -1 ? 'selected' : ''}>Bài kiểm tra Tổng hợp</option>`;
            select.innerHTML = html;
        }
        function switchLessonFromDropdown(val) { const id = parseInt(val); if(id === -1) loadComprehensiveLesson(); else loadLesson(id); }

        function renderNavigation() {
            const container = document.getElementById('lesson-navigation');
            const next = currentLessonId < courseData.length - 1 ? currentLessonId + 1 : null;
            container.innerHTML = next !== null 
                ? `<button onclick="loadLesson(${next})" class="text-blue-600 font-bold text-sm ml-auto flex items-center gap-2">Mục tiếp theo <i class="fa-solid fa-arrow-right"></i></button>`
                : `<button onclick="loadComprehensiveLesson()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-sm ml-auto">Thi chứng chỉ <i class="fa-solid fa-graduation-cap"></i></button>`;
        }

        function toggleModal(id) {
            const m = document.getElementById(id);
            m.classList.toggle('opacity-0');
            m.classList.toggle('pointer-events-none');
            document.body.classList.toggle('modal-active');
        }

        function triggerMegaConfetti() {
            var duration = 3 * 1000; var animationEnd = Date.now() + duration;
            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) return clearInterval(interval);
                confetti({ particleCount: 40, origin: { x: Math.random(), y: Math.random() - 0.2 } });
            }, 250);
        }

        window.onload = init;
    </script></body></html>
