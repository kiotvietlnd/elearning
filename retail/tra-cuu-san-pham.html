<!DOCTYPE html><html lang="vi" class="scroll-smooth"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khóa học: Tra cứu sản phẩm | KiotViet Retail</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #334155; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .soft-glow-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -10; background: linear-gradient(to bottom right, #f8fafc, #e0f2fe); }
        .nav-link { position: relative; transition: color 0.3s; }
        .nav-link.active { color: var(--theme-color); }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.8); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); transition: all 0.3s ease; }
        .glass-card:hover { transform: translateY(-4px); box-shadow: 0 15px 30px -5px rgba(0,0,0,0.1); }
        .perspective-1000 { perspective: 1000px; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; cursor: pointer; }
        .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
        .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 1rem; }
        .flip-card-back { transform: rotateY(180deg); }
        .float-btn { transition: transform 0.2s; }
        .float-btn:hover { transform: scale(1.1); }
        .tab-btn { position: relative; transition: all 0.3s ease; }
        .tab-btn::after { content: ''; position: absolute; bottom: -2px; left: 0; width: 0; height: 2px; background-color: currentColor; transition: width 0.3s ease; }
        .tab-btn.active::after { width: 100%; }
        .modal { transition: opacity 0.3s ease; }
        body.modal-active { overflow: hidden; }
        .knowledge-list li::marker { color: var(--theme-color); font-weight: bold; }
        @media print { body * { visibility: hidden; } #certificate-modal, #certificate-modal * { visibility: visible; } #certificate-modal { position: absolute; left: 0; top: 0; width: 100%; height: 100%; background: white; } .no-print { display: none; } }
    </style></head><body id="top" class="text-slate-700 antialiased selection:bg-blue-100 selection:text-blue-900">
    <div class="soft-glow-background"></div>

    <header class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-slate-200 h-20">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 h-full">
            <div class="flex items-center justify-between h-full gap-8">
                <a href="https://kiotvietlnd.github.io/elearning" class="flex-shrink-0 flex items-center gap-3 hover:opacity-80">
                    <img src="https://logo.kiotviet.vn/KiotViet-Logo-Horizontal.svg" alt="KiotViet Logo" class="h-8">
                    <span class="text-slate-300 font-light text-2xl">|</span>
                    <span class="font-bold text-blue-600 tracking-tight text-lg uppercase">E-Learning</span>
                </a>
                <nav class="hidden lg:flex flex-1 justify-end items-center gap-8">
                    <a href="https://kiotvietlnd.github.io/elearning/retail" class="nav-link text-sm font-bold text-slate-600 hover:text-blue-600 uppercase py-1">Retail</a>
                    <a href="https://kiotvietlnd.github.io/elearning/fnb" class="nav-link text-sm font-bold text-slate-600 hover:text-orange-600 uppercase py-1">FNB</a>
                    <a href="https://kiotvietlnd.github.io/elearning/salon" class="nav-link text-sm font-bold text-slate-600 hover:text-pink-600 uppercase py-1">Salon</a>
                    <a href="https://kiotvietlnd.github.io/elearning/hotel" class="nav-link text-sm font-bold text-slate-600 hover:text-green-600 uppercase py-1">Hotel</a>
                    <div class="h-6 w-px bg-slate-300"></div>
                    <a href="https://kiotvietlnd.github.io/elearning/retail" class="flex items-center gap-2 px-4 py-2 bg-slate-100 text-slate-600 rounded-full font-bold text-sm border border-slate-200 hover:bg-slate-200 hover:text-blue-700 transition-all">
                        <i class="fa-solid fa-arrow-left"></i> Quay lại Danh mục
                    </a>
                </nav>
                <div class="lg:hidden">
                    <button onclick="document.getElementById('mobile-menu').classList.toggle('hidden')" class="text-slate-600 text-2xl p-2"><i class="fa-solid fa-bars"></i></button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden lg:hidden bg-white border-b border-slate-200 shadow-lg absolute w-full left-0 top-20 z-50">
            <div class="px-4 pt-2 pb-4 space-y-2">
                <a href="https://kiotvietlnd.github.io/elearning/retail" class="block px-3 py-2 rounded-md text-base font-bold text-blue-600 bg-blue-50">Retail</a>
                <a href="https://kiotvietlnd.github.io/elearning/fnb" class="block px-3 py-2 rounded-md text-base font-medium text-slate-600 hover:text-orange-600 hover:bg-orange-50">FNB</a>
                <a href="https://kiotvietlnd.github.io/elearning/salon" class="block px-3 py-2 rounded-md text-base font-medium text-slate-600 hover:text-pink-600 hover:bg-pink-50">Salon</a>
                <a href="https://kiotvietlnd.github.io/elearning/hotel" class="block px-3 py-2 rounded-md text-base font-medium text-slate-600 hover:text-green-600 hover:bg-green-50">Hotel</a>
                <div class="border-t border-slate-200 my-2 pt-2">
                    <a href="https://kiotvietlnd.github.io/elearning/retail" class="flex items-center gap-2 px-3 py-2 text-base font-bold text-slate-600 hover:text-blue-600">
                        <i class="fa-solid fa-arrow-left"></i> Quay lại Danh mục
                    </a>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-10 min-h-[80vh]">
        <div id="view-menu" class="animate__animated animate__fadeIn">
            <div class="text-center mb-12">
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-100 mb-4">
                    <i class="fa-solid fa-boxes-stacked text-xs"></i><span class="text-xs font-bold uppercase tracking-wider">Khóa học Retail</span>
                </div>
                <h1 class="text-3xl md:text-5xl font-black text-slate-800 tracking-tight mb-4">Tra cứu sản phẩm</h1>
                <div class="max-w-md mx-auto bg-white rounded-full h-4 shadow-inner border border-slate-200 overflow-hidden relative">
                    <div id="course-progress" class="bg-gradient-to-r from-blue-500 to-blue-400 h-full w-0 transition-all duration-1000"></div>
                </div>
                <p class="text-xs text-slate-400 mt-2 font-bold uppercase">Tiến độ: <span id="progress-text" class="text-blue-600">0%</span></p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="lesson-grid"></div>
            <div onclick="loadLessonFromMenu(-1)" class="mt-8 bg-gradient-to-r from-indigo-600 to-purple-600 p-1 rounded-2xl cursor-pointer group hover:scale-[1.01] transition-transform shadow-xl">
                <div class="bg-white/10 backdrop-blur-md p-6 rounded-xl flex items-center justify-between h-full">
                    <div class="flex items-center gap-5 text-white">
                        <div class="w-14 h-14 rounded-2xl bg-white/20 flex items-center justify-center text-3xl"><i class="fa-solid fa-graduation-cap"></i></div>
                        <div><h3 class="font-bold text-xl mb-1">Bài kiểm tra Tổng hợp</h3><p class="text-indigo-100 text-sm opacity-90">Hoàn thành để nhận chứng chỉ.</p></div>
                    </div>
                    <div class="w-10 h-10 rounded-full bg-white text-indigo-600 flex items-center justify-center shadow-lg"><i class="fa-solid fa-arrow-right"></i></div>
                </div>
            </div>
        </div>

        <div id="view-learning" class="hidden animate__animated animate__fadeInRight">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                <button onclick="goBack()" class="group flex items-center gap-2 text-slate-500 hover:text-blue-600 font-bold text-sm bg-white px-4 py-2 rounded-lg border border-slate-200 shadow-sm hover:shadow transition-all">
                    <i class="fa-solid fa-arrow-left group-hover:-translate-x-1 transition-transform"></i> Danh sách mục
                </button>
                <div class="flex items-center gap-3 bg-white px-4 py-2 rounded-lg border border-slate-200 shadow-sm">
                    <i class="fa-solid fa-list-check text-blue-500"></i>
                    <select id="lesson-selector" onchange="switchLessonFromDropdown(this.value)" class="bg-transparent text-sm font-bold text-slate-700 focus:outline-none cursor-pointer w-56"></select>
                </div>
            </div>
            <div class="bg-white p-8 rounded-2xl shadow-sm border border-slate-200 mb-8 relative overflow-hidden">
                <div class="absolute right-0 top-0 w-64 h-64 bg-gradient-to-br from-blue-50 to-transparent rounded-full -mr-16 -mt-16 opacity-70 pointer-events-none"></div>
                <div class="relative z-10 flex items-center gap-6">
                    <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 text-white flex items-center justify-center shrink-0 shadow-lg">
                        <i id="lesson-icon" class="fa-solid fa-book-open text-2xl"></i>
                    </div>
                    <div>
                        <div class="flex items-center gap-2 mb-1"><span class="text-[10px] font-bold text-white bg-blue-500 px-2 py-0.5 rounded uppercase tracking-wider">Đang học</span></div>
                        <div id="lesson-title-container"></div>
                        <p id="lesson-desc" class="text-slate-500 mt-2 font-medium"></p>
                    </div>
                </div>
            </div>
            <div class="mb-8 bg-white rounded-xl shadow-sm border border-slate-100 p-1 inline-flex w-full md:w-auto overflow-x-auto">
                <button onclick="switchTab('knowledge')" id="btn-tab-knowledge" class="tab-btn flex-1 md:flex-none px-6 py-3 text-sm font-bold text-slate-500 hover:text-blue-600 active:text-blue-600 transition-all whitespace-nowrap"><i class="fa-regular fa-lightbulb"></i> Kiến thức</button>
                <div class="w-px bg-slate-200 my-2"></div>
                <button onclick="switchTab('dialogue')" id="btn-tab-dialogue" class="tab-btn flex-1 md:flex-none px-6 py-3 text-sm font-bold text-slate-500 hover:text-blue-600 active:text-blue-600 transition-all whitespace-nowrap"><i class="fa-regular fa-comments"></i> Hội thoại</button>
                <div class="w-px bg-slate-200 my-2"></div>
                <button onclick="switchTab('vocab')" id="btn-tab-vocab" class="tab-btn flex-1 md:flex-none px-6 py-3 text-sm font-bold text-slate-500 hover:text-blue-600 active:text-blue-600 transition-all whitespace-nowrap"><i class="fa-solid fa-bolt"></i> Flashcard</button>
                <div class="w-px bg-slate-200 my-2"></div>
                <button onclick="switchTab('quiz')" id="btn-tab-quiz" class="tab-btn flex-1 md:flex-none px-6 py-3 text-sm font-bold text-slate-500 hover:text-blue-600 active:text-blue-600 transition-all whitespace-nowrap"><i class="fa-solid fa-clipboard-question"></i> Luyện tập</button>
            </div>
            <div class="min-h-[400px]">
                <div id="content-knowledge" class="space-y-4 max-w-4xl mx-auto pb-10 hidden"></div>
                <div id="content-dialogue" class="space-y-6 max-w-3xl mx-auto pb-10 hidden"></div>
                <div id="content-vocab" class="grid grid-cols-1 md:grid-cols-2 gap-6 pb-10 hidden"></div>
                <div id="content-quiz" class="max-w-2xl mx-auto pb-10 hidden">
                     <div id="quiz-stats" class="bg-indigo-50 rounded-2xl p-5 flex justify-between items-center mb-6 border border-indigo-100">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-white text-indigo-600 flex items-center justify-center font-bold text-xl shadow-sm"><i class="fa-solid fa-trophy"></i></div>
                            <div><p class="text-xs text-indigo-500 font-bold uppercase">Kết quả</p><p class="text-xl font-black text-slate-800"><span id="quiz-score">0</span>/<span id="quiz-total">0</span></p></div>
                        </div>
                        <button onclick="resetQuiz()" class="text-xs font-bold text-slate-600 bg-white px-4 py-2 rounded-xl border border-slate-200 hover:bg-slate-50 shadow-sm"><i class="fa-solid fa-rotate-right"></i> Làm lại</button>
                    </div>
                    <div id="quiz-list" class="space-y-6"></div>
                </div>
            </div>
            <div id="lesson-navigation" class="mt-8 pt-6 border-t border-slate-200 flex justify-between items-center"></div>
        </div>
    </main>

    <footer class="bg-white/80 backdrop-blur-md border-t border-slate-200 mt-10 py-8 text-center relative z-10">
        <p class="text-slate-500 font-medium text-sm">Learning and Development Department</p>
        <p class="text-slate-400 text-xs mt-2">© 2026 KiotViet. All rights reserved.</p>
    </footer>

    <div class="fixed bottom-6 right-6 z-50 flex flex-col items-center space-y-3">
        <a href="https://notebooklm.google.com/notebook/a4480a38-2d6e-4974-9880-c45e534f5fa5" target="_blank" title="Hỏi Chatbot AI" class="float-btn w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 text-white rounded-full flex items-center justify-center shadow-lg border-2 border-white"><i class="fa-solid fa-robot"></i></a>
        <a href="https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-tra-cuu-san-pham/tra-cuu-san-pham/#v-thao-tac-tren-may-pos" target="_blank" title="Xem Tài liệu" class="float-btn w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center shadow-lg border-2 border-white"><i class="fa-solid fa-book-open"></i></a>
        <a href="https://www.youtube.com/playlist?list=PL3x3GXJzpHzSXXO4aVoriCCGga4hTWsMYFNB" target="_blank" title="Xem Video" class="float-btn w-12 h-12 bg-red-600 text-white rounded-full flex items-center justify-center shadow-lg border-2 border-white"><i class="fa-brands fa-youtube"></i></a>
        <button id="scroll-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="hidden w-12 h-12 bg-white text-slate-600 border border-slate-200 rounded-full items-center justify-center shadow-lg float-btn"><i class="fas fa-arrow-up"></i></button>
    </div>

    <div id="certificate-modal" class="modal opacity-0 pointer-events-none fixed inset-0 z-[100] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/90 backdrop-blur-sm" onclick="toggleModal('certificate-modal')"></div>
        <div class="bg-white w-full max-w-3xl rounded-xl shadow-2xl relative z-10 transform scale-95 transition-all duration-300" id="cert-content">
            <div class="p-2">
                <div class="border-8 border-double border-blue-800 p-8 text-center bg-white relative overflow-hidden">
                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-[url('https://cdn-icons-png.flaticon.com/512/2912/2912761.png')] bg-contain bg-no-repeat opacity-5 pointer-events-none"></div>
                    <img src="https://logo.kiotviet.vn/KiotViet-Logo-Horizontal.svg" alt="Logo" class="h-10 mx-auto mb-6">
                    <h2 class="text-4xl font-black font-sans text-blue-900 mb-2 uppercase tracking-widest">Giấy Chứng Nhận</h2>
                    <div class="w-24 h-1 bg-gradient-to-r from-blue-600 to-indigo-600 mx-auto mb-8"></div>
                    <p class="text-slate-500 italic mb-2 font-medium">Chứng nhận nhân viên:</p>
                    <div class="text-3xl font-black text-blue-600 mb-6 uppercase tracking-wider font-sans">Học Viên KiotViet</div>
                    <p class="text-slate-600 mb-2 font-medium">Đã hoàn thành xuất sắc khóa đào tạo:</p>
                    <h3 class="text-2xl font-bold text-slate-800 mb-10 uppercase border-2 border-slate-800 inline-block px-6 py-2">Tra cứu sản phẩm</h3>
                    <div class="flex justify-between items-end mt-12 px-10">
                        <div class="text-center"><p class="text-xs text-slate-400 font-bold uppercase mb-1">Ngày cấp</p><p class="text-lg font-bold text-slate-700" id="cert-date">--/--/----</p></div>
                        <div class="text-center relative"><div class="w-24 h-24 absolute -top-12 -left-6 bg-[url('https://cdn-icons-png.flaticon.com/512/1041/1041166.png')] bg-contain bg-no-repeat opacity-80 rotate-12"></div><p class="text-sm font-bold text-blue-900 mt-10 relative z-10">KiotViet Training Dept.</p></div>
                    </div>
                </div>
            </div>
            <div class="bg-slate-50 p-4 flex justify-end gap-3 rounded-b-xl border-t border-slate-100 no-print">
                <button onclick="toggleModal('certificate-modal')" class="px-5 py-2.5 text-slate-600 font-bold rounded-lg hover:bg-slate-200">Đóng</button>
                <button onclick="window.print()" class="px-5 py-2.5 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 flex items-center gap-2"><i class="fa-solid fa-print"></i> In chứng chỉ</button>
            </div>
        </div>
    </div>

    <script>
        const courseData = [
  {
    "title": "Giới thiệu chung",
    "desc": "Tổng quan về tính năng Tra cứu sản phẩm, vị trí, lợi ích và các nền tảng hỗ trợ.",
    "icon": "fa-solid fa-circle-info",
    "knowledge": [
      {
        "header": "Tổng quan",
        "content": [
          "Vị trí: Tích hợp ngay trên màn hình Bán hàng.",
          "Mục tiêu: Giúp tra cứu, lựa chọn hàng hóa thêm vào đơn nhanh chóng, chính xác."
        ]
      },
      {
        "header": "Lợi ích nổi bật",
        "content": [
          "Tốc độ & Chính xác: Giảm thời gian chờ, hạn chế sai sót qua việc quét mã vạch hoặc nhập tên/mã.",
          "Đa dạng tiêu chí: Tìm theo thuộc tính (size, màu), nhóm hàng phù hợp nhiều ngành nghề.",
          "Đa nền tảng: Đồng bộ thao tác trên Web, App điện thoại và máy POS."
        ]
      }
    ],
    "dialogue": [
      {
        "speaker": "Lan",
        "target": "Chào Minh, cửa hàng chị nhiều mã hàng quá, nhân viên mới hay bị nhầm lẫn khi tìm tên sản phẩm để bán, có cách nào nhanh hơn không?"
      },
      {
        "speaker": "Minh (Chuyên viên KiotViet)",
        "target": "Chào chị Lan. Tính năng **Tra cứu sản phẩm** trên màn hình bán hàng của KiotViet sẽ giải quyết vấn đề này ạ. Nhân viên có thể dùng máy quét mã vạch hoặc tìm theo màu sắc, kích cỡ, đảm bảo lên đơn cực nhanh và không bao giờ sai sót đâu ạ."
      }
    ],
    "vocab": [
      {
        "q": "Tính năng tra cứu sản phẩm được tích hợp ngay trên __________ của KiotViet.",
        "full": "Tính năng tra cứu sản phẩm được tích hợp ngay trên **màn hình bán hàng** của KiotViet."
      },
      {
        "q": "Bạn có thể tìm kiếm sản phẩm bằng nhiều cách như __________, nhập tên hoặc mã hàng.",
        "full": "Bạn có thể tìm kiếm sản phẩm bằng nhiều cách như **quét mã vạch**, nhập tên hoặc mã hàng."
      },
      {
        "q": "Tìm kiếm theo thuộc tính giúp đáp ứng nhu cầu đặc thù của từng __________.",
        "full": "Tìm kiếm theo thuộc tính giúp đáp ứng nhu cầu đặc thù của từng **ngành kinh doanh**."
      }
    ],
    "quiz": [
      {
        "q": "Tính năng \"Tra cứu sản phẩm\" mang lại lợi ích gì lớn nhất cho thu ngân?",
        "opts": [
          "Giúp kiểm kho tự động.",
          "Giảm thiểu thời gian chờ đợi và hạn chế sai sót khi lên đơn.",
          "Tự động tính toán lợi nhuận sau khi bán."
        ],
        "a": 1
      },
      {
        "q": "Bạn có thể tra cứu sản phẩm trên các nền tảng nào của KiotViet?",
        "opts": [
          "Chỉ trên máy tính (Web).",
          "Chỉ trên điện thoại.",
          "Trên cả Web, Điện thoại và Máy POS."
        ],
        "a": 2
      }
    ]
  },
  {
    "title": "Các thao tác cơ bản",
    "desc": "Hướng dẫn chi tiết 3 cách tìm kiếm sản phẩm: theo tên/mã, chọn trực quan và dùng bộ lọc.",
    "icon": "fa-solid fa-magnifying-glass",
    "knowledge": [
      {
        "header": "Cách 1: Tìm theo Tên/Mã/Mã vạch",
        "content": [
          "Nhập trực tiếp vào ô tìm kiếm.",
          "Hoặc dùng máy quét tít mã vạch."
        ]
      },
      {
        "header": "Cách 2: Chọn trực quan",
        "content": [
          "Theo hình ảnh: Click chọn ảnh sản phẩm bên phải màn hình (chế độ Bán thường).",
          "Hàng yêu thích: Chọn các sản phẩm có đánh dấu sao để bán nhanh (hàng bán chạy)."
        ]
      },
      {
        "header": "Cách 3: Lọc hàng hóa",
        "content": [
          "Bước 1: Nhấn biểu tượng Lọc theo nhóm hoặc Lọc theo thuộc tính.",
          "Bước 2: Tích chọn tiêu chí (Ví dụ: Nhóm Áo thun, Màu Đỏ, Size S).",
          "Bước 3: Nhấn \"Xong\" để hiển thị kết quả."
        ]
      }
    ],
    "dialogue": [
      {
        "speaker": "Lan",
        "target": "Khách hỏi mua cái áo thun màu đỏ size S, mà danh sách dài quá chị tìm hoa cả mắt."
      },
      {
        "speaker": "Minh (Chuyên viên KiotViet)",
        "target": "Chị dùng bộ lọc đi ạ. Chị nhấn vào biểu tượng Lọc thuộc tính, chọn **Màu đỏ** và **Size S**, hệ thống sẽ chỉ hiện ra đúng những mẫu chị cần thôi. Rất tiện cho ngành thời trang đó chị."
      }
    ],
    "vocab": [
      {
        "q": "Để tìm sản phẩm bằng máy quét, bạn chỉ cần __________ của sản phẩm.",
        "full": "Để tìm sản phẩm bằng máy quét, bạn chỉ cần **quét mã vạch** của sản phẩm."
      },
      {
        "q": "Các sản phẩm bán chạy có thể được đánh dấu __________ để hiển thị nổi bật, giúp chọn nhanh.",
        "full": "Các sản phẩm bán chạy có thể được đánh dấu **yêu thích** để hiển thị nổi bật, giúp chọn nhanh."
      },
      {
        "q": "Sử dụng bộ lọc giúp tìm kiếm chính xác sản phẩm theo __________ hoặc thuộc tính.",
        "full": "Sử dụng bộ lọc giúp tìm kiếm chính xác sản phẩm theo **nhóm hàng** hoặc thuộc tính."
      }
    ],
    "quiz": [
      {
        "q": "Làm thế nào để tìm nhanh một sản phẩm cụ thể nếu bạn có máy quét mã vạch?",
        "opts": [
          "Nhập tên sản phẩm vào ô tìm kiếm rồi nhấn Enter.",
          "Quét mã vạch sản phẩm, hệ thống tự động thêm vào đơn.",
          "Vào menu Hàng hóa để tìm mã vạch."
        ],
        "a": 1
      },
      {
        "q": "Nếu muốn tìm tất cả các sản phẩm \"Áo sơ mi\" có \"Màu trắng\", bạn nên dùng tính năng nào?",
        "opts": [
          "Tìm theo tên hàng.",
          "Quét mã vạch.",
          "Lọc hàng hóa theo nhóm và thuộc tính."
        ],
        "a": 2
      }
    ]
  },
  {
    "title": "Các tính năng nâng cao",
    "desc": "Tối ưu hóa thao tác với chế độ nhập nhanh, gộp hàng hóa, thêm mới nhanh và tìm hàng đặc thù (Lô, Serial/IMEI).",
    "icon": "fa-solid fa-layer-group",
    "knowledge": [
      {
        "header": "Chế độ nhập (Phím tắt F6)",
        "content": [
          "Nhập thường: Chọn xong trỏ chuột nhảy sang ô số lượng (nhập tay).",
          "Nhập nhanh: Tối ưu cho máy quét, quét 1 lần tự tăng số lượng lên 1."
        ]
      },
      {
        "header": "Gộp/Tách hàng hóa",
        "content": [
          "Vào Tùy chọn hiển thị -> Khác -> Bật \"Gộp hàng hóa liên quan\" để nhóm các biến thể (size/màu) cho gọn."
        ]
      },
      {
        "header": "Thêm mới nhanh",
        "content": [
          "Nếu tìm không thấy, chọn \"+ Thêm mới hàng hóa\" ngay trên màn hình bán."
        ]
      },
      {
        "header": "Hàng Lô/Date",
        "content": [
          "Hệ thống tự gợi ý lô hết hạn trước (FEFO) hoặc nhập tên Lô để tìm."
        ]
      },
      {
        "header": "Hàng Serial/IMEI",
        "content": [
          "Nhập chính xác số Serial/IMEI để tìm đúng sản phẩm duy nhất."
        ]
      }
    ],
    "dialogue": [
      {
        "speaker": "Lan",
        "target": "Cửa hàng chị bán cả điện thoại, mỗi cái một mã IMEI riêng, tìm kiểu gì cho chuẩn em nhỉ?"
      },
      {
        "speaker": "Minh (Chuyên viên KiotViet)",
        "target": "Chị chỉ cần nhập hoặc quét đúng số IMEI vào ô tìm kiếm. Hệ thống sẽ lấy chính xác chiếc điện thoại đó đưa vào đơn hàng, không sợ nhầm lẫn với chiếc khác đâu ạ."
      },
      {
        "speaker": "Lan",
        "target": "Thế còn sữa trẻ em có hạn sử dụng thì sao?"
      },
      {
        "speaker": "Minh (Chuyên viên KiotViet)",
        "target": "KiotViet hỗ trợ nguyên tắc FEFO (Hết hạn trước xuất trước). Khi chị chọn sữa, máy sẽ tự gợi ý lô có hạn sử dụng gần nhất để chị bán trước ạ."
      }
    ],
    "vocab": [
      {
        "q": "Nhấn phím __________ để chuyển đổi nhanh giữa chế độ Nhập nhanh và Nhập thường.",
        "full": "Nhấn phím **F6** để chuyển đổi nhanh giữa chế độ Nhập nhanh và Nhập thường."
      },
      {
        "q": "Chế độ Nhập nhanh tối ưu cho việc sử dụng __________, số lượng tự động tăng khi quét.",
        "full": "Chế độ Nhập nhanh tối ưu cho việc sử dụng **máy quét mã vạch**, số lượng tự động tăng khi quét."
      },
      {
        "q": "Với hàng quản lý theo Lô/Hạn sử dụng, hệ thống gợi ý xuất bán theo nguyên tắc __________.",
        "full": "Với hàng quản lý theo Lô/Hạn sử dụng, hệ thống gợi ý xuất bán theo nguyên tắc **FEFO**."
      },
      {
        "q": "Khi tìm kiếm sản phẩm chưa có trong hệ thống, bạn có thể chọn __________ ngay lập tức.",
        "full": "Khi tìm kiếm sản phẩm chưa có trong hệ thống, bạn có thể chọn **+ Thêm mới hàng hóa** ngay lập tức."
      }
    ],
    "quiz": [
      {
        "q": "Phím tắt F6 trên màn hình bán hàng có tác dụng gì?",
        "opts": [
          "Mở hộp thoại thanh toán.",
          "Chuyển đổi giữa chế độ Nhập nhanh và Nhập thường.",
          "In hóa đơn tạm tính."
        ],
        "a": 1
      },
      {
        "q": "Nguyên tắc FEFO trong quản lý hàng Lô/Hạn sử dụng nghĩa là gì?",
        "opts": [
          "Hàng nhập trước xuất trước.",
          "Hàng hết hạn trước xuất trước.",
          "Hàng mới nhất xuất trước."
        ],
        "a": 1
      },
      {
        "q": "Khi kích hoạt tính năng \"Gộp hàng hóa liên quan\", giao diện danh sách hàng hóa sẽ thay đổi thế nào?",
        "opts": [
          "Hiển thị tất cả hàng hóa ở dạng danh sách dài.",
          "Các sản phẩm có cùng thuộc tính (biến thể) sẽ được nhóm lại với nhau.",
          "Chỉ hiển thị tên hàng hóa, ẩn giá bán."
        ],
        "a": 1
      }
    ]
  },
  {
    "title": "Thao tác trên Điện thoại",
    "desc": "Hướng dẫn tìm kiếm, quét mã và lên đơn nhanh chóng ngay trên ứng dụng điện thoại.",
    "icon": "fa-solid fa-mobile-screen",
    "knowledge": [
      {
        "header": "Truy cập",
        "content": [
          "Menu Bán hàng -> Chọn Bán hàng."
        ]
      },
      {
        "header": "Các cách tìm",
        "content": [
          "Nhập liệu: Nhập tên, mã, serial... vào ô tìm kiếm.",
          "Quét mã: Chạm biểu tượng mã vạch -> Dùng camera điện thoại để quét.",
          "Bộ lọc: Chạm tùy chọn lọc theo Nhóm/Thuộc tính."
        ]
      },
      {
        "header": "Tiện ích",
        "content": [
          "Chế độ chọn nhiều: Thêm nhiều mặt hàng cùng lúc.",
          "Thêm mới: Biểu tượng dấu cộng (+) để thêm hàng chưa có."
        ]
      }
    ],
    "dialogue": [
      {
        "speaker": "Lan",
        "target": "Chị hay chạy ra ngoài, không ngồi máy tính thì bán hàng kiểu gì?"
      },
      {
        "speaker": "Minh (Chuyên viên KiotViet)",
        "target": "Chị dùng App KiotViet trên điện thoại nhé. Chị bấm vào biểu tượng mã vạch, camera sẽ biến thành máy quét, tít mã sản phẩm là lên đơn ngay, tiện lắm chị."
      }
    ],
    "vocab": [
      {
        "q": "Trên điện thoại, chạm vào biểu tượng mã vạch để sử dụng __________ quét mã sản phẩm.",
        "full": "Trên điện thoại, chạm vào biểu tượng mã vạch để sử dụng **camera** quét mã sản phẩm."
      },
      {
        "q": "Bật __________ trên ứng dụng điện thoại để thêm nhiều mặt hàng vào đơn cùng lúc.",
        "full": "Bật **Chế độ chọn nhiều** trên ứng dụng điện thoại để thêm nhiều mặt hàng vào đơn cùng lúc."
      },
      {
        "q": "Chạm vào biểu tượng __________ trên App để thêm hàng hóa mới ngay khi bán.",
        "full": "Chạm vào biểu tượng **dấu cộng** trên App để thêm hàng hóa mới ngay khi bán."
      }
    ],
    "quiz": [
      {
        "q": "Làm sao để quét mã vạch sản phẩm bằng điện thoại?",
        "opts": [
          "Phải gắn thêm thiết bị quét mã vạch bluetooth.",
          "Chạm vào biểu tượng mã vạch và sử dụng camera của điện thoại.",
          "Nhập mã số của mã vạch bằng tay."
        ],
        "a": 1
      },
      {
        "q": "Tính năng \"Chế độ chọn nhiều\" trên App điện thoại giúp ích gì?",
        "opts": [
          "Chọn nhiều khách hàng cùng lúc.",
          "Chọn nhiều phương thức thanh toán.",
          "Thêm nhiều mặt hàng vào đơn hàng cùng một lúc mà không cần tìm lại."
        ],
        "a": 2
      }
    ]
  },
  {
    "title": "Thao tác trên Máy POS",
    "desc": "Tận dụng màn hình cảm ứng của máy POS để bán hàng nhanh chóng và chuyên nghiệp.",
    "icon": "fa-solid fa-cash-register",
    "knowledge": [
      {
        "header": "Môi trường",
        "content": [
          "Máy POS Android (Cảm ứng)."
        ]
      },
      {
        "header": "Tìm kiếm & Chọn hàng",
        "content": [
          "Nhập vào ô \"Tìm hàng hóa\" hoặc dùng máy quét tích hợp/gắn ngoài.",
          "Cơ chế: Quét/Chọn 1 lần -> Tự động tăng số lượng thêm 1.",
          "Chọn nhanh: Chọn từ danh sách nhóm hàng phân loại sẵn trên màn hình cảm ứng."
        ]
      },
      {
        "header": "Điều chỉnh",
        "content": [
          "Chạm biểu tượng (+ / -) hoặc chạm vào số lượng để nhập số mới."
        ]
      }
    ],
    "dialogue": [
      {
        "speaker": "Lan",
        "target": "Máy POS cảm ứng thì thao tác có nhanh như máy tính dùng chuột không em?"
      },
      {
        "speaker": "Minh (Chuyên viên KiotViet)",
        "target": "Nhanh hơn chị ạ! Chị chỉ cần chạm vào nhóm hàng rồi chạm vào sản phẩm là xong. Nếu khách mua 5 cái, chị chạm 5 lần hoặc chạm vào số lượng để sửa thành 5, rất trực quan ạ."
      }
    ],
    "vocab": [
      {
        "q": "Trên máy POS, mỗi lần quét hoặc chọn sản phẩm, __________ sẽ tự động tăng thêm 1.",
        "full": "Trên máy POS, mỗi lần quét hoặc chọn sản phẩm, **số lượng** sẽ tự động tăng thêm 1."
      },
      {
        "q": "Bạn có thể chọn nhanh sản phẩm từ các __________ đã được phân loại sẵn trên màn hình POS.",
        "full": "Bạn có thể chọn nhanh sản phẩm từ các **nhóm hàng hóa** đã được phân loại sẵn trên màn hình POS."
      },
      {
        "q": "Để điều chỉnh số lượng trên POS, bạn có thể chạm vào biểu tượng __________ hoặc nhập trực tiếp.",
        "full": "Để điều chỉnh số lượng trên POS, bạn có thể chạm vào biểu tượng **+ / -** hoặc nhập trực tiếp."
      }
    ],
    "quiz": [
      {
        "q": "Thao tác mặc định khi chọn một sản phẩm trên màn hình máy POS là gì?",
        "opts": [
          "Hiển thị thông tin chi tiết sản phẩm.",
          "Thêm sản phẩm vào đơn và tăng số lượng lên 1.",
          "Mở hộp thoại nhập giá bán."
        ],
        "a": 1
      },
      {
        "q": "Cách nhanh nhất để chọn sản phẩm trên giao diện cảm ứng của POS là gì?",
        "opts": [
          "Gõ tên từng sản phẩm.",
          "Chọn từ các nhóm hàng hóa hiển thị sẵn trên màn hình.",
          "Vào menu kho hàng để tìm."
        ],
        "a": 1
      }
    ]
  }
]; // THIS WILL BE INJECTED BY CHATBOT

        let currentLessonId = 0;
        let completedLessons = new Set();
        let quizState = { correct: 0, total: 0 };
        let currentActiveTab = 'knowledge'; // Default tab

        function init() {
            renderMenu();
            updateProgress();
            const today = new Date();
            document.getElementById('cert-date').innerText = `${today.getDate()}/${today.getMonth() + 1}/${today.getFullYear()}`;
            
            const scrollTopBtn = document.getElementById('scroll-to-top');
            window.onscroll = function() {
                if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) { scrollTopBtn.classList.remove('hidden'); scrollTopBtn.classList.add('flex'); }
                else { scrollTopBtn.classList.add('hidden'); scrollTopBtn.classList.remove('flex'); }
            };
        }

        function renderMenu() {
            const grid = document.getElementById('lesson-grid');
            grid.innerHTML = courseData.map((lesson, idx) => `
                <div onclick="loadLessonFromMenu(${idx})" class="glass-card bg-white rounded-xl p-5 cursor-pointer group hover:border-blue-400 relative overflow-hidden transition-all duration-300">
                    <div class="flex items-start gap-4 relative z-10">
                        <div class="w-12 h-12 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center text-xl shadow-sm border border-blue-100 group-hover:bg-blue-600 group-hover:text-white transition-colors duration-300"><i class="${lesson.icon}"></i></div>
                        <div><h3 class="font-bold text-lg text-slate-800 group-hover:text-blue-600 transition-colors">${lesson.title}</h3><p class="text-sm text-slate-500 mt-1 line-clamp-2">${lesson.desc}</p></div>
                    </div>
                    <div class="mt-4 pt-3 border-t border-slate-100 flex items-center justify-between">
                        <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest group-hover:text-blue-500">Mục ${idx + 1}</span>
                        ${completedLessons.has(idx) ? '<i class="fa-solid fa-circle-check text-green-500 text-xl animate__animated animate__rubberBand"></i>' : '<i class="fa-regular fa-circle-play text-slate-300 text-xl group-hover:text-blue-500 transition-colors"></i>'}
                    </div>
                </div>
            `).join('');
        }

        function loadLessonFromMenu(id) {
            currentActiveTab = 'knowledge';
            if(id === -1) loadComprehensiveLesson(); else loadLesson(id);
        }

        function loadLesson(id) {
            currentLessonId = id;
            const lesson = courseData[id];
            const mainTopic = '<span class="block text-sm text-blue-500 font-bold uppercase tracking-wider mb-1">Tra cứu sản phẩm</span>';
            document.getElementById('lesson-title-container').innerHTML = `${mainTopic}<h2 id="lesson-title" class="text-2xl md:text-3xl font-black text-slate-800">${lesson.title}</h2>`;
            document.getElementById('lesson-desc').innerText = lesson.desc;
            document.getElementById('lesson-icon').className = `${lesson.icon} text-2xl`;
            
            renderKnowledge(lesson.knowledge);
            renderDialogue(lesson.dialogue);
            renderVocab(lesson.vocab);
            renderQuiz(lesson.quiz);
            
            updateDropdown();
            renderNavigation();
            document.getElementById('view-menu').classList.add('hidden');
            document.getElementById('view-learning').classList.remove('hidden');
            switchTab(currentActiveTab);
            window.scrollTo(0, 0);
        }

        function renderKnowledge(data) {
            const container = document.getElementById('content-knowledge');
            if(!data || data.length === 0) {
                 container.innerHTML = `<div class="p-6 bg-slate-50 rounded-xl text-center text-slate-500">Chưa có dữ liệu chi tiết.</div>`;
                 return;
            }
            container.innerHTML = data.map((item, idx) => `
                <div class="bg-white rounded-xl p-6 shadow-sm border border-slate-100 animate__animated animate__fadeInUp" style="animation-delay: ${idx * 100}ms">
                    <div class="flex gap-4">
                        <div class="shrink-0 w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center font-bold shadow-sm border border-blue-100">${idx + 1}</div>
                        <div class="flex-1">
                            <h3 class="font-bold text-slate-800 text-lg mb-3 pb-2 border-b border-slate-100">${item.header}</h3>
                            <ul class="space-y-3 knowledge-list">
                                ${item.content.map(point => `<li class="flex gap-3 text-sm text-slate-600 leading-relaxed items-start"><i class="fa-solid fa-check text-blue-500 mt-1 shrink-0"></i> <span>${point}</span></li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderDialogue(dialogue) {
            const container = document.getElementById('content-dialogue');
            container.innerHTML = dialogue.map((line, idx) => {
                const isKiot = line.speaker.includes('KiotViet');
                const formattedText = line.target.replace(/\*\*(.*?)\*\*/g, '<b class="text-blue-700 font-bold">$1</b>');
                return `
                <div class="flex ${isKiot ? 'flex-row' : 'flex-row-reverse'} gap-4 items-end animate__animated animate__fadeInUp" style="animation-delay: ${idx * 50}ms">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center shrink-0 shadow-md ${isKiot ? 'bg-blue-600 text-white' : 'bg-white border border-slate-200 text-slate-600'}"><i class="fa-solid ${isKiot ? 'fa-user-tie' : 'fa-store'}"></i></div>
                    <div class="flex flex-col ${isKiot ? 'items-start' : 'items-end'} max-w-[80%]">
                        <span class="text-[10px] font-bold text-slate-400 mb-1 uppercase tracking-wide">${line.speaker}</span>
                        <div class="p-4 rounded-2xl shadow-sm text-sm font-medium leading-relaxed border ${isKiot ? 'bg-blue-50 border-blue-100 rounded-bl-none text-slate-700' : 'bg-white border-slate-200 rounded-br-none text-slate-600'}">${formattedText}</div>
                    </div>
                </div>`;
            }).join('');
        }

        function renderVocab(vocab) {
            const container = document.getElementById('content-vocab');
            container.innerHTML = vocab.map((v, i) => {
                // FIXED: Parse markdown bold syntax to HTML span
                const formattedFull = v.full.replace(/\*\*(.*?)\*\*/g, '<span class="text-yellow-300 font-black border-b border-yellow-300">$1</span>');
                return `
                <div class="flip-card h-56 perspective-1000 group animate__animated animate__fadeIn" style="animation-delay: ${i * 50}ms" onclick="this.classList.toggle('flipped')">
                    <div class="flip-card-inner shadow-sm rounded-xl">
                        <div class="flip-card-front bg-white border border-slate-200 hover:border-blue-300 transition-colors">
                            <div class="w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center mb-4 text-blue-500"><i class="fa-solid fa-question text-xl"></i></div>
                            <h3 class="text-base font-bold text-slate-800 px-4 leading-snug">${v.q}</h3>
                            <p class="text-[10px] text-slate-400 mt-6 uppercase tracking-widest font-bold flex items-center gap-1"><i class="fa-solid fa-hand-pointer animate-pulse"></i> Chạm để lật</p>
                        </div>
                        <div class="flip-card-back bg-gradient-to-br from-blue-600 to-indigo-700 text-white">
                            <i class="fa-solid fa-lightbulb text-yellow-300 text-3xl mb-3"></i>
                            <span class="text-[10px] font-bold uppercase tracking-widest text-blue-200 mb-1">Ghi nhớ</span>
                            <p class="font-medium text-sm px-4 leading-relaxed">${formattedFull}</p>
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        function renderQuiz(quiz) {
            const list = document.getElementById('quiz-list');
            quizState = { correct: 0, total: quiz.length };
            updateQuizStats();
            list.innerHTML = quiz.map((q, idx) => `
                <div class="bg-white rounded-xl p-6 shadow-sm border border-slate-100 quiz-card transition-all" id="quiz-${idx}">
                    <div class="flex gap-4 mb-4"><span class="shrink-0 w-8 h-8 bg-blue-100 text-blue-700 rounded-lg flex items-center justify-center text-xs font-bold">Q${idx + 1}</span><h3 class="font-bold text-slate-800 text-base leading-snug">${q.q}</h3></div>
                    <div class="space-y-3 pl-12">
                        ${q.opts.map((opt, oid) => `
                            <button onclick="checkAnswer(${idx}, ${oid}, ${q.a})" class="w-full text-left p-3 rounded-lg border border-slate-200 hover:bg-blue-50 hover:border-blue-300 transition-all text-sm font-medium text-slate-600 quiz-opt flex items-center group">
                                <span class="w-6 h-6 rounded-md border border-slate-300 flex items-center justify-center text-[10px] text-slate-500 font-bold mr-3 group-hover:border-blue-400 group-hover:text-blue-500 opt-idx transition-colors">${String.fromCharCode(65+oid)}</span><span class="flex-1">${opt}</span>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function checkAnswer(qIdx, selected, correct) {
            const card = document.getElementById(`quiz-${qIdx}`);
            if(card.hasAttribute('data-answered')) return;
            card.setAttribute('data-answered', 'true');
            const opts = card.querySelectorAll('.quiz-opt');
            opts.forEach((btn, idx) => {
                btn.disabled = true;
                btn.classList.remove('hover:bg-blue-50', 'hover:border-blue-300');
                const idxSpan = btn.querySelector('.opt-idx');
                if (idx === correct) {
                    btn.classList.add('bg-green-50', 'border-green-500', 'text-green-800');
                    idxSpan.classList.add('bg-green-500', 'border-green-500', 'text-white');
                    idxSpan.innerHTML = '<i class="fa-solid fa-check"></i>';
                } else if (idx === selected) {
                    btn.classList.add('bg-red-50', 'border-red-500', 'text-red-800');
                    idxSpan.classList.add('bg-red-500', 'border-red-500', 'text-white');
                    idxSpan.innerHTML = '<i class="fa-solid fa-xmark"></i>';
                }
            });
            if (selected === correct) { quizState.correct++; confetti({ particleCount: 40, spread: 60, origin: { y: 0.7 } }); } 
            else { card.classList.add('animate__animated', 'animate__shakeX'); }
            updateQuizStats();
            if(document.querySelectorAll('.quiz-card[data-answered]').length === quizState.total) {
                if(quizState.correct === quizState.total && currentLessonId !== -1) { completedLessons.add(currentLessonId); updateProgress(); }
                if(currentLessonId === -1 && quizState.correct === quizState.total) { triggerMegaConfetti(); setTimeout(() => toggleModal('certificate-modal'), 1200); }
            }
        }

        function updateQuizStats() { document.getElementById('quiz-score').innerText = quizState.correct; document.getElementById('quiz-total').innerText = quizState.total; }
        function resetQuiz() { if(currentLessonId === -1) loadComprehensiveLesson(); else renderQuiz(courseData[currentLessonId].quiz); }

        function loadComprehensiveLesson() {
            currentLessonId = -1;
            const allQuizzes = courseData.flatMap(c => c.quiz);
            const allDialogues = courseData.flatMap(c => c.dialogue);
            const allVocabs = courseData.flatMap(c => c.vocab);
            const allKnowledge = courseData.flatMap(c => c.knowledge);
            
            const mainTopic = '<span class="block text-sm text-indigo-500 font-bold uppercase tracking-wider mb-1">Tra cứu sản phẩm</span>';
            document.getElementById('lesson-title-container').innerHTML = `${mainTopic}<h2 id="lesson-title" class="text-2xl md:text-3xl font-black text-slate-800">Bài kiểm tra Tổng hợp</h2>`;
            document.getElementById('lesson-desc').innerText = "Ôn tập toàn diện và trả lời đúng 100% câu hỏi để nhận Chứng chỉ.";
            document.getElementById('lesson-icon').className = "fa-solid fa-graduation-cap text-2xl";
            
            // Render content
            renderKnowledge(allKnowledge); renderDialogue(allDialogues); renderVocab(allVocabs); renderQuiz(allQuizzes);
            
            // View transition
            document.getElementById('view-menu').classList.add('hidden');
            document.getElementById('view-learning').classList.remove('hidden');
            document.getElementById('lesson-navigation').innerHTML = `<div class="w-full flex justify-center"><button onclick="goBack()" class="text-slate-400 font-bold text-sm hover:text-slate-600 flex items-center gap-2"><i class="fa-solid fa-arrow-up"></i> Quay về trang chủ</button></div>`;
            
            // Show all tabs
            document.getElementById('btn-tab-knowledge').classList.remove('hidden');
            document.getElementById('btn-tab-dialogue').nextElementSibling.classList.remove('hidden'); 
            
            updateDropdown(); // Update dropdown to show "Test" selected

            switchTab('quiz'); 
            window.scrollTo(0, 0);
        }

        function switchTab(tab) {
            currentActiveTab = tab;
            ['knowledge', 'dialogue', 'vocab', 'quiz'].forEach(t => { 
                const contentEl = document.getElementById(`content-${t}`);
                const btnEl = document.getElementById(`btn-tab-${t}`);
                if(contentEl) contentEl.classList.add('hidden'); 
                if(btnEl) btnEl.classList.remove('active', 'text-blue-600'); 
            });
            const targetContent = document.getElementById(`content-${tab}`);
            const targetBtn = document.getElementById(`btn-tab-${tab}`);
            if(targetContent) targetContent.classList.remove('hidden');
            if(targetBtn) targetBtn.classList.add('active', 'text-blue-600');
        }

        function goBack() { 
            document.getElementById('btn-tab-knowledge').classList.remove('hidden');
            document.getElementById('btn-tab-dialogue').nextElementSibling.classList.remove('hidden');
            document.getElementById('view-learning').classList.add('hidden'); 
            document.getElementById('view-menu').classList.remove('hidden'); 
            updateProgress(); 
            renderMenu(); 
            window.scrollTo(0, 0); 
        }
        function updateProgress() { const pct = Math.round((completedLessons.size / courseData.length) * 100); document.getElementById('course-progress').style.width = `${pct}%`; document.getElementById('progress-text').innerText = `${pct}%`; }
        function updateDropdown() { 
            const select = document.getElementById('lesson-selector'); 
            let html = courseData.map((l, i) => `<option value="${i}" ${i === currentLessonId ? 'selected' : ''}>${i+1}. ${l.title}</option>`).join(''); 
            html += `<option value="-1" ${currentLessonId === -1 ? 'selected' : ''}>Bài kiểm tra Tổng hợp</option>`;
            select.innerHTML = html;
        }
        function switchLessonFromDropdown(val) { 
            const id = parseInt(val);
            if(id === -1) loadComprehensiveLesson();
            else loadLesson(id); 
        }

        function renderNavigation() {
            const container = document.getElementById('lesson-navigation');
            const prev = currentLessonId > 0 ? currentLessonId - 1 : null;
            const next = currentLessonId < courseData.length - 1 ? currentLessonId + 1 : null;
            let html = '<div class="flex-1">';
            if (prev !== null) html += `<button onclick="loadLesson(${prev})" class="flex items-center gap-2 text-slate-500 hover:text-blue-600 font-bold text-sm transition-colors"><i class="fa-solid fa-arrow-left"></i> Mục trước</button>`;
            html += '</div><div class="flex-1 text-right">';
            if (next !== null) html += `<button onclick="loadLesson(${next})" class="flex items-center gap-2 text-blue-600 hover:text-blue-800 font-bold text-sm transition-colors ml-auto">Mục tiếp theo <i class="fa-solid fa-arrow-right"></i></button>`;
            else html += `<button onclick="loadComprehensiveLesson()" class="flex items-center gap-2 text-white bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg shadow-md font-bold text-sm transition-all ml-auto animate-pulse">Thi chứng chỉ <i class="fa-solid fa-graduation-cap"></i></button>`;
            html += '</div>';
            container.innerHTML = html;
        }

        function toggleModal(id) {
            const m = document.getElementById(id);
            const content = document.getElementById('cert-content');
            if (m.classList.contains('opacity-0')) { m.classList.remove('opacity-0', 'pointer-events-none'); content.classList.remove('scale-95'); content.classList.add('scale-100'); }
            else { m.classList.add('opacity-0', 'pointer-events-none'); content.classList.remove('scale-100'); content.classList.add('scale-95'); }
            document.body.classList.toggle('modal-active');
        }

        function triggerMegaConfetti() {
            var duration = 3000; var animationEnd = Date.now() + duration; var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) return clearInterval(interval);
                var particleCount = 50 * (timeLeft / duration);
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: Math.random() * 0.2 + 0.1, y: Math.random() - 0.2 } }));
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: Math.random() * 0.2 + 0.7, y: Math.random() - 0.2 } }));
            }, 250);
        }

        window.onload = init;
    </script></body></html>
