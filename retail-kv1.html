<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KiotViet - Tài liệu Ôn tập KV1</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- AOS -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }

        /* Sidebar Styling */
        .sidebar-group-title {
            font-size: 0.75rem; text-transform: uppercase; font-weight: 800;
            color: #64748b; letter-spacing: 0.05em; margin-top: 1.5rem;
            margin-bottom: 0.5rem; padding-left: 0.75rem;
        }
        
        .sidebar-link {
            display: block; padding: 0.5rem 0.75rem; font-size: 0.875rem;
            font-weight: 500; color: #334155; border-radius: 0.5rem;
            transition: all 0.2s; border-left: 3px solid transparent;
        }

        .sidebar-link:hover { color: #1d4ed8; background-color: #f1f5f9; }
        .sidebar-link.active {
            background-color: #eff6ff; color: #1d4ed8;
            border-left-color: #1d4ed8; font-weight: 600;
        }

        .scroll-mt-24 { scroll-margin-top: 6rem; }
        
        /* Article Item */
        .article-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 10px 16px; border-bottom: 1px dashed #e2e8f0;
            transition: background-color 0.3s;
        }
        .article-item:last-child { border-bottom: none; }
        .article-item:hover { background-color: #f8fafc; }

        /* Highlight Animation for Search Result */
        @keyframes highlight-pulse {
            0% { background-color: #fef08a; } /* yellow-200 */
            100% { background-color: transparent; }
        }
        .highlight-result { animation: highlight-pulse 2s ease-out; }

        /* Tooltip */
        .tooltip { position: relative; display: inline-block; }
        .tooltip .tooltiptext {
            visibility: hidden; width: 100px; background-color: #334155; color: #fff;
            text-align: center; border-radius: 4px; padding: 4px 0; position: absolute;
            z-index: 10; bottom: 130%; left: 50%; margin-left: -50px; opacity: 0;
            transition: opacity 0.3s; font-size: 10px;
        }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }

        /* Search Dropdown Styling */
        #search-results-dropdown {
            position: absolute; top: 100%; left: 0; right: 0;
            background: white; border: 1px solid #e2e8f0;
            border-radius: 0.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            max-height: 400px; overflow-y: auto; z-index: 60;
            margin-top: 0.5rem; display: none;
        }
        .search-result-item {
            padding: 0.75rem 1rem; border-bottom: 1px solid #f1f5f9;
            cursor: pointer; transition: background 0.2s;
        }
        .search-result-item:hover { background-color: #eff6ff; }
        .search-result-item:last-child { border-bottom: none; }
    </style>
</head>
<body id="top" class="text-slate-700 antialiased">

    <!-- Header -->
    <header class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-slate-200 h-20">
        <div class="max-w-6xl mx-auto px-4 h-full flex items-center justify-between gap-4">
            <div class="flex items-center gap-3 shrink-0">
                <img src="https://logo.kiotviet.vn/KiotViet-Logo-Horizontal.svg" alt="Logo" class="h-6">
                <span class="text-slate-300 text-xl">|</span>
                <span class="font-bold text-blue-700 text-sm uppercase hidden sm:block">KV1 Review</span>
            </div>
            
            <!-- Search Container -->
            <div class="flex-1 max-w-xl relative group">
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fa-solid fa-magnifying-glass text-slate-400"></i>
                    </span>
                    <input type="text" id="search-input" autocomplete="off" 
                        placeholder="Tìm kiếm nội dung (VD: Nhập hàng, Bán hàng...)" 
                        class="w-full pl-10 pr-4 py-2.5 rounded-lg border border-slate-200 bg-slate-50 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all shadow-sm">
                    <!-- Loading Spinner (Hidden by default) -->
                    <span id="search-loading" class="absolute inset-y-0 right-0 pr-3 flex items-center hidden">
                        <i class="fa-solid fa-circle-notch fa-spin text-blue-500"></i>
                    </span>
                </div>
                
                <!-- Result Counter -->
                <div id="search-count-display" class="absolute -bottom-6 right-0 text-xs font-semibold text-slate-500 hidden">
                    <!-- Text injected via JS -->
                </div>

                <!-- Dropdown Results -->
                <div id="search-results-dropdown" class="custom-scrollbar">
                    <!-- JS Injected Results -->
                </div>
            </div>

            <div class="shrink-0 w-8"></div> <!-- Spacer -->
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8 min-h-[80vh]">
        <div class="flex flex-col lg:flex-row gap-8">
            
            <!-- Sidebar Navigation -->
            <aside class="lg:w-1/4 hidden lg:block">
                <div class="sticky top-24 bg-white rounded-2xl p-4 shadow-sm border border-slate-200 overflow-y-auto max-h-[calc(100vh-120px)] custom-scrollbar">
                    <h3 class="font-bold text-slate-800 mb-2 px-3 text-sm uppercase tracking-wider">DANH MỤC</h3>
                    <hr class="border-slate-100 mb-2">
                    <nav id="retail-sidebar" class="space-y-1">
                        <!-- JS Generated Content -->
                    </nav>
                </div>
            </aside>

            <!-- Main Content -->
            <div class="lg:w-3/4 w-full">
                <div id="retail-content">
                    <!-- JS Generated Content -->
                </div>
            </div>
        </div>
    </main>

    <!-- Scroll Top Button -->
    <a id="scroll-to-top" href="#top" class="fixed bottom-6 right-6 hidden w-10 h-10 bg-white text-blue-600 border border-slate-200 rounded-full items-center justify-center shadow-lg hover:bg-slate-50 z-50 transition-all">
        <i class="fas fa-arrow-up"></i>
    </a>

    <!-- Scripts -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        // --- DỮ LIỆU ---
        const kv1Data = [
            {
                groupName: "KIẾN THỨC CƠ BẢN",
                sections: [
                    {
                        id: "buoi-1",
                        title: "Buổi 1",
                        desc: "Làm quen & Quy trình cơ bản",
                        topics: [
                            {
                                title: "Làm quen với KiotViet",
                                icon: "fa-flag-checkered",
                                articles: [
                                    { title: "Khởi tạo gian hàng", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-khoi-tao-gian-hang/khoi-tao-gian-hang/", courseLink: "" },
                                    { title: "Đăng ký tài khoản", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-khoi-tao-gian-hang/dang-ky-tai-khoan/", courseLink: "" },
                                    { title: "Tổng quan các bước làm quen", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-lam-quen-voi-kiotviet/tong-quan-cac-buoc-lam-quen-kiotviet/", courseLink: "" },
                                    { title: "Bước 1 - Thêm mới hàng hóa", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-lam-quen-voi-kiotviet/buoc-1-them-moi-hang-hoa/", courseLink: "https://example.com/course1" }, // Ví dụ có link khóa học
                                    { title: "Bước 2 - Nhập hàng", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-lam-quen-voi-kiotviet/buoc-2-nhap-hang/", courseLink: "" },
                                    { title: "Bước 3 - Bán hàng", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-lam-quen-voi-kiotviet/buoc-3-ban-hang/", courseLink: "" },
                                    { title: "Bước 4 - Trả hàng", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-lam-quen-voi-kiotviet/buoc-4-tra-hang/", courseLink: "" },
                                    { title: "Bước 5 - Quản lý công nợ", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-lam-quen-voi-kiotviet/buoc-5-quan-ly-cong-no/", courseLink: "" },
                                    { title: "Bước 6 - Theo dõi báo cáo", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-lam-quen-voi-kiotviet/buoc-6-theo-doi-bao-cao/", courseLink: "" },
                                    { title: "Tổng quan các nhóm giải pháp", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-lam-quen-voi-kiotviet/tong-quan-cac-nhom-giai-phap-kiotviet/", courseLink: "" }
                                ]
                            }
                        ]
                    },
                    {
                        id: "buoi-2",
                        title: "Buổi 2",
                        desc: "Các chủ đề FAQ thường gặp",
                        topics: [
                            {
                                title: "Phân quyền & Hàng hóa",
                                icon: "fa-users-gear",
                                articles: [
                                    { title: "Quản lý người dùng (Phân quyền)", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-thiet-lap/quan-ly-nguoi-dung/", courseLink: "" },
                                    { title: "Thêm mới hàng dịch vụ", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-hang-hoa/hang-dich-vu/", courseLink: "" },
                                    { title: "Tạo bảng giá sỉ", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-hang-hoa/thiet-lap-gia/", courseLink: "" }
                                ]
                            },
                            {
                                title: "Giao dịch (Nhập - Bán - Trả)",
                                icon: "fa-cart-shopping",
                                articles: [
                                    { title: "Nhập hàng sản phẩm mới", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-giao-dich/nhap-hang/", courseLink: "" },
                                    { title: "Thêm dòng, thiết lập giá nhập", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-giao-dich/chi-phi-nhap-hang/", courseLink: "" },
                                    { title: "Giá vốn trung bình", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-bao-cao/tong-quan-bao-cao-tai-chinh/#giavon", courseLink: "" },
                                    { title: "Bán hàng sản phẩm mới", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-ban-hang/ban-hang/", courseLink: "" },
                                    { title: "Tra cứu vị trí", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-tra-cuu-san-pham/tra-cuu-san-pham/", courseLink: "" },
                                    { title: "Lập phiếu thu công nợ", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-so-quy/so-quy#lap-phieu-thu", courseLink: "" },
                                    { title: "Bán hàng khi mất mạng", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-ban-hang/che-do-ban-hang-offline/", courseLink: "" },
                                    { title: "Thiết lập thời gian trả hàng", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-thiet-lap/thiet-lap-cua-hang/#GiaoDich", courseLink: "" },
                                    { title: "Trả hàng nhanh", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-tra-hang/tra-hang/", courseLink: "" }
                                ]
                            },
                            {
                                title: "Đối tác & Kho quỹ",
                                icon: "fa-warehouse",
                                articles: [
                                    { title: "Tạo nhóm khách VIP", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-khach-hang/khach-hang/#ThemNhomKhach", courseLink: "" },
                                    { title: "Tạo phiếu kiểm kho", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-hang-hoa/kiem-kho/", courseLink: "" },
                                    { title: "Sổ quỹ: Tạo phiếu thu - chi", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-so-quy/so-quy", courseLink: "" }
                                ]
                            }
                        ]
                    },
                    {
                        id: "buoi-3",
                        title: "Buổi 3",
                        desc: "Thao tác luồng cơ bản 6 bước trên App KiotViet - Phần cứng",
                        topics: [
                            {
                                title: "Thao tác luồng cơ bản 6 bước trên Mobile App KiotViet",
                                icon: "fa-mobile-screen",
                                articles: [
                                    { title: "Thao tác trên Mobile App KiotViet", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-mobile-app-ban-hang/ban-hang/", courseLink: "" }
                                ]
                            },
                            {
                                title: "Phần cứng",
                                icon: "fa-print",
                                articles: [
                                    { title: "Máy POS Android", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-thiet-bi-phan-cung/may-pos-android/", courseLink: "" },
                                    { title: "Máy in hóa đơn", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-thiet-bi-phan-cung/may-in-hoa-don/", courseLink: "" },
                                    { title: "Máy in tem mã", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-thiet-bi-phan-cung/may-in-tem-nhan/", courseLink: "" },
                                    { title: "Máy quét mã vạch", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-thiet-bi-phan-cung/may-quet-ma-vach/", courseLink: "" },
                                    { title: "Màn hiển thị QR", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-thiet-bi-phan-cung/man-hien-thi-qr/", courseLink: "" },
                                    { title: "Ngăn kéo đựng tiền", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-thiet-bi-phan-cung/ngan-keo-dung-tien/", courseLink: "" }
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                groupName: "KIẾN THỨC NÂNG CAO",
                sections: [
                    {
                        id: "toi-uu-van-hanh",
                        title: "Tối ưu Vận hành",
                        desc: "Giao vận & Hóa đơn điện tử",
                        topics: [
                            {
                                title: "Giao vận",
                                icon: "fa-truck-fast",
                                articles: [
                                    { title: "Giao hàng", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-giao-van/giao-hang/", courseLink: "" }
                                ]
                            },
                            {
                                title: "Hóa đơn điện tử",
                                icon: "fa-file-invoice-dollar",
                                articles: [
                                    { title: "Quy trình triển khai HĐĐT", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-hoa-don-dien-tu/quy-trinh-trien-khai-hoa-don-dien-tu/", courseLink: "" },
                                    { title: "Đăng ký Chữ ký số IntrustCA", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-hoa-don-dien-tu/dang-ky-chu-ky-so-kiotviet-intrustca/", courseLink: "" },
                                    { title: "Thiết lập Thuế VAT", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-hoa-don-dien-tu/thiet-lap-thue-vat/", courseLink: "" },
                                    { title: "Đăng ký HĐĐT KiotViet eInvoice", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-hoa-don-dien-tu/dang-ky-hoa-don-dien-tu-kiotviet-einvoice/", courseLink: "" },
                                    { title: "Thiết lập chữ ký số", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-hoa-don-dien-tu/thiet-lap-chu-ky-so-tren-kiotviet-einvoice/", courseLink: "" },
                                    { title: "Lập Tờ khai đăng ký HĐĐT", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-hoa-don-dien-tu/lap-to-khai-dang-ky-hddt-tren-kiotviet-einvoice/", courseLink: "" },
                                    { title: "Tạo mẫu HĐĐT", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-hoa-don-dien-tu/tao-mau-hoa-don-dien-tu-tren-kiotviet-einvoice/", courseLink: "" },
                                    { title: "Kết nối PM HĐĐT khác", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-hoa-don-dien-tu/ket-noi-phan-mem-hoa-don-dien-tu/", courseLink: "" },
                                    { title: "Phát hành HĐĐT", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-hoa-don-dien-tu/phat-hanh-hoa-don-dien-tu-tren-kiotviet/", courseLink: "" },
                                    { title: "Quản lý HĐĐT", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-hoa-don-dien-tu/quan-ly-hoa-don-dien-tu-tren-kiotviet-einvoice/", courseLink: "" },
                                    { title: "Sổ kế toán & Tờ khai thuế", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-hoa-don-dien-tu/so-ke-toan/", courseLink: "" },
                                    { title: "Giá bán sau thuế", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-hoa-don-dien-tu/gia-ban-sau-thue/", courseLink: "" },
                                    { title: "Xử lý lỗi tờ khai thường gặp", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-hoa-don-dien-tu/xu-ly-loi-to-khai-dang-ky-hddt-thuong-gap/", courseLink: "" },
                                    { title: "Xử lý lỗi HĐĐT theo mã lỗi", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-hoa-don-dien-tu/xu-ly-loi-hddt-theo-ma-loi/", courseLink: "" }
                                ]
                            }
                        ]
                    },
                    {
                        id: "toi-uu-quan-ly",
                        title: "Tối ưu Quản lý",
                        desc: "Hàng hóa & Thiết lập nâng cao",
                        topics: [
                            {
                                title: "Hàng hóa & Giao dịch",
                                icon: "fa-boxes-stacked",
                                articles: [
                                    { title: "Hàng hóa Lô - HSD", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-hang-hoa/hang-hoa-lo-han-su-dung", courseLink: "" },
                                    { title: "VAT Nhập hàng", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-giao-dich/vat-nhap-hang/", courseLink: "" },
                                    { title: "Hóa đơn đầu vào", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-giao-dich/hoa-don-dau-vao/", courseLink: "" }
                                ]
                            },
                            {
                                title: "Nhân viên & Thiết lập",
                                icon: "fa-gears",
                                articles: [
                                    { title: "Quản lý chấm công", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-nhan-vien/quan-ly-cham-cong/", courseLink: "" },
                                    { title: "Quản lý mẫu in", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-thiet-lap/quan-ly-mau-in/", courseLink: "" }
                                ]
                            }
                        ]
                    },
                    {
                        id: "thuc-day-doanh-thu",
                        title: "Thúc đẩy Doanh thu",
                        desc: "Marketing & Đa kênh",
                        topics: [
                            {
                                title: "Kênh bán hàng mở rộng",
                                icon: "fa-globe",
                                articles: [
                                    { title: "KiotViet Web (Website)", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-kiotviet-web/kiotviet-web", courseLink: "" },
                                    { title: "Kết nối Sàn TMĐT", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-san-tmdt/ket-noi-san-tmdt/", courseLink: "" }
                                ]
                            },
                            {
                                title: "Công cụ Marketing",
                                icon: "fa-bullhorn",
                                articles: [
                                    { title: "Chương trình Khuyến mại", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-khuyen-mai/khuyen-mai/", courseLink: "" },
                                    { title: "Voucher", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-voucher/voucher/", courseLink: "" },
                                    { title: "Coupon", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-coupon/coupon/", courseLink: "" },
                                    { title: "Tích điểm", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-tich-diem/tich-diem/", courseLink: "" },
                                    { title: "Chăm sóc khách hàng (Zalo OA)", guideLink: "https://www.kiotviet.vn/huong-dan-su-dung-kiotviet/retail-cskh/tin-nhan-zalo-oa/", courseLink: "" }
                                ]
                            }
                        ]
                    }
                ]
            }
        ];

        document.addEventListener('DOMContentLoaded', function () {
            AOS.init();
            renderContent();
            
            // --- XỬ LÝ TÌM KIẾM NÂNG CAO ---
            const searchInput = document.getElementById('search-input');
            const searchDropdown = document.getElementById('search-results-dropdown');
            const searchCountDisplay = document.getElementById('search-count-display');
            const searchLoading = document.getElementById('search-loading');

            // Hàm xóa dấu tiếng Việt để tìm kiếm tốt hơn
            function removeVietnameseTones(str) {
                str = str.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g,"a"); 
                str = str.replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g,"e"); 
                str = str.replace(/ì|í|ị|ỉ|ĩ/g,"i"); 
                str = str.replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g,"o"); 
                str = str.replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g,"u"); 
                str = str.replace(/ỳ|ý|ỵ|ỷ|ỹ/g,"y"); 
                str = str.replace(/đ/g,"d");
                str = str.replace(/À|Á|Ạ|Ả|Ã|Â|Ầ|Ấ|Ậ|Ẩ|Ẫ|Ă|Ằ|Ắ|Ặ|Ẳ|Ẵ/g, "A");
                str = str.replace(/È|É|Ẹ|Ẻ|Ẽ|Ê|Ề|Ế|Ệ|Ể|Ễ/g, "E");
                str = str.replace(/Ì|Í|Ị|Ỉ|Ĩ/g, "I");
                str = str.replace(/Ò|Ó|Ọ|Ỏ|Õ|Ô|Ồ|Ố|Ộ|Ổ|Ỗ|Ơ|Ờ|Ớ|Ợ|Ở|Ỡ/g, "O");
                str = str.replace(/Ù|Ú|Ụ|Ủ|Ũ|Ư|Ừ|Ứ|Ự|Ử|Ữ/g, "U");
                str = str.replace(/Ỳ|Ý|Ỵ|Ỷ|Ỹ/g, "Y");
                str = str.replace(/Đ/g, "D");
                return str;
            }

            searchInput.addEventListener('input', function(e) {
                const term = e.target.value;
                const normalizedTerm = removeVietnameseTones(term).toLowerCase();
                
                // Reset UI
                searchDropdown.innerHTML = '';
                searchDropdown.style.display = 'none';
                searchCountDisplay.classList.add('hidden');
                
                // Nếu chưa nhập ký tự nào thì dừng
                if (term.length === 0) return;

                // Hiển thị loading (giả lập)
                searchLoading.classList.remove('hidden');

                // Tìm kiếm logic
                setTimeout(() => {
                    const matches = [];
                    
                    kv1Data.forEach(group => {
                        group.sections.forEach(section => {
                            section.topics.forEach(topic => {
                                topic.articles.forEach(article => {
                                    const titleNormalized = removeVietnameseTones(article.title).toLowerCase();
                                    if (titleNormalized.includes(normalizedTerm)) {
                                        matches.push({
                                            title: article.title,
                                            topic: topic.title,
                                            section: section.title,
                                            elementId: `article-${removeVietnameseTones(article.title).replace(/\s+/g, '-').toLowerCase()}` // ID ảo để scroll
                                        });
                                    }
                                });
                            });
                        });
                    });

                    searchLoading.classList.add('hidden');

                    // Cập nhật số lượng kết quả
                    if (matches.length > 0) {
                        searchCountDisplay.innerText = `Tìm thấy ${matches.length} kết quả`;
                        searchCountDisplay.classList.remove('hidden');
                        
                        // Render Dropdown
                        matches.forEach(match => {
                            const div = document.createElement('div');
                            div.className = 'search-result-item';
                            div.innerHTML = `
                                <div class="font-medium text-slate-700 text-sm">${match.title}</div>
                                <div class="text-xs text-slate-400 mt-1">${match.section} > ${match.topic}</div>
                            `;
                            
                            // Sự kiện click điều hướng
                            div.addEventListener('click', () => {
                                // Tìm element thật trong DOM
                                const allArticles = document.querySelectorAll('.article-item span');
                                for (let span of allArticles) {
                                    if (span.innerText === match.title) {
                                        const articleRow = span.closest('.article-item');
                                        
                                        // Scroll tới
                                        articleRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                        
                                        // Highlight effect
                                        articleRow.classList.add('highlight-result');
                                        setTimeout(() => {
                                            articleRow.classList.remove('highlight-result');
                                        }, 2000);
                                        
                                        // Ẩn dropdown sau khi chọn
                                        searchDropdown.style.display = 'none';
                                        break;
                                    }
                                }
                            });
                            
                            searchDropdown.appendChild(div);
                        });
                        
                        searchDropdown.style.display = 'block';
                    } else {
                        searchCountDisplay.innerText = `Không tìm thấy kết quả nào`;
                        searchCountDisplay.classList.remove('hidden');
                    }
                }, 100); // Debounce nhẹ 100ms
            });

            // Ẩn dropdown khi click ra ngoài
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !searchDropdown.contains(e.target)) {
                    searchDropdown.style.display = 'none';
                }
            });

            // Scroll Top Logic
            window.onscroll = () => {
                document.getElementById('scroll-to-top').classList.toggle('hidden', window.scrollY < 300);
                document.getElementById('scroll-to-top').classList.toggle('flex', window.scrollY >= 300);
            };
        });

        function renderContent() {
            const sidebar = document.getElementById('retail-sidebar');
            const content = document.getElementById('retail-content');
            let sidebarHtml = '';
            let contentHtml = '';

            kv1Data.forEach((group) => {
                sidebarHtml += `<div class="sidebar-group-title">${group.groupName}</div>`;

                group.sections.forEach((section) => {
                    sidebarHtml += `
                        <a href="#${section.id}" class="sidebar-link">
                            ${section.title}
                        </a>
                    `;

                    contentHtml += `
                        <div id="${section.id}" class="scroll-mt-24 mb-16">
                            <div class="flex flex-col gap-1 mb-6 pb-4 border-b border-slate-200">
                                <span class="text-xs font-bold text-blue-600 uppercase tracking-widest">${group.groupName}</span>
                                <h2 class="text-3xl font-bold text-slate-800">${section.title}</h2>
                                <p class="text-slate-500">${section.desc}</p>
                            </div>
                            <div class="grid grid-cols-1 gap-6">
                    `;

                    section.topics.forEach(topic => {
                        const articlesHtml = topic.articles.map(article => `
                            <div class="article-item group/item">
                                <span class="text-sm font-medium text-slate-700">${article.title}</span>
                                <div class="flex items-center gap-2">
                                    ${article.guideLink ? 
                                        `<a href="${article.guideLink}" target="_blank" class="px-2 py-1 text-xs font-bold text-blue-600 bg-blue-50 hover:bg-blue-100 rounded border border-blue-200 transition-colors flex items-center gap-1" title="Hướng dẫn sử dụng">
                                            <i class="fa-solid fa-book-open"></i> HDSD
                                        </a>` : ''
                                    }
                                    
                                    <!-- Button Khóa học -->
                                    ${article.courseLink ? 
                                        `<a href="${article.courseLink}" target="_blank" class="px-2 py-1 text-xs font-bold text-white bg-orange-500 hover:bg-orange-600 rounded border border-orange-600 transition-colors flex items-center gap-1" title="Vào khóa học">
                                            <i class="fa-solid fa-chalkboard-user"></i> Khóa học
                                        </a>` : 
                                        `<div class="tooltip">
                                            <span class="px-2 py-1 text-xs font-bold text-gray-400 bg-gray-100 rounded border border-gray-200 cursor-not-allowed flex items-center gap-1 opacity-60">
                                                <i class="fa-solid fa-chalkboard-user"></i> Khóa học
                                            </span>
                                            <span class="tooltiptext">Đang cập nhật</span>
                                        </div>`
                                    }
                                </div>
                            </div>
                        `).join('');

                        contentHtml += `
                            <div class="topic-card bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden hover:shadow-md transition-shadow">
                                <div class="bg-slate-50 p-4 border-b border-slate-100 flex items-center gap-3">
                                    <div class="w-8 h-8 rounded bg-white text-blue-600 flex items-center justify-center shadow-sm border border-slate-200">
                                        <i class="fa-solid ${topic.icon}"></i>
                                    </div>
                                    <h3 class="font-bold text-base text-slate-700">${topic.title}</h3>
                                </div>
                                <div class="flex flex-col">
                                    ${articlesHtml}
                                </div>
                            </div>
                        `;
                    });

                    contentHtml += `</div></div>`;
                });
            });

            sidebar.innerHTML = sidebarHtml;
            content.innerHTML = contentHtml;

            // Scroll Spy
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.getAttribute('id');
                        document.querySelectorAll('.sidebar-link').forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('href') === `#${id}`) {
                                link.classList.add('active');
                            }
                        });
                    }
                });
            }, { rootMargin: '-20% 0px -60% 0px' });

            document.querySelectorAll('[id]').forEach(section => {
                if(section.id.includes('buoi') || section.id.includes('toi-uu') || section.id.includes('thuc-day')) observer.observe(section);
            });
        }
    </script>
</body>
</html>
