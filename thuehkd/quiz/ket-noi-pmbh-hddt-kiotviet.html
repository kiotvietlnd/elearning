<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Learning: Kết nối HĐĐT - KiotViet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f9ff; overflow-x: hidden; }
        ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-thumb { background: #93c5fd; border-radius: 3px; }
        
        /* Background */
        .soft-glow-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -10; background: linear-gradient(135deg, #ffffff 0%, #e0f2fe 50%, #dcfce7 100%); }
        .soft-glow-background .shape { position: absolute; filter: blur(120px); opacity: 0.6; }
        .soft-glow-background .shape1 { height: 300px; width: 300px; background: #bae6fd; border-radius: 50%; top: -50px; left: -50px; animation: moveInCircle 25s ease-in-out infinite; }
        .soft-glow-background .shape2 { height: 350px; width: 350px; background: #bbf7d0; border-radius: 50%; bottom: -50px; right: -50px; animation: moveVertical 30s ease-in-out infinite; }
        @keyframes moveInCircle { 0% { transform: rotate(0deg); } 50% { transform: rotate(180deg); } 100% { transform: rotate(360deg); } }
        @keyframes moveVertical { 0% { transform: translateY(-20%); } 50% { transform: translateY(20%); } 100% { transform: translateY(-20%); } }

        /* UI Elements */
        .nav-link { transition: all 0.2s ease; border-left: 3px solid transparent; }
        .nav-link:hover { color: #2563eb; background: rgba(255, 255, 255, 0.6); }
        .nav-link.active { color: #1e3a8a; border-left: 3px solid #2563eb; background: #eff6ff; font-weight: 600; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }

        /* Card Flip - Fixed & Improved */
        .perspective-1000 { perspective: 1000px; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; }
        .card-inner.flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; top: 0; left: 0; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); background-color: white; }
        .card-back { transform: rotateY(180deg); }
        .type-card { transition: all 0.2s ease; }
        .type-card:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); border-color: #93c5fd; }

        /* Chat */
        .chat-bubble { max-width: 85%; padding: 0.75rem 1rem; border-radius: 1rem; position: relative; font-size: 0.9rem; line-height: 1.5; }
        .chat-bubble-customer { background-color: #f1f5f9; color: #334155; border-bottom-left-radius: 0.25rem; margin-left: 2.5rem; }
        .chat-bubble-consultant { background-color: #eff6ff; color: #1e40af; border-bottom-right-radius: 0.25rem; margin-right: 2.5rem; border: 1px solid #dbeafe; }
        
        /* Mobile Sidebar Overlay */
        #mobile-overlay { transition: opacity 0.3s ease; }
        #sidebar { transition: transform 0.3s ease; }
        .sidebar-open #sidebar { transform: translateX(0); }
        .sidebar-open #mobile-overlay { opacity: 1; pointer-events: auto; }
        .sidebar-closed #sidebar { transform: translateX(-100%); }
        .sidebar-closed #mobile-overlay { opacity: 0; pointer-events: none; }
        @media (min-width: 768px) { .sidebar-closed #sidebar { transform: translateX(0); } }

        /* Certificate */
        .certificate-container { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .watermark { position: absolute; top: 50%; left: 60%; transform: translate(-50%, -50%) rotate(-30deg); font-size: 6rem; font-weight: 900; color: rgba(200, 0, 0, 0.05); pointer-events: none; z-index: 0; }
        [title] { cursor: help; }
        
        /* Custom Scrollbar for Card Content */
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        
        /* Animation */
        .animate-fade-in-up { animation: fadeInUp 0.5s ease-out; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="text-slate-700 antialiased h-screen flex flex-col overflow-hidden sidebar-closed" id="app-body">
    <div class="soft-glow-background"><div class="shape shape1"></div><div class="shape shape2"></div></div>

    <!-- Header -->
    <header class="sticky top-0 z-40 bg-white/80 backdrop-blur-md border-b border-white/50 h-16 shadow-sm flex-shrink-0">
        <div class="max-w-7xl mx-auto px-4 h-full flex items-center justify-between">
            <div class="flex items-center gap-4">
                <button onclick="toggleSidebar()" class="md:hidden text-slate-600 hover:text-blue-600 p-1">
                    <i class="fa-solid fa-bars text-xl"></i>
                </button>
                <a href="https://kiotvietlnd.github.io/elearning/" class="flex items-center gap-2 select-none">
                    <img src="https://logo.kiotviet.vn/KiotViet-Logo-Horizontal.svg" alt="Logo" class="h-6">
                    <span class="hidden sm:inline font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-700 to-green-700 text-base uppercase">E-LEARNING</span>
                </a>
            </div>
            <!-- Right Buttons - No Back Button -->
            <div class="flex items-center gap-2 md:gap-3">
                <a href="https://www.kiotviet.vn/ho-tro" target="_blank" class="hidden md:flex items-center gap-2 text-xs sm:text-sm font-bold text-white bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded-lg shadow-sm transition-colors">
                    <i class="fa-solid fa-book-open"></i> Kho Tài liệu HDSD
                </a>
                <a href="https://www.youtube.com/@HDSDPhanmemKiotViet" target="_blank" class="hidden md:flex items-center gap-2 text-xs sm:text-sm font-bold text-white bg-red-600 hover:bg-red-700 px-3 py-2 rounded-lg shadow-sm transition-colors">
                    <i class="fa-brands fa-youtube"></i> Kho Video HDSD
                </a>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="flex-1 flex overflow-hidden relative">
        <div id="mobile-overlay" class="fixed inset-0 bg-black/20 z-40 md:hidden" onclick="toggleSidebar()"></div>

        <!-- Sidebar -->
        <aside id="sidebar" class="absolute inset-y-0 left-0 z-50 w-72 bg-white/95 backdrop-blur-xl border-r border-white/60 shadow-2xl md:static md:bg-white/60 md:shadow-lg md:rounded-r-2xl flex flex-col transform transition-transform duration-300">
            <div class="p-5 border-b border-slate-100 flex-shrink-0">
                <div class="flex justify-between items-start mb-4 md:hidden">
                     <img src="https://logo.kiotviet.vn/KiotViet-Logo-Horizontal.svg" alt="Logo" class="h-5">
                     <button onclick="toggleSidebar()" class="text-slate-400"><i class="fa-solid fa-xmark text-xl"></i></button>
                </div>
                <h2 class="font-black text-blue-800 text-lg leading-tight mb-2 uppercase">KẾT NỐI QLBH & HĐĐT</h2>
                <h3 class="font-bold text-blue-900 text-sm uppercase tracking-wider mb-2">MỤC LỤC BÀI HỌC</h3>
                <div class="w-full bg-slate-200 rounded-full h-1.5"><div id="totalProgress" class="bg-gradient-to-r from-blue-500 to-green-500 h-1.5 rounded-full transition-all duration-500" style="width: 0%"></div></div>
                <div class="flex justify-between mt-1 text-[10px] text-slate-500 font-medium"><span id="completedCount">0/0</span><span>Hoàn thành</span></div>
            </div>
            <nav class="flex-1 overflow-y-auto p-3 space-y-1 custom-scrollbar">
                 <button onclick="switchTab('cheatsheet')" id="nav-cheatsheet" class="nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3 active"><i class="fa-solid fa-bolt text-yellow-500 w-5 text-center"></i><span class="font-bold text-sm">Tóm tắt nhanh</span></button>
                 <div class="mt-4 mb-2 px-3 text-[10px] font-bold text-slate-400 uppercase">Nội dung</div>
                 
                 <!-- DYNAMIC TABS PLACEHOLDER -->
                 <div id="dynamic-nav-container">
                    <button onclick="switchTab('part1')" id="nav-part1" class="nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3"><i class="fa-solid fa-circle-info text-blue-500 w-5 text-center"></i><span class="font-bold text-sm">1. Tổng quan & Lợi ích</span></button>
                    <button onclick="switchTab('part2')" id="nav-part2" class="nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3"><i class="fa-solid fa-sliders text-indigo-500 w-5 text-center"></i><span class="font-bold text-sm">2. Thao tác Kết nối</span></button>
                    <button onclick="switchTab('part3')" id="nav-part3" class="nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3"><i class="fa-solid fa-gears text-teal-500 w-5 text-center"></i><span class="font-bold text-sm">3. Thiết lập Cấu hình</span></button>
                    <button onclick="switchTab('part4')" id="nav-part4" class="nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3"><i class="fa-solid fa-triangle-exclamation text-rose-500 w-5 text-center"></i><span class="font-bold text-sm">4. Tình huống Nâng cao</span></button>
                 </div>
                 
                 <div class="mt-4 mb-2 px-3 text-[10px] font-bold text-slate-400 uppercase">Ôn tập</div>
                 <button onclick="switchTab('summary')" id="nav-summary" class="nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3"><i class="fa-solid fa-table-columns text-purple-500 w-5 text-center"></i><span class="font-bold text-sm">Bảng so sánh</span></button>
                 <button onclick="switchTab('game')" id="nav-game" class="nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3"><i class="fa-solid fa-gamepad text-orange-500 w-5 text-center"></i><span class="font-bold text-sm">Quiz Game</span></button>
            </nav>
            <div class="p-4 bg-slate-50 border-t border-slate-100 text-center text-[10px] text-slate-400">© KiotViet Learning & Development Department</div>
        </aside>

        <!-- Content Area -->
        <main class="flex-1 overflow-y-auto scroll-smooth p-4 md:p-8" id="contentArea">
            <div class="max-w-5xl mx-auto pb-20" id="lessonContainer"> 
                <!-- CHEATSHEET CONTENT -->
                <div id="tab-cheatsheet" class="tab-content block animate-fade-in-up">
                    <div class="mb-8 text-center">
                         <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider border border-blue-200">Đào tạo Sản phẩm</span>
                        <h1 class="text-2xl md:text-3xl font-black text-blue-900 mt-4 leading-tight">KẾT NỐI QLBH & HÓA ĐƠN ĐIỆN TỬ</h1>
                        <p class="text-slate-500 mt-2 italic text-sm md:text-base">Giải pháp đồng bộ hóa quy trình bán hàng và xuất hóa đơn trên một nền tảng duy nhất.</p>
                    </div>

                    <!-- 3 Lợi ích -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600 mb-3"><i class="fa-solid fa-bolt text-xl"></i></div>
                            <h3 class="font-bold text-slate-800 mb-1">Xử lý tức thì</h3>
                            <p class="text-xs text-slate-500">Dữ liệu đồng bộ ngay lập tức, không còn độ trễ giữa bán hàng và lập hóa đơn.</p>
                        </div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition">
                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center text-green-600 mb-3"><i class="fa-solid fa-clock text-xl"></i></div>
                            <h3 class="font-bold text-slate-800 mb-1">Linh hoạt 24/7</h3>
                            <p class="text-xs text-slate-500">Chủ động phát hành hóa đơn bất cứ lúc nào, kể cả ngoài giờ hành chính.</p>
                        </div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition">
                            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600 mb-3"><i class="fa-solid fa-wand-magic-sparkles text-xl"></i></div>
                            <h3 class="font-bold text-slate-800 mb-1">Tối giản thao tác</h3>
                            <p class="text-xs text-slate-500">Không yêu cầu cắm USB Token cho từng hóa đơn lẻ trên máy tính tiền.</p>
                        </div>
                    </div>

                    <!-- Quy trình 4 bước -->
                    <div class="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden mb-8">
                        <div class="bg-blue-600 px-6 py-4 flex items-center gap-3">
                            <i class="fa-solid fa-list-check text-white text-xl"></i>
                            <h2 class="text-white font-bold text-lg uppercase">Quy trình Kết nối (4 Bước)</h2>
                        </div>
                        <div class="p-6 relative">
                            <!-- Vertical Line -->
                            <div class="absolute left-9 top-6 bottom-6 w-0.5 bg-slate-200 hidden md:block"></div>
                            
                            <div class="space-y-6">
                                <!-- Step 1 -->
                                <div class="flex flex-col md:flex-row gap-4 relative">
                                    <div class="flex-shrink-0 w-12 h-12 bg-white border-4 border-blue-100 rounded-full flex items-center justify-center font-black text-blue-600 z-10 text-lg shadow-sm">1</div>
                                    <div class="flex-1 bg-slate-50 p-4 rounded-xl border border-slate-100">
                                        <h4 class="font-bold text-blue-900 mb-1">Khởi tạo Kết nối</h4>
                                        <p class="text-sm text-slate-600">Vào <strong>Thiết lập</strong> <i class="fa-solid fa-gear text-xs text-slate-400"></i> → <strong>Hóa đơn điện tử</strong>. Bật tính năng & chọn <strong>Nhà cung cấp KiotViet</strong>.</p>
                                    </div>
                                </div>
                                <!-- Step 2 -->
                                <div class="flex flex-col md:flex-row gap-4 relative">
                                    <div class="flex-shrink-0 w-12 h-12 bg-white border-4 border-blue-100 rounded-full flex items-center justify-center font-black text-blue-600 z-10 text-lg shadow-sm">2</div>
                                    <div class="flex-1 bg-slate-50 p-4 rounded-xl border border-slate-100">
                                        <h4 class="font-bold text-blue-900 mb-1">Xác minh Mã số thuế</h4>
                                        <p class="text-sm text-slate-600">Nhập <strong>Mã số thuế (MST)</strong> của cửa hàng. Hệ thống sẽ tự động kiểm tra hồ sơ.</p>
                                        <div class="mt-2 text-xs bg-yellow-50 text-yellow-700 px-2 py-1 rounded inline-block border border-yellow-100"><i class="fa-solid fa-triangle-exclamation mr-1"></i>Đảm bảo MST đã đăng ký dịch vụ HĐĐT.</div>
                                    </div>
                                </div>
                                <!-- Step 3 -->
                                <div class="flex flex-col md:flex-row gap-4 relative">
                                    <div class="flex-shrink-0 w-12 h-12 bg-white border-4 border-blue-100 rounded-full flex items-center justify-center font-black text-blue-600 z-10 text-lg shadow-sm">3</div>
                                    <div class="flex-1 bg-slate-50 p-4 rounded-xl border border-slate-100">
                                        <h4 class="font-bold text-blue-900 mb-1">Xác thực Bảo mật (OTP)</h4>
                                        <p class="text-sm text-slate-600">Nhập mã <strong>OTP</strong> gửi về SĐT chủ gian hàng để xác thực quyền sở hữu.</p>
                                    </div>
                                </div>
                                <!-- Step 4 -->
                                <div class="flex flex-col md:flex-row gap-4 relative">
                                    <div class="flex-shrink-0 w-12 h-12 bg-white border-4 border-blue-100 rounded-full flex items-center justify-center font-black text-blue-600 z-10 text-lg shadow-sm">4</div>
                                    <div class="flex-1 bg-slate-50 p-4 rounded-xl border border-slate-100">
                                        <h4 class="font-bold text-blue-900 mb-1">Cấu hình Phát hành</h4>
                                        <p class="text-sm text-slate-600">Chọn <strong>Mẫu hóa đơn</strong> (VD: C26MHT) và tùy chọn chế độ <strong>Tự động phát hành</strong>.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB 1: TỔNG QUAN -->
                <div id="tab-part1" class="tab-content hidden animate-fade-in-up">
                    <h2 class="text-xl font-bold text-blue-900 mb-4 border-l-4 border-blue-500 pl-3">1. Tổng quan & Lợi ích</h2>
                    
                    <!-- Chat Dialogue -->
                    <div class="mb-8 space-y-4">
                        <div class="flex items-end">
                            <div class="w-8 h-8 rounded-full bg-slate-300 flex items-center justify-center text-slate-600 mr-2 flex-shrink-0"><i class="fa-solid fa-user"></i></div>
                            <div class="chat-bubble chat-bubble-customer">Anh ngại dùng Hóa đơn điện tử lắm, bán hàng bên này xong lại phải qua phần mềm khác nhập liệu, vừa lâu vừa dễ sai.</div>
                        </div>
                        <div class="flex items-end justify-end">
                            <div class="chat-bubble chat-bubble-consultant">Không đâu anh ơi! Với tính năng Kết nối của KiotViet, anh bán hàng xong là hóa đơn tự động sang hệ thống Thuế ngay lập tức, không cần nhập lại đâu ạ.</div>
                            <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white ml-2 flex-shrink-0"><img src="https://files.kiotviet.vn/recruit/2020/09/08/icon-kv.png" class="w-6 h-6 object-contain brightness-0 invert"></div>
                        </div>
                    </div>

                    <!-- Flashcards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Card 1 -->
                        <div id="card-container-1" class="perspective-1000 h-[340px] md:h-[300px] w-full cursor-pointer group">
                            <div class="card-inner w-full h-full relative">
                                <div class="card-face p-6 flex flex-col items-center justify-center border-2 border-slate-100 text-center type-card">
                                    <div class="absolute top-4 left-4"><span class="bg-blue-100 text-blue-800 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Nhận định 1</span></div>
                                    <i class="fa-solid fa-arrows-rotate text-4xl text-blue-200 mb-4"></i>
                                    <h3 class="font-bold text-lg text-slate-800 mb-2">Phải nhập liệu 2 lần trên 2 phần mềm riêng biệt.</h3>
                                    <p class="text-sm text-slate-500 mb-6">Theo bạn, nhận định này là:</p>
                                    <div class="flex gap-4 w-full px-4">
                                        <button onclick="flipCard(1, true)" class="flex-1 bg-green-50 text-green-700 py-2 rounded-lg font-bold border border-green-200 hover:bg-green-100 transition">ĐÚNG</button>
                                        <button onclick="flipCard(1, false)" class="flex-1 bg-red-50 text-red-700 py-2 rounded-lg font-bold border border-red-200 hover:bg-red-100 transition">SAI</button>
                                    </div>
                                </div>
                                <div class="card-face card-back"></div> <!-- Generated by JS -->
                            </div>
                        </div>

                        <!-- Card 2 -->
                        <div id="card-container-2" class="perspective-1000 h-[340px] md:h-[300px] w-full cursor-pointer group">
                            <div class="card-inner w-full h-full relative">
                                <div class="card-face p-6 flex flex-col items-center justify-center border-2 border-slate-100 text-center type-card">
                                    <div class="absolute top-4 left-4"><span class="bg-blue-100 text-blue-800 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Nhận định 2</span></div>
                                    <i class="fa-solid fa-key text-4xl text-blue-200 mb-4"></i>
                                    <h3 class="font-bold text-lg text-slate-800 mb-2">Bắt buộc ký số bằng USB Token cho từng hóa đơn lẻ.</h3>
                                    <p class="text-sm text-slate-500 mb-6">Theo bạn, nhận định này là:</p>
                                    <div class="flex gap-4 w-full px-4">
                                        <button onclick="flipCard(2, true)" class="flex-1 bg-green-50 text-green-700 py-2 rounded-lg font-bold border border-green-200 hover:bg-green-100 transition">ĐÚNG</button>
                                        <button onclick="flipCard(2, false)" class="flex-1 bg-red-50 text-red-700 py-2 rounded-lg font-bold border border-red-200 hover:bg-red-100 transition">SAI</button>
                                    </div>
                                </div>
                                <div class="card-face card-back"></div> <!-- Generated by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB 2: THAO TÁC KẾT NỐI -->
                <div id="tab-part2" class="tab-content hidden animate-fade-in-up">
                    <h2 class="text-xl font-bold text-blue-900 mb-4 border-l-4 border-blue-500 pl-3">2. Thao tác Kết nối</h2>
                    
                    <div class="mb-8 space-y-4">
                        <div class="flex items-end">
                            <div class="w-8 h-8 rounded-full bg-slate-300 flex items-center justify-center text-slate-600 mr-2 flex-shrink-0"><i class="fa-solid fa-user"></i></div>
                            <div class="chat-bubble chat-bubble-customer">Để kết nối chắc phức tạp lắm, phải chờ đội kỹ thuật xuống cài đặt à em?</div>
                        </div>
                        <div class="flex items-end justify-end">
                            <div class="chat-bubble chat-bubble-consultant">Dạ thao tác đơn giản lắm ạ. Anh chỉ cần chuẩn bị Mã số thuế và Điện thoại để nhận OTP là tự làm được ngay trong 2 phút thôi.</div>
                            <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white ml-2 flex-shrink-0"><img src="https://files.kiotviet.vn/recruit/2020/09/08/icon-kv.png" class="w-6 h-6 object-contain brightness-0 invert"></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Card 3 -->
                        <div id="card-container-3" class="perspective-1000 h-[340px] md:h-[300px] w-full cursor-pointer group">
                            <div class="card-inner w-full h-full relative">
                                <div class="card-face p-6 flex flex-col items-center justify-center border-2 border-slate-100 text-center type-card">
                                    <div class="absolute top-4 left-4"><span class="bg-blue-100 text-blue-800 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Nhận định 3</span></div>
                                    <i class="fa-solid fa-users-gear text-4xl text-blue-200 mb-4"></i>
                                    <h3 class="font-bold text-lg text-slate-800 mb-2">Bất kỳ nhân viên nào cũng có thể tự ý thực hiện kết nối.</h3>
                                    <p class="text-sm text-slate-500 mb-6">Theo bạn, nhận định này là:</p>
                                    <div class="flex gap-4 w-full px-4">
                                        <button onclick="flipCard(3, true)" class="flex-1 bg-green-50 text-green-700 py-2 rounded-lg font-bold border border-green-200 hover:bg-green-100 transition">ĐÚNG</button>
                                        <button onclick="flipCard(3, false)" class="flex-1 bg-red-50 text-red-700 py-2 rounded-lg font-bold border border-red-200 hover:bg-red-100 transition">SAI</button>
                                    </div>
                                </div>
                                <div class="card-face card-back"></div>
                            </div>
                        </div>

                        <!-- Card 4 -->
                        <div id="card-container-4" class="perspective-1000 h-[340px] md:h-[300px] w-full cursor-pointer group">
                            <div class="card-inner w-full h-full relative">
                                <div class="card-face p-6 flex flex-col items-center justify-center border-2 border-slate-100 text-center type-card">
                                    <div class="absolute top-4 left-4"><span class="bg-blue-100 text-blue-800 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Nhận định 4</span></div>
                                    <i class="fa-solid fa-clock-rotate-left text-4xl text-blue-200 mb-4"></i>
                                    <h3 class="font-bold text-lg text-slate-800 mb-2">Mã OTP xác thực có hiệu lực vĩnh viễn.</h3>
                                    <p class="text-sm text-slate-500 mb-6">Theo bạn, nhận định này là:</p>
                                    <div class="flex gap-4 w-full px-4">
                                        <button onclick="flipCard(4, true)" class="flex-1 bg-green-50 text-green-700 py-2 rounded-lg font-bold border border-green-200 hover:bg-green-100 transition">ĐÚNG</button>
                                        <button onclick="flipCard(4, false)" class="flex-1 bg-red-50 text-red-700 py-2 rounded-lg font-bold border border-red-200 hover:bg-red-100 transition">SAI</button>
                                    </div>
                                </div>
                                <div class="card-face card-back"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB 3: THIẾT LẬP CẤU HÌNH -->
                <div id="tab-part3" class="tab-content hidden animate-fade-in-up">
                    <h2 class="text-xl font-bold text-blue-900 mb-4 border-l-4 border-blue-500 pl-3">3. Thiết lập Cấu hình</h2>
                    
                    <div class="mb-8 space-y-4">
                        <div class="flex items-end">
                            <div class="w-8 h-8 rounded-full bg-slate-300 flex items-center justify-center text-slate-600 mr-2 flex-shrink-0"><i class="fa-solid fa-user"></i></div>
                            <div class="chat-bubble chat-bubble-customer">Kết nối xong lỡ nó cứ tự động xuất lung tung thì sao em? Anh muốn kiểm soát được không?</div>
                        </div>
                        <div class="flex items-end justify-end">
                            <div class="chat-bubble chat-bubble-consultant">Anh yên tâm, anh hoàn toàn làm chủ việc này. Anh có thể tích chọn 'Tự động phát hành' hoặc không ngay ở bước Cấu hình ạ.</div>
                            <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white ml-2 flex-shrink-0"><img src="https://files.kiotviet.vn/recruit/2020/09/08/icon-kv.png" class="w-6 h-6 object-contain brightness-0 invert"></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Card 5 -->
                        <div id="card-container-5" class="perspective-1000 h-[340px] md:h-[300px] w-full cursor-pointer group">
                            <div class="card-inner w-full h-full relative">
                                <div class="card-face p-6 flex flex-col items-center justify-center border-2 border-slate-100 text-center type-card">
                                    <div class="absolute top-4 left-4"><span class="bg-blue-100 text-blue-800 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Nhận định 5</span></div>
                                    <i class="fa-solid fa-robot text-4xl text-blue-200 mb-4"></i>
                                    <h3 class="font-bold text-lg text-slate-800 mb-2">Hệ thống luôn mặc định tự động phát hành cho mọi đơn hàng.</h3>
                                    <p class="text-sm text-slate-500 mb-6">Theo bạn, nhận định này là:</p>
                                    <div class="flex gap-4 w-full px-4">
                                        <button onclick="flipCard(5, true)" class="flex-1 bg-green-50 text-green-700 py-2 rounded-lg font-bold border border-green-200 hover:bg-green-100 transition">ĐÚNG</button>
                                        <button onclick="flipCard(5, false)" class="flex-1 bg-red-50 text-red-700 py-2 rounded-lg font-bold border border-red-200 hover:bg-red-100 transition">SAI</button>
                                    </div>
                                </div>
                                <div class="card-face card-back"></div>
                            </div>
                        </div>

                        <!-- Card 6 -->
                        <div id="card-container-6" class="perspective-1000 h-[340px] md:h-[300px] w-full cursor-pointer group">
                            <div class="card-inner w-full h-full relative">
                                <div class="card-face p-6 flex flex-col items-center justify-center border-2 border-slate-100 text-center type-card">
                                    <div class="absolute top-4 left-4"><span class="bg-blue-100 text-blue-800 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Nhận định 6</span></div>
                                    <i class="fa-solid fa-file-invoice text-4xl text-blue-200 mb-4"></i>
                                    <h3 class="font-bold text-lg text-slate-800 mb-2">Mẫu hóa đơn là do hệ thống tự chọn ngẫu nhiên.</h3>
                                    <p class="text-sm text-slate-500 mb-6">Theo bạn, nhận định này là:</p>
                                    <div class="flex gap-4 w-full px-4">
                                        <button onclick="flipCard(6, true)" class="flex-1 bg-green-50 text-green-700 py-2 rounded-lg font-bold border border-green-200 hover:bg-green-100 transition">ĐÚNG</button>
                                        <button onclick="flipCard(6, false)" class="flex-1 bg-red-50 text-red-700 py-2 rounded-lg font-bold border border-red-200 hover:bg-red-100 transition">SAI</button>
                                    </div>
                                </div>
                                <div class="card-face card-back"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB 4: TÌNH HUỐNG NÂNG CAO -->
                <div id="tab-part4" class="tab-content hidden animate-fade-in-up">
                    <h2 class="text-xl font-bold text-blue-900 mb-4 border-l-4 border-blue-500 pl-3">4. Tình huống Nâng cao</h2>
                    
                    <div class="mb-8 space-y-4">
                        <div class="flex items-end">
                            <div class="w-8 h-8 rounded-full bg-slate-300 flex items-center justify-center text-slate-600 mr-2 flex-shrink-0"><i class="fa-solid fa-user"></i></div>
                            <div class="chat-bubble chat-bubble-customer">Hôm trước anh nhập MST vào nó báo 'Chưa có hồ sơ', anh tưởng lỗi nên thoát ra luôn.</div>
                        </div>
                        <div class="flex items-end justify-end">
                            <div class="chat-bubble chat-bubble-consultant">Lần sau anh đừng thoát nhé! Ngay tại thông báo đó có nút 'Tạo hồ sơ', anh bấm vào đó để đăng ký thông tin luôn là được ạ.</div>
                            <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white ml-2 flex-shrink-0"><img src="https://files.kiotviet.vn/recruit/2020/09/08/icon-kv.png" class="w-6 h-6 object-contain brightness-0 invert"></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Card 7 -->
                        <div id="card-container-7" class="perspective-1000 h-[340px] md:h-[300px] w-full cursor-pointer group">
                            <div class="card-inner w-full h-full relative">
                                <div class="card-face p-6 flex flex-col items-center justify-center border-2 border-slate-100 text-center type-card">
                                    <div class="absolute top-4 left-4"><span class="bg-blue-100 text-blue-800 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Nhận định 7</span></div>
                                    <i class="fa-solid fa-circle-exclamation text-4xl text-blue-200 mb-4"></i>
                                    <h3 class="font-bold text-lg text-slate-800 mb-2">Nếu báo "Chưa có hồ sơ", bạn không thể tiếp tục sử dụng.</h3>
                                    <p class="text-sm text-slate-500 mb-6">Theo bạn, nhận định này là:</p>
                                    <div class="flex gap-4 w-full px-4">
                                        <button onclick="flipCard(7, true)" class="flex-1 bg-green-50 text-green-700 py-2 rounded-lg font-bold border border-green-200 hover:bg-green-100 transition">ĐÚNG</button>
                                        <button onclick="flipCard(7, false)" class="flex-1 bg-red-50 text-red-700 py-2 rounded-lg font-bold border border-red-200 hover:bg-red-100 transition">SAI</button>
                                    </div>
                                </div>
                                <div class="card-face card-back"></div>
                            </div>
                        </div>

                        <!-- Card 8 -->
                        <div id="card-container-8" class="perspective-1000 h-[340px] md:h-[300px] w-full cursor-pointer group">
                            <div class="card-inner w-full h-full relative">
                                <div class="card-face p-6 flex flex-col items-center justify-center border-2 border-slate-100 text-center type-card">
                                    <div class="absolute top-4 left-4"><span class="bg-blue-100 text-blue-800 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Nhận định 8</span></div>
                                    <i class="fa-solid fa-link-slash text-4xl text-blue-200 mb-4"></i>
                                    <h3 class="font-bold text-lg text-slate-800 mb-2">Có thể tự do ngắt kết nối và đổi sang MST mới bất cứ lúc nào.</h3>
                                    <p class="text-sm text-slate-500 mb-6">Theo bạn, nhận định này là:</p>
                                    <div class="flex gap-4 w-full px-4">
                                        <button onclick="flipCard(8, true)" class="flex-1 bg-green-50 text-green-700 py-2 rounded-lg font-bold border border-green-200 hover:bg-green-100 transition">ĐÚNG</button>
                                        <button onclick="flipCard(8, false)" class="flex-1 bg-red-50 text-red-700 py-2 rounded-lg font-bold border border-red-200 hover:bg-red-100 transition">SAI</button>
                                    </div>
                                </div>
                                <div class="card-face card-back"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SUMMARY TAB -->
                <div id="tab-summary" class="tab-content hidden animate-fade-in-up">
                    <h2 class="text-xl font-bold text-blue-900 mb-6 border-l-4 border-blue-500 pl-3">Bảng so sánh: Lầm tưởng & Sự thật</h2>
                    <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                        <table class="w-full table-fixed border-collapse">
                            <thead>
                                <tr class="bg-slate-100 text-slate-600 text-sm uppercase tracking-wider">
                                    <th class="w-12 py-4 border-r border-slate-200 text-center">#</th>
                                    <th class="w-[45%] py-4 border-r border-slate-200 text-center text-red-600 bg-red-50/50">Lầm tưởng (Sai)</th>
                                    <th class="w-[45%] py-4 text-center text-green-600 bg-green-50/50">Sự thật (Đúng)</th>
                                </tr>
                            </thead>
                            <tbody id="summaryTableBody" class="text-sm"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Game & Certificate -->
                <div id="tab-game" class="tab-content hidden animate-fade-in-up">
                    <div id="game-start" class="text-center py-20 bg-white/60 backdrop-blur rounded-3xl border border-white/50 shadow-xl">
                        <div class="inline-block p-6 rounded-full bg-orange-100 mb-6 animate-bounce"><i class="fa-solid fa-gamepad text-5xl md:text-6xl text-orange-500"></i></div>
                        <h2 class="text-2xl md:text-3xl font-black text-slate-800 mb-4 tracking-tight">Quiz Game: Kết nối HĐĐT</h2>
                        <p class="text-slate-600 mb-6 max-w-lg mx-auto leading-relaxed text-sm md:text-base">Hệ thống sẽ hiển thị ngẫu nhiên các nhận định về quy trình kết nối Hóa đơn điện tử. <br><strong>Đạt 80% số câu để nhận Chứng chỉ.</strong></p>
                        <div class="mb-8 flex justify-center">
                            <input type="text" id="player-name" placeholder="Nhập tên của bạn để in lên Chứng chỉ..." class="px-5 py-3 rounded-lg border border-slate-300 w-full max-w-md focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-transparent text-center font-medium shadow-inner">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 max-w-3xl mx-auto px-4">
                            <button onclick="startGame('standard')" class="bg-white border border-blue-200 text-blue-700 px-4 py-3 rounded-lg font-bold hover:bg-blue-50 transition transform hover:scale-105 shadow-sm text-sm"><div class="text-base mb-1">Cơ bản</div><div class="text-xs font-normal text-slate-500">4 Câu hỏi ngẫu nhiên</div></button>
                            <button onclick="startGame('pro')" class="bg-white border border-purple-200 text-purple-700 px-4 py-3 rounded-lg font-bold hover:bg-purple-50 transition transform hover:scale-105 shadow-sm text-sm"><div class="text-base mb-1">Nâng cao</div><div class="text-xs font-normal text-slate-500">6 Câu hỏi ngẫu nhiên</div></button>
                            <button onclick="startGame('promax')" class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-4 py-3 rounded-lg font-bold shadow-lg hover:shadow-orange-200 hover:scale-105 transition transform border-2 border-white/20 text-sm"><div class="text-base mb-1" id="btn-promax-text">Toàn bộ</div><div class="text-xs font-normal text-white/80">Tất cả kiến thức</div></button>
                        </div>
                    </div>

                    <div id="game-playing" class="hidden max-w-3xl mx-auto py-10">
                        <div class="flex justify-between items-center mb-6 px-2">
                            <div class="text-slate-400 font-bold uppercase text-xs tracking-wider">Câu hỏi: <span id="q-progress" class="text-orange-600 text-base">1/10</span></div>
                            <div class="text-xs font-bold bg-white px-3 py-1.5 rounded-full border border-slate-200 shadow-sm text-slate-600">Điểm: <span id="current-score" class="text-green-600">0</span></div>
                        </div>
                        <div id="game-card" class="bg-white rounded-3xl shadow-xl p-8 md:p-10 min-h-[280px] md:min-h-[320px] flex items-center justify-center text-center border border-slate-100 mb-8 relative overflow-hidden transition-all"><div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-400 to-purple-400"></div><h3 id="question-text" class="text-xl md:text-3xl font-extrabold text-slate-800 leading-snug">Loading...</h3></div>
                        <div class="grid grid-cols-2 gap-4 md:gap-6">
                            <button onclick="answerGame(true)" class="py-4 md:py-6 rounded-2xl bg-white border-2 border-green-100 hover:border-green-500 hover:bg-green-50 text-green-600 font-bold text-lg md:text-2xl shadow-sm hover:shadow-lg transition-all transform active:scale-95 group"><i class="fa-solid fa-check-circle mb-1 block text-2xl md:text-3xl group-hover:scale-110 transition-transform"></i> ĐÚNG</button>
                            <button onclick="answerGame(false)" class="py-4 md:py-6 rounded-2xl bg-white border-2 border-red-100 hover:border-red-500 hover:bg-red-50 text-red-600 font-bold text-lg md:text-2xl shadow-sm hover:shadow-lg transition-all transform active:scale-95 group"><i class="fa-solid fa-times-circle mb-1 block text-2xl md:text-3xl group-hover:scale-110 transition-transform"></i> SAI</button>
                        </div>
                    </div>
                    
                    <!-- Result Screen -->
                    <div id="game-result" class="hidden flex flex-col items-center">
                        <div id="certificate" class="w-full max-w-4xl aspect-video bg-white shadow-2xl flex overflow-hidden certificate-container mx-auto">
                            <div class="w-1/3 bg-blue-900 flex flex-col items-center justify-center text-white p-6 relative">
                                <div class="mb-6"><i class="fa-solid fa-award text-6xl text-yellow-400"></i></div>
                                <div class="text-center z-10"><p class="uppercase tracking-widest text-[10px] opacity-70 mb-1">Cấp bởi</p><p class="font-bold text-sm leading-tight">KiotViet LND Department</p></div>
                                <div class="absolute bottom-0 left-0 w-full h-2 bg-green-500"></div><div class="absolute top-0 right-0 w-2 h-full bg-black/10"></div>
                            </div>
                            <div class="w-2/3 p-8 md:p-12 flex flex-col justify-center relative bg-white">
                                <div id="fail-watermark" class="watermark hidden">CHƯA ĐẠT</div>
                                <h1 class="text-3xl md:text-4xl font-black text-blue-900 uppercase mb-1 font-sans tracking-tight">GIẤY CHỨNG NHẬN</h1>
                                <p class="text-slate-500 italic text-sm mb-6 border-b border-slate-100 pb-4">Hoàn thành xuất sắc nội dung Đào tạo Sản phẩm</p>
                                <div class="space-y-1 mb-6"><p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider">Trao tặng cho:</p><h2 class="text-2xl md:text-3xl font-bold text-blue-700 uppercase leading-tight" id="certificate-name">HỌC VIÊN</h2></div>
                                <div class="space-y-1 mb-6"><p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider">Nội dung học phần:</p><h3 class="text-xl font-bold text-slate-800 uppercase">KẾT NỐI HÓA ĐƠN ĐIỆN TỬ</h3></div>
                                <div class="flex justify-between items-end mt-auto pt-4 border-t border-slate-100">
                                    <div><p class="text-[10px] text-slate-400 uppercase font-bold">Ngày hoàn thành</p><p class="text-sm font-medium text-slate-600" id="cert-date">dd/mm/yyyy</p></div>
                                    <div class="text-right"><p class="text-[10px] text-slate-400 uppercase font-bold">Kết quả</p><p class="text-xl font-black text-green-600" id="final-score-cert">100%</p></div>
                                </div>
                            </div>
                        </div>
                        <div id="fail-message-container" class="hidden mt-6 bg-red-50 px-6 py-4 rounded-xl border border-red-100 text-center">
                            <p class="text-red-600 font-bold"><i class="fa-solid fa-triangle-exclamation mr-2"></i>Chưa đạt yêu cầu nhận chứng nhận</p>
                            <p class="text-sm text-slate-600 mt-1">Hãy tham khảo lại nội dung và thử lại nhé!</p>
                        </div>
                        <div class="flex flex-col md:flex-row gap-4 mt-8 mb-12">
                            <button onclick="playAgain()" class="bg-white border-2 border-blue-600 text-blue-700 px-6 py-3 rounded-full font-bold shadow-sm hover:bg-blue-50 transition"><i class="fa-solid fa-rotate-right mr-2"></i> Làm lại bài thi</button>
                            <button onclick="switchTab('cheatsheet')" class="bg-white border border-slate-200 text-slate-700 px-6 py-3 rounded-full font-bold shadow hover:bg-slate-50 transition flex items-center justify-center gap-2"><i class="fa-solid fa-bolt text-yellow-500"></i> Xem Tóm tắt</button>
                            <button id="btn-download" onclick="downloadCertificate()" class="bg-blue-600 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-blue-700 transition hidden"><i class="fa-solid fa-download mr-2"></i> Tải chứng nhận</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        // DATA: MYTH-BUSTING (ĐÚNG NHẬN SAI CÃI)
        const lessonData = [
            {
                id: 1,
                questionText: "Dữ liệu bán hàng phải được nhập tay lại vào phần mềm HĐĐT sau khi bán xong.",
                isTrue: false,
                wrong: "Phải nhập liệu 2 lần trên 2 phần mềm (QLBH và HĐĐT) riêng biệt.",
                right: "Dữ liệu được đồng bộ hóa tức thì trên một nền tảng duy nhất ngay khi hoàn tất đơn hàng."
            },
            {
                id: 2,
                questionText: "Mỗi lần xuất hóa đơn bán lẻ đều bắt buộc phải cắm USB Token để ký số.",
                isTrue: false,
                wrong: "Bắt buộc ký số bằng USB Token cho từng hóa đơn lẻ.",
                right: "Hệ thống tối ưu hóa quy trình từ máy tính tiền, không yêu cầu ký số thủ công cho từng hóa đơn lẻ."
            },
            {
                id: 3,
                questionText: "Bất kỳ nhân viên nào cũng có thể tự ý thực hiện kết nối Hóa đơn điện tử.",
                isTrue: false,
                wrong: "Ai vào phần Thiết lập cũng có thể bấm kết nối được.",
                right: "Cần có mã OTP gửi về số điện thoại Chủ gian hàng để xác thực bảo mật trước khi kết nối."
            },
            {
                id: 4,
                questionText: "Mã OTP xác thực có hiệu lực vĩnh viễn.",
                isTrue: false,
                wrong: "Mã OTP dùng lúc nào cũng được, không bao giờ hết hạn.",
                right: "Mã OTP chỉ có hiệu lực trong 5 phút. Nếu quá hạn, bạn cần nhấn 'Gửi lại mã OTP'."
            },
            {
                id: 5,
                questionText: "Hệ thống sẽ mặc định tự động phát hành hóa đơn cho mọi đơn hàng ngay sau khi kết nối.",
                isTrue: false,
                wrong: "Cứ kết nối xong là máy tự động xuất hóa đơn hết, không kiểm soát được.",
                right: "Bạn có quyền tùy chọn bật/tắt tính năng 'Tự động phát hành' trong phần thiết lập cấu hình."
            },
            {
                id: 6,
                questionText: "Mẫu hóa đơn là do hệ thống tự chọn ngẫu nhiên.",
                isTrue: false,
                wrong: "Hệ thống tự gán mẫu nào dùng mẫu đó.",
                right: "Việc chọn Mẫu hóa đơn (Ví dụ: C26MHT) là thao tác bắt buộc do người dùng chọn khi thiết lập."
            },
            {
                id: 7,
                questionText: "Nếu nhập MST mà hệ thống báo 'Chưa có hồ sơ', bạn không thể tiếp tục sử dụng.",
                isTrue: false,
                wrong: "Báo lỗi chưa có hồ sơ thì phải dừng lại, không kết nối được.",
                right: "Bạn nhấn nút 'Tạo hồ sơ' ngay trên thông báo để được chuyển hướng sang trang đăng ký HĐĐT KiotViet."
            },
            {
                id: 8,
                questionText: "Có thể tự do ngắt kết nối và đổi sang Mã số thuế mới bất cứ lúc nào.",
                isTrue: false,
                wrong: "Thích đổi MST lúc nào cũng được, chỉ cần ngắt kết nối cũ đi.",
                right: "Nếu dữ liệu đã gắn với Sổ kế toán/Tờ khai cũ, bạn cần gọi 1900 6522 để được hỗ trợ chuyển đổi an toàn."
            }
        ];

        // LOGIC
        let gameQuestions = [], currentIndex = 0, score = 0, playerName = "HỌC VIÊN", completedCards = new Set();
        let isNavRendered = false;

        function toggleSidebar() { document.body.classList.toggle('sidebar-closed'); document.body.classList.toggle('sidebar-open'); }
        
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById('tab-' + tabId).classList.remove('hidden');
            document.querySelectorAll('.nav-link').forEach(el => { el.classList.remove('active', 'bg-blue-50', 'text-blue-900', 'border-blue-600'); el.classList.add('text-slate-700'); });
            const btn = document.getElementById('nav-' + tabId); if(btn) { btn.classList.add('active'); btn.classList.remove('text-slate-700'); }
            if(window.innerWidth < 768) { document.body.classList.add('sidebar-closed'); document.body.classList.remove('sidebar-open'); }
            document.getElementById('contentArea').scrollTop = 0;
            if(tabId === 'summary') renderSummary();
        }

        function renderNav() {
             if (isNavRendered) return;
             document.getElementById('btn-promax-text').innerText = `Toàn bộ (${lessonData.length} câu)`;
             isNavRendered = true;
        }

        function renderSummary() {
            const tbody = document.getElementById('summaryTableBody');
            tbody.innerHTML = lessonData.map((item, idx) => `
                <tr class="hover:bg-slate-50 border-b border-slate-50 last:border-0">
                    <td class="px-2 md:px-4 py-3 text-slate-400 font-bold text-center align-top">${idx+1}</td>
                    <td class="px-2 md:px-4 py-3 text-slate-600 bg-red-50/30 border-r border-slate-100 align-top">
                        <div class="flex items-start gap-2"><i class="fa-solid fa-xmark text-red-500 mt-1 flex-shrink-0"></i><span>${item.wrong}</span></div>
                    </td>
                    <td class="px-2 md:px-4 py-3 text-slate-800 bg-green-50/30 align-top font-medium">
                        <div class="flex items-start gap-2"><i class="fa-solid fa-check text-green-500 mt-1 flex-shrink-0"></i><span>${item.right}</span></div>
                    </td>
                </tr>
            `).join('');
        }

        function flipCard(id, choice) {
            const container = document.getElementById(`card-container-${id}`);
            const inner = container.querySelector('.card-inner');
            const backFace = container.querySelector('.card-back');
            const item = lessonData.find(i => i.id === id);
            
            // Check Correctness
            const isCorrect = (choice === item.isTrue);
            
            // Dynamic Result UI
            const resultHeader = isCorrect 
                ? '<div class="mb-2 font-bold text-lg text-green-600 animate-bounce"><i class="fa-solid fa-check-circle mr-1"></i> Chính xác!</div>' 
                : '<div class="mb-2 font-bold text-lg text-red-600 animate-pulse"><i class="fa-solid fa-times-circle mr-1"></i> Chưa chính xác!</div>';
            
            const badgeClass = item.isTrue ? 'bg-green-100 text-green-700 border-green-200' : 'bg-red-100 text-red-700 border-red-200';
            const badgeText = item.isTrue ? 'ĐÚNG' : 'SAI';
            const backBorderClass = isCorrect ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50';

            backFace.className = `card-face card-back p-4 border-2 flex flex-col justify-center rounded-2xl text-center ${backBorderClass}`;
            backFace.innerHTML = `
                <div class="flex flex-col h-full overflow-y-auto custom-scrollbar">
                    ${resultHeader}
                    <div class="text-xs text-slate-400 uppercase tracking-widest mb-1 font-bold">Nhận định...</div>
                    <p class="text-slate-700 font-medium text-sm mb-3 italic px-2">"${item.questionText}"</p>
                    <div class="mb-4"><span class="px-3 py-1 rounded-full text-xs font-bold border ${badgeClass}">${badgeText}</span></div>
                    <div class="bg-white p-3 rounded-lg border border-blue-100 shadow-sm text-left flex-1">
                        <p class="text-xs text-blue-600 font-bold uppercase mb-1"><i class="fa-solid fa-lightbulb mr-1"></i>Sự thật là:</p>
                        <p class="text-slate-700 text-sm leading-relaxed">${item.right}</p>
                    </div>
                    <button onclick="resetCard(${item.id})" class="mt-3 text-xs text-slate-400 underline hover:text-blue-600">Xem lại câu hỏi</button>
                </div>`;
            
            inner.classList.add('flipped');
            if (isCorrect) confetti({ particleCount: 50, spread: 60, origin: { y: 0.7 }, disableForReducedMotion: true });
            if (!completedCards.has(id)) { completedCards.add(id); updateProgress(); }
        }
        function resetCard(id) { document.getElementById(`card-container-${id}`).querySelector('.card-inner').classList.remove('flipped'); }
        function updateProgress() { document.getElementById('totalProgress').style.width = `${(completedCards.size / lessonData.length) * 100}%`; document.getElementById('completedCount').innerText = `${completedCards.size}/${lessonData.length}`; }

        // GAME ENGINE
        function startGame(mode) {
            const nameInput = document.getElementById('player-name').value;
            if(nameInput.trim() !== "") playerName = nameInput;
            
            let count = 4;
            if(mode === 'pro') count = 6;
            if(mode === 'promax') count = lessonData.length;

            // Shuffle
            gameQuestions = [...lessonData].sort(() => 0.5 - Math.random()).slice(0, count);
            currentIndex = 0;
            score = 0;
            
            document.getElementById('game-start').classList.add('hidden');
            document.getElementById('game-result').classList.add('hidden');
            document.getElementById('game-playing').classList.remove('hidden');
            loadGameQuestion();
        }

        function loadGameQuestion() {
            const item = gameQuestions[currentIndex];
            document.getElementById('q-progress').innerText = `${currentIndex + 1}/${gameQuestions.length}`;
            document.getElementById('current-score').innerText = score;
            const qText = document.getElementById('question-text');
            qText.style.opacity = 0;
            setTimeout(() => {
                qText.innerText = item.questionText;
                qText.style.opacity = 1;
            }, 200);
        }

        function answerGame(choice) {
            const item = gameQuestions[currentIndex];
            if(choice === item.isTrue) {
                score++;
                confetti({ particleCount: 30, spread: 50, origin: { y: 0.6 } });
            }
            
            currentIndex++;
            if(currentIndex < gameQuestions.length) {
                loadGameQuestion();
            } else {
                endGame();
            }
        }

        function endGame() {
            document.getElementById('game-playing').classList.add('hidden');
            document.getElementById('game-result').classList.remove('hidden');
            
            const percentage = Math.round((score / gameQuestions.length) * 100);
            const passed = percentage >= 80;
            
            document.getElementById('certificate-name').innerText = playerName;
            document.getElementById('cert-date').innerText = new Date().toLocaleDateString('vi-VN');
            document.getElementById('final-score-cert').innerText = `${percentage}%`;
            
            if(passed) {
                document.getElementById('fail-message-container').classList.add('hidden');
                document.getElementById('btn-download').classList.remove('hidden');
                document.getElementById('fail-watermark').classList.add('hidden');
                confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });
            } else {
                document.getElementById('fail-message-container').classList.remove('hidden');
                document.getElementById('btn-download').classList.add('hidden');
                document.getElementById('fail-watermark').classList.remove('hidden');
            }
        }

        function playAgain() {
            document.getElementById('game-result').classList.add('hidden');
            document.getElementById('game-start').classList.remove('hidden');
        }

        function downloadCertificate() {
            const cert = document.getElementById('certificate');
            html2canvas(cert, { scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = `ChungNhan_${playerName.replace(/\s+/g, '_')}.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        window.onload = function() { renderNav(); switchTab('cheatsheet'); }
    </script>
</body>
</html>
