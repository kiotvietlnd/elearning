<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Learning: Tờ khai thuế (Thông tư 40) - KiotViet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f9ff; overflow-x: hidden; }
        ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-thumb { background: #93c5fd; border-radius: 3px; }
        
        /* Background */
        .soft-glow-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -10; background: linear-gradient(135deg, #ffffff 0%, #e0f2fe 50%, #dcfce7 100%); }
        .soft-glow-background .shape { position: absolute; filter: blur(120px); opacity: 0.6; }
        .soft-glow-background .shape1 { height: 300px; width: 300px; background: #bae6fd; border-radius: 50%; top: -50px; left: -50px; animation: moveInCircle 25s ease-in-out infinite; }
        .soft-glow-background .shape2 { height: 350px; width: 350px; background: #bbf7d0; border-radius: 50%; bottom: -50px; right: -50px; animation: moveVertical 30s ease-in-out infinite; }
        @keyframes moveInCircle { 0% { transform: rotate(0deg); } 50% { transform: rotate(180deg); } 100% { transform: rotate(360deg); } }
        @keyframes moveVertical { 0% { transform: translateY(-20%); } 50% { transform: translateY(20%); } 100% { transform: translateY(-20%); } }

        /* UI Elements */
        .nav-link { transition: all 0.2s ease; border-left: 3px solid transparent; }
        .nav-link:hover { color: #2563eb; background: rgba(255, 255, 255, 0.6); }
        .nav-link.active { color: #1e3a8a; border-left: 3px solid #2563eb; background: #eff6ff; font-weight: 600; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }

        /* Card Flip */
        .perspective-1000 { perspective: 1000px; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s cubic-bezier(0.4, 0.0, 0.2, 1); transform-style: preserve-3d; }
        .card-inner.flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; top: 0; left: 0; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); background-color: white; }
        .card-back { transform: rotateY(180deg); }
        .type-card { transition: all 0.2s ease; }
        .type-card:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); border-color: #93c5fd; }

        /* Chat */
        .chat-bubble { max-width: 85%; padding: 0.75rem 1rem; border-radius: 1rem; position: relative; font-size: 0.9rem; line-height: 1.5; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .chat-bubble-customer { background-color: #ffffff; color: #334155; border-bottom-left-radius: 0.25rem; margin-left: 0; border: 1px solid #e2e8f0; }
        .chat-bubble-consultant { background-color: #dbeafe; color: #1e40af; border-bottom-right-radius: 0.25rem; margin-right: 0; border: 1px solid #bfdbfe; }
        
        /* Mobile Sidebar Overlay */
        #mobile-overlay { transition: opacity 0.3s ease; }
        #sidebar { transition: transform 0.3s ease; }
        .sidebar-open #sidebar { transform: translateX(0); }
        .sidebar-open #mobile-overlay { opacity: 1; pointer-events: auto; }
        .sidebar-closed #sidebar { transform: translateX(-100%); }
        .sidebar-closed #mobile-overlay { opacity: 0; pointer-events: none; }
        @media (min-width: 768px) { .sidebar-closed #sidebar { transform: translateX(0); } }

        /* Certificate */
        .certificate-container { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .watermark { position: absolute; top: 50%; left: 60%; transform: translate(-50%, -50%) rotate(-30deg); font-size: 6rem; font-weight: 900; color: rgba(200, 0, 0, 0.05); pointer-events: none; z-index: 0; }
        [title] { cursor: help; }
        
        /* Animation */
        .animate-fade-in-up { animation: fadeInUp 0.5s ease-out; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="text-slate-700 antialiased h-screen flex flex-col overflow-hidden sidebar-closed" id="app-body">
    <div class="soft-glow-background"><div class="shape shape1"></div><div class="shape shape2"></div></div>

    <!-- Header (Standardized) -->
    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-white/50 h-20 shadow-sm flex-shrink-0">
        <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 h-full">
            <div class="flex items-center justify-between h-full gap-4 lg:gap-8">
                <a href="https://kiotvietlnd.github.io/elearning/" class="flex-shrink-0 flex items-center gap-3 select-none hover:opacity-80 transition-opacity" title="Về trang chủ E-Learning">
                    <img src="https://logo.kiotviet.vn/KiotViet-Logo-Horizontal.svg" alt="KiotViet Logo" class="h-6 lg:h-8">
                    <span class="text-slate-300 font-light text-xl lg:text-2xl">|</span>
                    <span class="font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-700 to-green-700 tracking-tight text-base lg:text-lg uppercase">E-Learning</span>
                </a>

                <nav class="hidden lg:flex flex-1 justify-end items-center gap-4">
                    <a href="https://www.kiotviet.vn/ho-tro" target="_blank" class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-full font-bold text-sm shadow-md hover:bg-blue-700 hover:-translate-y-0.5 transition-all">
                        <i class="fa-solid fa-book-open-reader"></i> Kho Tài liệu HDSD
                    </a>
                    
                    <a href="https://www.youtube.com/@HDSDPhanmemKiotViet" target="_blank" class="flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-full font-bold text-sm shadow-md hover:bg-red-700 hover:-translate-y-0.5 transition-all">
                        <i class="fa-brands fa-youtube"></i> Kho Video HDSD
                    </a>

                    <a href="https://kiotvietlnd.github.io/elearning/thuehkd/" class="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-600 to-green-700 text-white rounded-full font-bold text-sm border border-blue-400 shadow-lg transform hover:scale-105 transition-all hover:shadow-green-500/30">
                        <i class="fa-solid fa-scale-balanced"></i> Cẩm nang Thuế HKD
                    </a>
                </nav>
                
                <div class="lg:hidden">
                    <!-- Mobile Menu Button with Toggle Logic -->
                    <button onclick="toggleSidebar()" class="text-slate-600 hover:text-green-700 text-2xl"><i class="fa-solid fa-bars"></i></button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="flex-1 flex overflow-hidden relative">
        <div id="mobile-overlay" class="fixed inset-0 bg-black/20 z-40 md:hidden" onclick="toggleSidebar()"></div>

        <!-- Sidebar -->
        <aside id="sidebar" class="absolute inset-y-0 left-0 z-50 w-72 bg-white/95 backdrop-blur-xl border-r border-white/60 shadow-2xl md:static md:bg-white/60 md:shadow-lg md:rounded-r-2xl flex flex-col transform transition-transform duration-300">
            <div class="p-5 border-b border-slate-100 flex-shrink-0">
                <div class="flex justify-between items-start mb-4 md:hidden">
                     <img src="https://logo.kiotviet.vn/KiotViet-Logo-Horizontal.svg" alt="Logo" class="h-5">
                     <button onclick="toggleSidebar()" class="text-slate-400"><i class="fa-solid fa-xmark text-xl"></i></button>
                </div>
                <h2 class="font-black text-blue-800 text-lg leading-tight mb-2 uppercase">TỜ KHAI THUẾ</h2>
                <h3 class="font-bold text-blue-900 text-sm uppercase tracking-wider mb-2">TIẾN ĐỘ HỌC TẬP</h3>
                <div class="w-full bg-slate-200 rounded-full h-1.5"><div id="totalProgress" class="bg-gradient-to-r from-blue-500 to-green-500 h-1.5 rounded-full transition-all duration-500" style="width: 0%"></div></div>
                <div class="flex justify-between mt-1 text-[10px] text-slate-500 font-medium"><span id="completedCount">0/0</span><span>Hoàn thành</span></div>
            </div>
            <nav class="flex-1 overflow-y-auto p-3 space-y-1 custom-scrollbar">
                 <button onclick="switchTab('cheatsheet')" id="nav-cheatsheet" class="nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3 active"><i class="fa-solid fa-bolt text-yellow-500 w-5 text-center"></i><span class="font-bold text-sm">Tóm tắt nhanh</span></button>
                 <div class="mt-4 mb-2 px-3 text-[10px] font-bold text-slate-400 uppercase">Nội dung</div>
                 
                 <!-- DYNAMIC NAV -->
                 <div id="dynamic-nav-container"></div>
                 
                 <div class="mt-4 mb-2 px-3 text-[10px] font-bold text-slate-400 uppercase">Ôn tập</div>
                 <button onclick="switchTab('summary')" id="nav-summary" class="nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3"><i class="fa-solid fa-table-columns text-purple-500 w-5 text-center"></i><span class="font-bold text-sm">Bảng so sánh</span></button>
                 <button onclick="switchTab('game')" id="nav-game" class="nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3"><i class="fa-solid fa-gamepad text-orange-500 w-5 text-center"></i><span class="font-bold text-sm">Quiz Game</span></button>
            </nav>
            <div class="p-4 bg-slate-50 border-t border-slate-100 text-center text-[10px] text-slate-400">© KiotViet Learning & Development Department</div>
        </aside>

        <!-- Content Area -->
        <main class="flex-1 overflow-y-auto scroll-smooth p-4 md:p-8" id="contentArea">
            <div class="max-w-5xl mx-auto pb-20" id="lessonContainer"> 
                <!-- CHEATSHEET CONTENT -->
                <div id="tab-cheatsheet" class="tab-content block animate-fade-in-up">
                    <div class="mb-8 text-center">
                         <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider border border-blue-200">Đào tạo Sản phẩm</span>
                        <h1 class="text-2xl md:text-3xl font-black text-blue-900 mt-4 leading-tight">TỜ KHAI THUẾ (THÔNG TƯ 40)</h1>
                        <p class="text-slate-500 mt-2 italic text-sm md:text-base">Dành cho Hộ kinh doanh phương pháp Kê khai</p>
                    </div>
                    
                    <!-- 3 Benefits -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition">
                            <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 mb-3"><i class="fa-solid fa-calculator"></i></div>
                            <h3 class="font-bold text-slate-800 mb-1">Tự động tính thuế</h3>
                            <p class="text-xs text-slate-500 leading-relaxed">Tổng hợp doanh thu từ HĐĐT, tự động tính số thuế GTGT & TNCN phải nộp.</p>
                        </div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition">
                            <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600 mb-3"><i class="fa-solid fa-file-invoice"></i></div>
                            <h3 class="font-bold text-slate-800 mb-1">Chuẩn mẫu TT40</h3>
                            <p class="text-xs text-slate-500 leading-relaxed">Xuất file XML chuẩn định dạng của Tổng cục Thuế, sẵn sàng nộp online.</p>
                        </div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition">
                            <div class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 mb-3"><i class="fa-solid fa-pen-to-square"></i></div>
                            <h3 class="font-bold text-slate-800 mb-1">Linh hoạt điều chỉnh</h3>
                            <p class="text-xs text-slate-500 leading-relaxed">Cho phép sửa số liệu thủ công hoặc nhập file Excel bổ sung trước khi chốt.</p>
                        </div>
                    </div>

                    <!-- Process Steps -->
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 md:p-8 mb-8">
                        <h3 class="font-bold text-xl text-blue-900 mb-6 flex items-center gap-2"><i class="fa-solid fa-list-check"></i> Quy trình Kê khai (4 Bước)</h3>
                        <div class="space-y-6 relative pl-2">
                            <!-- Connecting Line -->
                            <div class="absolute left-[11px] top-2 bottom-2 w-0.5 bg-slate-200"></div>

                            <div class="relative pl-8">
                                <div class="absolute left-0 top-1 w-6 h-6 bg-blue-600 rounded-full text-white text-xs flex items-center justify-center font-bold z-10">1</div>
                                <h4 class="font-bold text-sm text-slate-800">Thiết lập</h4>
                                <p class="text-xs text-slate-500 mt-1">Chọn Ngày bắt đầu & Kỳ kê khai (Tháng/Quý).</p>
                            </div>

                            <div class="relative pl-8">
                                <div class="absolute left-0 top-1 w-6 h-6 bg-blue-600 rounded-full text-white text-xs flex items-center justify-center font-bold z-10">2</div>
                                <h4 class="font-bold text-sm text-slate-800">Kiểm tra số liệu</h4>
                                <p class="text-xs text-slate-500 mt-1">Xem <b>Mẫu 01/CNKD</b> (Doanh thu/Thuế) & <b>Bảng kê 01-2</b> (Hàng hóa/Chi phí).</p>
                            </div>

                            <div class="relative pl-8">
                                <div class="absolute left-0 top-1 w-6 h-6 bg-blue-600 rounded-full text-white text-xs flex items-center justify-center font-bold z-10">3</div>
                                <h4 class="font-bold text-sm text-slate-800">Hoàn thiện & Điều chỉnh</h4>
                                <p class="text-xs text-slate-500 mt-1">Cập nhật thông tin pháp lý. Sửa số liệu (nếu cần).</p>
                            </div>

                            <div class="relative pl-8">
                                <div class="absolute left-0 top-1 w-6 h-6 bg-green-500 rounded-full text-white text-xs flex items-center justify-center font-bold z-10"><i class="fa-solid fa-download"></i></div>
                                <h4 class="font-bold text-sm text-slate-800">Kết xuất</h4>
                                <p class="text-xs text-slate-500 mt-1">Tải file <b>XML</b> (nộp online) hoặc <b>Excel</b> (lưu nội bộ).</p>
                            </div>
                        </div>
                    </div>

                    <!-- Notes -->
                    <div class="bg-amber-50 rounded-xl p-5 border border-amber-200">
                        <h4 class="font-bold text-amber-800 mb-3 text-sm uppercase"><i class="fa-solid fa-triangle-exclamation mr-1"></i> Lưu ý quan trọng</h4>
                        <ul class="list-disc list-inside text-sm text-amber-900 space-y-1">
                            <li><span class="font-bold">Nguồn doanh thu:</span> Chỉ tính từ đơn hàng <b>có xuất HĐĐT</b>. Không tính đơn sàn TMĐT (đã nộp thay).</li>
                            <li><span class="font-bold">Chỉnh sửa:</span> Sửa thủ công xong sẽ <b>ngừng tự động cập nhật</b>. Muốn tự động lại nhấn "Lấy lại số liệu".</li>
                            <li><span class="font-bold">Tồn kho:</span> Tuyệt đối không để tồn kho bị <b>ÂM</b> trong Bảng kê.</li>
                        </ul>
                    </div>
                </div>

                <!-- DYNAMIC TABS -->

                <!-- SUMMARY TAB -->
                <div id="tab-summary" class="tab-content hidden animate-fade-in-up">
                    <h2 class="text-xl font-bold text-blue-900 mb-6 border-l-4 border-blue-500 pl-3">Bảng so sánh: Lầm tưởng & Sự thật</h2>
                    <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                        <table class="w-full table-fixed border-collapse">
                            <thead>
                                <tr class="bg-slate-100 text-slate-600 text-sm uppercase tracking-wider">
                                    <th class="w-12 py-4 border-r border-slate-200 text-center">#</th>
                                    <th class="w-[45%] py-4 border-r border-slate-200 text-center text-red-600 bg-red-50/50">Lầm tưởng (Sai)</th>
                                    <th class="w-[45%] py-4 text-center text-green-600 bg-green-50/50">Sự thật (Đúng)</th>
                                </tr>
                            </thead>
                            <tbody id="summaryTableBody" class="text-sm"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Game & Certificate -->
                <div id="tab-game" class="tab-content hidden animate-fade-in-up">
                    <!-- Start Screen -->
                    <div id="game-start" class="text-center py-10 md:py-20 bg-white/60 backdrop-blur rounded-3xl border border-white/50 shadow-xl">
                        <div class="inline-block p-6 rounded-full bg-orange-100 mb-6 animate-bounce"><i class="fa-solid fa-gamepad text-5xl md:text-6xl text-orange-500"></i></div>
                        <h2 class="text-2xl md:text-3xl font-black text-slate-800 mb-4 tracking-tight">Quiz Game: Tờ Khai Thuế</h2>
                        <p class="text-slate-600 mb-6 max-w-lg mx-auto leading-relaxed text-sm md:text-base">Hệ thống sẽ hiển thị ngẫu nhiên các nhận định. Nhiệm vụ của bạn là xác định nó ĐÚNG hay SAI. <br><strong>Đạt 80% số câu để nhận Chứng chỉ.</strong></p>
                        <div class="mb-8 flex justify-center">
                            <input type="text" id="player-name" placeholder="Nhập Họ và tên - Phòng ban" class="px-5 py-3 rounded-lg border border-slate-300 w-full max-w-md focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-transparent text-center font-medium shadow-inner">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 max-w-3xl mx-auto px-4">
                            <button onclick="startGame('standard')" class="bg-white border border-blue-200 text-blue-700 px-4 py-3 rounded-lg font-bold hover:bg-blue-50 transition transform hover:scale-105 shadow-sm text-sm"><div class="text-base mb-1">Tiêu Chuẩn</div><div class="text-xs font-normal text-slate-500">4 Câu hỏi ngẫu nhiên</div></button>
                            <button onclick="startGame('pro')" class="bg-white border border-purple-200 text-purple-700 px-4 py-3 rounded-lg font-bold hover:bg-purple-50 transition transform hover:scale-105 shadow-sm text-sm"><div class="text-base mb-1">Pro</div><div class="text-xs font-normal text-slate-500">5 Câu hỏi ngẫu nhiên</div></button>
                            <button onclick="startGame('promax')" class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-4 py-3 rounded-lg font-bold shadow-lg hover:shadow-orange-200 hover:scale-105 transition transform border-2 border-white/20 text-sm"><div class="text-base mb-1" id="btn-promax-text">Promax (Full)</div><div class="text-xs font-normal text-white/80">Toàn bộ câu hỏi</div></button>
                        </div>
                    </div>

                    <!-- Playing Screen -->
                    <div id="game-playing" class="hidden max-w-2xl mx-auto py-6">
                        <div class="flex justify-between items-center mb-6 px-2">
                            <div class="text-slate-400 font-bold uppercase text-xs tracking-wider">Câu hỏi: <span id="q-progress" class="text-orange-600 text-base">1/10</span></div>
                            <div class="text-xs font-bold bg-white px-3 py-1.5 rounded-full border border-slate-200 shadow-sm text-slate-600">Score: <span id="current-score" class="text-green-600">0</span></div>
                        </div>
                        <div id="game-card" class="bg-white rounded-3xl shadow-xl p-6 min-h-[220px] flex items-center justify-center text-center border border-slate-100 mb-6 relative overflow-hidden transition-all">
                            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-400 to-purple-400"></div>
                            <h3 id="question-text" class="text-lg md:text-xl font-extrabold text-slate-800 leading-snug">Loading...</h3>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <button onclick="answerGame(true)" class="py-3 md:py-4 rounded-2xl bg-white border-2 border-green-100 hover:border-green-500 hover:bg-green-50 text-green-600 font-bold text-base md:text-xl shadow-sm hover:shadow-lg transition-all transform active:scale-95 group"><i class="fa-solid fa-check-circle mb-1 block text-xl md:text-2xl group-hover:scale-110 transition-transform"></i> ĐÚNG</button>
                            <button onclick="answerGame(false)" class="py-3 md:py-4 rounded-2xl bg-white border-2 border-red-100 hover:border-red-500 hover:bg-red-50 text-red-600 font-bold text-base md:text-xl shadow-sm hover:shadow-lg transition-all transform active:scale-95 group"><i class="fa-solid fa-times-circle mb-1 block text-xl md:text-2xl group-hover:scale-110 transition-transform"></i> SAI</button>
                        </div>
                    </div>
                    
                    <!-- Result Screen -->
                    <div id="game-result" class="hidden flex flex-col items-center">
                        <div id="certificate" class="w-full max-w-4xl aspect-video bg-white shadow-2xl flex overflow-hidden certificate-container mx-auto">
                            <div class="w-1/3 bg-blue-900 flex flex-col items-center justify-center text-white p-6 relative">
                                <div class="mb-6"><i class="fa-solid fa-award text-6xl text-yellow-400"></i></div>
                                <div class="text-center z-10"><p class="uppercase tracking-widest text-[10px] opacity-70 mb-1">Cấp bởi</p><p class="font-bold text-sm leading-tight">KiotViet LND Department</p></div>
                                <div class="absolute bottom-0 left-0 w-full h-2 bg-green-500"></div><div class="absolute top-0 right-0 w-2 h-full bg-black/10"></div>
                            </div>
                            <div class="w-2/3 p-8 md:p-12 flex flex-col justify-center relative bg-white">
                                <div id="fail-watermark" class="watermark hidden">SAMPLE</div>
                                <h1 class="text-3xl md:text-4xl font-black text-blue-900 uppercase mb-1 font-sans tracking-tight">GIẤY CHỨNG NHẬN</h1>
                                <p class="text-slate-500 italic text-sm mb-6 border-b border-slate-100 pb-4">Hoàn thành xuất sắc nội dung Đào tạo Sản phẩm</p>
                                <div class="space-y-1 mb-6"><p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider">Trao tặng cho:</p><h2 class="text-2xl md:text-3xl font-bold text-blue-700 uppercase leading-tight" id="certificate-name">TÊN HỌC VIÊN</h2></div>
                                <div class="space-y-1 mb-6"><p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider">Nội dung học phần:</p><h3 class="text-xl font-bold text-slate-800 uppercase">TỜ KHAI THUẾ</h3></div>
                                <div class="flex justify-between items-end mt-auto pt-4 border-t border-slate-100">
                                    <div><p class="text-[10px] text-slate-400 uppercase font-bold">Ngày hoàn thành</p><p class="text-sm font-medium text-slate-600" id="cert-date">dd/mm/yyyy</p></div>
                                    <div class="text-right"><p class="text-[10px] text-slate-400 uppercase font-bold">Kết quả</p><p class="text-xl font-black text-green-600" id="final-score-cert">100%</p></div>
                                </div>
                            </div>
                        </div>
                        <div id="fail-message-container" class="hidden mt-6 bg-red-50 px-6 py-4 rounded-xl border border-red-100 text-center">
                            <p class="text-red-600 font-bold"><i class="fa-solid fa-triangle-exclamation mr-2"></i>Chưa đạt yêu cầu nhận chứng nhận</p>
                            <p class="text-sm text-slate-600 mt-1">Hãy tham khảo lại nội dung và thử lại nhé!</p>
                        </div>
                        <div class="flex flex-wrap justify-center gap-4 mt-8 mb-12">
                            <button onclick="playAgain()" class="bg-white border-2 border-blue-600 text-blue-700 px-6 py-3 rounded-full font-bold shadow-sm hover:bg-blue-50 transition"><i class="fa-solid fa-rotate-right mr-2"></i> Chơi lại</button>
                            <button onclick="switchTab('cheatsheet')" class="bg-white border border-slate-200 text-slate-700 px-6 py-3 rounded-full font-bold shadow hover:bg-slate-50 transition flex items-center gap-2"><i class="fa-solid fa-bolt text-yellow-500"></i> Xem Tóm tắt</button>
                            <button onclick="switchTab('summary')" class="bg-white border border-slate-200 text-slate-700 px-6 py-3 rounded-full font-bold shadow hover:bg-slate-50 transition flex items-center gap-2"><i class="fa-solid fa-table-columns text-purple-500"></i> Xem So sánh</button>
                            <button id="btn-download" onclick="downloadCertificate()" class="bg-blue-600 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-blue-700 transition hidden"><i class="fa-solid fa-download mr-2"></i> Tải chứng nhận</button>
                        </div>
                        <!-- Result Review -->
                        <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden w-full">
                            <h3 class="text-xl font-bold text-blue-900 px-6 py-4 bg-slate-50 border-b border-slate-100">Chi tiết kết quả</h3>
                            <table class="min-w-full divide-y divide-slate-100">
                                <thead class="bg-white">
                                    <tr>
                                        <th class="px-6 py-4 text-center text-xs font-bold text-slate-500 uppercase">Câu hỏi</th>
                                        <th class="px-6 py-4 text-center text-xs font-bold text-slate-500 uppercase w-32">Bạn chọn</th>
                                        <th class="px-6 py-4 text-center text-xs font-bold text-slate-500 uppercase w-40">Kết quả</th>
                                    </tr>
                                </thead>
                                <tbody id="review-body" class="bg-white divide-y divide-slate-100 text-sm"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        // DATA
        const lessonData = [
            // PART 1
            {
                id: 1, tabId: 'part1', tabName: 'Cơ chế Tự động',
                questionText: "Doanh thu tính thuế trên Tờ khai bao gồm tất cả các đơn hàng bán ra trên phần mềm, bất kể đã xuất hóa đơn hay chưa.",
                isTrue: false,
                wrong: "Doanh thu tính thuế trên Tờ khai bao gồm tất cả các đơn hàng bán ra trên phần mềm, bất kể đã xuất hóa đơn hay chưa.",
                right: "Hệ thống chỉ tổng hợp và tính thuế dựa trên doanh thu của các giao dịch đã được phát hành hóa đơn điện tử thành công."
            },
            {
                id: 2, tabId: 'part1', tabName: 'Cơ chế Tự động',
                questionText: "Doanh thu từ các sàn TMĐT (Shopee, TikTok...) luôn được cộng gộp vào tờ khai thuế của hộ kinh doanh.",
                isTrue: true,
                wrong: "Doanh thu từ các sàn TMĐT (Shopee, TikTok...) luôn được cộng gộp vào tờ khai thuế của hộ kinh doanh.",
                right: "Doanh thu từ sàn TMĐT có chức năng thanh toán (đã nộp thuế thay) sẽ được hệ thống loại trừ khỏi doanh thu chịu thuế GTGT và TNCN."
            },
            // PART 2
            {
                id: 3, tabId: 'part2', tabName: 'Kiểm tra & Điều chỉnh',
                questionText: "Dữ liệu trên Tờ khai thuế là cố định từ phần mềm, người dùng không thể chỉnh sửa hay thêm bớt các khoản thu chi ngoài hệ thống.",
                isTrue: false,
                wrong: "Dữ liệu trên Tờ khai thuế là cố định từ phần mềm, người dùng không thể chỉnh sửa hay thêm bớt các khoản thu chi ngoài hệ thống.",
                right: "Bạn hoàn toàn có thể sử dụng chức năng \"Chỉnh sửa\" để thay đổi số liệu thủ công hoặc nhập file Excel để bổ sung dữ liệu."
            },
            {
                id: 4, tabId: 'part2', tabName: 'Kiểm tra & Điều chỉnh',
                questionText: "Sau khi chỉnh sửa thủ công và lưu lại, nếu có đơn hàng mới phát sinh, hệ thống vẫn sẽ tiếp tục cộng dồn vào tờ khai đó.",
                isTrue: true,
                wrong: "Sau khi chỉnh sửa thủ công và lưu lại, nếu có đơn hàng mới phát sinh, hệ thống vẫn sẽ tiếp tục cộng dồn vào tờ khai đó.",
                right: "Khi đã can thiệp sửa thủ công, tờ khai sẽ ngừng tự động cập nhật. Muốn đồng bộ lại, bạn phải nhấn nút \"Lấy lại số liệu theo sổ kế toán\"."
            },
            // PART 3
            {
                id: 5, tabId: 'part3', tabName: 'Kết xuất & Nộp',
                questionText: "Để nộp tờ khai online, chủ cửa hàng phải tự nhập lại từng con số từ phần mềm KiotViet sang trang web của Tổng cục Thuế.",
                isTrue: false,
                wrong: "Để nộp tờ khai online, chủ cửa hàng phải tự nhập lại từng con số từ phần mềm KiotViet sang trang web của Tổng cục Thuế.",
                right: "KiotViet hỗ trợ xuất khẩu file XML chuẩn định dạng, bạn chỉ cần tải về và nộp trực tiếp lên trang Thuế điện tử mà không cần nhập tay."
            },
            {
                id: 6, tabId: 'part3', tabName: 'Kết xuất & Nộp',
                questionText: "Trong Bảng kê hàng hóa, số liệu tồn kho bị âm cũng không sao, miễn là tổng giá trị hàng hóa dương là được.",
                isTrue: false,
                wrong: "Trong Bảng kê hàng hóa, số liệu tồn kho bị âm cũng không sao, miễn là tổng giá trị hàng hóa dương là được.",
                right: "Theo quy định kế toán, số lượng và giá trị tồn kho không được phép âm. Bạn bắt buộc phải kiểm tra và điều chỉnh lại trước khi nộp."
            }
        ];

        // LOGIC
        let gameQuestions = [], currentIndex = 0, score = 0, playerName = "HỌC VIÊN", completedCards = new Set();
        let isNavRendered = false;

        function toggleSidebar() { document.body.classList.toggle('sidebar-closed'); document.body.classList.toggle('sidebar-open'); }
        
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById('tab-' + tabId).classList.remove('hidden');
            document.querySelectorAll('.nav-link').forEach(el => { el.classList.remove('active', 'bg-blue-50', 'text-blue-900', 'border-blue-600'); el.classList.add('text-slate-700'); });
            const btn = document.getElementById('nav-' + tabId); if(btn) { btn.classList.add('active'); btn.classList.remove('text-slate-700'); }
            if(window.innerWidth < 768) { document.body.classList.add('sidebar-closed'); document.body.classList.remove('sidebar-open'); }
            document.getElementById('contentArea').scrollTop = 0;
            if(tabId === 'summary') renderSummary();
        }

        // RENDER FUNCTIONS
        function renderNav() {
            if (isNavRendered) return;
            const container = document.getElementById('dynamic-nav-container');
            const tabs = [...new Set(lessonData.map(i => JSON.stringify({id: i.tabId, name: i.tabName})))].map(s => JSON.parse(s));
            
            tabs.forEach(tab => {
                const btn = document.createElement('button');
                btn.className = 'nav-link w-full text-left px-3 py-3 rounded-lg flex items-center gap-3 text-slate-700';
                btn.id = `nav-${tab.id}`;
                btn.onclick = () => switchTab(tab.id);
                btn.innerHTML = `<i class="fa-solid fa-book-open text-blue-400 w-5 text-center"></i><span class="font-bold text-sm">${tab.name}</span>`;
                container.appendChild(btn);
            });
            document.getElementById('btn-promax-text').innerText = `Promax (${lessonData.length} câu)`;
            isNavRendered = true;
        }

        function renderCards() {
            const tabs = [...new Set(lessonData.map(item => item.tabId))];
            const container = document.getElementById('lessonContainer');
            const insertPoint = document.getElementById('tab-summary');

            tabs.forEach(tabId => {
                const tabData = lessonData.filter(i => i.tabId === tabId);
                const div = document.createElement('div');
                div.id = `tab-${tabId}`;
                div.className = 'tab-content hidden animate-fade-in-up';
                
                // Chat Logic
                let chatHTML = '';
                if(tabId === 'part1') {
                     chatHTML = `
                     <div class="mb-8 space-y-4">
                        <div class="flex items-start">
                            <div class="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-slate-500 flex-shrink-0 mt-1"><i class="fa-solid fa-user"></i></div>
                            <div class="chat-bubble chat-bubble-customer">Anh bán hàng trên KiotViet thì phần mềm có tự tính được anh phải đóng bao nhiêu thuế tháng này không?</div>
                        </div>
                        <div class="flex items-start justify-end">
                            <div class="chat-bubble chat-bubble-consultant">Có ạ. Hệ thống cộng tổng doanh thu <b>đã xuất HĐĐT</b>, rồi nhân với <b>% thuế suất</b> để ra số thuế phải nộp anh nhé.</div>
                            <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 flex-shrink-0 mt-1 ml-2"><i class="fa-solid fa-headset"></i></div>
                        </div>
                     </div>`;
                } else if(tabId === 'part2') {
                    chatHTML = `
                     <div class="mb-8 space-y-4">
                        <div class="flex items-start">
                            <div class="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-slate-500 flex-shrink-0 mt-1"><i class="fa-solid fa-user"></i></div>
                            <div class="chat-bubble chat-bubble-customer">Chị muốn sửa lại số liệu tồn kho trong Bảng kê vì thực tế khác phần mềm. Sửa xong thì dữ liệu có tự nhảy nữa không?</div>
                        </div>
                        <div class="flex items-start justify-end">
                            <div class="chat-bubble chat-bubble-consultant">Chị sửa được ạ. Nhưng sau khi sửa, tờ khai sẽ <b>ngừng tự động cập nhật</b>. Muốn tự động lại, chị phải nhấn nút <b>'Lấy lại số liệu'</b> nhé.</div>
                            <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 flex-shrink-0 mt-1 ml-2"><i class="fa-solid fa-headset"></i></div>
                        </div>
                     </div>`;
                } else if(tabId === 'part3') {
                     chatHTML = `
                     <div class="mb-8 space-y-4">
                        <div class="flex items-start">
                            <div class="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-slate-500 flex-shrink-0 mt-1"><i class="fa-solid fa-user"></i></div>
                            <div class="chat-bubble chat-bubble-customer">Xong xuôi hết rồi, giờ anh nộp tờ khai cho bên Thuế kiểu gì? In ra giấy mang lên chi cục à?</div>
                        </div>
                        <div class="flex items-start justify-end">
                            <div class="chat-bubble chat-bubble-consultant">Không cần đâu anh. Anh tải file <b>XML</b> từ phần mềm về, rồi đăng nhập trang Thuế điện tử nộp online là xong ngay ạ.</div>
                            <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 flex-shrink-0 mt-1 ml-2"><i class="fa-solid fa-headset"></i></div>
                        </div>
                     </div>`;
                }

                // Grid
                const grid = document.createElement('div');
                grid.className = 'grid grid-cols-1 md:grid-cols-2 gap-6';
                
                tabData.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'type-card h-80 perspective-1000 cursor-pointer group';
                    card.id = `card-container-${item.id}`;
                    card.innerHTML = `
                        <div class="card-inner relative w-full h-full duration-500">
                            <!-- Front -->
                            <div class="card-face p-6 flex flex-col justify-between items-center border-2 border-slate-100 group-hover:border-blue-200">
                                <div class="w-12 h-12 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center text-xl mb-4 font-bold shadow-sm">${item.id}</div>
                                <h3 class="text-lg font-bold text-center text-slate-700 flex-1 flex items-center justify-center leading-snug px-2">"${item.questionText}"</h3>
                                <p class="text-xs text-slate-400 mt-4 font-semibold uppercase tracking-wider">Chọn đáp án của bạn</p>
                                <div class="flex gap-3 w-full mt-3">
                                    <button onclick="flipCard(${item.id}, true)" class="flex-1 py-2 rounded-lg border border-green-200 text-green-700 font-bold hover:bg-green-50 transition">ĐÚNG</button>
                                    <button onclick="flipCard(${item.id}, false)" class="flex-1 py-2 rounded-lg border border-red-200 text-red-700 font-bold hover:bg-red-50 transition">SAI</button>
                                </div>
                            </div>
                            <!-- Back -->
                            <div class="card-back"></div>
                        </div>`;
                    grid.appendChild(card);
                });

                div.innerHTML = `<h2 class="text-xl md:text-2xl font-black text-blue-900 mb-6 border-l-4 border-blue-600 pl-4 uppercase">${tabData[0].tabName}</h2>` + chatHTML;
                div.appendChild(grid);
                container.insertBefore(div, insertPoint);
            });
        }

        function renderSummary() {
            const tbody = document.getElementById('summaryTableBody');
            tbody.innerHTML = lessonData.map((item, idx) => `
                <tr class="hover:bg-slate-50 border-b border-slate-50 last:border-0">
                    <td class="px-2 py-3 text-slate-400 font-bold text-center align-top">${idx+1}</td>
                    <td class="px-4 py-3 text-slate-600 bg-red-50/30 border-r border-slate-100 align-top">
                        <div class="flex gap-2"><i class="fa-solid fa-xmark text-red-500 mt-1 flex-shrink-0"></i><span class="text-sm">${item.wrong}</span></div>
                    </td>
                    <td class="px-4 py-3 text-slate-800 bg-green-50/30 align-top font-medium">
                        <div class="flex gap-2"><i class="fa-solid fa-check text-green-500 mt-1 flex-shrink-0"></i><span class="text-sm">${item.right}</span></div>
                    </td>
                </tr>
            `).join('');
        }

        // CARD INTERACTION
        function flipCard(id, choice) {
            const container = document.getElementById(`card-container-${id}`);
            const inner = container.querySelector('.card-inner');
            const backFace = container.querySelector('.card-back');
            const item = lessonData.find(i => i.id === id);
            
            const isCorrect = (choice === item.isTrue);
            
            // Build Back Face Content
            const resultHeader = isCorrect 
                ? '<div class="mb-2 font-bold text-lg text-green-600 flex items-center justify-center gap-2"><i class="fa-solid fa-check-circle"></i> Chính xác!</div>' 
                : '<div class="mb-2 font-bold text-lg text-red-600 flex items-center justify-center gap-2"><i class="fa-solid fa-times-circle"></i> Chưa chính xác!</div>';
            
            const badgeClass = item.isTrue ? 'bg-green-100 text-green-700 border-green-200' : 'bg-red-100 text-red-700 border-red-200';
            const badgeText = item.isTrue ? 'MỆNH ĐỀ ĐÚNG' : 'MỆNH ĐỀ SAI';
            const backBorderClass = isCorrect ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50';

            backFace.className = `card-face card-back p-5 border-2 flex flex-col rounded-2xl text-center ${backBorderClass}`;
            backFace.innerHTML = `
                <div class="flex flex-col h-full overflow-y-auto custom-scrollbar">
                    ${resultHeader}
                    <div class="mb-4"><span class="px-3 py-1 rounded-full text-[10px] font-bold border ${badgeClass}">${badgeText}</span></div>
                    <div class="bg-white p-4 rounded-xl border border-blue-100 shadow-sm text-left flex-1">
                        <p class="text-xs text-blue-600 font-bold uppercase mb-2 flex items-center gap-2"><i class="fa-solid fa-lightbulb"></i> Sự thật là:</p>
                        <p class="text-slate-700 text-sm leading-relaxed font-medium">${item.right}</p>
                    </div>
                    <button onclick="resetCard(${item.id})" class="mt-4 text-xs text-slate-400 font-bold hover:text-blue-600 uppercase tracking-wider flex items-center justify-center gap-1"><i class="fa-solid fa-rotate-left"></i> Xem lại câu hỏi</button>
                </div>`;
            
            inner.classList.add('flipped');
            if (!completedCards.has(id)) { completedCards.add(id); updateProgress(); }
        }

        function resetCard(id) { document.getElementById(`card-container-${id}`).querySelector('.card-inner').classList.remove('flipped'); }
        function updateProgress() { 
            const pct = Math.round((completedCards.size / lessonData.length) * 100);
            document.getElementById('totalProgress').style.width = `${pct}%`; 
            document.getElementById('completedCount').innerText = `${completedCards.size}/${lessonData.length}`; 
        }

        // GAME LOGIC
        function startGame(mode) {
            const nameInput = document.getElementById('player-name').value.trim();
            if(!nameInput) { alert("Vui lòng nhập tên của bạn!"); return; }
            playerName = nameInput;

            let count = mode === 'standard' ? 4 : (mode === 'pro' ? 5 : lessonData.length);
            // Shuffle and pick
            gameQuestions = [...lessonData].sort(() => 0.5 - Math.random()).slice(0, count);
            
            currentIndex = 0; score = 0;
            document.getElementById('game-start').classList.add('hidden');
            document.getElementById('game-playing').classList.remove('hidden');
            loadGameQuestion();
        }

        function loadGameQuestion() {
            const q = gameQuestions[currentIndex];
            document.getElementById('q-progress').innerText = `${currentIndex + 1}/${gameQuestions.length}`;
            document.getElementById('current-score').innerText = score;
            document.getElementById('question-text').innerText = q.questionText;
        }

        function answerGame(choice) {
            const q = gameQuestions[currentIndex];
            const isCorrect = (choice === q.isTrue);
            if(isCorrect) score++;
            
            // Record result for review
            q.userChoice = choice;
            q.isCorrect = isCorrect;

            currentIndex++;
            if(currentIndex < gameQuestions.length) {
                loadGameQuestion();
            } else {
                endGame();
            }
        }

        function endGame() {
            document.getElementById('game-playing').classList.add('hidden');
            document.getElementById('game-result').classList.remove('hidden');
            
            const pct = Math.round((score / gameQuestions.length) * 100);
            const passed = pct >= 80;
            const dateStr = new Date().toLocaleDateString('vi-VN');

            document.getElementById('certificate-name').innerText = playerName;
            document.getElementById('cert-date').innerText = dateStr;
            document.getElementById('final-score-cert').innerText = `${pct}%`;

            if(passed) {
                document.getElementById('fail-watermark').classList.add('hidden');
                document.getElementById('btn-download').classList.remove('hidden');
                document.getElementById('fail-message-container').classList.add('hidden');
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            } else {
                document.getElementById('fail-watermark').classList.remove('hidden');
                document.getElementById('btn-download').classList.add('hidden');
                document.getElementById('fail-message-container').classList.remove('hidden');
            }

            // Render Review Table
            const reviewBody = document.getElementById('review-body');
            reviewBody.innerHTML = gameQuestions.map(q => `
                <tr>
                    <td class="px-6 py-4 text-slate-700 text-xs">${q.questionText}</td>
                    <td class="px-6 py-4 text-center text-xs font-bold ${q.userChoice ? 'text-green-600' : 'text-red-600'}">${q.userChoice ? 'ĐÚNG' : 'SAI'}</td>
                    <td class="px-6 py-4 text-center">
                        ${q.isCorrect 
                            ? '<span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-[10px] font-bold">Chính xác</span>' 
                            : '<span class="px-2 py-1 bg-red-100 text-red-700 rounded-full text-[10px] font-bold">Sai</span>'}
                    </td>
                </tr>
            `).join('');
        }

        function playAgain() {
            document.getElementById('game-result').classList.add('hidden');
            document.getElementById('game-start').classList.remove('hidden');
        }

        function downloadCertificate() {
            const certNode = document.getElementById('certificate');
            html2canvas(certNode, { scale: 2, useCORS: true }).then(canvas => {
                const link = document.createElement('a');
                link.download = `ChungNhan_${playerName.replace(/\s/g,'_')}.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        // INIT
        window.onload = function() {
            renderNav();
            switchTab('cheatsheet');
            renderCards();
        }
    </script>
</body>
</html>
